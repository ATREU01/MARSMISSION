import{dA as M,d5 as x,d6 as D,d7 as U,d9 as m,dq as I,dw as f,d4 as E,ex as v,dr as N,db as c,dJ as O}from"./index-3CuyeEXd.js";import{a as k}from"./shouldProceedtoEmbeddedWalletCreationFlow-BI33jNSF-Z46tsNNc.js";import{n as j}from"./ScreenLayout-CNho46nP-CTPC5QKU.js";import{c as F}from"./telegram-B-JqnkqZ-BRJuLGif.js";import"./Button-BCV6mjvS-BmN5ircB.js";import"./Screen-_0H_rCdH-BGlXeOcw.js";import"./ModalHeader-BTru6YQw-Cho8yYGx.js";import"./index-CJMgUOnw-DFxtpEnK.js";const $=({success:r,errorMessage:a,onRetry:d})=>{let i=r?"Successfully connected with Telegram":a?a.message:"Verifying connection to Telegram";return E.jsx(j,{title:i,subtitle:r?"You're good to go!":a?a.detail:"Just a few moments more",icon:F,iconVariant:"loading",iconLoadingStatus:{success:r,fail:!!a},secondaryCta:a?.retryable&&d?{label:"Retry",onClick:d}:void 0,watermark:!0})},Y={component:()=>{let{authenticated:r,logout:a,ready:d,user:i}=M(),{setModalData:A,navigate:l,resetNavigation:u,data:p}=x(),y=D(),{initLoginWithTelegram:R,loginWithTelegram:b,updateWallets:C,setReadyToTrue:w,closePrivyModal:_,createAnalyticsEvent:W,getAuthMeta:h}=U(),[g,L]=m.useState(!1),[S,o]=m.useState(void 0),s=I();async function T(){try{let e=await(async function(){let t;if(!r){if(s.enabled&&s.status==="error")throw new N(s.error,null,c.CAPTCHA_FAILURE);return s.enabled&&s.status!=="success"&&(s.execute(),t=await s.waitForResult()),t}})();await b({captchaToken:e}),L(!0),w(!0)}catch(e){if(e?.privyErrorCode===c.ALLOWLIST_REJECTED)return o(void 0),u(),void l("AllowlistRejectionScreen");if(e?.privyErrorCode===c.USER_LIMIT_REACHED)return console.error(new O(e).toString()),o(void 0),u(),void l("UserLimitReachedScreen");if(e?.privyErrorCode===c.USER_DOES_NOT_EXIST)return o(void 0),u(),void l("AccountNotFoundScreen");if(e?.privyErrorCode===c.ACCOUNT_TRANSFER_REQUIRED&&e.data?.data?.nonce)return o(void 0),u(),A({accountTransfer:{nonce:e.data?.data?.nonce,account:e.data?.data?.subject,telegramAuthResult:h()?.telegramAuthResult,telegramWebAppData:h()?.telegramWebAppData,displayName:e.data?.data?.account?.displayName,linkMethod:"telegram",embeddedWalletAddress:e.data?.data?.otherUser?.embeddedWalletAddress}}),void l("LinkConflictScreen");let{retryable:t,detail:n}=v(e);o({retryable:t,detail:n,message:"Authentication failed"})}}return m.useEffect((()=>{T()}),[]),m.useEffect((()=>{if(!(d&&r&&g&&i))return;if(y?.legal.requireUsersAcceptTerms&&!i.hasAcceptedTerms){let t=setTimeout((()=>{l("AffirmativeConsentScreen")}),f);return()=>clearTimeout(t)}if(k(i,y.embeddedWallets)){let t=setTimeout((()=>{A({createWallet:{onSuccess:()=>{},onFailure:n=>{console.error(n),W({eventName:"embedded_wallet_creation_failure_logout",payload:{error:n,provider:"telegram",screen:"TelegramAuthScreen"}}),a()},callAuthOnSuccessOnClose:!0}}),l("EmbeddedWalletOnAccountCreateScreen")}),f);return()=>clearTimeout(t)}C();let e=setTimeout((()=>_({shouldCallAuthOnSuccess:!0,isSuccess:!0})),f);return()=>clearTimeout(e)}),[d,r,g,i]),E.jsx($,{success:g,errorMessage:S,onRetry:S?.retryable?async()=>{try{o(void 0),p?.telegramAuthModalData?.seamlessAuth||await R(void 0,p?.login?.disableSignup),await T()}catch(e){let{retryable:t,detail:n}=v(e);o({retryable:t,detail:n,message:"Authentication failed"})}}:void 0})},isCaptchaRequired:!0,isShownBeforeReady:!0};export{Y as TelegramAuthScreen,$ as TelegramAuthScreenView,Y as default};
