import{d9 as a,dA as $,d7 as j,d5 as U,d6 as k,dX as A,dY as L,d4 as T,dZ as V,dW as w}from"./index-C6aulGjq.js";import{p as W,o as D}from"./SetWalletPasswordForm-vaG_68V0-BIB_TVXR.js";import"./ExclamationTriangleIcon-BBMpLoPy.js";import"./Layouts-Bmf8DxNP-ChOdzYv7.js";import"./ModalHeader-BTru6YQw-DkYP7_q4.js";import"./shared-D8TfUpfU-DFFTNa7m.js";import"./Button-BCV6mjvS-QQOxW8LY.js";import"./Checkbox-NmGCZeKL-ifWCpuhm.js";import"./CheckCircleIcon-BhwMDRmX.js";import"./ScreenHeader-Biz1wq02-D07oAbVG.js";const J={component:()=>{let[n,R]=a.useState(null),[P,y]=a.useState(!1),[l,o]=a.useState(null),[i,v]=a.useState(""),{authenticated:m,user:c}=$(),{client:b,walletProxy:h,refreshSessionAndUser:S,closePrivyModal:d,createAnalyticsEvent:r}=j(),{navigate:x,data:E,onUserCloseViaDialogOrKeybindRef:C}=U(),I=k(),{onSuccess:f,onFailure:p}=E.setWalletPassword,e=A(c),g=n?.recoveryMethod==="user-passcode",t=e?.recoveryMethod==="user-passcode";a.useEffect((()=>{m||(x("LandingScreen"),p(new L("User must be authenticated before setting a password on a Privy wallet")))}),[m]);let u=()=>l?(p(l),void d({shouldCallAuthOnSuccess:!1})):g?(f(n),void d({shouldCallAuthOnSuccess:!1})):(p(new w("Exited before password was added to wallet")),void d({shouldCallAuthOnSuccess:!1}));return C.current=u,T.jsx(W,{appName:I?.name||"privy",config:{initiatedBy:"user",onCancel:u},error:l?"An error has occurred, please try again.":void 0,buttonLoading:P,buttonHideAnimations:!1,password:i,isResettingPassword:t,onPasswordGenerate:()=>v(D()),onPasswordChange:v,onSubmit:async()=>{g?(f(n),d({shouldCallAuthOnSuccess:!1})):(y(!0),o(null),await(async()=>{let _=await b.getAccessToken();if(_&&c&&e?.address&&i&&h)try{r({eventName:"embedded_wallet_set_recovery_started",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t}});let{entropyId:s,entropyIdVerifier:N}=V(c);if(!(await h.setRecovery({accessToken:_,entropyId:s,entropyIdVerifier:N,recoveryPassword:i,recoveryMethod:"user-passcode"})).entropyId)return o(new w("Error setting password on privy wallet")),void r({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t,reason:"error setting password"}});let O=await S(),M=A(O);if(!M)return o(new w("Error setting password on privy wallet")),void r({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t,reason:"wallet disconnected"}});R(M),r({eventName:"embedded_wallet_set_recovery_completed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t}})}catch(s){console.warn(s),o(s instanceof Error?s:Error("Error setting password on privy wallet")),r({eventName:"embedded_wallet_set_password_failed",payload:{walletAddress:e.address,reason:s}})}})(),y(!1))},onClose:u})}};export{J as EmbeddedWalletPasswordUpdateScreen,J as default};
