import{d6 as U,d7 as G,d5 as J,d9 as r,dk as K,df as s,dl as X,dm as b,dd as Z,dn as j,d4 as e,dp as I,db as m,di as ee}from"./index-Ctm9nHNV.js";import{F as te}from"./CheckCircleIcon-BNJzdwIA.js";import{r as ne,a as ae,l as re}from"./Layouts-Bmf8DxNP-tXkHabBL.js";import{s as R}from"./ModalHeader-BTru6YQw-iyrvpJuy.js";import{r as se}from"./ScreenHeader-Biz1wq02-CAbLKHv7.js";import{t as D}from"./FundWalletMethodHeader-CS84Ots9-DrQqNVqQ.js";import{t as oe}from"./index-CJMgUOnw-Ck92nKck.js";import{t as ie}from"./analytics-mkkvFRju-DOXuftJB.js";import{u as de,o as le,n as ce,s as ue,r as me,f as pe}from"./reservoir-kvLjIrEo-0515s-XN.js";import{I as fe}from"./TransferOrBridgeLoadingScreen-BY7Eot6x-duEy2Ea9.js";import{p as ge}from"./parseEther-2lE09Yo9.js";import"./InjectedWalletIcon-DLcYOGDj-ijC1_BNz.js";import"./WalletIcon-CRmIDK9B.js";import"./Value-B4M62ove-6RSF9szj.js";import"./LoadingSkeleton-CHdaq3pb-BVb1i4fh.js";import"./Address-BUmpXgsy-B1yw3q4U.js";import"./Button-BCV6mjvS-Dmkeowl_.js";import"./check-5K1cwlnd.js";import"./createLucideIcon-Cl5FmNam.js";import"./copy-Ch3ql4MT.js";import"./GlobeAltIcon-CRGqOOvY.js";import"./parseUnits--lUwZLf1.js";const Le={component:function(){let W=U(),{closePrivyModal:B,createAnalyticsEvent:k,connectors:C}=G(),{navigate:L,setModalData:P,data:o}=J(),$=U(),x=r.useRef(!1),y=K(),[E,h]=r.useState(!1),[w,_]=r.useState(!1),[v,d]=r.useState(null),[H,M]=r.useState(),[q,F]=r.useState();if(!o?.funding||o.funding.chainType!=="ethereum")throw Error("Invalid funding data");let{amount:p,connectedWallet:f,chain:l,solanaChain:O,isUSDC:g}=o.funding,S=o.funding.address,Q=o.funding.erc20Address,A=o.funding.isUSDC?"USDC":l.nativeCurrency.symbol,n=r.useMemo((()=>f?.type==="solana"?f.provider:(function({connectors:t,connectedWalletAddress:i}){let c=t.find((a=>a.chainType==="solana"&&a.wallets.some((T=>T.address===i)))),u=c?.wallet.accounts.find((a=>a.address===i));if(!c||!u)throw new s("Unable to find source wallet connector");return new X({wallet:c.wallet,account:u})})({connectors:C,connectedWalletAddress:f?.address||""})),[f,C]),N=r.useMemo((()=>{let t=y(b);if(!t)throw new s("Unable to load solana plugin");let i=W.solanaRpcs["solana:mainnet"];if(!i)throw new s("Unable to load mainnet RPC");return t.getSolanaRpcClient({rpc:i.rpc,rpcSubscriptions:i.rpcSubscriptions,chain:"solana:mainnet",blockExplorerUrl:i.blockExplorerUrl??"https://explorer.solana.com"})}),[]),V=Z(j(n?.standardWallet.name||"unknown")),Y=V?.name||"wallet";return r.useEffect((()=>{(async function(){if(!n||!l||x.current)return;let t=y(b);if(!t)return void d(new s("Unable to solana plugin"));x.current=!0,l?.testnet&&console.warn("Solana testnets are not supported for bridging");let i=g?1e6*parseFloat(p):ge(p),c=await de({isTestnet:!!l.testnet,input:le({appId:$.id,amount:i.toString(),user:n.address,recipient:S,destinationChainId:l.id,originChainId:me,originCurrency:g?ce:ue,destinationCurrency:g?Q:void 0})}).catch(console.error);if(!c)return void d(new s(`Unable to fetch quotes for bridging. Wallet ${I(n.address)} does not have enough funds.`,void 0,m.INSUFFICIENT_BALANCE));let u=await t.createTransactionFromRelayQuote({quote:c,source:n.address,solanaClient:N});if(u)try{h(!0);let a=await t.simulateTransaction({solanaClient:N,tx:u});if(a.hasError)return a.hasFunds?(console.error("Transaction failed:",a.error),void d(new s("Something went wrong",void 0,m.TRANSACTION_FAILURE))):void d(new s(`Wallet ${I(n?.address)} does not have enough funds. ${c.details.currencyIn.amountFormatted} ${A} are needed to complete the transaction.`,void 0,m.INSUFFICIENT_BALANCE));let{signature:T}=await n.signAndSendTransaction({chain:"solana:mainnet",transaction:u}),z=t.getAddressFromBuffer(T);M(z),F("pending")}catch(a){if(console.error(a),/user rejected the request/gi.test(a.message||""))return void d(new s("Transaction was rejected by the user",void 0,m.TRANSACTION_FAILURE));d(new s("Something went wrong",void 0,m.TRANSACTION_FAILURE))}else d(new s(`Unable to select bridge option from quotes. Wallet ${I(n.address)} does not have enough funds.`,void 0,m.INSUFFICIENT_BALANCE))})().catch(console.error)}),[]),pe({transactionHash:H,isTestnet:!1,bridgingStatus:q,setBridgingStatus:F,onSuccess({transactionHash:t}){h(!1),_(!0),k({eventName:ie,payload:{provider:"external",status:"success",txHash:t,address:n.address,chainType:"solana",clusterName:O,token:"SOL",destinationAddress:S,destinationChainId:l.id,destinationChainType:"ethereum",destinationValue:p,destinationToken:g?"USDC":"ETH"}})},onFailure({error:t}){h(!1),d(t)}}),r.useEffect((()=>{if(!w)return;let t=setTimeout(B,ee);return()=>clearTimeout(t)}),[w]),r.useEffect((()=>{v&&(P({funding:o?.funding,solanaFundingData:o?.solanaFundingData,sendTransaction:o?.sendTransaction,errorModalData:{error:v,previousScreen:"TransferFromWalletScreen"}}),L("ErrorScreen",!1))}),[v]),w?e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsx(ne,{}),e.jsxs(ae,{children:[e.jsx(te,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),e.jsx(se,{title:"Success!",description:`Youâ€™ve successfully added ${p} ${A} to your ${$.name} wallet. It may take a minute before the funds are available to use.`})]}),e.jsx(re,{}),e.jsx(R,{})]}):E&&n?e.jsx(fe,{walletClientType:j(n?.standardWallet.name||"unknown"),displayName:Y,addressToFund:S,isBridging:E,isErc20Flow:!1,chainId:l.id,chainName:l.name,totalPriceInUsd:void 0,totalPriceInNativeCurrency:void 0,gasPriceInUsd:void 0,gasPriceInNativeCurrency:void 0}):e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsx(oe,{}),e.jsx("div",{style:{marginTop:"1rem"}}),e.jsx(R,{})]})}};export{Le as AwaitingSolToEvmBridgingScreen,Le as default};
