import{dA as A,d5 as B,d9 as i,d4 as d}from"./index-B4-LruoG.js";import{Q as b,R as j,z as V,X as w}from"./to-ui-error-CYFXznYy-BmFiS6FM.js";import"./PinInput-C3_MNxMt-BJWJB0Tm.js";import"./FingerPrintIcon-BgyZPh4D.js";import"./PhoneIcon-Dn_7BK6H.js";import"./ShieldCheckIcon-DAROFB15.js";import"./ModalHeader-BTru6YQw-mNrl3KWP.js";import"./ScreenLayout-CNho46nP-D6C5Lh0T.js";import"./Button-BCV6mjvS-DdwUXkRg.js";import"./Screen-_0H_rCdH-84nYgpso.js";import"./index-CJMgUOnw-CX4nbFWI.js";import"./ExclamationTriangleIcon-MGKYAckR.js";import"./StackedContainer-BrIQsdas-C7wR42iM.js";import"./useGetTokenPrice-CDPxMEO--lEUXvGLZ.js";import"./useGetSolPrice-Cfm8o9C5-BOWVNegP.js";import"./TransactionDetails-BdW2lq_B-DK0fCwjZ.js";import"./WalletLink-Cj92ni3W-XPtjiVdx.js";import"./ethers-Bl5aM5Gz-BLGFYpuF.js";import"./getFormattedUsdFromLamports-B6EqSEho-C-HCdwKa.js";import"./transaction-CnfuREWo-nROljJQP.js";import"./Layouts-Bmf8DxNP-t0AgBc9P.js";import"./ChevronDownIcon-cznXK1ad.js";const _={component:()=>{let{user:o}=A(),{data:u}=B(),[r,s]=i.useState(o?.mfaMethods[0]),[f,h]=i.useState(!1),[c,S]=i.useState(),[n,a]=i.useState();if(i.useEffect((()=>{s(o?.mfaMethods[0])}),[o?.mfaMethods]),!u?.mfaVerify)throw Error("Missing modal data for MFA verification screen.");let{onFailure:M,onSuccess:m,generateOptions:g,verifyTotpCode:E,verifyPasskey:y,verifySmsCode:C,sendSmsCode:x}=u.mfaVerify,v=async e=>{if(e!=="passkey")try{s(e),e==="sms"&&(s(e),await x()),e==="totp"&&s(e)}catch(t){console.error(t)}else try{s(e);let t=await g();if(!t)throw Error("something went wrong");S(t),await y(t),h(!0),a(void 0),m()}catch(t){a(w(t))}},k=async e=>{a(void 0);try{if(!e||!r)return;if(r==="passkey"){if(!c)throw Error("Missing passkey challenge");await y(c)}else r==="sms"?await C(e):r==="totp"&&await E(e);a(void 0),h(!0),m()}catch(t){throw w(t).error}},l=()=>{n||!f?M(n?.error??Error("Canceled MFA verification.")):m()},p=i.useRef(!1);return i.useEffect((()=>{!p.current&&r&&(p.current=!0,v(r).finally((()=>{p.current=!1})))}),[open]),o?r==="passkey"?d.jsx(b,{account:o.linkedAccounts.filter((e=>e.type==="passkey"&&e.enrolledInMfa)).sort(((e,t)=>t.firstVerifiedAt.valueOf()-e.firstVerifiedAt.valueOf()))[0],submitSuccess:f,hasBlockingError:n?.isBlocking??!1,error:n?.error,onClose:l,onBack:()=>{s(void 0),a(void 0)},handleSubmit:()=>k(c).catch(a)}):r==="sms"||r==="totp"?d.jsx(j,{selectedMethod:r,submitSuccess:f,hasBlockingError:n?.isBlocking??!1,handleSubmitCode:k,onClose:l,onBack:o.mfaMethods.length>1?()=>s(void 0):void 0}):d.jsx(V,{user:o,onSelect:v,handleClose:l}):null}};export{_ as MfaAuthVerifyFlowScreen,_ as default};
