import{d4 as f,d5 as P,d6 as y,d9 as c,dA as R,d7 as I,dT as T,dU as k,dV as F,dL as L,dW as V}from"./index-CUKlbBka.js";import{t as j}from"./use-create-wallet-without-fallback-C0dI_RFZ-UjlmW5sr.js";import{n as $}from"./ScreenLayout-CNho46nP-CLb3JE63.js";import{C as D}from"./circle-x-CHKPRFWx.js";import"./Button-BCV6mjvS-BVimNoDj.js";import"./Screen-_0H_rCdH-BAcCN2MH.js";import"./ModalHeader-BTru6YQw-BOw6POVk.js";import"./index-CJMgUOnw-DwaS8ZB-.js";import"./createLucideIcon-BfcfeeeP.js";const q=({errorMessage:l,onClose:a})=>f.jsx($,l?{title:"Something went wrong",subtitle:l,icon:D,iconVariant:"error",primaryCta:{label:"Close",onClick:a},watermark:!0}:{title:"Creating your wallet",subtitle:"Please wait...",iconVariant:"loading",watermark:!1}),Y={component:()=>{let{setModalData:l,navigate:a,data:r,onUserCloseViaDialogOrKeybindRef:p}=P(),s=y(),[g,S]=c.useState(""),{embeddedWallets:b}=y(),{authenticated:u,user:e}=R(),{closePrivyModal:d,walletProxy:v,client:O}=I(),{onSuccess:W,onFailure:m,callAuthOnSuccessOnClose:w,shouldCreateEth:x,shouldCreateSol:A}=r.createWallet,h=s.embeddedWallets.mode==="legacy-embedded-wallets-only"&&s?.embeddedWallets.requireUserOwnedRecoveryOnCreate===!0,[C,E]=c.useState(null),{create:o}=j(),n=x??(!!e&&T(e,s.embeddedWallets.ethereum.createOnLogin)),i=A??(!!e&&k(e,s.embeddedWallets.solana.createOnLogin)),U=new L((async()=>{let M=await O.getAccessToken();if(e&&M&&v)try{let t;if(n&&i)t=await o({chainType:"ethereum",walletIndex:0,latestUser:e}),t=await o({chainType:"solana",walletIndex:0,latestUser:t.user});else if(i)t=await o({chainType:"solana",walletIndex:0,latestUser:e});else{if(!n)return void d({shouldCallAuthOnSuccess:w});t=await o({chainType:"ethereum",walletIndex:0,latestUser:e})}E(t),a("EmbeddedWalletCreatedScreen")}catch(t){S(t.message)}}));return c.useEffect((()=>u&&e?h?(l({...r,createWallet:{...r.createWallet,shouldCreateEth:n,shouldCreateSol:i},recoverySelection:{...r?.recoverySelection,isInAccountCreateFlow:!0,shouldCreateEth:n,shouldCreateSol:i}}),a(F({walletAction:"create",showAutomaticRecovery:!1,availableRecoveryMethods:b.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:!1,isResettingPassword:!1}))):void U.execute():(a("LandingScreen"),void m(Error("User must be authenticated before creating a Privy wallet")))),[h,u]),p.current=()=>null,f.jsx(q,{errorMessage:g||void 0,onClose:()=>{C?(W(C),d({shouldCallAuthOnSuccess:w})):(m(new V("User wallet creation failed")),d({shouldCallAuthOnSuccess:!1}))}})}};export{Y as EmbeddedWalletOnAccountCreateScreen,q as EmbeddedWalletOnAccountCreateView,Y as default};
