import{d4 as t,dA as M,d5 as U,d6 as $,d7 as D,d9 as s,db as c,dJ as B,dw as N,dy as j,ds as n,dt as W}from"./index-C6aulGjq.js";import{n as z}from"./OpenLink-BpeNYBKs-B0tHMr_E.js";import{x as P}from"./QrCode-Oxn5GT3C-CB1E9BHK.js";import{b as q}from"./Button-BCV6mjvS-QQOxW8LY.js";import{e as V}from"./LabelXs-BOisBtqT-C4ILARiC.js";import{a as Q}from"./shouldProceedtoEmbeddedWalletCreationFlow-BI33jNSF-EB9aVWxW.js";import{n as H}from"./ScreenLayout-CNho46nP-zIMefLr6.js";import{l as A}from"./farcaster-DPlSjvF5-CyuNwknL.js";import{C as J}from"./check-B-FJ1RU_.js";import{C as K}from"./copy-miwUQLez.js";import"./dijkstra-COg3n3zL.js";import"./Screen-_0H_rCdH-BPGpqP_O.js";import"./ModalHeader-BTru6YQw-DkYP7_q4.js";import"./index-CJMgUOnw-C7AHVm-K.js";import"./createLucideIcon-D9llCs1E.js";let X=n.div.withConfig({displayName:"Container",componentId:"sc-913deead-0"})(["width:100%;"]),Y=n.div.withConfig({displayName:"InputContainer",componentId:"sc-913deead-1"})(["display:flex;align-items:center;justify-content:space-between;gap:0.75rem;padding:0.75rem;height:56px;background:",";border:1px solid var(--privy-color-foreground-4);border-radius:var(--privy-border-radius-md);&:hover{border-color:",";}"],(e=>e.$disabled?"var(--privy-color-background-2)":"var(--privy-color-background)"),(e=>e.$disabled?"var(--privy-color-foreground-4)":"var(--privy-color-foreground-3)")),G=n.div.withConfig({displayName:"TextContainer",componentId:"sc-913deead-2"})(["flex:1;min-width:0;display:flex;align-items:center;"]),L=n.span.withConfig({displayName:"Text",componentId:"sc-913deead-3"})(["display:block;font-size:16px;line-height:24px;color:",";overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;word-break:break-all;@media (min-width:441px){font-size:14px;line-height:20px;}"],(e=>e.$disabled?"var(--privy-color-foreground-2)":"var(--privy-color-foreground)")),Z=n(L).withConfig({displayName:"PlaceholderText",componentId:"sc-913deead-4"})(["color:var(--privy-color-foreground-3);font-style:italic;"]),ee=n(V).withConfig({displayName:"TitleLabel",componentId:"sc-913deead-5"})(["margin-bottom:0.5rem;"]),te=n(q).withConfig({displayName:"CopyButton",componentId:"sc-913deead-6"})(["&&{gap:0.375rem;font-size:14px;flex-shrink:0;}"]);const re=({value:e,title:p,placeholder:l,className:r,showCopyButton:d=!0,truncate:i,maxLength:u=40,disabled:m=!1})=>{let[h,x]=s.useState(!1),b=i&&e?((a,w,f)=>{if((a=a.startsWith("https://")?a.slice(8):a).length<=f)return a;if(w==="middle"){let v=Math.ceil(f/2)-2,S=Math.floor(f/2)-1;return`${a.slice(0,v)}...${a.slice(-S)}`}return`${a.slice(0,f-3)}...`})(e,i,u):e;return s.useEffect((()=>{if(h){let a=setTimeout((()=>x(!1)),3e3);return()=>clearTimeout(a)}}),[h]),t.jsxs(X,{className:r,children:[p&&t.jsx(ee,{children:p}),t.jsxs(Y,{$disabled:m,children:[t.jsx(G,{children:e?t.jsx(L,{$disabled:m,title:e,children:b}):t.jsx(Z,{$disabled:m,children:l||"No value"})}),d&&e&&t.jsx(te,{onClick:function(a){a.stopPropagation(),navigator.clipboard.writeText(e).then((()=>x(!0))).catch(console.error)},size:"sm",children:t.jsxs(t.Fragment,h?{children:["Copied",t.jsx(J,{size:14})]}:{children:["Copy",t.jsx(K,{size:14})]})})]})]})},ae=({connectUri:e,loading:p,success:l,errorMessage:r,onBack:d,onClose:i,onOpenFarcaster:u})=>t.jsx(H,j.isMobile||p?j.isIOS?{title:r?r.message:"Sign in with Farcaster",subtitle:r?r.detail:"To sign in with Farcaster, please open the Farcaster app.",icon:A,iconVariant:"loading",iconLoadingStatus:{success:l,fail:!!r},primaryCta:e&&u?{label:"Open Farcaster app",onClick:u}:void 0,onBack:d,onClose:i,watermark:!0}:{title:r?r.message:"Signing in with Farcaster",subtitle:r?r.detail:"This should only take a moment",icon:A,iconVariant:"loading",iconLoadingStatus:{success:l,fail:!!r},onBack:d,onClose:i,watermark:!0,children:e&&j.isMobile&&t.jsx(oe,{children:t.jsx(z,{text:"Take me to Farcaster",url:e,color:"#8a63d2"})})}:{title:"Sign in with Farcaster",subtitle:"Scan with your phone's camera to continue.",onBack:d,onClose:i,watermark:!0,children:t.jsxs(ie,{children:[t.jsx(ne,{children:e?t.jsx(P,{url:e,size:275,squareLogoElement:A}):t.jsx(de,{children:t.jsx(W,{})})}),t.jsxs(se,{children:[t.jsx(le,{children:"Or copy this link and paste it into a phone browser to open the Farcaster app."}),e&&t.jsx(re,{value:e,truncate:"end",maxLength:30,showCopyButton:!0,disabled:!0})]})]})}),Te={component:()=>{let{authenticated:e,logout:p,ready:l,user:r}=M(),{lastScreen:d,navigate:i,navigateBack:u,setModalData:m}=U(),h=$(),{getAuthFlow:x,loginWithFarcaster:b,closePrivyModal:a,createAnalyticsEvent:w}=D(),[f,v]=s.useState(void 0),[S,O]=s.useState(!1),[C,_]=s.useState(!1),E=s.useRef([]),F=x(),T=F?.meta.connectUri;return s.useEffect((()=>{let g=Date.now(),I=setInterval((async()=>{let k=await F.pollForReady.execute(),R=Date.now()-g;if(k){clearInterval(I),O(!0);try{await b(),_(!0)}catch(o){let y={retryable:!1,message:"Authentication failed"};if(o?.privyErrorCode===c.ALLOWLIST_REJECTED)return void i("AllowlistRejectionScreen");if(o?.privyErrorCode===c.USER_LIMIT_REACHED)return console.error(new B(o).toString()),void i("UserLimitReachedScreen");if(o?.privyErrorCode===c.USER_DOES_NOT_EXIST)return void i("AccountNotFoundScreen");if(o?.privyErrorCode===c.LINKED_TO_ANOTHER_USER)y.detail=o.message??"This account has already been linked to another user.";else{if(o?.privyErrorCode===c.ACCOUNT_TRANSFER_REQUIRED&&o.data?.data?.nonce)return m({accountTransfer:{nonce:o.data?.data?.nonce,account:o.data?.data?.subject,displayName:o.data?.data?.account?.displayName,linkMethod:"farcaster",embeddedWalletAddress:o.data?.data?.otherUser?.embeddedWalletAddress,farcasterEmbeddedAddress:o.data?.data?.otherUser?.farcasterEmbeddedAddress}}),void i("LinkConflictScreen");o?.privyErrorCode===c.INVALID_CREDENTIALS?(y.retryable=!0,y.detail="Something went wrong. Try again."):o?.privyErrorCode===c.TOO_MANY_REQUESTS&&(y.detail="Too many requests. Please wait before trying again.")}v(y)}}else R>12e4&&(clearInterval(I),v({retryable:!0,message:"Authentication failed",detail:"The request timed out. Try again."}))}),2e3);return()=>{clearInterval(I),E.current.forEach((k=>clearTimeout(k)))}}),[]),s.useEffect((()=>{if(l&&e&&C&&r){if(h?.legal.requireUsersAcceptTerms&&!r.hasAcceptedTerms){let g=setTimeout((()=>{i("AffirmativeConsentScreen")}),N);return()=>clearTimeout(g)}C&&(Q(r,h.embeddedWallets)?E.current.push(setTimeout((()=>{m({createWallet:{onSuccess:()=>{},onFailure:g=>{console.error(g),w({eventName:"embedded_wallet_creation_failure_logout",payload:{error:g,screen:"FarcasterConnectStatusScreen"}}),p()},callAuthOnSuccessOnClose:!0}}),i("EmbeddedWalletOnAccountCreateScreen")}),N)):E.current.push(setTimeout((()=>a({shouldCallAuthOnSuccess:!0,isSuccess:!0})),N)))}}),[C,l,e,r]),t.jsx(ae,{connectUri:T,loading:S,success:C,errorMessage:f,onBack:d?u:void 0,onClose:a,onOpenFarcaster:()=>{T&&(window.location.href=T)}})}};let oe=n.div.withConfig({displayName:"MobileLinkContainer",componentId:"sc-914339e1-0"})(["margin-top:24px;"]),ie=n.div.withConfig({displayName:"ContentContainer",componentId:"sc-914339e1-1"})(["display:flex;flex-direction:column;align-items:center;gap:24px;"]),ne=n.div.withConfig({displayName:"QrContainer",componentId:"sc-914339e1-2"})(["display:flex;align-items:center;justify-content:center;min-height:275px;"]),se=n.div.withConfig({displayName:"InstructionsContainer",componentId:"sc-914339e1-3"})(["display:flex;flex-direction:column;align-items:center;gap:16px;"]),le=n.div.withConfig({displayName:"InstructionText",componentId:"sc-914339e1-4"})(["font-size:0.875rem;text-align:center;color:var(--privy-color-foreground-2);"]),de=n.div.withConfig({displayName:"LoaderWrapper",componentId:"sc-914339e1-5"})(["position:relative;width:82px;height:82px;"]);export{Te as FarcasterConnectStatusScreen,ae as FarcasterConnectStatusView,Te as default};
