import{d7 as z,d9 as v,dl as at,fc as st,dc as it,fd as me,d6 as Ye,d5 as we,el as We,df as M,db as U,fe as xe,dZ as Fe,ff as rt,fg as ot,fh as lt,fi as ct,fj as dt,fk as Ke,fl as ze,fm as ut,fn as ye,e8 as gt,fo as ft,fp as Oe,fq as pt,fr as ht,fs as mt,ft as wt,fu as Me,fv as At,fw as yt,dn as Ue,d4 as h,fx as Pe,fy as De,fz as vt,fA as $e,di as St,fB as Ne,fC as ve,fD as Le,fE as Be,fF as Tt}from"./index-D7nMmKzf.js";import{F as It}from"./CheckCircleIcon-BEOZTi67.js";import{n as bt}from"./Button-BCV6mjvS-CnRinvWJ.js";import{r as Et,a as Ot,l as jt,t as Ct}from"./Layouts-Bmf8DxNP-BBsG0PDI.js";import{s as Se}from"./ModalHeader-BTru6YQw-DO8X_2OJ.js";import{r as Re}from"./ScreenHeader-Biz1wq02-B9m03Psw.js";import{t as Te}from"./FundWalletMethodHeader-CS84Ots9-CNHiSCcE.js";import{i as Wt}from"./InjectedWalletIcon-DLcYOGDj-rnBjGVZB.js";import{t as xt}from"./index-CJMgUOnw-CVNrZBd5.js";import{e as Ft,o as _t,r as Mt,i as Ut}from"./Value-B4M62ove-DVisqyV5.js";import{d as He,f as he,c as Pt,u as Dt,p as $t,l as pe}from"./useSolanaRpcClient-Brcjny8C-CwhIkXSc.js";import{c as Nt}from"./useGetTokenPrice-CDPxMEO--DZOwlkiB.js";import{t as Lt}from"./analytics-mkkvFRju-DOXuftJB.js";import{C as fe,e as ke,s as Bt}from"./getFormattedUsdFromLamports-B6EqSEho-C-HCdwKa.js";import{r as Rt}from"./getUsdcMintAddress-DFI1hv05-jlhpBW9a.js";import{e as kt}from"./getChainName-DjpPdUSc-c2urPd0g.js";import{n as Ie}from"./formatters-epansgp1.js";import"./WalletIcon-r17Eqn-w.js";import"./LoadingSkeleton-CHdaq3pb-Bx-etR21.js";import"./useGetSolPrice-Cfm8o9C5-CG1SB5rb.js";const Ze=()=>{let{walletProxy:e,client:n}=z();return v.useMemo((()=>({signWithUserSigner:async({message:a,targetAppId:l})=>{if(!e)throw Error("Wallet proxy not initialized");let d=await n.getAccessToken();if(!d)throw Error("User must be authenticated");let{signature:o}=await e.signWithUserSigner({accessToken:d,message:a,targetAppId:l});return{signature:o}}})),[e,n])},Je=["solana:mainnet","solana:devnet","solana:testnet"];function Vt(e){return st().decode(e)}function Z(e,n){if(!Object.prototype.hasOwnProperty.call(e,n))throw TypeError("attempted to use private field on non-instance");return e}var Gt=0,P="__private_"+Gt+++"__implementation";function _(e,n){if(!Object.prototype.hasOwnProperty.call(e,n))throw TypeError("attempted to use private field on non-instance");return e}var Qt=0;function H(e){return"__private_"+Qt+++"_"+e}var J=H("_address"),q=H("_publicKey"),X=H("_chains"),ee=H("_features"),te=H("_label"),ne=H("_icon");class _e{get address(){return _(this,J)[J]}get publicKey(){return _(this,q)[q].slice()}get chains(){return _(this,X)[X].slice()}get features(){return _(this,ee)[ee].slice()}get label(){return _(this,te)[te]}get icon(){return _(this,ne)[ne]}constructor({address:n,publicKey:a,label:l,icon:d}){Object.defineProperty(this,J,{writable:!0,value:void 0}),Object.defineProperty(this,q,{writable:!0,value:void 0}),Object.defineProperty(this,X,{writable:!0,value:void 0}),Object.defineProperty(this,ee,{writable:!0,value:void 0}),Object.defineProperty(this,te,{writable:!0,value:void 0}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),_(this,J)[J]=n,_(this,q)[q]=a,_(this,X)[X]=Je,_(this,te)[te]=l,_(this,ne)[ne]=d,_(this,ee)[ee]=["solana:signAndSendTransaction","solana:signTransaction","solana:signMessage"],new.target===_e&&Object.freeze(this)}}function s(e,n){if(!Object.prototype.hasOwnProperty.call(e,n))throw TypeError("attempted to use private field on non-instance");return e}var Yt=0;function b(e){return"__private_"+Yt+++"_"+e}var x=b("_listeners"),ae=b("_version"),se=b("_name"),ie=b("_icon"),E=b("_injection"),re=b("_isPrivyWallet"),Q=b("_accounts"),oe=b("_on"),Y=b("_emit"),be=b("_off"),K=b("_connected"),le=b("_connect"),ce=b("_disconnect"),de=b("_signMessage"),ue=b("_signAndSendTransaction"),ge=b("_signTransaction");function Kt(e,...n){s(this,x)[x][e]?.forEach((a=>a.apply(null,n)))}function zt(e,n){s(this,x)[x][e]=s(this,x)[x][e]?.filter((a=>n!==a))}function Ht(e,n,a){let l=structuredClone(gt().decode(e)),d=ft(n);return d in l.signatures&&(l.signatures[d]=a),new Uint8Array(Oe().encode(l))}function qe(){let{isHeadlessSigning:e,walletProxy:n,initializeWalletProxy:a,recoverEmbeddedWallet:l,openModal:d,privy:o,client:i}=z(),{user:t}=me(),{setModalData:r}=we(),{signWithUserSigner:u}=Ze();return{signMessage:({message:c,address:w,options:S})=>new Promise((async(D,C)=>{let p=We(t,w);if(p?.walletClientType!=="privy")return void C(new M("Wallet is not a Privy wallet",void 0,U.EMBEDDED_WALLET_NOT_FOUND));let{entropyId:A,entropyIdVerifier:y}=Fe(t,p),T=xe(p),m=he(c).toString("base64");if(m.length<1)return void C(new M("Message must be a non-empty string",void 0,U.INVALID_MESSAGE));let k=async()=>{let f;if(!t)throw Error("User must be authenticated before signing with a Privy wallet");let O=await i.getAccessToken();if(!O)throw Error("User must be authenticated to use their embedded wallet.");let F=n??await a(15e3);if(!F)throw Error("Failed to initialize embedded wallet proxy.");if(!await l({address:p.address}))throw Error("Unable to connect to wallet");if(T){let W=await Ke(o,u,{chain_type:"solana",method:"signMessage",params:{message:m,encoding:"base64"},wallet_id:p.id});if(!W.data||!("signature"in W.data))throw Error("Failed to sign message");f=W.data.signature}else{let{response:W}=await F.rpc({accessToken:O,entropyId:A,entropyIdVerifier:y,chainType:"solana",hdWalletIndex:p.walletIndex??0,requesterAppId:S?.uiOptions?.requesterAppId,request:{method:"signMessage",params:{message:m}}});f=W.data.signature}return f};if(e({showWalletUIs:S?.uiOptions?.showWalletUIs}))try{let f=await k(),O=new Uint8Array(he(f,"base64"));D({signature:O})}catch(f){C(f)}else r({signMessage:{method:"solana_signMessage",data:m,confirmAndSign:k,onSuccess:f=>{D({signature:new Uint8Array(he(f,"base64"))})},onFailure:f=>{C(f)},uiOptions:S?.uiOptions??{}},connectWallet:{recoveryMethod:p.recoveryMethod,connectingWalletAddress:p.address,entropyId:A,entropyIdVerifier:y,isUnifiedWallet:T,onCompleteNavigateTo:"SignRequestScreen",onFailure:f=>{C(new M("Failed to connect to wallet",f,U.UNKNOWN_CONNECT_WALLET_ERROR))}}}),d("EmbeddedWalletConnectingScreen")}))}}function Ve(){let{isHeadlessSigning:e,openModal:n}=z(),{setModalData:a}=we(),{signMessage:l}=qe(),{user:d}=me();return{signTransaction:async({transaction:o,options:i,chain:t="solana:mainnet",address:r})=>{async function u(c){let{signature:w}=await l({message:Pt(c),address:r,options:{...i,uiOptions:{...i?.uiOptions,showWalletUIs:!1}}});return{signedTransaction:Ht(c,r,w)}}return e({showWalletUIs:i?.uiOptions?.showWalletUIs})?u(o):new Promise((async(c,w)=>{let S=We(d,r);if(S?.walletClientType!=="privy")return void w(new M("Wallet is not a Privy wallet",void 0,U.EMBEDDED_WALLET_NOT_FOUND));let{entropyId:D,entropyIdVerifier:C}=Fe(d,S),p=xe(S);function A(T){return m=>{w(m instanceof M?m:new M("Failed to connect to wallet",m,T))}}let y={account:S,transaction:o,chain:t,signOnly:!0,uiOptions:i?.uiOptions||{},onConfirm:u,onSuccess:c,onFailure:A(U.TRANSACTION_FAILURE)};a({connectWallet:{recoveryMethod:S.recoveryMethod,connectingWalletAddress:S.address,entropyId:D,entropyIdVerifier:C,isUnifiedWallet:p,onCompleteNavigateTo:"StandardSignAndSendTransactionScreen",onFailure:A(U.UNKNOWN_CONNECT_WALLET_ERROR)},standardSignAndSendTransaction:y}),n("EmbeddedWalletConnectingScreen")}))}}}let je=new class extends ut{setImplementation(e){Z(this,P)[P]=e}async signMessage(e){return Z(this,P)[P].signMessage(e)}async signAndSendTransaction(e){return Z(this,P)[P].signAndSendTransaction(e)}async signTransaction(e){return Z(this,P)[P].signTransaction(e)}constructor(e){super(),Object.defineProperty(this,P,{writable:!0,value:void 0}),Z(this,P)[P]=e}}({signTransaction:ye("signTransaction was not injected"),signAndSendTransaction:ye("signAndSendTransaction was not injected"),signMessage:ye("signMessage was not injected")}),Ge=new class{get version(){return s(this,ae)[ae]}get name(){return s(this,se)[se]}get icon(){return s(this,ie)[ie]}get chains(){return Je.slice()}get features(){return{"standard:connect":{version:"1.0.0",connect:s(this,le)[le]},"standard:disconnect":{version:"1.0.0",disconnect:s(this,ce)[ce]},"standard:events":{version:"1.0.0",on:s(this,oe)[oe]},"solana:signAndSendTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signAndSendTransaction:s(this,ue)[ue]},"solana:signTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signTransaction:s(this,ge)[ge]},"solana:signMessage":{version:"1.0.0",signMessage:s(this,de)[de]},"privy:":{privy:{signMessage:s(this,E)[E].signMessage,signTransaction:s(this,E)[E].signTransaction,signAndSendTransaction:s(this,E)[E].signAndSendTransaction}}}}get accounts(){return s(this,Q)[Q].slice()}get isPrivyWallet(){return s(this,re)[re]}constructor({name:e,icon:n,version:a,injection:l,wallets:d}){Object.defineProperty(this,Y,{value:Kt}),Object.defineProperty(this,be,{value:zt}),Object.defineProperty(this,x,{writable:!0,value:void 0}),Object.defineProperty(this,ae,{writable:!0,value:void 0}),Object.defineProperty(this,se,{writable:!0,value:void 0}),Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,E,{writable:!0,value:void 0}),Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,Q,{writable:!0,value:void 0}),Object.defineProperty(this,oe,{writable:!0,value:void 0}),Object.defineProperty(this,K,{writable:!0,value:void 0}),Object.defineProperty(this,le,{writable:!0,value:void 0}),Object.defineProperty(this,ce,{writable:!0,value:void 0}),Object.defineProperty(this,de,{writable:!0,value:void 0}),Object.defineProperty(this,ue,{writable:!0,value:void 0}),Object.defineProperty(this,ge,{writable:!0,value:void 0}),s(this,x)[x]={},s(this,oe)[oe]=(o,i)=>(s(this,x)[x][o]?.push(i)||(s(this,x)[x][o]=[i]),()=>s(this,be)[be](o,i)),s(this,K)[K]=o=>{o!=null&&(s(this,Q)[Q]=o.map((({address:i})=>new _e({address:i,publicKey:ze.decode(i)})))),s(this,Y)[Y]("change",{accounts:this.accounts})},s(this,le)[le]=async()=>(s(this,Y)[Y]("change",{accounts:this.accounts}),{accounts:this.accounts}),s(this,ce)[ce]=async()=>{s(this,Y)[Y]("change",{accounts:this.accounts})},s(this,de)[de]=async(...o)=>{let i=[];for(let{account:t,...r}of o){let{signature:u}=await s(this,E)[E].signMessage({...r,address:t.address});i.push({signedMessage:r.message,signature:u})}return i},s(this,ue)[ue]=async(...o)=>{let i=[];for(let t of o){let{signature:r}=await s(this,E)[E].signAndSendTransaction({...t,transaction:t.transaction,address:t.account.address,chain:t.chain||"solana:mainnet",options:t.options});i.push({signature:r})}return i},s(this,ge)[ge]=async(...o)=>{let i=[];for(let{transaction:t,account:r,options:u,chain:c}of o){let{signedTransaction:w}=await s(this,E)[E].signTransaction({transaction:t,address:r.address,chain:c||"solana:mainnet",options:u});i.push({signedTransaction:w})}return i},s(this,se)[se]=e,s(this,ie)[ie]=n,s(this,ae)[ae]=a,s(this,E)[E]=l,s(this,Q)[Q]=[],s(this,re)[re]=!0,l.on("accountChanged",s(this,K)[K],this),s(this,K)[K](d)}}({name:"Privy",version:"1.0.0",icon:"data:image/png;base64,AAABAAEAFBQAAAAAIABlAQAAFgAAAIlQTkcNChoKAAAADUlIRFIAAAAUAAAAFAgGAAAAjYkdDQAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAQVJREFUeJxiYMANZIC4E4ivAPFPIP4FxDeAuB+IlfDowwBMQFwJxF+B+D8O/AOI66Bq8QJGIF6ExyB0vAqImfEZmEeCYTDcgMswPiB+T4aB34FYApuBsWQYBsP52AycToGBK7EZuJECAw9jM3AVBQbuwWZgIwUGTsZmoDkFBnpiMxAEjpJh2FV8iVsbiD+TYBgoDVrgMgwGnID4HRGGgTKBGyHDYEAaiBdCSxh0g/5AU4Q8sYYhAzEgjoGmABBOgFo2eACowFABYn0oVgViAVINkQTiZUD8DIj/ATF6GILEXgLxCiCWIsZAbiAuBeKtQHwHiEHJ6C8UfwHie0C8E4jLoWpRAAAAAP//rcbhsQAAAAZJREFUAwBYFs3VKJ0cuQAAAABJRU5ErkJggg==",wallets:[],injection:je});function Zt(){let{ready:e}=it(),{user:n}=me(),{signMessage:a}=qe(),{signTransaction:l}=Ve(),{signAndSendTransaction:d}=(function(){let t=Ye(),{isHeadlessSigning:r,openModal:u}=z(),{setModalData:c}=we(),{signTransaction:w}=Ve(),S=He(),{user:D}=me(),{signWithUserSigner:C}=Ze();return{signAndSendTransaction:async({transaction:p,address:A,chain:y="solana:mainnet",options:T})=>{let m=We(D,A);if(m?.walletClientType!=="privy")throw new M("Wallet is not a Privy wallet",void 0,U.EMBEDDED_WALLET_NOT_FOUND);let k=xe(m);async function f(O){if(T?.sponsor)return await(async g=>{if(!k)throw new M("Sponsoring transactions is only supported for wallets on the TEE stack",U.INVALID_DATA);let I=new ct({appId:t.id,clientId:t.appClientId,storage:dt}),j=await Ke(I,C,{chain_type:"solana",method:"signAndSendTransaction",sponsor:!0,params:{transaction:he(g).toString("base64"),encoding:"base64"},caip2:`solana:${(await S(y).rpc.getGenesisHash().send()).substring(0,32)}`,wallet_id:m.id});if(j.data&&"hash"in j.data)return{signature:ze.decode(j.data.hash)};throw Error("Failed to sign and send transaction")})(O);let{signedTransaction:F}=await w({transaction:O,address:A,chain:y,options:{...T,uiOptions:{...T?.uiOptions,showWalletUIs:!1}}}),{signature:W}=await S(y).sendAndConfirmTransaction(F);return{signature:W}}return r({showWalletUIs:T?.uiOptions?.showWalletUIs})?f(p):new Promise((async(O,F)=>{let W,g,{entropyId:I,entropyIdVerifier:j}=Fe(D,m);function $(V){return R=>{F(R instanceof M?R:new M("Failed to connect to wallet",R,V))}}let G={account:m,transaction:p,chain:y,signOnly:!1,uiOptions:T?.uiOptions||{},onConfirm:f,onSuccess:O,onFailure:$(U.TRANSACTION_FAILURE),isSponsored:!!T?.sponsor},N={recoveryMethod:m.recoveryMethod,connectingWalletAddress:m.address,entropyId:I,entropyIdVerifier:j,isUnifiedWallet:k,onCompleteNavigateTo:"StandardSignAndSendTransactionScreen",onFailure:$(U.UNKNOWN_CONNECT_WALLET_ERROR)};t.fundingConfig&&(W=rt({address:A,appConfig:t,methodScreen:"FundingMethodSelectionScreen",fundWalletConfig:{...T,asset:"native-currency",chain:y},externalSolanaFundingScreen:"FundSolWalletWithExternalSolanaWallet"}),g={amount:t.fundingConfig.defaultRecommendedAmount,asset:"SOL",chain:y,destinationAddress:A,afterSuccessScreen:"StandardSignAndSendTransactionScreen",sourceWalletData:void 0}),c({connectWallet:N,standardSignAndSendTransaction:G,funding:W,solanaFundingData:g}),u("EmbeddedWalletConnectingScreen")}))}}})(),o=v.useMemo((()=>{let t=[...ot(n).sort(((u,c)=>(u.walletIndex??0)-(c.walletIndex??0)))],r=lt(n);return r.length?[...t,...r]:t}),[n]),i=v.useMemo((()=>({signMessage:async({message:t,address:r,options:u})=>await a({message:t,address:r,options:u}),signTransaction:async({transaction:t,address:r,chain:u,options:c})=>await l({transaction:t,address:r,chain:u,options:c}),async signAndSendTransaction({transaction:t,address:r,chain:u,options:c}){let{signature:w}=await d({transaction:t,address:r,chain:u,options:c});return{signature:w}}})),[a,l,d]);return v.useEffect((()=>{je?.setImplementation(i)}),[i]),v.useEffect((()=>{var t;!e||(t=Ge.accounts).length===o.length&&t.every(((r,u)=>r.address===o[u]?.address))||je?.emit("accountChanged",o)}),[e,o]),{ready:e,wallet:Ge}}function Jt(){let{client:e}=z(),{ready:n,wallet:a}=Zt(),[l,d]=v.useState([]),[o,i]=v.useState([]);return v.useEffect((()=>{let t=[a,...l.filter((c=>c.chainType==="solana"&&!!c.wallet.features)).map((c=>c.wallet))];i(t);let r=l.flatMap((c=>{let w=()=>i([...t]);return c.on("walletsUpdated",w),{connector:c,off:w}})),u=t.map((c=>c.features["standard:events"]?.on("change",(()=>{i([...t])}))));return()=>{u.forEach((c=>c?.())),r.forEach((({connector:c,off:w})=>c.off("walletsUpdated",w)))}}),[l]),v.useEffect((()=>{d(e.connectors?.walletConnectors.filter((r=>r.chainType==="solana"))??[]);let t=()=>{d(e.connectors?.walletConnectors.filter((r=>r.chainType==="solana"))??[])};return e.connectors?.on("connectorInitialized",t),()=>{e.connectors?.off("connectorInitialized",t)}}),[n,e.connectors]),{ready:n,wallets:o}}function qt(){let{ready:e,wallets:n}=Jt();return{ready:e,wallets:v.useMemo((()=>n.flatMap((a=>a.accounts.map((l=>new at({wallet:a,account:l})))))),[n])}}var Xt="11111111111111111111111111111111";function en(e){if(!e)throw new Error("Expected a Address.");return typeof e=="object"&&"address"in e?e.address:Array.isArray(e)?e[0]:e}function tn(e,n){return a=>{if(!a.value)return;const l=a.isWritable?Me.WRITABLE:Me.READONLY;return Object.freeze({address:en(a.value),role:Qe(a.value)?At(l):l,...Qe(a.value)?{signer:a.value}:{}})}}function Qe(e){return!!e&&typeof e=="object"&&"address"in e&&yt(e)}var nn=2;function an(){return pt(ht([["discriminator",mt()],["amount",wt()]]),e=>({...e,discriminator:nn}))}function sn(e,n){const a=Xt,d={source:{value:e.source??null,isWritable:!0},destination:{value:e.destination??null,isWritable:!0}},o={...e},i=tn();return Object.freeze({accounts:[i(d.source),i(d.destination)],data:an().encode(o),programAddress:a})}function rn({rows:e}){return h.jsx(Ft,{children:e.filter((n=>!!n)).map(((n,a)=>n.value!=null||n.isLoading?h.jsxs(_t,{children:[h.jsx(Mt,{children:n.label}),h.jsx(Ut,{$isLoading:n.isLoading,children:n.value})]},a):null))})}function Ce(e){return BigInt(Math.floor(1e9*parseFloat(e)))}function Ee(e){return+on.format(parseFloat(e.toString())/1e9)}let on=Intl.NumberFormat(void 0,{maximumFractionDigits:8});async function ln({tx:e,solanaClient:n,amount:a,asset:l,tokenPrice:d}){if(!e)return null;if(l==="SOL"&&d){let o=Ce(a),i=fe(o,d),t=await pe({solanaClient:n,tx:e});return{amountInUsd:i,feeInUsd:d?fe(t,d):void 0,totalInUsd:fe(o+t,d)}}if(l==="USDC"&&d){let o="$"+a,i=await pe({solanaClient:n,tx:e}),t=(function(r,u){let c=parseFloat(r.toString())/Bt*u;return c<.01?0:c})(i,d);return{amountInUsd:o,feeInUsd:fe(i,d),totalInUsd:"$"+(parseFloat(a)+t).toFixed(2)}}if(l==="SOL"){let o=Ce(a),i=await pe({solanaClient:n,tx:e});return{amountInSol:a+" SOL",feeInSol:Ee(i)+" SOL",totalInSol:Ee(o+i)+" SOL"}}return{amountInUsdc:a+" USDC",feeInSol:Ee(await pe({solanaClient:n,tx:e}))+" SOL"}}const Wn={component:function(){let e=Ye(),{closePrivyModal:n,createAnalyticsEvent:a}=z(),{data:l,setModalData:d,navigate:o}=we(),{wallets:i}=qt(),[t,r]=v.useState("preparing"),[u,c]=v.useState(),[w,S]=v.useState(),[D,C]=v.useState();if(!l?.solanaFundingData)throw Error("Funding config is missing");if(!l.solanaFundingData.sourceWalletData)throw Error("Funding config is missing source wallet data");let{amount:p,asset:A,chain:y,sourceWalletData:T,destinationAddress:m,afterSuccessScreen:k}=l.solanaFundingData,f=i.find((g=>g.address===T.address&&Ue(T.walletClientType)===Ue(g.standardWallet.name))),O=He()(y),{tokenPrice:F,isTokenPriceLoading:W}=Nt("solana");return v.useEffect((()=>{if(t!=="preparing"||W||!f)return;let g=A==="SOL"?Ce(p):(function(I){return BigInt(Math.floor(1e6*parseFloat(I)))})(p);S({amount:(A==="SOL"&&F?fe(g,F):p)??p}),(A==="SOL"?(async function({solanaClient:I,source:j,destination:$,amountInLamports:G}){let{value:N}=await I.rpc.getLatestBlockhash().send(),V={address:j},R=Pe($e({version:0}),(L=>Be(V,L)),(L=>Le(N,L)),(L=>ve(sn({amount:G,source:V,destination:$}),L)),(L=>Ne(L)));return new Uint8Array(Oe().encode(R))})({solanaClient:O,source:f.address,destination:m,amountInLamports:g}):(async function({solanaClient:I,source:j,destination:$,amountInBaseUnits:G}){let N=Rt(I.chain),{value:V}=await I.rpc.getLatestBlockhash().send(),R={address:j},[L]=await De({mint:N,owner:j,tokenProgram:ke}),[Ae]=await De({mint:N,owner:$,tokenProgram:ke}),[Xe,et]=await Promise.all([I.rpc.getAccountInfo(L,{commitment:"confirmed",encoding:"jsonParsed"}).send().catch((()=>null)),I.rpc.getAccountInfo(Ae,{commitment:"confirmed",encoding:"jsonParsed"}).send().catch((()=>null))]);if(!Xe?.value)throw Error(`Source token account does not exist for address: ${j}`);let tt=vt({payer:R,ata:Ae,owner:$,mint:N}),nt=Pe($e({version:0}),(B=>Be(R,B)),(B=>Le(V,B)),(B=>et?.value?B:ve(tt,B)),(B=>ve(Tt({source:L,destination:Ae,authority:R,amount:G}),B)),(B=>Ne(B)));return new Uint8Array(Oe().encode(nt))})({solanaClient:O,source:f.address,destination:m,amountInBaseUnits:g})).then(c).catch((I=>{r("error"),C(I)}))}),[t,p,A,y,f,m,W,F]),v.useEffect((()=>{t==="preparing"&&u&&ln({tx:u,solanaClient:O,amount:p,asset:A,tokenPrice:F}).then((g=>{r("loaded"),S({amount:g?.amountInUsd??g?.amountInUsdc??g?.amountInSol??p,fee:g?.feeInUsd??g?.feeInSol,total:g?.totalInUsd??g?.totalInSol})})).catch((g=>{r("error"),C(g)}))}),[u,p,A,t,F]),v.useEffect((()=>{t==="error"&&D&&(d({errorModalData:{error:D,previousScreen:"FundSolWalletWithExternalSolanaWallet"},solanaFundingData:l.solanaFundingData}),o("ErrorScreen",!1))}),[t,o]),v.useEffect((()=>{if(t!=="success")return;let g=setTimeout(k?()=>o(k):n,St);return()=>clearTimeout(g)}),[t]),h.jsxs(h.Fragment,t==="success"?{children:[h.jsx(Te,{}),h.jsx(Et,{}),h.jsxs(Ot,{children:[h.jsx(It,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),h.jsx(Re,{title:"Success!",description:`Youâ€™ve successfully added ${p} ${A} to your ${e.name} wallet. It may take a minute before the funds are available to use.`})]}),h.jsx(jt,{}),h.jsx(Se,{})]}:t==="preparing"||t==="loaded"||t==="sending"?{children:[h.jsx(Te,{}),h.jsx(Ct,{style:{marginTop:"16px"},children:h.jsx(Wt,{icon:f?.standardWallet.icon,name:f?.standardWallet.name})}),h.jsx(Re,{style:{marginTop:"8px",marginBottom:"12px"},title:t==="sending"&&f?`Confirming with ${f.standardWallet.name}`:"Confirm transaction"}),h.jsx(rn,{rows:[{label:"Source",value:Ie(T.address)},{label:"Destination",value:Ie(m)},{label:"Network",value:kt(y)},{label:"Amount",value:w?.amount,isLoading:t==="preparing"},{label:"Estimated fee",value:w?.fee,isLoading:t==="preparing"},{label:"Total",value:w?.total,isLoading:t==="preparing"}]}),h.jsx(bt,{style:{marginTop:"1rem"},loading:t==="preparing"||t==="sending",onClick:function(){t==="loaded"&&u&&f&&(r("sending"),(async function({transaction:g,chain:I,sourceWallet:j,solanaClient:$}){let{hasFunds:G}=await Dt({solanaClient:$,tx:g});if(!G)throw new M(`Wallet ${Ie(j.address)} does not have enough funds.`,void 0,U.INSUFFICIENT_BALANCE);let N=Vt((await j.signAndSendTransaction({transaction:g,chain:I}).catch((V=>{throw new M("Transaction was rejected by the user",V,U.TRANSACTION_FAILURE)}))).signature);return await $t({rpcSubscriptions:$.rpcSubscriptions,signature:N,timeout:2e4}),N})({solanaClient:O,transaction:u,chain:y,sourceWallet:f}).then((g=>{r("success"),a({eventName:Lt,payload:{provider:"external",status:"success",txHash:g,address:f.address,value:p,chainType:"solana",clusterName:y,token:A,destinationAddress:m,destinationValue:p,destinationChainType:"solana",destinationClusterName:y,destinationToken:A}})})).catch((g=>{r("error"),C(g)})))},children:"Confirm"}),h.jsx(Se,{})]}:{children:[h.jsx(Te,{}),h.jsx(xt,{}),h.jsx("div",{style:{marginTop:"1rem"}}),h.jsx(Se,{})]})}};export{Wn as FundSolWalletWithExternalSolanaWallet,Wn as default};
