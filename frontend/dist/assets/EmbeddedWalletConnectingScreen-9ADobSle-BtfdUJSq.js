import{d4 as A,dA as P,d7 as V,d5 as M,d9 as y,dN as g,dO as W}from"./index-CFG-wFBU.js";import{n as U}from"./ScreenLayout-CNho46nP-BmM59R6W.js";import{C as _}from"./circle-x-BrPWZhts.js";import"./Button-BCV6mjvS-Diy1onH6.js";import"./Screen-_0H_rCdH-_AHEcb1T.js";import"./ModalHeader-BTru6YQw-DYdjiBJP.js";import"./index-CJMgUOnw-GErmhyO9.js";import"./createLucideIcon-Bi9Ux4FY.js";const O=({connectionFailed:i,onClose:s})=>A.jsx(U,i?{title:"Something went wrong",subtitle:"We're on it. Please try again later.",icon:_,iconVariant:"error",primaryCta:{label:"Close",onClick:s},watermark:!0}:{title:"Connecting to your wallet",subtitle:"Please wait...",iconVariant:"loading",showClose:!0,onClose:s,watermark:!1}),z={component:()=>{let{authenticated:i,user:s}=P(),{client:f,closePrivyModal:u,createAnalyticsEvent:m,walletProxy:o}=V(),{navigate:n,data:v,setModalData:I,onUserCloseViaDialogOrKeybindRef:E}=M(),x=y.useMemo((()=>Date.now()),[]),[w,S]=y.useState(!1),{onCompleteNavigateTo:t,onFailure:h,shouldForceMFA:T,entropyId:c,entropyIdVerifier:d,recoveryMethod:l,connectingWalletAddress:b,isUnifiedWallet:k=!1}=v?.connectWallet,e=r=>{w||(S(!0),h(typeof r=="string"?Error(r):r))};return y.useEffect((()=>{let r;return i?o?((async()=>{let p=await f.getAccessToken();if(!p)return e("User must be authenticated and have a Privy wallet before it can be connected");try{if(!k){if(!c||!d)return e("For on-device first-class chain wallets, entropyId and entropyIdVerifier are required");await o.connect({accessToken:p,entropyId:c,entropyIdVerifier:d})}T&&await o.verifyMfa({accessToken:p});let a=(Date.now()-x)/1e3;t==="EmbeddedWalletKeyExportScreen"&&a<1?r=setTimeout((()=>{n(t,!1)}),1e3*(1-a)):n(t,!1)}catch(a){if(g(a)&&l==="privy"){let C=await f.getAccessToken();if(!C)return e("User must be authenticated and have a Privy wallet before it can be recovered");try{m({eventName:"embedded_wallet_pinless_recovery_started",payload:{walletAddress:b}}),(await o?.recover({accessToken:C,entropyId:c,entropyIdVerifier:d}))?.entropyId||e(Error("Unable to recover wallet")),t?n(t):u({shouldCallAuthOnSuccess:!1}),m({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:b}}),n(t)}catch{e("An error has occurred, please try again.")}}else g(a)&&l!=="privy"&&l!=="privy-v2"?(I({...v,recoverWallet:{entropyId:c,entropyIdVerifier:d,onCompleteNavigateTo:t,onFailure:h},recoveryOAuthStatus:{provider:l,action:"recover",isInAccountCreateFlow:!1,shouldCreateEth:!1,shouldCreateSol:!1}}),n(W(l))):e(a)}})(),()=>clearTimeout(r)):void 0:e("User must be authenticated and have a Privy wallet before it can be connected")}),[i,s,o]),E.current=()=>{e("User exited before wallet could be connected"),u({shouldCallAuthOnSuccess:!1})},A.jsx(O,{connectionFailed:w,onClose:()=>u({shouldCallAuthOnSuccess:!1})})}};export{z as EmbeddedWalletConnectingScreen,O as EmbeddedWalletConnectingView,z as default};
