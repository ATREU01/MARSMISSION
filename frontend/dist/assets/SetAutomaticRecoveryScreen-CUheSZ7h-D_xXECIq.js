import{dA as E,d7 as F,d5 as P,d9 as y,d4 as e,ds as R,ez as g,el as w,dw as U}from"./index-C6aulGjq.js";import{F as W}from"./ExclamationTriangleIcon-BBMpLoPy.js";import{F as k}from"./LockClosedIcon-DINohc4u.js";import{t as x}from"./Button-BCV6mjvS-QQOxW8LY.js";import{y as v,s as j}from"./ModalHeader-BTru6YQw-DkYP7_q4.js";import{t as A}from"./Subtitle-DkvfP2Ev-HWIzc2N1.js";import{o as S}from"./Title-D0pfZff--OiqNSe8K.js";const M=R.div.withConfig({displayName:"WithCircleBorder",componentId:"sc-e4fc5563-0"})(["&&{border-width:4px;}display:flex;justify-content:center;align-items:center;padding:1rem;aspect-ratio:1;border-style:solid;border-color:",";border-radius:50%;"],(t=>t.$color??"var(--privy-color-accent)")),O={component:()=>{let{user:t}=E(),{client:b,walletProxy:m,refreshSessionAndUser:C,closePrivyModal:s}=F(),r=P(),{entropyId:u,entropyIdVerifier:I}=r.data?.recoverWallet,[a,f]=y.useState(!1),[i,T]=y.useState(null),[l,h]=y.useState(null);function n(){if(!a){if(l)return r.data?.setWalletPassword?.onFailure(l),void s();if(!i)return r.data?.setWalletPassword?.onFailure(Error("User exited set recovery flow")),void s()}}r.onUserCloseViaDialogOrKeybindRef.current=n;let $=!(!a&&!i);return e.jsxs(e.Fragment,l?{children:[e.jsx(v,{onClose:n},"header"),e.jsx(M,{$color:"var(--privy-color-error)",style:{alignSelf:"center"},children:e.jsx(W,{height:38,width:38,stroke:"var(--privy-color-error)"})}),e.jsx(S,{style:{marginTop:"0.5rem"},children:"Something went wrong"}),e.jsx(g,{style:{minHeight:"2rem"}}),e.jsx(x,{onClick:()=>h(null),children:"Try again"}),e.jsx(j,{})]}:{children:[e.jsx(v,{onClose:n},"header"),e.jsx(k,{style:{width:"3rem",height:"3rem",alignSelf:"center"}}),e.jsx(S,{style:{marginTop:"0.5rem"},children:"Automatically secure your account"}),e.jsx(A,{style:{marginTop:"1rem"},children:"When you log into a new device, youâ€™ll only need to authenticate to access your account. Never get logged out if you forget your password."}),e.jsx(g,{style:{minHeight:"2rem"}}),e.jsx(x,{loading:a,disabled:$,onClick:()=>(async function(){f(!0);try{let o=await b.getAccessToken(),c=w(t,u);if(!o||!m||!c)return;if(!(await m.setRecovery({accessToken:o,entropyId:u,entropyIdVerifier:I,existingRecoveryMethod:c.recoveryMethod,recoveryMethod:"privy"})).entropyId)throw Error("Unable to set recovery on wallet");let d=await C();if(!d)throw Error("Unable to set recovery on wallet");let p=w(d,c.address);if(!p)throw Error("Unabled to set recovery on wallet");T(!!d),setTimeout((()=>{r.data?.setWalletPassword?.onSuccess(p),s()}),U)}catch(o){h(o)}finally{f(!1)}})(),children:i?"Success":"Confirm"}),e.jsx(j,{})]})}};export{O as SetAutomaticRecoveryScreen,O as default};
