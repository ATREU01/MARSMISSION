import{d4 as e,d9 as o,dA as y,d7 as A,d5 as v,dq as U,d6 as C,e5 as M,e6 as T}from"./index-Cpv0zDxI.js";import{F as $}from"./EnvelopeIcon-CdM7iJ3j.js";import{i as P}from"./Layouts-Bmf8DxNP-Oxchg1Qk.js";import{g as q,n as D}from"./Button-BCV6mjvS-Dszq2MTY.js";import{t as R,a as F}from"./EmailInputForm-B4hjCxRU-BiTHswoP.js";import{e as I}from"./ErrorMessage-Cx8GKGhL-CQfknOzQ.js";import{n as L}from"./ScreenLayout-CNho46nP-Dt3g6k8I.js";import{M as N}from"./mail-BXzJwlx4.js";import"./Screen-_0H_rCdH-C2vR92kV.js";import"./ModalHeader-BTru6YQw-BHChfpN7.js";import"./index-CJMgUOnw-BrnuYJRU.js";import"./createLucideIcon-CExn7AN7.js";const W=o.forwardRef(((s,d)=>{let[r,g]=o.useState(""),[t,m]=o.useState(""),[l,u]=o.useState(!1),{authenticated:S,user:i}=y(),{initUpdateEmail:p}=A(),{navigate:n,setModalData:h,currentScreen:w}=v(),{enabled:j,token:f}=U(),k=C(),E=M(r)&&(k.disablePlusEmails&&r.includes("+")?(t||m("Please enter a valid email address without a '+'."),!1):(t&&m(""),!0)),x=l||!E,c=()=>{!j||f||S?(async a=>{if(!i?.email)throw Error("User is required to have an email address to update it.");u(!0);try{await p({oldAddress:i.email.address,newAddress:r,captchaToken:a}),n("AwaitingPasswordlessCodeScreen")}catch(b){h({errorModalData:{error:b,previousScreen:w||"LandingScreen"}}),n("ErrorScreen")}u(!1)})(f):(h({captchaModalData:{callback:a=>{if(!i?.email)throw Error("User is required to have an email address to update it.");return p({oldAddress:i.email.address,newAddress:r,captchaToken:a})},userIntentRequired:!1,onSuccessNavigateTo:"AwaitingPasswordlessCodeScreen",onErrorNavigateTo:"ErrorScreen"}}),n("CaptchaScreen"))};return e.jsxs(e.Fragment,{children:[e.jsxs(K,{children:[t&&e.jsx(I,{style:{marginTop:"0.25rem",textAlign:"left"},children:t}),e.jsxs(V,{$error:!!t,children:[e.jsx(T,{children:e.jsx(N,{})}),e.jsx("input",{ref:d,id:"email-input",type:"email",placeholder:"your@email.com",onChange:a=>g(a.target.value),onKeyUp:a=>{a.key==="Enter"&&c()},value:r,autoComplete:"email"}),s.stacked?null:e.jsx(q,{isSubmitting:l,onClick:c,disabled:x,children:"Submit"})]})]}),s.stacked?e.jsx(D,{loadingText:null,loading:l,disabled:x,onClick:c,style:{width:"100%"},children:"Submit"}):null]})}));let K=R,V=F;const z=({title:s="Update your email",subtitle:d="Add the email address you'd like to use going forward. We'll send you a confirmation code"})=>e.jsx(L,{title:s,subtitle:d,icon:$,watermark:!0,children:e.jsx(P,{children:e.jsx(W,{stacked:!0})})}),re={component:()=>e.jsx(z,{})};export{re as UpdateEmailScreen,z as UpdateEmailScreenView,re as default};
