import{dA as L,d5 as D,d6 as P,d7 as $,d9 as p,d4 as v,db as i,dJ as x,ej as _,dw as E,ek as M,e0 as h}from"./index-CxnvHo3x.js";import{i as W,B as j,C as F,o as Y,h as H,n as V,d as q,s as B,l as J,e as Q,r as G}from"./twitch-5IOe4sIQ-DTVx5oCU.js";import{F as K}from"./GlobeAltIcon-C97KZow0.js";import{a as X}from"./shouldProceedtoEmbeddedWalletCreationFlow-BI33jNSF-BTm6fm_z.js";import{n as z}from"./ScreenLayout-CNho46nP-CGlsDcj3.js";import{e as Z}from"./capitalizeFirstLetter-DmLYqXsO-tV1Idewc.js";import"./Button-BCV6mjvS-BQSVM_xe.js";import"./Screen-_0H_rCdH-BCzg1mBm.js";import"./ModalHeader-BTru6YQw-Bs39T04u.js";import"./index-CJMgUOnw-BfeihkNZ.js";const ee=({style:t})=>v.jsx(K,{style:{color:"var(--privy-color-error)",...t}});let O={google:{name:"Google",component:G},discord:{name:"Discord",component:Q},github:{name:"Github",component:J},linkedin:{name:"LinkedIn",component:B},twitter:{name:"Twitter",component:q},spotify:{name:"Spotify",component:V},instagram:{name:"Instagram",component:H},tiktok:{name:"Tiktok",component:Y},line:{name:"LINE",component:F},twitch:{name:"Twitch",component:j},apple:{name:"Apple",component:W}},te=({iconUrl:t,...o})=>h.createElement("svg",{width:"33",height:"32",viewBox:"0 0 33 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},h.createElement("foreignObject",{x:"2",y:"2",width:"29",height:"28"},h.createElement("img",{src:t,width:"29",height:"28",style:{display:"block",objectFit:"contain",borderRadius:"4px"},alt:"Provider icon"})));const f=(t,o)=>{if(t in O)return O[t];if(M(t)&&o){let a=o.find((e=>e.provider===t));if(a)return{name:a.provider_display_name,component:e=>h.createElement(te,{...e,iconUrl:a.provider_icon_url})}}return{name:"Unknown",component:ee}};function re(t,o,a){let e={detail:"",retryable:!1},s=Z(o);if(t?.privyErrorCode===i.LINKED_TO_ANOTHER_USER&&(e.detail="This account has already been linked to another user."),t?.privyErrorCode===i.INVALID_CREDENTIALS&&(e.retryable=!0,e.detail="Something went wrong. Try again."),t.privyErrorCode===i.OAUTH_USER_DENIED&&(e.detail=`Retry and check ${s} to finish connecting your account.`,e.retryable=!0),t?.privyErrorCode===i.TOO_MANY_REQUESTS&&(e.detail="Too many requests. Please wait before trying again."),t?.privyErrorCode===i.TOO_MANY_REQUESTS&&t.message.includes("provider rate limit")){let n=f(o,a).name;e.detail=`Request limit reached for ${n}. Please wait a moment and try again.`}if(t?.privyErrorCode===i.OAUTH_ACCOUNT_SUSPENDED){let n=f(o,a).name;e.detail=`Your ${n} account is suspended. Please try another login method.`}return t?.privyErrorCode===i.CANNOT_LINK_MORE_OF_TYPE&&(e.detail="You cannot authorize more than one account for this user."),t?.privyErrorCode===i.OAUTH_UNEXPECTED&&o.startsWith("privy:")&&(e.detail="Something went wrong. Please try again."),e}const oe=({providerName:t,ProviderLogo:o,success:a,errorMessage:e,onRetry:s})=>{let n=a?`Successfully connected with ${t}`:e?e.message:`Verifying connection to ${t}`;return v.jsx(z,{title:n,subtitle:a?"You're good to go!":e?e.detail:"Just a few moments more",icon:o,iconVariant:"loading",iconLoadingStatus:{success:a,fail:!!e},secondaryCta:e?.retryable&&s?{label:"Retry",onClick:s}:void 0,watermark:!0})},he={component:()=>{let{authenticated:t,logout:o,ready:a,user:e}=L(),{setModalData:s,navigate:n,resetNavigation:l}=D(),u=P(),{getAuthMeta:g,initLoginWithOAuth:C,loginWithOAuth:w,updateWallets:R,setReadyToTrue:S,closePrivyModal:N,createAnalyticsEvent:b}=$(),[y,U]=p.useState(!1),[A,d]=p.useState(void 0),c=g()?.provider||"google",{name:T,component:I}=f(c,u.customOAuthProviders);return p.useEffect((()=>{w(c).then((()=>{U(!0),S(!0)})).catch((r=>{if(S(!1),r?.privyErrorCode===i.ALLOWLIST_REJECTED)return d(void 0),l(),void n("AllowlistRejectionScreen");if(r?.privyErrorCode===i.USER_LIMIT_REACHED)return console.error(new x(r).toString()),d(void 0),l(),void n("UserLimitReachedScreen");if(r?.privyErrorCode===i.USER_DOES_NOT_EXIST)return d(void 0),l(),void n("AccountNotFoundScreen");if(r?.privyErrorCode===i.ACCOUNT_TRANSFER_REQUIRED&&r.data?.data?.nonce)return d(void 0),l(),s({accountTransfer:{nonce:r.data?.data?.nonce,account:r.data?.data?.subject,displayName:r.data?.data?.account?.displayName,linkMethod:g()?.provider,embeddedWalletAddress:r.data?.data?.otherUser?.embeddedWalletAddress,oAuthUserInfo:r.data?.data?.otherUser?.oAuthUserInfo}}),void n("LinkConflictScreen");let{retryable:m,detail:k}=re(r,c,u.customOAuthProviders);d({retryable:m,detail:k,message:"Authentication failed"})})).finally((()=>{_()}))}),[T,c]),p.useEffect((()=>{if(a&&t&&y&&e){if(u?.legal.requireUsersAcceptTerms&&!e.hasAcceptedTerms){let r=setTimeout((()=>{n("AffirmativeConsentScreen")}),E);return()=>clearTimeout(r)}if(X(e,u.embeddedWallets)){let r=setTimeout((()=>{s({createWallet:{onSuccess:()=>{},onFailure:m=>{console.error(m),b({eventName:"embedded_wallet_creation_failure_logout",payload:{error:m,provider:c,screen:"OAuthStatusScreen"}}),o()},callAuthOnSuccessOnClose:!0}}),n("EmbeddedWalletOnAccountCreateScreen")}),E);return()=>clearTimeout(r)}{let r=setTimeout((()=>N({shouldCallAuthOnSuccess:!0,isSuccess:!0})),E);return R(),()=>clearTimeout(r)}}}),[a,t,y,e]),v.jsx(oe,{providerName:T,ProviderLogo:I,success:y,errorMessage:A,onRetry:A?.retryable?()=>{_(),C(c),d(void 0)}:void 0})},isShownBeforeReady:!0};export{he as OAuthStatusScreen,oe as OAuthStatusScreenView,he as default};
