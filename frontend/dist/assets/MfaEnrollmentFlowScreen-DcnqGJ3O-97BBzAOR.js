import{d9 as n,dA as oe,f3 as z,d5 as G,d6 as J,d7 as se,eH as ae,d4 as e,dt as le,f4 as ie,eV as ce,eW as me,f5 as de}from"./index-D7nMmKzf.js";import{y as d,v as u,F as I}from"./ModalHeader-BTru6YQw-DO8X_2OJ.js";import{F as Y}from"./ShieldCheckIcon-CBrwcuKJ.js";import{n as v,b as ue}from"./Button-BCV6mjvS-CnRinvWJ.js";import{r as he,u as fe,l as xe,i as je}from"./EnrollTotp-CMtBCJbR-BH2mu0An.js";import{F as pe}from"./CheckCircleIcon-BEOZTi67.js";import{F as D}from"./PhoneIcon-f_XPmOT_.js";import{w as ye,p as we}from"./ConnectPhoneForm-OQSgPQxP--k36P4rU.js";import{a as ve,d as O,b as x,l as j,p,f as g,s as ge,m as K,c as q,C as Ce,L as Fe}from"./PinInput-C3_MNxMt-JDos2ahE.js";import{ErrorScreenView as ke}from"./ErrorScreen-Yi-Rhs0v-XGctZSPW.js";import"./QrCode-Oxn5GT3C-BNwEPH-x.js";import"./FingerPrintIcon-DujWPOEA.js";import"./Chip-Bsgj4Yc--CJFNBrbK.js";import"./LoadingSkeleton-CHdaq3pb-Bx-etR21.js";import"./LinkPasskeyScreen-B5LWH116-G5FlTa6K.js";import"./TodoList-Dn0Qu-vv-CM1Eimbn.js";import"./createLucideIcon-C9GMKqRJ.js";import"./check-BwLN_dXo.js";import"./ScreenLayout-CNho46nP-NI-VA8g5.js";import"./Screen-_0H_rCdH-BQcvWe35.js";import"./index-CJMgUOnw-CVNrZBd5.js";import"./circle-check-big-vBkRt-L4.js";import"./fingerprint-pattern-BVoZtmHj.js";import"./CopyToClipboard-DatKc59_-Q9evHqXL.js";import"./copy-Bx2Jwc5_-DngT74Oe.js";import"./Layouts-Bmf8DxNP-BBsG0PDI.js";import"./LabelXs-BOisBtqT-Df1MeHll.js";import"./Subtitle-DkvfP2Ev-D9evDQ8Y.js";import"./Title-D0pfZff--DOmkRLk3.js";import"./shared-CtYf3O54-BdNo99uG.js";import"./reservoir-kvLjIrEo-Czgs1T5V.js";import"./lock-JEtt1aYR.js";import"./dijkstra-COg3n3zL.js";function be({title:r,titleId:m,...h},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":m},h),r?n.createElement("title",{id:m},r):null,n.createElement("path",{fillRule:"evenodd",d:"M8.603 3.799A4.49 4.49 0 0 1 12 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 0 1 3.498 1.307 4.491 4.491 0 0 1 1.307 3.497A4.49 4.49 0 0 1 21.75 12a4.49 4.49 0 0 1-1.549 3.397 4.491 4.491 0 0 1-1.307 3.497 4.491 4.491 0 0 1-3.497 1.307A4.49 4.49 0 0 1 12 21.75a4.49 4.49 0 0 1-3.397-1.549 4.49 4.49 0 0 1-3.498-1.306 4.491 4.491 0 0 1-1.307-3.498A4.49 4.49 0 0 1 2.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 0 1 1.307-3.497 4.49 4.49 0 0 1 3.497-1.307Zm7.007 6.387a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z",clipRule:"evenodd"}))}const Ee=n.forwardRef(be);function Me({title:r,titleId:m,...h},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":m},h),r?n.createElement("title",{id:m},r):null,n.createElement("path",{fillRule:"evenodd",d:"M4.5 3.75a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V6.75a3 3 0 0 0-3-3h-15Zm4.125 3a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Zm-3.873 8.703a4.126 4.126 0 0 1 7.746 0 .75.75 0 0 1-.351.92 7.47 7.47 0 0 1-3.522.877 7.47 7.47 0 0 1-3.522-.877.75.75 0 0 1-.351-.92ZM15 8.25a.75.75 0 0 0 0 1.5h3.75a.75.75 0 0 0 0-1.5H15ZM14.25 12a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H15a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3.75a.75.75 0 0 0 0-1.5H15Z",clipRule:"evenodd"}))}const Se=n.forwardRef(Me),Re=({appName:r,onComplete:m,onReset:h,onClose:a})=>{let[s,A]=n.useState(""),[B,W]=n.useState(!1),[b,C]=n.useState(null),[E,M]=n.useState("enroll"),{initEnrollmentWithSms:f,submitEnrollmentWithSms:T}=z(),{data:l}=G(),S=J();function F(){l?.mfaEnrollmentFlow?.onSuccess(),m()}return b?e.jsx(ke,{allowlistConfig:S.allowlistConfig,error:b,onBack:()=>C(null),onRetry:()=>C(null)}):e.jsxs(e.Fragment,E==="enroll"?{children:[e.jsx(d,{backFn:h,onClose:a},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(D,{})}),e.jsx(j,{children:"Set up SMS verification"}),e.jsxs(p,{children:["We'll text a verification code to this mobile device whenever you use your ",r," ","wallet."]}),e.jsxs(O,{children:[e.jsx(ye,{onSubmit:async function({qualifiedPhoneNumber:y}){try{await f({phoneNumber:y}),A(y),M("verify")}catch(i){C(i)}},hideRecent:!0}),e.jsxs(Ce,{children:["By providing your mobile number, you agree to receive text messages from ",S?.name,". Some carrier charges may apply"]})]}),e.jsx(u,{})]}:B?{children:[e.jsx(d,{onClose:F},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(pe,{})}),e.jsx(j,{children:"SMS verification added"}),e.jsxs(p,{children:["From now on, you'll enter the verification code sent to your mobile device whenever you use your ",r," wallet."]}),e.jsx(g,{children:e.jsx(v,{onClick:F,children:"Done"})}),e.jsx(u,{})]}:{children:[e.jsx(d,{backFn:function(){E==="verify"?M("enroll"):h()},onClose:a},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(D,{})}),e.jsx(j,{children:"Enter enrollment code"}),e.jsxs(O,{children:[e.jsx(Fe,{onChange:async function(y){try{if(!y)return;await T({phoneNumber:s,mfaCode:y}),W(!0)}catch(i){throw ie(i)?Error("You have exceeded the maximum number of attempts. Please close this window and try again in 10 seconds."):ce(i)?Error("The code you entered is not valid"):me(i)?Error("You have exceeded the time limit for code entry. Please try again in 30 seconds."):de(i)?Error("Verification canceled"):Error("Unknown error")}}}),e.jsxs(p,{children:["To continue, enter the 6-digit code sent to ",e.jsx("strong",{children:we(s)})]})]}),e.jsx(u,{})]})},mn={component:()=>{let{user:r,enrollInMfa:m,ready:h}=oe(),[a,s]=n.useState(null),{unenrollWithSms:A,unenrollWithTotp:B,unenrollWithPasskey:W,submitEnrollmentWithTotp:b,initEnrollmentWithPasskey:C,submitEnrollmentWithPasskey:E,initEnrollmentWithTotp:M}=z(),{data:f,onUserCloseViaDialogOrKeybindRef:T}=G(),l=J(),{closePrivyModal:S}=se(),{promptMfa:F}=ae(),[y,i]=n.useState(!1),[R,$]=n.useState(null),[U,Z]=n.useState(null),o=()=>{S({shouldCallAuthOnSuccess:!0}),m(!1),setTimeout((()=>{s(null),$(null)}),500)},[Q,N]=n.useState(!1),[X,k]=n.useState();T.current=o;let _=r?.mfaMethods.includes("sms"),ee=!!r?.phone,ne=r?.mfaMethods.includes("totp"),te=r?.mfaMethods.includes("passkey"),P=_||ne||te,H=r?.linkedAccounts.filter((t=>t.type==="passkey")).map((t=>t.credentialId))??[];function w(){s(null),$(null)}async function L(t=H){N(!0);try{return await C(),await E({credentialIds:t},{removeForLogin:f?.mfaEnrollmentFlow?.shouldUnlinkOnUnenrollMfa}),f?.mfaEnrollmentFlow?.onSuccess(),o()}catch(c){k(c)}finally{N(!1)}}if(n.useEffect((()=>{P&&i(!0)}),[P]),!h||!r||!l)return e.jsxs(e.Fragment,{children:[e.jsx(d,{onClose:o},"header"),e.jsx(ve,{children:e.jsx(he,{})}),e.jsx(O,{children:e.jsx(le,{})}),e.jsx(u,{})]});if(a==="sms")return e.jsxs(e.Fragment,{children:[e.jsx(d,{backFn:w,onClose:o},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(I,{})}),e.jsx(j,{children:"Remove SMS verification?"}),e.jsxs(p,{children:["MFA adds an extra layer of security to your ",l?.name," account. Make sure you have other methods to secure your account."]}),e.jsx(g,{children:e.jsx(v,{$warn:!0,onClick:async function(){s(null);try{await A()}catch{s(null)}},children:"Remove"})}),e.jsx(u,{})]});if(a==="totp")return e.jsxs(e.Fragment,{children:[e.jsx(d,{backFn:w,onClose:o},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(I,{})}),e.jsx(j,{children:"Remove authenticator app verification?"}),e.jsxs(p,{children:["MFA adds an extra layer of security to your ",l?.name," account. Make sure you have other methods to secure your account."]}),e.jsx(g,{children:e.jsx(v,{$warn:!0,onClick:async function(){s(null);try{await B()}catch{s(null)}},children:"Remove"})}),e.jsx(u,{})]});if(a==="passkey"){let t=f?.mfaEnrollmentFlow?.shouldUnlinkOnUnenrollMfa??!0;return e.jsxs(e.Fragment,{children:[e.jsx(d,{backFn:w,onClose:o},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(I,{})}),e.jsx(j,{children:"Are you sure you want to remove this passkey?"}),e.jsx(p,{children:t?"Removing your passkey will remove as both a verification method and a login method.":"Removing your passkey will remove as a verification method."}),e.jsx(g,{children:e.jsx(v,{$warn:!0,onClick:async function(){s(null);try{await W({removeForLogin:f?.mfaEnrollmentFlow?.shouldUnlinkOnUnenrollMfa})}catch{s(null)}},children:"Remove"})}),e.jsx(u,{})]})}if(f.mfaEnrollmentFlow.mfaMethods.length===0&&!P)return e.jsxs(e.Fragment,{children:[e.jsx(d,{onClose:o},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(Y,{})}),e.jsx(j,{children:"Add more security"}),e.jsxs(p,{children:[l?.name," does not have any verification methods enabled."]}),e.jsx(g,{children:e.jsx(v,{onClick:o,children:"Close"})}),e.jsx(u,{})]});let V=!P&&!y;return V?e.jsxs(e.Fragment,{children:[e.jsx(d,{onClose:o},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(Y,{})}),e.jsx(j,{children:"Transaction Protection"}),e.jsx(p,{children:"Set up transaction protection to add an extra layer of security to your account"}),e.jsxs(ge,{children:[e.jsxs(K,{children:[e.jsx(q,{children:e.jsx(Ee,{})}),"Enable 2-Step verification for your ",l?.name," wallet."]}),e.jsxs(K,{children:[e.jsx(q,{children:e.jsx(Se,{})}),"You'll be prompted to authenticate to complete transactions."]})]}),e.jsxs(g,{children:[e.jsx(v,{onClick:()=>i(!0),children:"Continue"}),e.jsx(ue,{onClick:o,children:"Not now"})]}),e.jsx(u,{})]}):R==="sms"?e.jsx(Re,{appName:l?.name||"Privy",onComplete:o,onReset:w,onClose:o}):R==="totp"&&U?e.jsx(fe,{onClose:o,onReset:w,submitEnrollmentWithTotp:({mfaCode:t})=>(async function(c){try{return k(void 0),await b({mfaCode:c}),f?.mfaEnrollmentFlow?.onSuccess(),o()}catch(re){k(re)}finally{s(null)}})(t),totpInfo:{...U,appName:l?.name||"Privy"}}):R==="passkey"?e.jsx(xe,{onReset:w,onClose:o,submitEnrollmentWithPasskey:L}):e.jsx(je,{showIntro:V,userMfaMethods:r.mfaMethods,appMfaMethods:l.mfa.methods,userHasAuthSms:ee,backFn:function(){i(!1)},handleSelectMethod:async function(t){try{await F()}catch(c){return void k(c)}return t==="totp"?($(t),Z(null),void M().then((c=>{Z(c)})).catch((()=>{Z(null),w()}))):t==="passkey"&&H.length===1?await L():void $(t)},isTotpLoading:R==="totp"&&!U,isPasskeyLoading:Q,error:X,onClose:o,setRemovingMfaMethod:async t=>{try{await F()}catch(c){return void k(c)}s(t)}})}};export{mn as MfaEnrollmentFlowScreen,mn as default};
