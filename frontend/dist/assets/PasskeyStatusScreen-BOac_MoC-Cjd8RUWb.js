import{d4 as d,d5 as P,d6 as C,d7 as b,dA as T,d9 as t,dw as m,ds as _,da as O,db as g}from"./index-CkUsQRUE.js";import{a as x}from"./shouldProceedtoEmbeddedWalletCreationFlow-BI33jNSF-rW7eZrlc.js";import{n as W}from"./ScreenLayout-CNho46nP-BZr87J58.js";import{F}from"./fingerprint-pattern-CrGzAccK.js";import"./Button-BCV6mjvS-Bd2xhR6y.js";import"./Screen-_0H_rCdH-Bj3CTtS4.js";import"./ModalHeader-BTru6YQw-hOUjxTYb.js";import"./index-CJMgUOnw-CfXgTGb2.js";import"./createLucideIcon-CfMu-kE1.js";const j=({status:e,passkeySignupFlow:n=!1,error:s,onRetry:a})=>d.jsx(W,{title:(()=>{switch(e){case"loading":return"Waiting for passkey";case"success":return"Success";case"error":return"Something went wrong"}})(),subtitle:d.jsx(N,{children:(()=>{switch(e){case"loading":return n?"Please follow prompts to register your passkey.":`Please follow prompts to verify your passkey.
You will have to sign up with another method first to register a passkey for your account.`;case"success":return"You've successfully logged in with your passkey.";case"error":if(s instanceof O){if(s.privyErrorCode===g.CANNOT_LINK_MORE_OF_TYPE)return"Cannot link more passkeys to account.";if(s.privyErrorCode===g.PASSKEY_NOT_ALLOWED)return`Passkey request timed out or rejected by user.
You will have to sign up with another method first to register a passkey for your account.`}return`An unknown error occurred.
You will have to sign up with another method first to register a passkey for your account.`}})()}),icon:F,iconVariant:"loading",iconLoadingStatus:{success:e==="success",fail:e==="error"},primaryCta:e==="error"&&a?{label:"Retry",onClick:a}:e==="success"?{label:"Continue",disabled:!0}:void 0,watermark:!0}),U={component:()=>{let{data:e,setModalData:n,navigate:s}=P(),a=C(),{loginWithPasskey:h,signupWithPasskey:w,closePrivyModal:S,createAnalyticsEvent:k}=b(),{user:o,logout:v}=T(),{passkeySignupFlow:p}=e?.passkeyAuthModalData??{},f=m-500,[u,c]=t.useState("loading"),[E,A]=t.useState(null),i=t.useRef([]),l=r=>{i.current=[r,...i.current]};t.useEffect((()=>()=>{i.current.forEach((r=>clearTimeout(r))),i.current=[]}),[]);let y=async()=>{c("loading");try{p?await w():await h(),c("success")}catch(r){A(r),c("error")}};return t.useEffect((()=>{if(u==="success"&&o){if(a?.legal.requireUsersAcceptTerms&&!o.hasAcceptedTerms)return void l(setTimeout((()=>{s("AffirmativeConsentScreen")}),f));if(!x(o,a?.embeddedWallets))return void l(setTimeout((()=>{S({shouldCallAuthOnSuccess:!0,isSuccess:!0})}),m));l(setTimeout((()=>{n({createWallet:{onSuccess:()=>{},onFailure:r=>{console.error(r),k({eventName:"embedded_wallet_creation_failure_logout",payload:{error:r,screen:"PasskeyStatusScreen"}}),v()},callAuthOnSuccessOnClose:!0}}),s("EmbeddedWalletOnAccountCreateScreen")}),f))}}),[o,u]),t.useEffect((()=>{y()}),[]),d.jsx(j,{status:u,passkeySignupFlow:p,error:E,onRetry:y})}};let N=_.span.withConfig({displayName:"SubtitleText",componentId:"sc-5f92460f-0"})(["white-space:pre-wrap;"]);export{U as PasskeyStatusScreen,j as PasskeyStatusScreenView,U as default};
