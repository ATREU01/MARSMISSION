import{d9 as o,d4 as L}from"./index-CS8KJWRb.js";var ee=({as:n="div",...u},i)=>L.jsx(n,{...u,ref:i}),re=o.forwardRef(ee),te="https://challenges.cloudflare.com/turnstile/v0/api.js",U="cf-turnstile-script",ne="cf-turnstile",N="onloadTurnstileCallback",D=n=>!!document.getElementById(n),oe=({render:n="explicit",onLoadCallbackName:u=N,scriptOptions:{nonce:i="",defer:e=!0,async:l=!0,id:x="",appendTo:f,onError:w,crossOrigin:p=""}={}})=>{let s=x||U;if(D(s))return;let c=document.createElement("script");c.id=s,c.src=`${te}?onload=${u}&render=${n}`,!document.querySelector(`script[src="${c.src}"]`)&&(c.defer=!!e,c.async=!!l,i&&(c.nonce=i),p&&(c.crossOrigin=p),w&&(c.onerror=w,delete window[u]),(f==="body"?document.body:document.getElementsByTagName("head")[0]).appendChild(c))},g={normal:{width:300,height:65},compact:{width:150,height:140},invisible:{width:0,height:0,overflow:"hidden"},flexible:{minWidth:300,width:"100%",height:65},interactionOnly:{width:"fit-content",height:"auto",display:"flex"}};function ie(n){if(n!=="invisible"&&n!=="interactionOnly")return n}function ae(n=U){let[u,i]=o.useState(!1);return o.useEffect(()=>{let e=()=>{D(n)&&i(!0)},l=new MutationObserver(e);return l.observe(document,{childList:!0,subtree:!0}),e(),()=>{l.disconnect()}},[n]),u}var R="unloaded",M,ce=new Promise((n,u)=>{M={resolve:n,reject:u},R==="ready"&&n(void 0)}),se=(n=N)=>(R==="unloaded"&&(R="loading",window[n]=()=>{M.resolve(),R="ready",delete window[n]}),ce),q=o.forwardRef((n,u)=>{let{scriptOptions:i,options:e={},siteKey:l,onWidgetLoad:x,onSuccess:f,onExpire:w,onError:p,onBeforeInteractive:s,onAfterInteractive:c,onUnsupported:C,onTimeout:O,onLoadScript:$,id:H,style:G,as:J="div",injectScript:A=!0,rerenderOnCallbackChange:a=!1,...V}=n,d=e.size,P=o.useCallback(()=>typeof d>"u"?{}:e.execution==="execute"?g.invisible:e.appearance==="interaction-only"?g.interactionOnly:g[d],[e.execution,d,e.appearance]),[X,k]=o.useState(P()),m=o.useRef(null),[y,z]=o.useState(!1),t=o.useRef(void 0),I=o.useRef(!1),K=H||ne,h=o.useRef({onSuccess:f,onError:p,onExpire:w,onBeforeInteractive:s,onAfterInteractive:c,onUnsupported:C,onTimeout:O});o.useEffect(()=>{a||(h.current={onSuccess:f,onError:p,onExpire:w,onBeforeInteractive:s,onAfterInteractive:c,onUnsupported:C,onTimeout:O})});let B=i?.id||U,j=ae(B),W=i?.onLoadCallbackName||N,Q=e.appearance||"always",S=o.useMemo(()=>({sitekey:l,action:e.action,cData:e.cData,theme:e.theme||"auto",language:e.language||"auto",tabindex:e.tabIndex,"response-field":e.responseField,"response-field-name":e.responseFieldName,size:ie(d),retry:e.retry||"auto","retry-interval":e.retryInterval||8e3,"refresh-expired":e.refreshExpired||"auto","refresh-timeout":e.refreshTimeout||"auto",execution:e.execution||"render",appearance:e.appearance||"always","feedback-enabled":e.feedbackEnabled||!0,callback:r=>{I.current=!0,a?f?.(r):h.current.onSuccess?.(r)},"error-callback":a?p:(...r)=>h.current.onError?.(...r),"expired-callback":a?w:(...r)=>h.current.onExpire?.(...r),"before-interactive-callback":a?s:(...r)=>h.current.onBeforeInteractive?.(...r),"after-interactive-callback":a?c:(...r)=>h.current.onAfterInteractive?.(...r),"unsupported-callback":a?C:(...r)=>h.current.onUnsupported?.(...r),"timeout-callback":a?O:(...r)=>h.current.onTimeout?.(...r)}),[e.action,e.appearance,e.cData,e.execution,e.language,e.refreshExpired,e.responseField,e.responseFieldName,e.retry,e.retryInterval,e.tabIndex,e.theme,e.feedbackEnabled,e.refreshTimeout,l,d,a,a?f:null,a?p:null,a?w:null,a?s:null,a?c:null,a?C:null,a?O:null]),v=o.useCallback(()=>typeof window<"u"&&!!window.turnstile,[]);return o.useEffect(function(){A&&!y&&oe({onLoadCallbackName:W,scriptOptions:{...i,id:B}})},[A,y,i,B]),o.useEffect(function(){R!=="ready"&&se(W).then(()=>z(!0)).catch(console.error)},[]),o.useEffect(function(){if(!m.current||!y)return;let r=!1;return(async()=>{if(r||!m.current)return;let b=window.turnstile.render(m.current,S);t.current=b,t.current&&x?.(t.current)})(),()=>{r=!0,t.current&&(window.turnstile.remove(t.current),I.current=!1)}},[K,y,S]),o.useImperativeHandle(u,()=>{let{turnstile:r}=window;return{getResponse(){if(!r?.getResponse||!t.current||!v()){console.warn("Turnstile has not been loaded");return}return r.getResponse(t.current)},async getResponsePromise(b=3e4,Y=100){return new Promise((Z,F)=>{let E,_=async()=>{if(I.current&&window.turnstile&&t.current)try{let T=window.turnstile.getResponse(t.current);return E&&clearTimeout(E),T?Z(T):F(new Error("No response received"))}catch(T){return E&&clearTimeout(E),console.warn("Failed to get response",T),F(new Error("Failed to get response"))}E||(E=setTimeout(()=>{E&&clearTimeout(E),F(new Error("Timeout"))},b)),await new Promise(T=>setTimeout(T,Y)),await _()};_()})},reset(){if(!r?.reset||!t.current||!v()){console.warn("Turnstile has not been loaded");return}e.execution==="execute"&&k(g.invisible);try{I.current=!1,r.reset(t.current)}catch(b){console.warn(`Failed to reset Turnstile widget ${t}`,b)}},remove(){if(!r?.remove||!t.current||!v()){console.warn("Turnstile has not been loaded");return}k(g.invisible),I.current=!1,r.remove(t.current),t.current=null},render(){if(!r?.render||!m.current||!v()||t.current){console.warn("Turnstile has not been loaded or container not found");return}let b=r.render(m.current,S);return t.current=b,t.current&&x?.(t.current),e.execution!=="execute"&&k(d?g[d]:{}),b},execute(){if(e.execution!=="execute"){console.warn('Execution mode is not set to "execute"');return}if(!r?.execute||!m.current||!t.current||!v()){console.warn("Turnstile has not been loaded or container not found");return}r.execute(m.current,S),k(d?g[d]:{})},isExpired(){return!r?.isExpired||!t.current||!v()?(console.warn("Turnstile has not been loaded"),!1):r.isExpired(t.current)}}},[t,e.execution,d,S,m,v,y,x]),o.useEffect(()=>{j&&!y&&window.turnstile&&z(!0)},[y,j]),o.useEffect(()=>{k(P())},[e.execution,d,Q]),o.useEffect(()=>{!j||typeof $!="function"||$()},[j]),L.jsx(re,{ref:m,as:J,id:K,style:{...X,...G},...V})});q.displayName="Turnstile";const le=({delayedExecution:n,captchaContext:u,...i})=>{let{appId:e,setError:l,setToken:x,setExecuting:f,siteKey:w,ref:p}=u;return L.jsx(q,{...i,ref:p,siteKey:w??"",options:{action:e,size:"invisible",...n?{appearance:"execute",execution:"execute"}:{appearance:"always",execution:"render"}},onUnsupported:()=>{i.onUnsupported?.(),console.warn("Browser does not support Turnstile.")},onError:s=>{i.onError?.(s),l("Captcha failed"),f(!1)},onSuccess:s=>{i.onSuccess?.(s),x(s),f(!1)},onExpire:s=>{i.onExpire?.(s);try{p.current?.reset(),l(void 0),x(void 0)}catch{l("expired_and_failed_reset")}}})};export{le as TurnstileWrapper,le as default};
