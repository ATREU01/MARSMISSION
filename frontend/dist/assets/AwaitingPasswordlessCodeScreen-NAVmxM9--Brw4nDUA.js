import{d9 as a,d5 as B,d6 as $,d7 as q,dA as V,dw as F,d4 as r,dM as h,db as g,dJ as H,ds as y,dy as K}from"./index-DmVdG9W6.js";import{F as z}from"./EnvelopeIcon-CMgQ0f0H.js";import{F as X}from"./PhoneIcon-BHj9FXZq.js";import{o as Y}from"./Layouts-Bmf8DxNP-C3C_Aq3h.js";import{n as J}from"./Link-DwjLfHwW-D1J_iqmu.js";import{a as Q}from"./shouldProceedtoEmbeddedWalletCreationFlow-BI33jNSF-BUUI4d2i.js";import{n as Z}from"./ScreenLayout-CNho46nP-BSvcNole.js";import"./Button-BCV6mjvS-BbqgBKtc.js";import"./Screen-_0H_rCdH-qTnuStgt.js";import"./ModalHeader-BTru6YQw-Cc62kSKK.js";import"./index-CJMgUOnw-DJwIVxzE.js";function G({title:o,titleId:d,...E},u){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":d},E),o?a.createElement("title",{id:d},o):null,a.createElement("path",{fillRule:"evenodd",d:"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z",clipRule:"evenodd"}))}const ee=a.forwardRef(G),re=({contactMethod:o,authFlow:d,appName:E="Privy",whatsAppEnabled:u=!1,onBack:R,onCodeSubmit:b,onResend:k,errorMessage:p,success:w=!1,resendCountdown:C=0,onInvalidInput:j,onClearError:T})=>{let[f,x]=a.useState(U);a.useEffect((()=>{p||x(U)}),[p]);let M=async i=>{i.preventDefault();let n=i.currentTarget.value.replace(" ","");if(n==="")return;if(isNaN(Number(n)))return void j?.("Code should be numeric");T?.();let s=Number(i.currentTarget.name?.charAt(5)),l=[...n||[""]].slice(0,P-s),m=[...f.slice(0,s),...l,...f.slice(s+l.length)];x(m);let c=Math.min(Math.max(s+l.length,0),P-1);isNaN(Number(i.currentTarget.value))||document.querySelector(`input[name=code-${c}]`)?.focus(),m.every((v=>v&&!isNaN(+v)))&&(document.querySelector(`input[name=code-${c}]`)?.blur(),await b?.(m.join("")))};return r.jsx(Z,{title:"Enter confirmation code",subtitle:r.jsxs("span",d==="email"?{children:["Please check ",r.jsx(W,{children:o})," for an email from privy.io and enter your code below."]}:{children:["Please check ",r.jsx(W,{children:o})," for a",u?" WhatsApp":""," message from ",E," and enter your code below."]}),icon:d==="email"?z:X,onBack:R,showBack:!0,helpText:r.jsxs(se,{children:[r.jsxs("span",{children:["Didn't get ",d==="email"?"an email":"a message","?"]}),C?r.jsxs(le,{children:[r.jsx(ee,{color:"var(--privy-color-foreground)",strokeWidth:1.33,height:"12px",width:"12px"}),r.jsx("span",{children:"Code sent"})]}):r.jsx(J,{as:"button",size:"sm",onClick:k,children:"Resend code"})]}),children:r.jsx(ae,{children:r.jsx(Y,{children:r.jsxs(ne,{children:[r.jsx("div",{children:f.map(((i,n)=>r.jsx("input",{name:`code-${n}`,type:"text",value:f[n],onChange:M,onKeyUp:s=>{s.key==="Backspace"&&(l=>{T?.(),x([...f.slice(0,l),"",...f.slice(l+1)]),l>0&&document.querySelector(`input[name=code-${l-1}]`)?.focus()})(n)},inputMode:"numeric",autoFocus:n===0,pattern:"[0-9]",className:`${w?"success":""} ${p?"fail":""}`,autoComplete:K.isMobile?"one-time-code":"off"},n)))}),r.jsx(ie,{$fail:!!p,$success:w,children:r.jsx("span",{children:p==="Invalid or expired verification code"?"Incorrect code":p||(w?"Success!":"")})})]})})})})};let P=6,U=Array(6).fill("");var A,N,oe=((A=oe||{})[A.RESET_AFTER_DELAY=0]="RESET_AFTER_DELAY",A[A.CLEAR_ON_NEXT_VALID_INPUT=1]="CLEAR_ON_NEXT_VALID_INPUT",A),te=((N=te||{})[N.EMAIL=0]="EMAIL",N[N.SMS=1]="SMS",N);const Ee={component:()=>{let{navigate:o,lastScreen:d,navigateBack:E,setModalData:u,onUserCloseViaDialogOrKeybindRef:R}=B(),b=$(),{closePrivyModal:k,resendEmailCode:p,resendSmsCode:w,getAuthMeta:C,loginWithCode:j,updateWallets:T,createAnalyticsEvent:f}=q(),{authenticated:x,logout:M,user:i}=V(),{whatsAppEnabled:n}=$(),[s,l]=a.useState(!1),[m,c]=a.useState(null),[v,S]=a.useState(null),[I,L]=a.useState(0);R.current=()=>null;let _=C()?.email?0:1,O=_===0?C()?.email||"":C()?.phoneNumber||"",D=F-500;return a.useEffect((()=>{if(I){let t=setTimeout((()=>{L(I-1)}),1e3);return()=>clearTimeout(t)}}),[I]),a.useEffect((()=>{if(x&&s&&i){if(b?.legal.requireUsersAcceptTerms&&!i.hasAcceptedTerms){let t=setTimeout((()=>{o("AffirmativeConsentScreen")}),D);return()=>clearTimeout(t)}if(Q(i,b.embeddedWallets)){let t=setTimeout((()=>{u({createWallet:{onSuccess:()=>{},onFailure:e=>{console.error(e),f({eventName:"embedded_wallet_creation_failure_logout",payload:{error:e,screen:"AwaitingPasswordlessCodeScreen"}}),M()},callAuthOnSuccessOnClose:!0}}),o("EmbeddedWalletOnAccountCreateScreen")}),D);return()=>clearTimeout(t)}{T();let t=setTimeout((()=>k({shouldCallAuthOnSuccess:!0,isSuccess:!0})),F);return()=>clearTimeout(t)}}}),[x,s,i]),a.useEffect((()=>{if(m&&v===0){let t=setTimeout((()=>{c(null),S(null),document.querySelector("input[name=code-0]")?.focus()}),1400);return()=>clearTimeout(t)}}),[m,v]),r.jsx(re,{contactMethod:O,authFlow:_===0?"email":"sms",appName:b?.name,whatsAppEnabled:n,onBack:()=>E(),onCodeSubmit:async t=>{try{await j(t),l(!0)}catch(e){if(e instanceof h&&e.privyErrorCode===g.INVALID_CREDENTIALS)c("Invalid or expired verification code"),S(0);else if(e instanceof h&&e.privyErrorCode===g.CANNOT_LINK_MORE_OF_TYPE)c(e.message);else{if(e instanceof h&&e.privyErrorCode===g.USER_LIMIT_REACHED)return console.error(new H(e).toString()),void o("UserLimitReachedScreen");if(e instanceof h&&e.privyErrorCode===g.USER_DOES_NOT_EXIST)return void o("AccountNotFoundScreen");if(e instanceof h&&e.privyErrorCode===g.LINKED_TO_ANOTHER_USER)return u({errorModalData:{error:e,previousScreen:d??"AwaitingPasswordlessCodeScreen"}}),void o("ErrorScreen",!1);if(e instanceof h&&e.privyErrorCode===g.DISALLOWED_PLUS_EMAIL)return u({inlineError:{error:e}}),void o("ConnectOrCreateScreen",!1);if(e instanceof h&&e.privyErrorCode===g.ACCOUNT_TRANSFER_REQUIRED&&e.data?.data?.nonce)return u({accountTransfer:{nonce:e.data?.data?.nonce,account:O,displayName:e.data?.data?.account?.displayName,linkMethod:_===0?"email":"sms",embeddedWalletAddress:e.data?.data?.otherUser?.embeddedWalletAddress}}),void o("LinkConflictScreen");c("Issue verifying code"),S(0)}}},onResend:async()=>{L(30),_===0?await p():await w()},errorMessage:m||void 0,success:s,resendCountdown:I,onInvalidInput:t=>{c(t),S(1)},onClearError:()=>{v===1&&(c(null),S(null))}})}};let ae=y.div.withConfig({displayName:"PasswordlessCodeContainer",componentId:"sc-6187bfee-0"})(["display:flex;flex-direction:column;align-items:center;justify-content:center;margin:auto;gap:16px;flex-grow:1;width:100%;"]),ne=y.div.withConfig({displayName:"CodeInput",componentId:"sc-6187bfee-1"})(["display:flex;flex-direction:column;width:100%;gap:12px;> div:first-child{display:flex;justify-content:center;gap:0.5rem;width:100%;border-radius:var(--privy-border-radius-sm);> input{border:1px solid var(--privy-color-foreground-4);background:var(--privy-color-background);border-radius:var(--privy-border-radius-sm);padding:8px 10px;height:48px;width:40px;text-align:center;font-size:18px;font-weight:600;color:var(--privy-color-foreground);transition:all 0.2s ease;}> input:focus{border:1px solid var(--privy-color-foreground);box-shadow:0 0 0 1px var(--privy-color-foreground);}> input:invalid{border:1px solid var(--privy-color-error);}> input.success{border:1px solid var(--privy-color-border-success);background:var(--privy-color-success-bg);}> input.fail{border:1px solid var(--privy-color-border-error);background:var(--privy-color-error-bg);animation:shake 180ms;animation-iteration-count:2;}}@keyframes shake{0%{transform:translate(1px,0px);}33%{transform:translate(-1px,0px);}67%{transform:translate(-1px,0px);}100%{transform:translate(1px,0px);}}"]),ie=y.div.withConfig({displayName:"InputHelp",componentId:"sc-6187bfee-2"})(["line-height:20px;min-height:20px;font-size:14px;font-weight:400;color:",";display:flex;justify-content:center;width:100%;text-align:center;"],(o=>o.$success?"var(--privy-color-success-dark)":o.$fail?"var(--privy-color-error-dark)":"transparent")),se=y.div.withConfig({displayName:"HelpTextContainer",componentId:"sc-6187bfee-3"})(["display:flex;gap:8px;align-items:center;justify-content:center;width:100%;color:var(--privy-color-foreground-2);"]),le=y.div.withConfig({displayName:"Badge",componentId:"sc-6187bfee-4"})(["display:flex;align-items:center;justify-content:center;border-radius:var(--privy-border-radius-sm);padding:2px 8px;gap:4px;background:var(--privy-color-background-2);color:var(--privy-color-foreground-2);"]),W=y.span.withConfig({displayName:"BoldWrappingSpan",componentId:"sc-6187bfee-5"})(["font-weight:500;word-break:break-all;color:var(--privy-color-foreground);"]);export{Ee as AwaitingPasswordlessCodeScreen,re as AwaitingPasswordlessCodeScreenView,Ee as default};
