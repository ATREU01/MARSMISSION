import{d6 as I,d5 as T,d7 as U,dK as E,d9 as d,df as A,d4 as C,dL as $,dw as h,dM as x,db as O}from"./index-Cpv0zDxI.js";import{a as R}from"./shouldProceedtoEmbeddedWalletCreationFlow-BI33jNSF-wSwmOunJ.js";import{n as W}from"./ScreenLayout-CNho46nP-Dt3g6k8I.js";import"./Button-BCV6mjvS-Dszq2MTY.js";import"./Screen-_0H_rCdH-C2vR92kV.js";import"./ModalHeader-BTru6YQw-BHChfpN7.js";import"./index-CJMgUOnw-BrnuYJRU.js";const _=({providerApp:a,success:s,error:r,onClose:c})=>{let{title:i,subtitle:u}=d.useMemo((()=>s?{title:`Successfully connected with ${a.name}`,subtitle:"You're good to go!"}:r?{title:"Authentication failed",subtitle:r.message}:{title:`Connecting to ${a.name}`,subtitle:`Please check the pop-up from ${a.name} to continue`}),[s,r,a.name]);return C.jsx(W,{title:i,subtitle:u,icon:a.logoUrl,iconVariant:"loading",iconLoadingStatus:{success:s,fail:!!r},onBack:c,watermark:!0})},L={component:()=>{let a=I(),{data:s,navigate:r,setModalData:c,onUserCloseViaDialogOrKeybindRef:i}=T(),{crossAppAuthFlow:u,updateWallets:y,closePrivyModal:g,createAnalyticsEvent:w}=U(),{logout:b}=E(),[o,n]=d.useState({}),e=s?.crossAppAuth,p=new A(`There was an issue connecting your ${e?.name} account. Please try again.`),v=new $((async l=>{if(e?.popup)try{let t=await u({appId:l,popup:e.popup,action:e.action});n({data:t})}catch(t){if(t instanceof A)n({error:t});else if(t instanceof x){if(t.privyErrorCode===O.ACCOUNT_TRANSFER_REQUIRED&&t.data?.data?.nonce)return c({accountTransfer:{nonce:t.data?.data?.nonce,account:t.data?.data?.subject,displayName:t.data?.data?.account?.displayName,linkMethod:`privy:${e.appId}`,embeddedWalletAddress:t.data?.data?.otherUser?.embeddedWalletAddress,oAuthUserInfo:t.data?.data?.otherUser?.oAuthUserInfo}}),void r("LinkConflictScreen");e.popup&&e.popup.close(),n({error:p})}else n({error:p})}else n({error:p})})),m=()=>{o.data&&(y(),e?.onSuccess(o.data),g({shouldCallAuthOnSuccess:!0,isSuccess:!0})),e?.onError(o.error??new A("User canceled flow")),g({shouldCallAuthOnSuccess:!1,isSuccess:!1})};return i.current=m,d.useEffect((()=>{e?.appId?.length&&v.execute(e.appId)}),[e?.appId]),d.useEffect((()=>{if(!o.data)return;let l=o.data;if(a.legal.requireUsersAcceptTerms&&!l.hasAcceptedTerms){let f=setTimeout((()=>{r("AffirmativeConsentScreen")}),h);return()=>clearTimeout(f)}if(R(l,a.embeddedWallets)){let f=setTimeout((()=>{c({createWallet:{onSuccess:()=>{},onFailure:S=>{console.error(S),w({eventName:"embedded_wallet_creation_failure_logout",payload:{error:S,provider:`privy:${e?.appId}`,screen:"CrossAppAuthScreen"}}),b()},callAuthOnSuccessOnClose:!0}}),r("EmbeddedWalletOnAccountCreateScreen")}),h);return()=>clearTimeout(f)}let t=setTimeout(m,h);return()=>clearTimeout(t)}),[o.data]),e?.appId?C.jsx(_,{providerApp:{id:e?.appId,logoUrl:e?.logoUrl,name:e?.name},success:!!o.data,error:o.error,onClose:m}):(console.warn("Missing data for Screen"),null)},isShownBeforeReady:!0};export{L as CrossAppAuthScreen,_ as CrossAppAuthScreenView,L as default};
