import{dA as G,d5 as J,d6 as Q,d9 as l,d4 as e,dt as X}from"./index-CmAhqgXz.js";import{y,v as x,F as U}from"./ModalHeader-BTru6YQw-BpO7CAfA.js";import{F as Y}from"./ShieldCheckIcon-CSQRIrin.js";import{n as w}from"./Button-BCV6mjvS-C8I5Wwg0.js";import{r as Z,u as _,l as ee,i as te}from"./EnrollTotp-CMtBCJbR-CaeA9Ndu.js";import{a as oe,d as re,b as F,l as b,p as C,f as R}from"./PinInput-C3_MNxMt-_gXAKpqY.js";import"./QrCode-Oxn5GT3C-CKGNLLG-.js";import"./FingerPrintIcon-BfzLW31A.js";import"./PhoneIcon-mKFjxxzA.js";import"./Chip-Bsgj4Yc--BMnjiugn.js";import"./LoadingSkeleton-CHdaq3pb-BMtLVe-8.js";import"./ErrorScreen-Yi-Rhs0v-CW0wvB06.js";import"./reservoir-kvLjIrEo-Bdg9m_4-.js";import"./ScreenLayout-CNho46nP-_IbYTLdk.js";import"./Screen-_0H_rCdH-B1nWB8Tj.js";import"./index-CJMgUOnw-CZQTeXe-.js";import"./createLucideIcon-zHmFXpcR.js";import"./lock-Ca8Jo67Y.js";import"./LinkPasskeyScreen-B5LWH116-CXPrxHPp.js";import"./TodoList-Dn0Qu-vv-BRCtHt5J.js";import"./check-ixOE9G87.js";import"./circle-check-big-A7ZNFJuN.js";import"./fingerprint-pattern-DZxOx8kZ.js";import"./CopyToClipboard-DatKc59_-CW2Xy5Qv.js";import"./copy-Bx2Jwc5_-BHXvZ-Rz.js";import"./Layouts-Bmf8DxNP-DlEYzfZu.js";import"./LabelXs-BOisBtqT-D5ssQRrt.js";import"./Subtitle-DkvfP2Ev-CxuqpOcn.js";import"./Title-D0pfZff--DGCrwuNF.js";import"./shared-CtYf3O54-BHzhp0zC.js";import"./dijkstra-COg3n3zL.js";const Be={component:()=>{let{user:s,ready:B}=G(),{data:j,onUserCloseViaDialogOrKeybindRef:I}=J(),m=Q(),[v,i]=l.useState(null),[h,p]=l.useState(null),[g,k]=l.useState(null),[L,O]=l.useState(!1),[S,a]=l.useState(!1),[f,r]=l.useState(),n=async()=>{f?A(f):s?await c({user:s}):A(Error("Must be logged in to manage MFA")),setTimeout((()=>{i(null),p(null)}),500)};if(I.current=n,!j?.mfaEnroll)throw Error("Missing modal data for MFA enrollment screen.");let{onFailure:A,onSuccess:c,onBack:M,mfaMethods:W,verify:E,generateTotpSecret:D,enrollTotp:H,unenrollTotp:K,enrollPasskey:T}=j.mfaEnroll,N=s?.mfaMethods.includes("sms"),V=s?.mfaMethods.includes("totp"),q=s?.mfaMethods.includes("passkey"),z=!!s?.phone,$=s?.linkedAccounts.filter((t=>t.type==="passkey")).map((t=>t.credentialId))??[];function d(){i(null),p(null),r(void 0)}async function P(t=$){try{r(void 0),a(!0);let o=await T(t);return await c({user:o})}catch(o){r(o)}finally{a(!1),O(!1)}}if(!B||!s||!m)return e.jsxs(e.Fragment,{children:[e.jsx(y,{onClose:n,backFn:M},"header"),e.jsx(oe,{children:e.jsx(Z,{})}),e.jsx(re,{children:e.jsx(X,{})}),e.jsx(x,{})]});if(v==="sms")return null;if(v==="totp")return e.jsxs(e.Fragment,{children:[e.jsx(y,{backFn:d,onClose:n},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(U,{})}),e.jsx(b,{children:"Remove authenticator app verification?"}),e.jsxs(C,{children:["MFA adds an extra layer of security to your ",m?.name," account. Make sure you have other methods to secure your account."]}),e.jsx(R,{children:e.jsx(w,{$warn:!0,onClick:async function(){try{r(void 0),a(!0);let t=await K();return await c({user:t})}catch(t){r(t)}finally{a(!1),i(null)}},loading:S,children:"Remove"})}),e.jsx(x,{})]});if(v==="passkey"){let t=j.mfaEnroll.shouldUnlinkOnUnenrollMfa??!0;return e.jsxs(e.Fragment,{children:[e.jsx(y,{backFn:d,onClose:n},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(U,{})}),e.jsx(b,{children:"Are you sure you want to remove this passkey?"}),e.jsx(C,{children:t?"Removing your passkey will remove as both a verification method and a login method.":"Removing your passkey will remove as a verification method."}),e.jsx(R,{children:e.jsx(w,{$warn:!0,onClick:async function(){try{r(void 0),a(!0);let o=await T([]);return await c({user:o})}catch(o){r(o)}finally{a(!1),i(null)}},loading:S,children:"Remove"})}),e.jsx(x,{})]})}return W.length!==0||N||V||q?h==="sms"?null:h==="totp"&&g?e.jsx(_,{onClose:n,onReset:d,submitEnrollmentWithTotp:t=>(async function(o){try{r(void 0),a(!0);let u=await H(o);return await c({user:u})}catch(u){r(u)}finally{a(!1),i(null)}})(t.mfaCode),error:f,totpInfo:{...g,appName:m?.name||"Privy"}}):h==="passkey"?e.jsx(ee,{onReset:d,onClose:n,submitEnrollmentWithPasskey:P}):e.jsx(te,{showIntro:!0,userMfaMethods:s.mfaMethods,appMfaMethods:m.mfa.methods,userHasAuthSms:z,backFn:M,handleSelectMethod:async function(t){r(void 0);try{await E()}catch(o){return void r(o)}return t==="totp"?(p(t),k(null),void D().then((({totpSecret:o,totpAuthUrl:u})=>{k({authUrl:u,secret:o})})).catch((()=>{k(null),d()}))):t==="passkey"&&$.length===1?await P():void p(t)},isTotpLoading:h==="totp"&&!g,isPasskeyLoading:L,error:f,onClose:n,setRemovingMfaMethod:async function(t){r(void 0);try{await E()}catch(o){return void r(o)}i(t)}}):e.jsxs(e.Fragment,{children:[e.jsx(y,{onClose:n,backFn:M},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(Y,{})}),e.jsx(b,{children:"Add more security"}),e.jsxs(C,{children:[m?.name," does not have any verification methods enabled."]}),e.jsx(R,{children:e.jsx(w,{onClick:n,children:"Close"})}),e.jsx(x,{})]})}};export{Be as MfaAuthEnrollmentFlowScreen,Be as default};
