<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <title>Culture Coins - LAUNCHR (Preview)</title>
    <meta name="description" content="Culture Coins - Participate in communities, not trades.">
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" href="/favicon.ico" type="image/jpeg">
    <link rel="apple-touch-icon" href="/website/logo-icon.jpg">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Solana Web3.js for token creation -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        html, body, #root {
            min-height: 100vh;
            background: #0a0a0a;
        }

        ::selection {
            background: #fff;
            color: #000;
        }

        /* Preview Banner */
        .preview-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, #FFD966, #FF3D8E);
            color: #000;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            padding: 8px;
            letter-spacing: 0.1em;
            z-index: 9999;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* Access Gate */
        .access-gate {
            position: fixed;
            inset: 0;
            background: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        .access-box {
            text-align: center;
            max-width: 400px;
            padding: 48px;
        }
        .access-logo {
            width: 64px;
            height: 64px;
            margin-bottom: 32px;
        }
        .access-title {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            color: #fff;
            margin-bottom: 12px;
        }
        .access-subtitle {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            color: #666;
            margin-bottom: 32px;
        }
        .access-input {
            width: 100%;
            padding: 16px 20px;
            background: #111;
            border: 1px solid #333;
            color: #fff;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            text-align: center;
            letter-spacing: 0.1em;
            margin-bottom: 16px;
            outline: none;
            transition: border-color 0.2s;
        }
        .access-input:focus {
            border-color: #FFD966;
        }
        .access-input::placeholder {
            color: #444;
        }
        .access-btn {
            width: 100%;
            padding: 16px;
            background: #fff;
            color: #000;
            border: none;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: background 0.2s;
        }
        .access-btn:hover {
            background: #eee;
        }
        .access-error {
            color: #ef4444;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            margin-top: 16px;
        }
        .access-hint {
            color: #333;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            margin-top: 24px;
        }
    </style>
</head>
<body>
    <!-- Access Gate -->
    <div class="access-gate" id="accessGate">
        <div class="access-box">
            <img src="/website/logo-icon.jpg" alt="LAUNCHR" class="access-logo">
            <h1 class="access-title">Culture Coins</h1>
            <p class="access-subtitle">This preview is restricted to team members and testers.</p>
            <input
                type="password"
                class="access-input"
                id="accessCode"
                placeholder="ENTER ACCESS CODE"
                onkeypress="if(event.key === 'Enter') checkAccess()"
                autocomplete="off"
            >
            <button type="button" class="access-btn" id="enterBtn">ENTER</button>
            <div class="access-error" id="accessError"></div>
            <div class="access-hint">Contact team lead for access</div>
        </div>
    </div>

    <div class="preview-banner" id="previewBanner" style="display:none;">PREVIEW MODE - TESTERS ONLY</div>
    <div id="root"></div>

    <script>
        // Access control - runs immediately when DOM is ready
        (function() {
            const ACCESS_CODE = 'MATRIXNOW100!';

            function checkAccess() {
                var input = document.getElementById('accessCode');
                var gate = document.getElementById('accessGate');
                var banner = document.getElementById('previewBanner');
                var error = document.getElementById('accessError');

                if (input && input.value === ACCESS_CODE) {
                    sessionStorage.setItem('cc_access', 'granted');
                    if (gate) gate.style.display = 'none';
                    if (banner) banner.style.display = 'block';
                } else {
                    if (error) error.textContent = 'Invalid access code';
                    if (input) input.value = '';
                }
            }

            // Make checkAccess global for onkeypress
            window.checkAccess = checkAccess;

            // Check if already authenticated this session
            if (sessionStorage.getItem('cc_access') === 'granted') {
                var gate = document.getElementById('accessGate');
                var banner = document.getElementById('previewBanner');
                if (gate) gate.style.display = 'none';
                if (banner) banner.style.display = 'block';
            }

            // Add click handler when DOM is ready
            document.addEventListener('DOMContentLoaded', function() {
                var btn = document.getElementById('enterBtn');
                if (btn) {
                    btn.addEventListener('click', checkAccess);
                }
            });

            // Also try to attach immediately in case DOMContentLoaded already fired
            var btn = document.getElementById('enterBtn');
            if (btn) {
                btn.addEventListener('click', checkAccess);
            }
        })();
    </script>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext, useRef } = React;

        // ═══════════════════════════════════════════════════════════════════
        // CIA-LEVEL CLIENT SECURITY - Anti-Tampering & Verification
        // ═══════════════════════════════════════════════════════════════════
        const CultureSecurity = {
            // Nonce storage for replay protection
            usedNonces: new Set(),

            // Generate cryptographic nonce
            generateNonce() {
                const array = new Uint8Array(16);
                crypto.getRandomValues(array);
                return Array.from(array).map(b => b.toString(16).padStart(2, '0')).join('');
            },

            // Hash data using SHA-256
            async hash(data) {
                const encoder = new TextEncoder();
                const dataBuffer = encoder.encode(typeof data === 'string' ? data : JSON.stringify(data));
                const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);
                return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
            },

            // Verify response hasn't been tampered with
            async verifyResponse(response) {
                if (!response.signature || !response.timestamp) return true; // No signature to verify

                // Check response age (max 60 seconds)
                const age = Date.now() - response.timestamp;
                if (age > 60000 || age < -5000) {
                    console.warn('[SECURITY] Response too old or timestamp in future');
                    return false;
                }

                // Check nonce not reused
                if (response.nonce && this.usedNonces.has(response.nonce)) {
                    console.warn('[SECURITY] Nonce reuse detected - possible replay attack');
                    return false;
                }
                if (response.nonce) this.usedNonces.add(response.nonce);

                return true;
            },

            // Create signed request
            async createSecureRequest(data, wallet, signMessage) {
                const timestamp = Date.now();
                const nonce = this.generateNonce();

                const request = {
                    ...data,
                    timestamp,
                    nonce,
                    wallet
                };

                // Sign the request if signMessage function provided
                if (signMessage && wallet) {
                    try {
                        const message = `CULTURE_REQUEST:${nonce}:${timestamp}`;
                        const signature = await signMessage(message);
                        request.signature = signature;
                        request.message = message;
                    } catch (e) {
                        console.warn('[SECURITY] Could not sign request:', e.message);
                    }
                }

                return request;
            },

            // Secure API call with verification
            async secureApiCall(endpoint, method, data, options = {}) {
                const headers = {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-Client-Nonce': this.generateNonce()
                };

                if (options.authToken) {
                    headers['Authorization'] = `Bearer ${options.authToken}`;
                }

                try {
                    const response = await fetch(endpoint, {
                        method,
                        headers,
                        body: method !== 'GET' ? JSON.stringify(data) : undefined,
                        credentials: 'same-origin'
                    });

                    const json = await response.json();

                    // Verify response integrity
                    const verified = await this.verifyResponse(json);
                    if (!verified) {
                        console.error('[SECURITY] Response verification failed');
                        return { success: false, error: 'Response verification failed' };
                    }

                    return json;
                } catch (e) {
                    console.error('[SECURITY] API call failed:', e);
                    return { success: false, error: e.message };
                }
            },

            // Verify tier access with cryptographic proof
            async verifyTierAccess(wallet, cultureId, connection) {
                return this.secureApiCall('/api/culture/verify-access', 'POST', {
                    wallet,
                    cultureId
                });
            },

            // Get authentication challenge
            async getAuthChallenge(wallet, action) {
                return this.secureApiCall('/api/culture/auth-challenge', 'POST', {
                    wallet,
                    action
                });
            },

            // Tamper detection for culture data
            async verifyCultureIntegrity(culture) {
                if (!culture.stateHash) return true; // No hash to verify

                const computedHash = await this.hash({
                    id: culture.id,
                    name: culture.name,
                    creator: culture.creator,
                    tiers: culture.tiers,
                    beliefs: culture.beliefs,
                    unlocks: culture.unlocks,
                    tokenAddress: culture.tokenAddress,
                    createdAt: culture.createdAt
                });

                if (computedHash !== culture.stateHash) {
                    console.error('[SECURITY] Culture data has been tampered with!');
                    return false;
                }

                return true;
            },

            // Clean up old nonces periodically
            cleanupNonces() {
                if (this.usedNonces.size > 1000) {
                    const arr = Array.from(this.usedNonces);
                    this.usedNonces = new Set(arr.slice(-500));
                }
            }
        };

        // Run nonce cleanup every 5 minutes
        setInterval(() => CultureSecurity.cleanupNonces(), 300000);

        // Wallet Context for global state
        const WalletContext = createContext(null);

        // ═══════════════════════════════════════════════════════════════════
        // TOOLTIP COMPONENT - Hover explanations for users
        // ═══════════════════════════════════════════════════════════════════
        const Tooltip = ({ text, children }) => {
          const [show, setShow] = useState(false);
          const [position, setPosition] = useState({ x: 0, y: 0 });

          const handleMouseEnter = (e) => {
            const rect = e.currentTarget.getBoundingClientRect();
            setPosition({ x: rect.left + rect.width / 2, y: rect.top });
            setShow(true);
          };

          return (
            <span
              style={{ position: 'relative', display: 'inline-flex', alignItems: 'center', cursor: 'help' }}
              onMouseEnter={handleMouseEnter}
              onMouseLeave={() => setShow(false)}
            >
              {children}
              {show && (
                <div style={{
                  position: 'fixed',
                  left: position.x,
                  top: position.y - 10,
                  transform: 'translate(-50%, -100%)',
                  background: '#222',
                  border: '1px solid #444',
                  padding: '12px 16px',
                  borderRadius: '4px',
                  maxWidth: '300px',
                  zIndex: 10000,
                  boxShadow: '0 4px 20px rgba(0,0,0,0.5)'
                }}>
                  <div style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '12px',
                    color: '#ccc',
                    lineHeight: 1.6
                  }}>
                    {text}
                  </div>
                  <div style={{
                    position: 'absolute',
                    bottom: '-6px',
                    left: '50%',
                    transform: 'translateX(-50%) rotate(45deg)',
                    width: '10px',
                    height: '10px',
                    background: '#222',
                    borderRight: '1px solid #444',
                    borderBottom: '1px solid #444'
                  }} />
                </div>
              )}
            </span>
          );
        };

        // Info icon for tooltips
        const InfoIcon = ({ tooltip }) => (
          <Tooltip text={tooltip}>
            <span style={{
              display: 'inline-flex',
              alignItems: 'center',
              justifyContent: 'center',
              width: '18px',
              height: '18px',
              borderRadius: '50%',
              border: '1px solid #444',
              fontSize: '11px',
              color: '#888',
              marginLeft: '8px',
              fontFamily: "'IBM Plex Mono', monospace",
              fontWeight: 'bold'
            }}>?</span>
          </Tooltip>
        );

        // Section header with built-in tooltip support
        const SectionHeader = ({ title, tooltip, style = {} }) => (
          <div style={{
            display: 'flex',
            alignItems: 'center',
            fontSize: '10px',
            letterSpacing: '0.15em',
            color: '#666',
            marginBottom: '12px',
            fontFamily: "'IBM Plex Mono', monospace",
            ...style
          }}>
            {title}
            {tooltip && <InfoIcon tooltip={tooltip} />}
          </div>
        );

        // Config from server
        const SOLANA_RPC = window.LAUNCHR_CONFIG?.SOLANA_RPC || 'https://api.mainnet-beta.solana.com';

        // ═══════════════════════════════════════════════════════════════════
        // PUMP.FUN TOKEN CREATION - Real on-chain token launch
        // ═══════════════════════════════════════════════════════════════════

        // Upload token metadata to Pump.fun IPFS
        async function uploadCultureTokenMetadata(name, symbol, description, imageFile) {
            console.log('[CULTURE-DEPLOY] Uploading metadata for:', name, symbol);

            if (!imageFile) {
                throw new Error('Token icon is required for pump.fun upload');
            }

            const formData = new FormData();

            // Append the image file directly
            formData.append('file', imageFile, imageFile.name || 'culture-token.png');
            formData.append('name', name);
            formData.append('symbol', symbol);
            formData.append('description', description || `${name} - A Culture Coin on LAUNCHR`);
            formData.append('showName', 'true');

            console.log('[CULTURE-DEPLOY] Uploading to pump.fun IPFS via proxy...');

            // Use server proxy to avoid CORS issues
            const response = await fetch('/api/ipfs-upload', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                const errorText = await response.text();
                console.error('[CULTURE-DEPLOY] IPFS upload failed:', errorText);
                throw new Error('Failed to upload metadata to IPFS: ' + errorText);
            }

            const data = await response.json();
            console.log('[CULTURE-DEPLOY] Metadata uploaded:', data);

            return {
                metadataUri: data.metadataUri,
                metadata: { name, symbol, uri: data.metadataUri }
            };
        }

        // Create token via PumpPortal API
        async function createCultureTokenTransaction(walletAddress, mintKeypair, tokenMetadata, initialBuySOL = 0) {
            const { VersionedTransaction, Connection } = solanaWeb3;
            const connection = new Connection(SOLANA_RPC, 'confirmed');

            const requestBody = {
                publicKey: walletAddress,
                action: 'create',
                tokenMetadata: {
                    name: tokenMetadata.metadata.name,
                    symbol: tokenMetadata.metadata.symbol,
                    uri: tokenMetadata.metadataUri
                },
                mint: mintKeypair.publicKey.toBase58(),
                denominatedInSol: 'true',
                amount: initialBuySOL,
                slippage: 10,
                priorityFee: 0.0005,
                pool: 'pump'
            };

            console.log('[CULTURE-DEPLOY] Creating token via PumpPortal:', requestBody);

            const response = await fetch('https://pumpportal.fun/api/trade-local', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            if (response.status !== 200) {
                const errorText = await response.text();
                throw new Error(`PumpPortal API error: ${response.status} - ${errorText}`);
            }

            // PumpPortal returns raw binary transaction data
            const txBuffer = await response.arrayBuffer();
            console.log('[CULTURE-DEPLOY] Received transaction buffer, size:', txBuffer.byteLength);

            // Deserialize the versioned transaction
            const tx = VersionedTransaction.deserialize(new Uint8Array(txBuffer));
            console.log('[CULTURE-DEPLOY] Transaction deserialized successfully');

            return { transaction: tx, connection, mintKeypair };
        }

        // Sign and send culture token transaction
        // Follows exact same pattern as main launchpad.html
        async function signAndSendCultureToken(tx, connection, mintKeypair) {
            console.log('[CULTURE-DEPLOY] Signing transaction...');

            // Validate inputs
            if (!mintKeypair || !mintKeypair.publicKey || !mintKeypair.secretKey) {
                throw new Error('Invalid mint keypair');
            }
            console.log('[CULTURE-DEPLOY] Mint keypair public key:', mintKeypair.publicKey.toBase58());
            console.log('[CULTURE-DEPLOY] Mint keypair secret key length:', mintKeypair.secretKey.length);

            // Sign with the mint keypair (local signing for the token address)
            console.log('[CULTURE-DEPLOY] Using local mint keypair signing...');
            tx.sign([mintKeypair]);
            console.log('[CULTURE-DEPLOY] Transaction signed with mint keypair');

            // PRE-SIMULATE: Simulate transaction before showing to wallet
            // This helps Phantom understand the transaction and reduces warnings
            console.log('[CULTURE-DEPLOY] Pre-simulating transaction...');
            try {
                const simulation = await connection.simulateTransaction(tx, {
                    sigVerify: false, // Skip signature verification for simulation
                    replaceRecentBlockhash: true
                });
                if (simulation.value.err) {
                    console.warn('[CULTURE-DEPLOY] Simulation warning:', simulation.value.err);
                    // Don't throw - let the user try anyway, just log it
                } else {
                    console.log('[CULTURE-DEPLOY] Pre-simulation successful, units consumed:', simulation.value.unitsConsumed);
                }
            } catch (simErr) {
                console.warn('[CULTURE-DEPLOY] Pre-simulation failed (continuing anyway):', simErr.message);
            }

            let signature;

            // Try Phantom wallet first (same as main launchpad.html)
            if (window.solana?.isPhantom) {
                console.log('[CULTURE-DEPLOY] Using Phantom wallet for signing...');
                const signedTx = await window.solana.signTransaction(tx);
                signature = await connection.sendRawTransaction(signedTx.serialize(), {
                    skipPreflight: false,
                    preflightCommitment: 'confirmed',
                    maxRetries: 3
                });
            }
            // Try Solflare
            else if (window.solflare?.isSolflare) {
                console.log('[CULTURE-DEPLOY] Using Solflare wallet for signing...');
                const signedTx = await window.solflare.signTransaction(tx);
                signature = await connection.sendRawTransaction(signedTx.serialize(), {
                    skipPreflight: false,
                    preflightCommitment: 'confirmed',
                    maxRetries: 3
                });
            }
            else {
                throw new Error('No compatible wallet found. Please install Phantom or Solflare.');
            }

            console.log('[CULTURE-DEPLOY] Transaction sent, signature:', signature);

            // Wait for confirmation
            console.log('[CULTURE-DEPLOY] Waiting for confirmation...');
            const confirmation = await connection.confirmTransaction(signature, 'confirmed');

            if (confirmation.value.err) {
                throw new Error('Transaction failed: ' + JSON.stringify(confirmation.value.err));
            }

            console.log('[CULTURE-DEPLOY] Token created successfully!');
            return signature;
        }

        // Load user-created cultures from localStorage
        const getUserCultures = () => {
          try {
            return JSON.parse(localStorage.getItem('user_cultures') || '[]');
          } catch (e) {
            return [];
          }
        };

        const saveUserCulture = (culture) => {
          const existing = getUserCultures();
          existing.push(culture);
          localStorage.setItem('user_cultures', JSON.stringify(existing));
          return culture;
        };

        // Sample data + user created
        const BASE_CULTURES = [
          {
            id: 1,
            name: "Quiet Capital",
            ticker: "QUIET",
            ethos: "Long-term thinkers. Patient deployers. No noise.",
            category: "Trading & Markets",
            creator: "0x7a3...f291",
            creatorName: "Silent Operator",
            supply: 1000000,
            burned: 127340,
            pillars: [
              "Patience over performance theater",
              "Conviction requires silence",
              "Signal is inverse to volume",
              "Decades, not quarters"
            ],
            tiers: [
              { name: "Observer", percent: 0.1, access: "Read-only feed access", expectation: "Learn quietly" },
              { name: "Participant", percent: 0.5, access: "Bidding rights, weekly threads", expectation: "Contribute signal monthly" },
              { name: "Insider", percent: 1.5, access: "Live sessions, early drops", expectation: "Active participation" },
              { name: "Steward", percent: 5, access: "Direct access, culture shaping", expectation: "Guide new members" }
            ],
            avgHoldDays: 127,
            participationRate: 73,
            holders: 1247,
            activeAuctions: 2
          },
          {
            id: 2,
            name: "Form & Function",
            ticker: "FORM",
            ethos: "Taste is a muscle. Train it daily.",
            category: "Taste & Curation",
            creator: "0x3b1...e892",
            creatorName: "Curator Zero",
            supply: 500000,
            burned: 43200,
            pillars: [
              "Less, but better",
              "Context over content",
              "Edit ruthlessly",
              "Beauty is not optional"
            ],
            tiers: [
              { name: "Observer", percent: 0.2, access: "Weekly curation drops", expectation: "None" },
              { name: "Participant", percent: 1, access: "Submit for review", expectation: "One submission monthly" },
              { name: "Insider", percent: 3, access: "Private collection access", expectation: "Provide feedback" },
              { name: "Steward", percent: 8, access: "Co-curation rights", expectation: "Active curation" }
            ],
            avgHoldDays: 89,
            participationRate: 61,
            holders: 834,
            activeAuctions: 1
          },
          {
            id: 3,
            name: "Iron Protocol",
            ticker: "IRON",
            ethos: "Discipline is freedom. The body keeps score.",
            category: "Fitness & Performance",
            creator: "0x9c4...a123",
            creatorName: "Protocol One",
            supply: 2000000,
            burned: 289000,
            pillars: [
              "Show up before you feel ready",
              "Progressive overload in all things",
              "Recovery is not optional",
              "Numbers don't lie"
            ],
            tiers: [
              { name: "Observer", percent: 0.05, access: "Public programming", expectation: "None" },
              { name: "Participant", percent: 0.25, access: "Full program library", expectation: "Log workouts" },
              { name: "Insider", percent: 1, access: "Form checks, live Q&A", expectation: "Weekly check-ins" },
              { name: "Steward", percent: 3, access: "1:1 programming", expectation: "Mentor newcomers" }
            ],
            avgHoldDays: 201,
            participationRate: 84,
            holders: 2103,
            activeAuctions: 3
          },
          {
            id: 4,
            name: "First Principles",
            ticker: "FIRST",
            ethos: "Think from zero. Build from truth.",
            category: "Mindset & Philosophy",
            creator: "0x2e8...b445",
            creatorName: "Zero Base",
            supply: 750000,
            burned: 67800,
            pillars: [
              "Question the question",
              "Complexity is debt",
              "Mental models compound",
              "Write to think"
            ],
            tiers: [
              { name: "Observer", percent: 0.1, access: "Essay archive", expectation: "None" },
              { name: "Participant", percent: 0.4, access: "Discussion threads", expectation: "One comment weekly" },
              { name: "Insider", percent: 1.2, access: "Draft reviews, AMAs", expectation: "Share frameworks" },
              { name: "Steward", percent: 4, access: "Co-authorship", expectation: "Original contributions" }
            ],
            avgHoldDays: 156,
            participationRate: 68,
            holders: 967,
            activeAuctions: 1
          },
          {
            id: 5,
            name: "Local Maximum",
            ticker: "LOCAL",
            ethos: "Your city. Your people. Your spots.",
            category: "Local & IRL",
            creator: "0x5f2...c789",
            creatorName: "City Scout",
            supply: 300000,
            burned: 18900,
            pillars: [
              "The best things aren't online",
              "Regulars over tourists",
              "Support the neighborhood",
              "Show up in person"
            ],
            tiers: [
              { name: "Observer", percent: 0.15, access: "City guide access", expectation: "None" },
              { name: "Participant", percent: 0.6, access: "Event invites", expectation: "Attend quarterly" },
              { name: "Insider", percent: 2, access: "Private dinners", expectation: "Host one event yearly" },
              { name: "Steward", percent: 6, access: "Location partnerships", expectation: "Active community building" }
            ],
            avgHoldDays: 112,
            participationRate: 79,
            holders: 523,
            activeAuctions: 0
          },
          {
            id: 6,
            name: "Ship Daily",
            ticker: "SHIP",
            ethos: "Momentum over perfection. Build in public.",
            category: "Operator",
            creator: "0x1a7...d234",
            creatorName: "Builder Prime",
            supply: 1500000,
            burned: 198400,
            pillars: [
              "Done beats perfect",
              "Feedback is fuel",
              "Compound in public",
              "Constraints create"
            ],
            tiers: [
              { name: "Observer", percent: 0.08, access: "Build logs", expectation: "None" },
              { name: "Participant", percent: 0.35, access: "Beta access, feedback loops", expectation: "Test and report" },
              { name: "Insider", percent: 1.5, access: "Architecture reviews", expectation: "Ship weekly" },
              { name: "Steward", percent: 4.5, access: "Co-build opportunities", expectation: "Mentor builders" }
            ],
            avgHoldDays: 94,
            participationRate: 91,
            holders: 1876,
            activeAuctions: 4
          }
        ];

        // Combine base cultures with user-created ones
        const CULTURES = [...BASE_CULTURES, ...getUserCultures()];

        const CATEGORIES = [
          { name: "Operator", description: "Builders, founders, tacticians", count: 47 },
          { name: "Taste & Curation", description: "Fashion, art, music, aesthetics", count: 32 },
          { name: "Mindset & Philosophy", description: "Long-term thinkers, writers, strategists", count: 28 },
          { name: "Fitness & Performance", description: "Health, discipline, routine-based", count: 41 },
          { name: "Trading & Markets", description: "Signal-first, thesis-driven", count: 23 },
          { name: "Local & IRL", description: "City-based, event-driven communities", count: 19 }
        ];

        const AUCTIONS = [
          {
            id: 1,
            cultureId: 1,
            cultureName: "Quiet Capital",
            title: "The Case for Doing Nothing",
            description: "A framework for strategic patience in volatile markets. When inaction is the highest-conviction trade.",
            type: "Essay",
            minBid: 500,
            currentBid: 2340,
            bidCount: 12,
            endsIn: "2h 14m",
            burnOrReturn: "burn",
            bidder: "0x8f2...a901"
          },
          {
            id: 2,
            cultureId: 1,
            cultureName: "Quiet Capital",
            title: "Q1 Thesis Review - Live Session",
            description: "90-minute breakdown of positions, mistakes, and recalibrations. Unfiltered.",
            type: "Live Session",
            minBid: 1000,
            currentBid: 4120,
            bidCount: 8,
            endsIn: "6h 42m",
            burnOrReturn: "treasury",
            bidder: "0x3c1...b234"
          },
          {
            id: 3,
            cultureId: 3,
            cultureName: "Iron Protocol",
            title: "12-Week Hypertrophy Block",
            description: "Complete programming with progression schemes, deload protocols, and nutrition timing.",
            type: "Program",
            minBid: 250,
            currentBid: 890,
            bidCount: 23,
            endsIn: "18h 03m",
            burnOrReturn: "burn",
            bidder: "0x7e4...c567"
          }
        ];

        // Navigation Component
        const Navigation = ({ view, setView }) => (
          <nav style={{
            position: 'fixed',
            top: '36px',
            left: 0,
            right: 0,
            height: '60px',
            background: '#0a0a0a',
            borderBottom: '1px solid #1a1a1a',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'space-between',
            padding: '0 40px',
            zIndex: 1000,
            fontFamily: "'IBM Plex Mono', monospace"
          }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '32px' }}>
              <a href="/" style={{
                fontSize: '14px',
                fontWeight: 600,
                letterSpacing: '0.15em',
                color: '#fff',
                textDecoration: 'none',
                display: 'flex',
                alignItems: 'center',
                gap: '12px'
              }}>
                <img src="/website/logo-icon.jpg" alt="LAUNCHR" style={{ height: '28px', width: '28px' }} />
                CULTURE COINS
              </a>
              <div style={{ display: 'flex', gap: '24px' }}>
                {['discover', 'feed', 'create', 'auctions', 'dashboard'].map(v => (
                  <button
                    key={v}
                    onClick={() => setView(v)}
                    style={{
                      background: 'none',
                      border: 'none',
                      color: view === v ? '#fff' : '#666',
                      fontSize: '11px',
                      letterSpacing: '0.1em',
                      textTransform: 'uppercase',
                      cursor: 'pointer',
                      padding: '4px 0',
                      borderBottom: view === v ? '1px solid #fff' : '1px solid transparent',
                      transition: 'all 0.2s',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}
                  >
                    {v}
                  </button>
                ))}
              </div>
            </div>
            <WalletButton />
          </nav>
        );

        // Wallet Button Component
        const WalletButton = () => {
          const wallet = useContext(WalletContext);

          if (wallet?.address) {
            return (
              <button
                onClick={wallet.showModal}
                style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '10px',
                  padding: '10px 16px',
                  background: '#111',
                  border: '1px solid #333',
                  color: '#fff',
                  fontSize: '12px',
                  fontFamily: "'IBM Plex Mono', monospace",
                  cursor: 'pointer'
                }}
              >
                <div style={{ width: '8px', height: '8px', borderRadius: '50%', background: '#22c55e' }} />
                {wallet.address.slice(0,4)}...{wallet.address.slice(-4)}
              </button>
            );
          }

          return (
            <button
              onClick={wallet?.connect}
              style={{
                padding: '10px 20px',
                background: '#fff',
                border: 'none',
                color: '#000',
                fontSize: '11px',
                fontFamily: "'IBM Plex Mono', monospace",
                letterSpacing: '0.1em',
                cursor: 'pointer',
                fontWeight: 600
              }}
            >
              CONNECT
            </button>
          );
        };

        // Discovery View
        const DiscoveryView = ({ onSelectCulture }) => {
          const [selectedCategory, setSelectedCategory] = useState(null);
          const [cultures, setCultures] = useState(CULTURES);
          const [loading, setLoading] = useState(true);
          const [searchQuery, setSearchQuery] = useState('');

          // Fetch cultures from API on mount and enrich with live pump.fun data
          useEffect(() => {
            const fetchCultures = async () => {
              try {
                const res = await fetch('/api/cultures');
                const data = await res.json();
                if (data.success && data.cultures) {
                  // Merge API cultures with base cultures (API cultures take priority)
                  const apiCultureIds = new Set(data.cultures.map(c => c.id));
                  const baseCulturesFiltered = BASE_CULTURES.filter(c => !apiCultureIds.has(c.id));
                  const allCultures = [...data.cultures, ...baseCulturesFiltered];

                  // Enrich with live pump.fun data for cultures with tokenAddress
                  const enriched = await Promise.all(allCultures.map(async (culture) => {
                    if (!culture.tokenAddress) return culture;
                    try {
                      const pumpRes = await fetch(`/api/pump/coin/${culture.tokenAddress}`);
                      if (pumpRes.ok) {
                        const pumpData = await pumpRes.json();
                        if (pumpData) {
                          return {
                            ...culture,
                            marketCap: pumpData.usd_market_cap || 0,
                            holders: pumpData.holder_count || 0,
                            volume: pumpData.volume_24h || 0
                          };
                        }
                      }
                    } catch (e) {
                      console.error('[DISCOVER] Failed to enrich', culture.name, e);
                    }
                    return culture;
                  }));

                  setCultures(enriched);
                }
              } catch (e) {
                console.error('[DISCOVER] Failed to fetch cultures:', e);
              } finally {
                setLoading(false);
              }
            };
            fetchCultures();
          }, []);

          // Filter by category and search query (name, ticker, or contract address)
          const filteredCultures = cultures.filter(c => {
            const matchesCategory = !selectedCategory || c.category === selectedCategory;
            if (!searchQuery.trim()) return matchesCategory;

            const query = searchQuery.toLowerCase().trim();
            const matchesSearch =
              (c.name && c.name.toLowerCase().includes(query)) ||
              (c.ticker && c.ticker.toLowerCase().includes(query)) ||
              (c.symbol && c.symbol.toLowerCase().includes(query)) ||
              (c.tokenAddress && c.tokenAddress.toLowerCase().includes(query));

            return matchesCategory && matchesSearch;
          });

          return (
            <div style={{ padding: '136px 40px 60px' }}>
              {/* Header */}
              <div style={{ marginBottom: '60px' }}>
                <h1 style={{
                  fontFamily: "'Playfair Display', serif",
                  fontSize: '48px',
                  fontWeight: 400,
                  color: '#fff',
                  marginBottom: '16px',
                  letterSpacing: '-0.02em'
                }}>
                  Explore Cultures
                </h1>
                <p style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '14px',
                  color: '#888',
                  maxWidth: '600px',
                  lineHeight: 1.7
                }}>
                  Culture Coins are not traded for profit. They are held to participate,
                  signal belief, and shape a way of life.
                </p>
              </div>

              {/* Search */}
              <div style={{ marginBottom: '32px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  background: '#0f0f0f',
                  border: '1px solid #222',
                  padding: '0 16px'
                }}>
                  <span style={{ color: '#666', marginRight: '12px', fontSize: '14px' }}>⌕</span>
                  <input
                    type="text"
                    placeholder="Search by name, ticker, or contract address..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    style={{
                      flex: 1,
                      padding: '14px 0',
                      background: 'transparent',
                      border: 'none',
                      outline: 'none',
                      color: '#fff',
                      fontSize: '13px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}
                  />
                  {searchQuery && (
                    <button
                      onClick={() => setSearchQuery('')}
                      style={{
                        background: 'transparent',
                        border: 'none',
                        color: '#666',
                        cursor: 'pointer',
                        fontSize: '16px',
                        padding: '4px 8px'
                      }}
                    >
                      ✕
                    </button>
                  )}
                </div>
              </div>

              {/* Categories */}
              <div style={{ marginBottom: '48px' }}>
                <div style={{
                  fontSize: '10px',
                  letterSpacing: '0.15em',
                  color: '#666',
                  marginBottom: '16px',
                  fontFamily: "'IBM Plex Mono', monospace"
                }}>
                  CATEGORIES
                </div>
                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                  <button
                    onClick={() => setSelectedCategory(null)}
                    style={{
                      padding: '10px 16px',
                      background: !selectedCategory ? '#fff' : 'transparent',
                      color: !selectedCategory ? '#000' : '#888',
                      border: '1px solid',
                      borderColor: !selectedCategory ? '#fff' : '#333',
                      fontSize: '11px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.05em',
                      cursor: 'pointer',
                      transition: 'all 0.2s'
                    }}
                  >
                    All Cultures
                  </button>
                  {CATEGORIES.map(cat => (
                    <button
                      key={cat.name}
                      onClick={() => setSelectedCategory(cat.name)}
                      style={{
                        padding: '10px 16px',
                        background: selectedCategory === cat.name ? '#fff' : 'transparent',
                        color: selectedCategory === cat.name ? '#000' : '#888',
                        border: '1px solid',
                        borderColor: selectedCategory === cat.name ? '#fff' : '#333',
                        fontSize: '11px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.05em',
                        cursor: 'pointer',
                        transition: 'all 0.2s'
                      }}
                    >
                      {cat.name} <span style={{ opacity: 0.5 }}>({cat.count})</span>
                    </button>
                  ))}
                </div>
              </div>

              {/* Culture Grid */}
              <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fill, minmax(380px, 1fr))',
                gap: '24px'
              }}>
                {filteredCultures.map(culture => (
                  <div
                    key={culture.id}
                    onClick={() => onSelectCulture(culture)}
                    style={{
                      background: '#0f0f0f',
                      border: '1px solid #1a1a1a',
                      padding: '32px',
                      cursor: 'pointer',
                      transition: 'all 0.3s',
                      position: 'relative',
                      overflow: 'hidden'
                    }}
                    onMouseEnter={e => {
                      e.currentTarget.style.borderColor = '#333';
                      e.currentTarget.style.transform = 'translateY(-2px)';
                    }}
                    onMouseLeave={e => {
                      e.currentTarget.style.borderColor = '#1a1a1a';
                      e.currentTarget.style.transform = 'translateY(0)';
                    }}
                  >
                    {/* Category Tag */}
                    <div style={{
                      fontSize: '9px',
                      letterSpacing: '0.15em',
                      color: '#666',
                      marginBottom: '16px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      {culture.category.toUpperCase()}
                    </div>

                    {/* Name & Ethos */}
                    <h3 style={{
                      fontFamily: "'Playfair Display', serif",
                      fontSize: '28px',
                      fontWeight: 400,
                      color: '#fff',
                      marginBottom: '12px'
                    }}>
                      {culture.name}
                    </h3>
                    <p style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '13px',
                      color: '#999',
                      lineHeight: 1.6,
                      marginBottom: '24px'
                    }}>
                      "{culture.ethos}"
                    </p>

                    {/* Stats - Real data from pump.fun */}
                    <div style={{
                      display: 'grid',
                      gridTemplateColumns: 'repeat(3, 1fr)',
                      gap: '16px',
                      borderTop: '1px solid #1a1a1a',
                      paddingTop: '20px'
                    }}>
                      <div>
                        <div style={{
                          fontSize: '18px',
                          color: '#22c55e',
                          fontFamily: "'IBM Plex Mono', monospace",
                          marginBottom: '4px'
                        }}>
                          {culture.marketCap
                            ? (culture.marketCap >= 1000000
                                ? `$${(culture.marketCap / 1000000).toFixed(1)}M`
                                : `$${(culture.marketCap / 1000).toFixed(1)}K`)
                            : '-'}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>
                          MCAP
                        </div>
                      </div>
                      <div>
                        <div style={{
                          fontSize: '18px',
                          color: '#fff',
                          fontFamily: "'IBM Plex Mono', monospace",
                          marginBottom: '4px'
                        }}>
                          {culture.volume
                            ? (culture.volume >= 1000000
                                ? `$${(culture.volume / 1000000).toFixed(1)}M`
                                : `$${(culture.volume / 1000).toFixed(1)}K`)
                            : '-'}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>
                          VOLUME
                        </div>
                      </div>
                      <div>
                        <div style={{
                          fontSize: '18px',
                          color: '#fff',
                          fontFamily: "'IBM Plex Mono', monospace",
                          marginBottom: '4px'
                        }}>
                          {(culture.holders || 0).toLocaleString()}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>
                          HOLDERS
                        </div>
                      </div>
                    </div>

                    {/* Active indicator */}
                    {culture.activeAuctions > 0 && (
                      <div style={{
                        position: 'absolute',
                        top: '24px',
                        right: '24px',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '6px'
                      }}>
                        <div style={{
                          width: '6px',
                          height: '6px',
                          borderRadius: '50%',
                          background: '#22c55e',
                          animation: 'pulse 2s infinite'
                        }} />
                        <span style={{
                          fontSize: '10px',
                          color: '#22c55e',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}>
                          {culture.activeAuctions} LIVE
                        </span>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          );
        };

        // Auction Card Component
        const AuctionCard = ({ auction, compact = false }) => {
          const [bidAmount, setBidAmount] = useState('');
          const [showBidInput, setShowBidInput] = useState(false);

          return (
            <div style={{
              background: '#0f0f0f',
              border: '1px solid #1a1a1a',
              padding: compact ? '24px' : '32px'
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '16px' }}>
                <div>
                  <div style={{
                    fontSize: '9px',
                    letterSpacing: '0.15em',
                    color: '#666',
                    marginBottom: '8px',
                    fontFamily: "'IBM Plex Mono', monospace"
                  }}>
                    {auction.type.toUpperCase()} - {auction.cultureName}
                  </div>
                  <h3 style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: compact ? '18px' : '22px',
                    color: '#fff',
                    marginBottom: '8px'
                  }}>
                    {auction.title}
                  </h3>
                </div>
                <div style={{
                  background: '#1a1a1a',
                  padding: '8px 12px',
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '11px',
                  color: '#fff'
                }}>
                  {auction.endsIn}
                </div>
              </div>

              {!compact && (
                <p style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#888',
                  lineHeight: 1.6,
                  marginBottom: '24px'
                }}>
                  {auction.description}
                </p>
              )}

              <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(3, 1fr)',
                gap: '16px',
                borderTop: '1px solid #1a1a1a',
                paddingTop: '16px',
                marginBottom: '16px'
              }}>
                <div>
                  <div style={{
                    fontSize: compact ? '16px' : '20px',
                    color: '#fff',
                    fontFamily: "'IBM Plex Mono', monospace",
                    marginBottom: '4px'
                  }}>
                    {auction.currentBid.toLocaleString()}
                  </div>
                  <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>
                    CURRENT BID
                  </div>
                </div>
                <div>
                  <div style={{
                    fontSize: compact ? '16px' : '20px',
                    color: '#666',
                    fontFamily: "'IBM Plex Mono', monospace",
                    marginBottom: '4px'
                  }}>
                    {auction.bidCount}
                  </div>
                  <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>
                    BIDS
                  </div>
                </div>
                <div>
                  <div style={{
                    fontSize: compact ? '16px' : '20px',
                    color: auction.burnOrReturn === 'burn' ? '#ef4444' : '#22c55e',
                    fontFamily: "'IBM Plex Mono', monospace",
                    marginBottom: '4px'
                  }}>
                    {auction.burnOrReturn === 'burn' ? 'BURN' : 'TREASURY'}
                  </div>
                  <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>
                    OUTCOME
                  </div>
                </div>
              </div>

              <div style={{
                background: '#0a0a0a',
                padding: '12px 16px',
                marginBottom: '16px',
                fontSize: '11px',
                color: '#666',
                fontFamily: "'IBM Plex Mono', monospace",
                lineHeight: 1.5
              }}>
                {auction.burnOrReturn === 'burn'
                  ? 'Winning bid is burned to strengthen the culture economy.'
                  : 'Winning bid returns to creator treasury for future rewards.'}
              </div>

              {showBidInput ? (
                <div style={{ display: 'flex', gap: '12px' }}>
                  <input
                    type="number"
                    value={bidAmount}
                    onChange={e => setBidAmount(e.target.value)}
                    placeholder={`Min: ${auction.currentBid + 100}`}
                    style={{
                      flex: 1,
                      padding: '12px 16px',
                      background: '#0a0a0a',
                      border: '1px solid #333',
                      color: '#fff',
                      fontSize: '14px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      outline: 'none'
                    }}
                  />
                  <button
                    style={{
                      padding: '12px 24px',
                      background: '#fff',
                      color: '#000',
                      border: 'none',
                      fontSize: '11px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em',
                      cursor: 'pointer'
                    }}
                  >
                    PLACE BID
                  </button>
                </div>
              ) : (
                <button
                  onClick={() => setShowBidInput(true)}
                  style={{
                    width: '100%',
                    padding: '14px',
                    background: 'transparent',
                    color: '#fff',
                    border: '1px solid #333',
                    fontSize: '11px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    letterSpacing: '0.1em',
                    cursor: 'pointer',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={e => e.currentTarget.style.borderColor = '#666'}
                  onMouseLeave={e => e.currentTarget.style.borderColor = '#333'}
                >
                  SIGNAL VALUE
                </button>
              )}
            </div>
          );
        };

        // Culture Page
        const CulturePage = ({ culture, onBack }) => {
          const [showJoinModal, setShowJoinModal] = useState(false);
          const [selectedTier, setSelectedTier] = useState(null);
          const [agreedToTerms, setAgreedToTerms] = useState(false);
          const wallet = useContext(WalletContext);

          // Theme with fallback defaults
          const theme = culture.theme || {};
          const accentColor = theme.accentColor || '#22c55e';
          const textColor = theme.textColor || '#ffffff';
          const cardBg = theme.cardBg || '#0f0f0f';
          const borderColor = theme.borderColor || '#1a1a1a';

          // Pattern definitions for themed backgrounds
          const patterns = {
            none: 'none',
            dots: 'radial-gradient(circle, #333 1px, transparent 1px)',
            grid: 'linear-gradient(#222 1px, transparent 1px), linear-gradient(90deg, #222 1px, transparent 1px)',
            diagonal: 'repeating-linear-gradient(45deg, #1a1a1a, #1a1a1a 10px, #0f0f0f 10px, #0f0f0f 20px)',
            hearts: 'url("data:image/svg+xml,%3Csvg width=\'40\' height=\'40\' viewBox=\'0 0 40 40\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M20 30l-7-7c-4-4-4-10 0-14s10-4 14 0l-7 7 7 7c4 4 4 10 0 14s-10 4-14 0l7-7z\' fill=\'%23333\' fill-opacity=\'0.3\'/%3E%3C/svg%3E")',
            stars: 'url("data:image/svg+xml,%3Csvg width=\'30\' height=\'30\' viewBox=\'0 0 30 30\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Ctext x=\'10\' y=\'20\' fill=\'%23333\' opacity=\'0.3\'%3E★%3C/text%3E%3C/svg%3E")'
          };

          // Get background style based on theme settings
          const getBackgroundStyle = () => {
            if (!theme.bgType) {
              return { background: '#0a0a0a' };
            }

            let bg = {};
            if (theme.bgType === 'solid') {
              bg.background = theme.bgColor || '#0a0a0a';
            } else if (theme.bgType === 'gradient') {
              const gradColors = theme.bgGradient || ['#0a0a0a', '#1a1a2e'];
              bg.background = `linear-gradient(135deg, ${gradColors[0]}, ${gradColors[1]})`;
            } else if (theme.bgType === 'pattern') {
              bg.background = theme.bgColor || '#0a0a0a';
              if (theme.bgPattern && theme.bgPattern !== 'none') {
                bg.backgroundImage = patterns[theme.bgPattern];
                bg.backgroundSize = theme.bgPattern === 'dots' ? '20px 20px' : theme.bgPattern === 'grid' ? '20px 20px' : 'auto';
              }
            } else if (theme.bgType === 'image' && theme.bgImage) {
              bg.backgroundImage = `url(${theme.bgImage})`;
              const fit = theme.bgImageFit || 'cover';
              if (fit === 'tile') {
                bg.backgroundSize = 'auto';
                bg.backgroundRepeat = 'repeat';
              } else if (fit === 'contain') {
                bg.backgroundSize = 'contain';
                bg.backgroundRepeat = 'no-repeat';
                bg.backgroundPosition = 'center';
              } else if (fit === 'stretch') {
                bg.backgroundSize = '100% 100%';
                bg.backgroundRepeat = 'no-repeat';
              } else { // cover
                bg.backgroundSize = 'cover';
                bg.backgroundPosition = 'center';
                bg.backgroundRepeat = 'no-repeat';
              }
            }
            return bg;
          };

          const backgroundStyle = getBackgroundStyle();

          // Real-time token data from pump.fun
          const [tokenData, setTokenData] = useState({
            marketCap: 0,
            holders: 0,
            volume: 0,
            loading: true
          });

          // Fetch real token data from pump.fun API
          useEffect(() => {
            const fetchTokenData = async () => {
              if (!culture.tokenAddress) {
                setTokenData(prev => ({ ...prev, loading: false }));
                return;
              }

              try {
                // Fetch from pump.fun API via proxy
                const res = await fetch(`/api/pump/coin/${culture.tokenAddress}`);
                if (res.ok) {
                  const data = await res.json();
                  console.log('[CULTURE] Pump.fun data:', data);
                  if (data) {
                    setTokenData({
                      marketCap: data.usd_market_cap || 0,
                      holders: data.holder_count || 0,
                      volume: data.volume_24h || 0,
                      price: data.price || 0,
                      loading: false
                    });
                  } else {
                    setTokenData(prev => ({ ...prev, loading: false }));
                  }
                } else {
                  setTokenData(prev => ({ ...prev, loading: false }));
                }
              } catch (e) {
                console.error('[CULTURE] Failed to fetch token data:', e);
                setTokenData(prev => ({ ...prev, loading: false }));
              }
            };

            fetchTokenData();
            // Refresh every 30 seconds
            const interval = setInterval(fetchTokenData, 30000);
            return () => clearInterval(interval);
          }, [culture.tokenAddress]);

          // Check if user already has this culture
          const existingHolding = wallet?.holdings?.find(h => h.cultureId === culture.id);
          const userHolding = existingHolding ? {
            percent: existingHolding.percent,
            tier: existingHolding.tier,
            coins: existingHolding.coins
          } : null;

          const cultureAuctions = AUCTIONS.filter(a => a.cultureId === culture.id);

          const handleJoin = () => {
            if (!wallet?.address) {
              wallet?.connect();
              return;
            }
            if (selectedTier && agreedToTerms) {
              wallet.joinCulture(culture, selectedTier);
              setShowJoinModal(false);
              setSelectedTier(null);
              setAgreedToTerms(false);
            }
          };

          // Helper to create accent rgba
          const accentRgba = (opacity) => {
            const hex = accentColor.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            return `rgba(${r}, ${g}, ${b}, ${opacity})`;
          };

          return (
            <div style={{ padding: '136px 40px 60px', minHeight: '100vh', ...backgroundStyle }}>
              <button
                onClick={onBack}
                style={{
                  background: 'none',
                  border: 'none',
                  color: '#666',
                  fontSize: '11px',
                  fontFamily: "'IBM Plex Mono', monospace",
                  letterSpacing: '0.1em',
                  cursor: 'pointer',
                  marginBottom: '40px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px'
                }}
              >
                &#8592; BACK TO CULTURES
              </button>

              <div style={{ maxWidth: '800px', marginBottom: '60px' }}>
                <div style={{
                  fontSize: '10px',
                  letterSpacing: '0.15em',
                  color: '#666',
                  marginBottom: '16px',
                  fontFamily: "'IBM Plex Mono', monospace"
                }}>
                  {culture.category.toUpperCase()}
                </div>

                <h1 style={{
                  fontFamily: "'Playfair Display', serif",
                  fontSize: '56px',
                  fontWeight: 400,
                  color: textColor,
                  marginBottom: '20px',
                  letterSpacing: '-0.02em'
                }}>
                  {culture.name}
                </h1>

                <p style={{
                  fontFamily: "'Playfair Display', serif",
                  fontSize: '24px',
                  fontStyle: 'italic',
                  color: textColor,
                  opacity: 0.8,
                  lineHeight: 1.5,
                  marginBottom: '24px'
                }}>
                  "{culture.ethos}"
                </p>

                <div style={{
                  fontSize: '12px',
                  color: '#666',
                  fontFamily: "'IBM Plex Mono', monospace",
                  marginBottom: '16px'
                }}>
                  Created by {culture.creatorName}
                </div>

                {/* Contract Address (Token Address) */}
                {culture.tokenAddress && (
                  <div style={{
                    display: 'inline-flex',
                    alignItems: 'center',
                    gap: '12px',
                    padding: '12px 16px',
                    background: accentRgba(0.1),
                    border: `1px solid ${accentRgba(0.3)}`,
                    marginBottom: '8px'
                  }}>
                    <div style={{
                      fontSize: '9px',
                      letterSpacing: '0.15em',
                      color: accentColor,
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      CA
                    </div>
                    <div style={{
                      fontSize: '13px',
                      color: textColor,
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.02em'
                    }}>
                      {culture.tokenAddress}
                    </div>
                    <button
                      onClick={() => {
                        navigator.clipboard.writeText(culture.tokenAddress);
                        alert('Address copied to clipboard!');
                      }}
                      style={{
                        background: 'none',
                        border: `1px solid ${accentRgba(0.5)}`,
                        color: accentColor,
                        padding: '4px 8px',
                        fontSize: '9px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        cursor: 'pointer',
                        letterSpacing: '0.1em'
                      }}
                    >
                      COPY
                    </button>
                  </div>
                )}

                {culture.isUserCreated && (
                  <div style={{
                    display: 'block',
                    fontSize: '10px',
                    color: accentColor,
                    fontFamily: "'IBM Plex Mono', monospace",
                    letterSpacing: '0.1em'
                  }}>
                    YOUR CULTURE
                  </div>
                )}
              </div>

              <div style={{ display: 'grid', gridTemplateColumns: '1fr 400px', gap: '60px' }}>
                <div>
                  {/* Pillars */}
                  <div style={{ marginBottom: '48px' }}>
                    <div style={{
                      fontSize: '10px',
                      letterSpacing: '0.15em',
                      color: '#666',
                      marginBottom: '24px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      WHAT THIS CULTURE BELIEVES
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                      {culture.pillars.map((pillar, i) => (
                        <div
                          key={i}
                          style={{
                            padding: '20px 24px',
                            background: cardBg,
                            border: `1px solid ${borderColor}`,
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '14px',
                            color: textColor,
                            lineHeight: 1.5
                          }}
                        >
                          {pillar}
                        </div>
                      ))}
                    </div>
                  </div>

                  {/* Tiers */}
                  <div style={{ marginBottom: '48px' }}>
                    <div style={{
                      fontSize: '10px',
                      letterSpacing: '0.15em',
                      color: '#666',
                      marginBottom: '24px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      CULTURE TIERS
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                      {culture.tiers.map((tier, i) => {
                        const isUserTier = userHolding && tier.name === userHolding.tier;
                        return (
                          <div
                            key={i}
                            style={{
                              padding: '24px',
                              background: isUserTier ? cardBg : (theme.bgColor || '#0a0a0a'),
                              border: '1px solid',
                              borderColor: isUserTier ? accentRgba(0.5) : borderColor,
                              position: 'relative'
                            }}
                          >
                            {isUserTier && (
                              <div style={{
                                position: 'absolute',
                                top: '-1px',
                                right: '24px',
                                background: accentColor,
                                color: '#000',
                                fontSize: '9px',
                                fontFamily: "'IBM Plex Mono', monospace",
                                letterSpacing: '0.1em',
                                padding: '4px 10px'
                              }}>
                                YOUR TIER
                              </div>
                            )}
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'baseline', marginBottom: '12px' }}>
                              <span style={{
                                fontFamily: "'Playfair Display', serif",
                                fontSize: '20px',
                                color: textColor
                              }}>
                                {tier.name}
                              </span>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '12px',
                                color: '#666'
                              }}>
                                {tier.percent}% of supply
                              </span>
                            </div>
                            <div style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '12px',
                              color: textColor,
                              opacity: 0.7,
                              marginBottom: '8px'
                            }}>
                              Access: {tier.access}
                            </div>
                            <div style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '11px',
                              color: '#666'
                            }}>
                              Expected: {tier.expectation}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* Auctions */}
                  {cultureAuctions.length > 0 && (
                    <div>
                      <div style={{
                        fontSize: '10px',
                        letterSpacing: '0.15em',
                        color: '#666',
                        marginBottom: '24px',
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        OPEN BIDDING
                      </div>
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                        {cultureAuctions.map(auction => (
                          <AuctionCard key={auction.id} auction={auction} compact />
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                {/* Right Column */}
                <div>
                  <div style={{
                    background: cardBg,
                    border: `1px solid ${borderColor}`,
                    padding: '32px',
                    marginBottom: '24px'
                  }}>
                    <div style={{
                      fontSize: '10px',
                      letterSpacing: '0.15em',
                      color: '#666',
                      marginBottom: '20px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      JOIN THE CULTURE
                    </div>

                    {userHolding ? (
                      <div style={{
                        padding: '16px',
                        background: accentRgba(0.15),
                        border: `1px solid ${accentRgba(0.3)}`,
                        marginBottom: '16px',
                        textAlign: 'center'
                      }}>
                        <div style={{
                          fontSize: '10px',
                          letterSpacing: '0.1em',
                          color: accentColor,
                          fontFamily: "'IBM Plex Mono', monospace",
                          marginBottom: '8px'
                        }}>
                          YOU ARE A MEMBER
                        </div>
                        <div style={{
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '18px',
                          color: textColor
                        }}>
                          {userHolding.tier}
                        </div>
                        <div style={{
                          fontSize: '11px',
                          color: '#888',
                          fontFamily: "'IBM Plex Mono', monospace",
                          marginTop: '4px'
                        }}>
                          {userHolding.percent}% ({userHolding.coins.toLocaleString()} coins)
                        </div>
                      </div>
                    ) : (
                      <button
                        onClick={() => setShowJoinModal(true)}
                        style={{
                          width: '100%',
                          padding: '16px',
                          background: accentColor,
                          color: '#000',
                          border: 'none',
                          fontSize: '12px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          letterSpacing: '0.1em',
                          cursor: 'pointer',
                          marginBottom: '16px'
                        }}
                      >
                        ACQUIRE ACCESS
                      </button>
                    )}

                    <p style={{
                      fontSize: '11px',
                      color: '#666',
                      fontFamily: "'IBM Plex Mono', monospace",
                      lineHeight: 1.6,
                      textAlign: 'center'
                    }}>
                      {userHolding ? 'Welcome to the culture.' : 'This is participation, not a trade.'}
                    </p>
                  </div>

                  {/* Economics */}
                  <div style={{
                    background: theme.bgColor || '#0a0a0a',
                    border: `1px solid ${borderColor}`,
                    padding: '32px'
                  }}>
                    <div style={{
                      fontSize: '10px',
                      letterSpacing: '0.15em',
                      color: '#666',
                      marginBottom: '24px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      CULTURE ECONOMICS
                    </div>

                    <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
                      {/* Market Cap - LIVE from pump.fun */}
                      <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                        <span style={{ fontSize: '12px', color: '#666', fontFamily: "'IBM Plex Mono', monospace" }}>Market Cap</span>
                        <span style={{ fontSize: '14px', color: accentColor, fontFamily: "'IBM Plex Mono', monospace" }}>
                          {tokenData.loading ? '...' : `$${tokenData.marketCap.toLocaleString(undefined, {maximumFractionDigits: 0})}`}
                        </span>
                      </div>

                      {/* Holders - LIVE from pump.fun */}
                      <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                        <span style={{ fontSize: '12px', color: '#666', fontFamily: "'IBM Plex Mono', monospace" }}>Holders</span>
                        <span style={{ fontSize: '14px', color: textColor, fontFamily: "'IBM Plex Mono', monospace" }}>
                          {tokenData.loading ? '...' : tokenData.holders.toLocaleString()}
                        </span>
                      </div>

                      <div style={{ borderTop: `1px solid ${borderColor}`, paddingTop: '20px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px' }}>
                          <span style={{ fontSize: '12px', color: '#666', fontFamily: "'IBM Plex Mono', monospace" }}>Total Supply</span>
                          <span style={{ fontSize: '14px', color: textColor, fontFamily: "'IBM Plex Mono', monospace" }}>{(culture.supply || 1000000000).toLocaleString()}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px' }}>
                          <span style={{ fontSize: '12px', color: '#666', fontFamily: "'IBM Plex Mono', monospace" }}>Total Burned</span>
                          <span style={{ fontSize: '14px', color: '#ef4444', fontFamily: "'IBM Plex Mono', monospace" }}>{(culture.burned || 0).toLocaleString()}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                          <span style={{ fontSize: '12px', color: '#666', fontFamily: "'IBM Plex Mono', monospace" }}>Circulating</span>
                          <span style={{ fontSize: '14px', color: textColor, fontFamily: "'IBM Plex Mono', monospace" }}>{((culture.supply || 1000000000) - (culture.burned || 0)).toLocaleString()}</span>
                        </div>
                      </div>

                      {culture.tokenAddress && (
                        <div style={{ borderTop: `1px solid ${borderColor}`, paddingTop: '20px' }}>
                          <a
                            href={`https://pump.fun/coin/${culture.tokenAddress}`}
                            target="_blank"
                            rel="noopener noreferrer"
                            style={{
                              display: 'block',
                              textAlign: 'center',
                              padding: '12px',
                              background: accentColor,
                              color: '#000',
                              fontSize: '11px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              letterSpacing: '0.1em',
                              textDecoration: 'none',
                              fontWeight: 600
                            }}
                          >
                            VIEW ON PUMP.FUN
                          </a>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </div>

              {/* Join Modal */}
              {showJoinModal && (
                <div style={{
                  position: 'fixed',
                  inset: 0,
                  background: 'rgba(0,0,0,0.9)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  zIndex: 2000
                }}>
                  <div style={{
                    background: theme.bgColor || '#0a0a0a',
                    border: `1px solid ${borderColor}`,
                    padding: '48px',
                    maxWidth: '500px',
                    width: '100%'
                  }}>
                    <h2 style={{
                      fontFamily: "'Playfair Display', serif",
                      fontSize: '28px',
                      color: textColor,
                      marginBottom: '24px'
                    }}>
                      Join {culture.name}
                    </h2>

                    <div style={{
                      background: cardBg,
                      border: `1px solid ${borderColor}`,
                      padding: '20px',
                      marginBottom: '24px'
                    }}>
                      <p style={{
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '13px',
                        color: textColor,
                        opacity: 0.7,
                        lineHeight: 1.7
                      }}>
                        "{culture.ethos}"
                      </p>
                    </div>

                    {/* Tier Selection */}
                    <div style={{ marginBottom: '24px' }}>
                      <div style={{
                        fontSize: '10px',
                        letterSpacing: '0.15em',
                        color: '#666',
                        marginBottom: '12px',
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        SELECT YOUR TIER
                      </div>
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                        {culture.tiers.map((tier, i) => (
                          <button
                            key={i}
                            onClick={() => setSelectedTier(tier)}
                            style={{
                              padding: '14px 16px',
                              background: selectedTier?.name === tier.name ? cardBg : (theme.bgColor || '#0a0a0a'),
                              border: '1px solid',
                              borderColor: selectedTier?.name === tier.name ? accentColor : borderColor,
                              color: textColor,
                              textAlign: 'left',
                              cursor: 'pointer',
                              display: 'flex',
                              justifyContent: 'space-between',
                              alignItems: 'center'
                            }}
                          >
                            <span style={{ fontFamily: "'Playfair Display', serif", fontSize: '16px' }}>
                              {tier.name}
                            </span>
                            <span style={{ fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', color: '#888' }}>
                              {tier.percent}% of supply
                            </span>
                          </button>
                        ))}
                      </div>
                    </div>

                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px' }}>
                      <input
                        type="checkbox"
                        id="understand"
                        checked={agreedToTerms}
                        onChange={(e) => setAgreedToTerms(e.target.checked)}
                        style={{ width: '18px', height: '18px', accentColor: accentColor }}
                      />
                      <label htmlFor="understand" style={{
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '12px',
                        color: '#888',
                        cursor: 'pointer'
                      }}>
                        I understand this is participation, not a trade.
                      </label>
                    </div>

                    <div style={{ display: 'flex', gap: '12px' }}>
                      <button
                        onClick={() => { setShowJoinModal(false); setSelectedTier(null); setAgreedToTerms(false); }}
                        style={{
                          flex: 1,
                          padding: '14px',
                          background: 'transparent',
                          color: '#888',
                          border: `1px solid ${borderColor}`,
                          fontSize: '12px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          letterSpacing: '0.1em',
                          cursor: 'pointer'
                        }}
                      >
                        CANCEL
                      </button>
                      <button
                        onClick={handleJoin}
                        disabled={!selectedTier || !agreedToTerms}
                        style={{
                          flex: 1,
                          padding: '14px',
                          background: (selectedTier && agreedToTerms) ? accentColor : '#333',
                          color: (selectedTier && agreedToTerms) ? '#000' : '#666',
                          border: 'none',
                          fontSize: '12px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          letterSpacing: '0.1em',
                          cursor: (selectedTier && agreedToTerms) ? 'pointer' : 'not-allowed'
                        }}
                      >
                        {wallet?.address ? 'ENTER THE CULTURE' : 'CONNECT WALLET'}
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // ═══════════════════════════════════════════════════════════════════════════
        // WEB3 SOCIAL PLATFORM - CULTURE CREATOR HUB
        // MySpace for Crypto - Customizable profiles, posts, media, timeline
        // ═══════════════════════════════════════════════════════════════════════════

        // Post Card Component - Displays individual posts in the feed
        const PostCard = ({ post, onLike, onComment, onRepost, currentUser }) => {
          const [showComments, setShowComments] = useState(false);
          const [newComment, setNewComment] = useState('');
          const isLiked = post.likes?.includes(currentUser);
          const isReposted = post.repostedBy?.includes(currentUser);
          const timeAgo = (date) => {
            const seconds = Math.floor((new Date() - new Date(date)) / 1000);
            if (seconds < 60) return 'just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
          };

          return (
            <div style={{
              background: '#0f0f0f',
              border: '1px solid #1a1a1a',
              marginBottom: '16px',
              overflow: 'hidden'
            }}>
              {/* Post Header */}
              <div style={{
                padding: '16px 20px',
                display: 'flex',
                alignItems: 'center',
                gap: '12px',
                borderBottom: '1px solid #1a1a1a'
              }}>
                <div style={{
                  width: '44px',
                  height: '44px',
                  borderRadius: '50%',
                  background: post.authorPfp ? `url(${post.authorPfp}) center/cover` : 'linear-gradient(135deg, #22c55e, #16a34a)',
                  border: '2px solid #22c55e'
                }} />
                <div style={{ flex: 1 }}>
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}>
                    <span style={{
                      fontFamily: "'Playfair Display', serif",
                      fontSize: '16px',
                      color: '#fff'
                    }}>
                      {post.authorName || 'Anonymous'}
                    </span>
                    {post.cultureName && (
                      <span style={{
                        fontSize: '10px',
                        padding: '2px 8px',
                        background: 'rgba(34, 197, 94, 0.2)',
                        color: '#22c55e',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.05em'
                      }}>
                        ${post.cultureTicker}
                      </span>
                    )}
                  </div>
                  <div style={{
                    fontSize: '11px',
                    color: '#666',
                    fontFamily: "'IBM Plex Mono', monospace"
                  }}>
                    {timeAgo(post.createdAt)}
                  </div>
                </div>
              </div>

              {/* Post Content */}
              <div style={{ padding: '20px' }}>
                {post.content && (
                  <p style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '14px',
                    color: '#e5e5e5',
                    lineHeight: 1.7,
                    marginBottom: post.media ? '16px' : 0,
                    whiteSpace: 'pre-wrap'
                  }}>
                    {post.content}
                  </p>
                )}

                {/* Media (Image/Video) */}
                {post.media && post.mediaType === 'image' && (
                  <img
                    src={post.media}
                    alt="Post media"
                    style={{
                      width: '100%',
                      maxHeight: '500px',
                      objectFit: 'cover',
                      borderRadius: '8px'
                    }}
                  />
                )}
                {post.media && post.mediaType === 'video' && (
                  <video
                    src={post.media}
                    controls
                    style={{
                      width: '100%',
                      maxHeight: '500px',
                      borderRadius: '8px'
                    }}
                  />
                )}
                {post.embedUrl && (
                  <iframe
                    src={post.embedUrl}
                    style={{
                      width: '100%',
                      height: '315px',
                      border: 'none',
                      borderRadius: '8px'
                    }}
                    allowFullScreen
                  />
                )}
              </div>

              {/* Post Actions */}
              <div style={{
                padding: '12px 20px',
                borderTop: '1px solid #1a1a1a',
                display: 'flex',
                gap: '24px'
              }}>
                <button
                  onClick={() => onLike?.(post.id)}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: isLiked ? '#22c55e' : '#666',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    transition: 'color 0.2s'
                  }}
                >
                  <span style={{ fontSize: '16px' }}>{isLiked ? '♥' : '♡'}</span>
                  {post.likes?.length || 0}
                </button>
                <button
                  onClick={() => setShowComments(!showComments)}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: '#666',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px'
                  }}
                >
                  <span style={{ fontSize: '14px' }}>💬</span>
                  {post.comments?.length || 0}
                </button>
                <button
                  onClick={() => onRepost?.(post.id)}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: isReposted ? '#22c55e' : '#666',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    transition: 'color 0.2s'
                  }}
                >
                  <span style={{ fontSize: '14px' }}>{isReposted ? '✓↻' : '↻'}</span>
                  {post.reposts || 0}
                </button>
              </div>

              {/* Comments Section */}
              {showComments && (
                <div style={{
                  padding: '16px 20px',
                  borderTop: '1px solid #1a1a1a',
                  background: '#0a0a0a'
                }}>
                  {post.comments?.map((comment, i) => (
                    <div key={i} style={{
                      padding: '12px 0',
                      borderBottom: i < post.comments.length - 1 ? '1px solid #1a1a1a' : 'none'
                    }}>
                      <div style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        marginBottom: '6px'
                      }}>
                        <span style={{
                          fontSize: '13px',
                          color: '#fff',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}>
                          {comment.author}
                        </span>
                        <span style={{ fontSize: '10px', color: '#444' }}>•</span>
                        <span style={{ fontSize: '10px', color: '#666' }}>
                          {timeAgo(comment.createdAt)}
                        </span>
                      </div>
                      <p style={{
                        fontSize: '13px',
                        color: '#999',
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        {comment.content}
                      </p>
                    </div>
                  ))}

                  {/* Add Comment */}
                  <div style={{
                    display: 'flex',
                    gap: '12px',
                    marginTop: '12px'
                  }}>
                    <input
                      type="text"
                      value={newComment}
                      onChange={(e) => setNewComment(e.target.value)}
                      placeholder="Write a comment..."
                      style={{
                        flex: 1,
                        padding: '10px 14px',
                        background: '#111',
                        border: '1px solid #222',
                        color: '#fff',
                        fontSize: '13px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        outline: 'none'
                      }}
                    />
                    <button
                      onClick={() => {
                        if (newComment.trim()) {
                          onComment?.(post.id, newComment);
                          setNewComment('');
                        }
                      }}
                      style={{
                        padding: '10px 16px',
                        background: '#22c55e',
                        border: 'none',
                        color: '#000',
                        fontSize: '11px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontWeight: 600,
                        cursor: 'pointer'
                      }}
                    >
                      POST
                    </button>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Post Composer Component - Create new posts
        const PostComposer = ({ onPost, profile, cultures }) => {
          const [content, setContent] = useState('');
          const [mediaPreview, setMediaPreview] = useState(null);
          const [mediaType, setMediaType] = useState(null);
          const [selectedCulture, setSelectedCulture] = useState(null);
          const [showCultureSelect, setShowCultureSelect] = useState(false);
          const fileInputRef = useRef(null);
          const videoInputRef = useRef(null);

          const handleImageSelect = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                setMediaPreview(e.target.result);
                setMediaType('image');
              };
              reader.readAsDataURL(file);
            }
          };

          const handleVideoSelect = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                setMediaPreview(e.target.result);
                setMediaType('video');
              };
              reader.readAsDataURL(file);
            }
          };

          const clearMedia = () => {
            setMediaPreview(null);
            setMediaType(null);
          };

          const handlePost = () => {
            if (content.trim() || mediaPreview) {
              onPost({
                content: content.trim(),
                media: mediaPreview,
                mediaType,
                cultureId: selectedCulture?.id,
                cultureName: selectedCulture?.name,
                cultureTicker: selectedCulture?.ticker
              });
              setContent('');
              clearMedia();
              setSelectedCulture(null);
            }
          };

          return (
            <div style={{
              background: '#0f0f0f',
              border: '1px solid #1a1a1a',
              marginBottom: '24px'
            }}>
              <div style={{ padding: '20px' }}>
                <div style={{ display: 'flex', gap: '12px' }}>
                  <div style={{
                    width: '48px',
                    height: '48px',
                    borderRadius: '50%',
                    background: profile?.pfp ? `url(${profile.pfp}) center/cover` : 'linear-gradient(135deg, #22c55e, #16a34a)',
                    border: '2px solid #22c55e',
                    flexShrink: 0
                  }} />
                  <div style={{ flex: 1 }}>
                    <textarea
                      value={content}
                      onChange={(e) => setContent(e.target.value)}
                      placeholder="What's happening in your culture?"
                      style={{
                        width: '100%',
                        minHeight: '80px',
                        padding: '12px',
                        background: '#0a0a0a',
                        border: '1px solid #222',
                        color: '#fff',
                        fontSize: '15px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        resize: 'vertical',
                        outline: 'none'
                      }}
                    />

                    {/* Media Preview */}
                    {mediaPreview && (
                      <div style={{ position: 'relative', marginTop: '12px' }}>
                        {mediaType === 'image' ? (
                          <img
                            src={mediaPreview}
                            alt="Preview"
                            style={{
                              maxWidth: '100%',
                              maxHeight: '300px',
                              borderRadius: '8px'
                            }}
                          />
                        ) : (
                          <video
                            src={mediaPreview}
                            controls
                            style={{
                              maxWidth: '100%',
                              maxHeight: '300px',
                              borderRadius: '8px'
                            }}
                          />
                        )}
                        <button
                          onClick={clearMedia}
                          style={{
                            position: 'absolute',
                            top: '8px',
                            right: '8px',
                            width: '28px',
                            height: '28px',
                            borderRadius: '50%',
                            background: 'rgba(0,0,0,0.8)',
                            border: 'none',
                            color: '#fff',
                            cursor: 'pointer',
                            fontSize: '14px'
                          }}
                        >
                          ✕
                        </button>
                      </div>
                    )}

                    {/* Selected Culture Tag */}
                    {selectedCulture && (
                      <div style={{
                        display: 'inline-flex',
                        alignItems: 'center',
                        gap: '8px',
                        padding: '6px 12px',
                        background: 'rgba(34, 197, 94, 0.15)',
                        border: '1px solid rgba(34, 197, 94, 0.3)',
                        marginTop: '12px'
                      }}>
                        <span style={{
                          fontSize: '12px',
                          color: '#22c55e',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}>
                          ${selectedCulture.ticker}
                        </span>
                        <button
                          onClick={() => setSelectedCulture(null)}
                          style={{
                            background: 'none',
                            border: 'none',
                            color: '#22c55e',
                            cursor: 'pointer',
                            padding: 0,
                            fontSize: '12px'
                          }}
                        >
                          ✕
                        </button>
                      </div>
                    )}
                  </div>
                </div>
              </div>

              {/* Action Bar */}
              <div style={{
                padding: '12px 20px',
                borderTop: '1px solid #1a1a1a',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }}>
                <div style={{ display: 'flex', gap: '16px' }}>
                  <input
                    type="file"
                    ref={fileInputRef}
                    accept="image/*"
                    onChange={handleImageSelect}
                    style={{ display: 'none' }}
                  />
                  <button
                    onClick={() => fileInputRef.current?.click()}
                    style={{
                      background: 'none',
                      border: 'none',
                      color: '#666',
                      cursor: 'pointer',
                      fontSize: '18px',
                      padding: '4px'
                    }}
                    title="Add image"
                  >
                    🖼️
                  </button>

                  <input
                    type="file"
                    ref={videoInputRef}
                    accept="video/*"
                    onChange={handleVideoSelect}
                    style={{ display: 'none' }}
                  />
                  <button
                    onClick={() => videoInputRef.current?.click()}
                    style={{
                      background: 'none',
                      border: 'none',
                      color: '#666',
                      cursor: 'pointer',
                      fontSize: '18px',
                      padding: '4px'
                    }}
                    title="Add video"
                  >
                    🎬
                  </button>

                  {cultures?.length > 0 && (
                    <div style={{ position: 'relative' }}>
                      <button
                        onClick={() => setShowCultureSelect(!showCultureSelect)}
                        style={{
                          background: 'none',
                          border: 'none',
                          color: '#666',
                          cursor: 'pointer',
                          fontSize: '14px',
                          padding: '4px',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}
                        title="Tag a culture"
                      >
                        #culture
                      </button>
                      {showCultureSelect && (
                        <div style={{
                          position: 'absolute',
                          top: '100%',
                          left: 0,
                          background: '#111',
                          border: '1px solid #222',
                          minWidth: '200px',
                          zIndex: 100
                        }}>
                          {cultures.map(c => (
                            <button
                              key={c.id}
                              onClick={() => {
                                setSelectedCulture(c);
                                setShowCultureSelect(false);
                              }}
                              style={{
                                display: 'block',
                                width: '100%',
                                padding: '10px 12px',
                                background: 'none',
                                border: 'none',
                                borderBottom: '1px solid #1a1a1a',
                                color: '#fff',
                                textAlign: 'left',
                                cursor: 'pointer',
                                fontSize: '13px',
                                fontFamily: "'IBM Plex Mono', monospace"
                              }}
                            >
                              {c.name} <span style={{ color: '#666' }}>${c.ticker}</span>
                            </button>
                          ))}
                        </div>
                      )}
                    </div>
                  )}
                </div>

                <button
                  onClick={handlePost}
                  disabled={!content.trim() && !mediaPreview}
                  style={{
                    padding: '10px 24px',
                    background: (content.trim() || mediaPreview) ? '#22c55e' : '#222',
                    border: 'none',
                    color: (content.trim() || mediaPreview) ? '#000' : '#666',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontWeight: 600,
                    letterSpacing: '0.05em',
                    cursor: (content.trim() || mediaPreview) ? 'pointer' : 'not-allowed'
                  }}
                >
                  POST
                </button>
              </div>
            </div>
          );
        };

        // Creator Profile Header - Customizable profile section
        const CreatorProfileHeader = ({ profile, onEditProfile, isOwner, stats }) => {
          const [isEditing, setIsEditing] = useState(false);
          const [editName, setEditName] = useState(profile?.displayName || '');
          const [editBio, setEditBio] = useState(profile?.bio || '');
          const pfpInputRef = useRef(null);
          const bannerInputRef = useRef(null);

          const handlePfpUpload = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                onEditProfile?.({ pfp: e.target.result });
              };
              reader.readAsDataURL(file);
            }
          };

          const handleBannerUpload = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                onEditProfile?.({ banner: e.target.result });
              };
              reader.readAsDataURL(file);
            }
          };

          return (
            <div style={{
              background: '#0f0f0f',
              border: '1px solid #1a1a1a',
              marginBottom: '24px',
              overflow: 'hidden'
            }}>
              {/* Banner - 1500x300 recommended */}
              <div
                style={{
                  height: '300px',
                  maxWidth: '1500px',
                  margin: '0 auto',
                  background: profile?.banner
                    ? `url(${profile.banner}) center/cover no-repeat`
                    : 'linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%)',
                  position: 'relative'
                }}
              >
                {isOwner && (
                  <>
                    <input
                      type="file"
                      ref={bannerInputRef}
                      accept="image/*"
                      onChange={handleBannerUpload}
                      style={{ display: 'none' }}
                    />
                    <button
                      onClick={() => bannerInputRef.current?.click()}
                      style={{
                        position: 'absolute',
                        bottom: '16px',
                        right: '16px',
                        padding: '10px 20px',
                        background: 'rgba(0,0,0,0.8)',
                        border: '1px solid #22c55e',
                        color: '#22c55e',
                        fontSize: '12px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        cursor: 'pointer',
                        letterSpacing: '0.05em',
                        transition: 'all 0.2s'
                      }}
                      onMouseOver={(e) => {
                        e.target.style.background = '#22c55e';
                        e.target.style.color = '#000';
                      }}
                      onMouseOut={(e) => {
                        e.target.style.background = 'rgba(0,0,0,0.8)';
                        e.target.style.color = '#22c55e';
                      }}
                    >
                      EDIT BANNER (1500×300)
                    </button>
                  </>
                )}
              </div>

              {/* Profile Info */}
              <div style={{ padding: '0 24px 24px', position: 'relative' }}>
                {/* PFP */}
                <div style={{
                  position: 'relative',
                  width: '120px',
                  marginTop: '-60px'
                }}>
                  <div style={{
                    width: '120px',
                    height: '120px',
                    borderRadius: '50%',
                    background: profile?.pfp
                      ? `url(${profile.pfp}) center/cover`
                      : 'linear-gradient(135deg, #22c55e, #16a34a)',
                    border: '4px solid #0f0f0f',
                    boxShadow: '0 0 20px rgba(34, 197, 94, 0.3)'
                  }} />
                  {isOwner && (
                    <>
                      <input
                        type="file"
                        ref={pfpInputRef}
                        accept="image/*"
                        onChange={handlePfpUpload}
                        style={{ display: 'none' }}
                      />
                      <button
                        onClick={() => pfpInputRef.current?.click()}
                        style={{
                          position: 'absolute',
                          bottom: '4px',
                          right: '4px',
                          width: '32px',
                          height: '32px',
                          borderRadius: '50%',
                          background: '#22c55e',
                          border: 'none',
                          color: '#000',
                          cursor: 'pointer',
                          fontSize: '14px',
                          fontWeight: 'bold'
                        }}
                      >
                        +
                      </button>
                    </>
                  )}
                </div>

                {/* Name & Bio */}
                <div style={{ marginTop: '16px' }}>
                  {isEditing ? (
                    <div style={{ marginBottom: '16px' }}>
                      <input
                        type="text"
                        value={editName}
                        onChange={(e) => setEditName(e.target.value)}
                        placeholder="Display name"
                        style={{
                          width: '100%',
                          padding: '12px',
                          background: '#0a0a0a',
                          border: '1px solid #222',
                          color: '#fff',
                          fontSize: '18px',
                          fontFamily: "'Playfair Display', serif",
                          marginBottom: '12px',
                          outline: 'none'
                        }}
                      />
                      <textarea
                        value={editBio}
                        onChange={(e) => setEditBio(e.target.value)}
                        placeholder="Tell the world about yourself..."
                        style={{
                          width: '100%',
                          minHeight: '80px',
                          padding: '12px',
                          background: '#0a0a0a',
                          border: '1px solid #222',
                          color: '#fff',
                          fontSize: '14px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          resize: 'vertical',
                          outline: 'none'
                        }}
                      />
                      <div style={{ display: 'flex', gap: '12px', marginTop: '12px' }}>
                        <button
                          onClick={() => {
                            onEditProfile?.({ displayName: editName, bio: editBio });
                            setIsEditing(false);
                          }}
                          style={{
                            padding: '10px 20px',
                            background: '#22c55e',
                            border: 'none',
                            color: '#000',
                            fontSize: '12px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontWeight: 600,
                            cursor: 'pointer'
                          }}
                        >
                          SAVE
                        </button>
                        <button
                          onClick={() => setIsEditing(false)}
                          style={{
                            padding: '10px 20px',
                            background: 'transparent',
                            border: '1px solid #333',
                            color: '#888',
                            fontSize: '12px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            cursor: 'pointer'
                          }}
                        >
                          CANCEL
                        </button>
                      </div>
                    </div>
                  ) : (
                    <>
                      <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '8px' }}>
                        <h2 style={{
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '28px',
                          fontWeight: 400,
                          color: '#fff',
                          margin: 0
                        }}>
                          {profile?.displayName || 'Anonymous Creator'}
                        </h2>
                        {isOwner && (
                          <button
                            onClick={() => setIsEditing(true)}
                            style={{
                              background: 'none',
                              border: '1px solid #333',
                              color: '#888',
                              padding: '6px 12px',
                              fontSize: '11px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              cursor: 'pointer'
                            }}
                          >
                            EDIT
                          </button>
                        )}
                      </div>
                      {profile?.wallet && (
                        <div style={{
                          fontSize: '12px',
                          color: '#666',
                          fontFamily: "'IBM Plex Mono', monospace",
                          marginBottom: '12px'
                        }}>
                          {profile.wallet.slice(0, 6)}...{profile.wallet.slice(-4)}
                        </div>
                      )}
                      {profile?.bio && (
                        <p style={{
                          fontSize: '14px',
                          color: '#999',
                          fontFamily: "'IBM Plex Mono', monospace",
                          lineHeight: 1.6,
                          maxWidth: '600px'
                        }}>
                          {profile.bio}
                        </p>
                      )}
                    </>
                  )}
                </div>

                {/* Stats Row */}
                <div style={{
                  display: 'flex',
                  gap: '32px',
                  marginTop: '20px',
                  paddingTop: '20px',
                  borderTop: '1px solid #1a1a1a'
                }}>
                  {[
                    { value: stats?.cultures || 0, label: 'Cultures' },
                    { value: stats?.posts || 0, label: 'Posts' },
                    { value: stats?.followers || 0, label: 'Followers' },
                    { value: stats?.following || 0, label: 'Following' }
                  ].map((stat, i) => (
                    <div key={i}>
                      <div style={{
                        fontSize: '20px',
                        fontWeight: 600,
                        color: '#fff',
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        {stat.value}
                      </div>
                      <div style={{
                        fontSize: '11px',
                        color: '#666',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.05em'
                      }}>
                        {stat.label}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          );
        };

        // Community Feed View - Shows all posts from all creators
        const FeedView = ({ onSelectCulture }) => {
          const wallet = useContext(WalletContext);
          const [posts, setPosts] = useState([]);
          const [loading, setLoading] = useState(true);
          const [filter, setFilter] = useState('all'); // all, following, cultures

          // Load posts from localStorage (would be API in production)
          useEffect(() => {
            const loadPosts = () => {
              try {
                const storedPosts = JSON.parse(localStorage.getItem('culture_posts') || '[]');
                // Sort by newest first
                storedPosts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                setPosts(storedPosts);
              } catch (e) {
                console.error('[FEED] Error loading posts:', e);
              } finally {
                setLoading(false);
              }
            };
            loadPosts();
            // Refresh every 30 seconds
            const interval = setInterval(loadPosts, 30000);
            return () => clearInterval(interval);
          }, []);

          const handleLike = (postId) => {
            if (!wallet?.address) return;
            const updatedPosts = posts.map(p => {
              if (p.id === postId) {
                const likes = p.likes || [];
                const isLiked = likes.includes(wallet.address);
                return {
                  ...p,
                  likes: isLiked
                    ? likes.filter(l => l !== wallet.address)
                    : [...likes, wallet.address]
                };
              }
              return p;
            });
            setPosts(updatedPosts);
            localStorage.setItem('culture_posts', JSON.stringify(updatedPosts));
          };

          const handleComment = (postId, comment) => {
            if (!wallet?.address) return;
            const updatedPosts = posts.map(p => {
              if (p.id === postId) {
                return {
                  ...p,
                  comments: [
                    ...(p.comments || []),
                    {
                      author: wallet.address.slice(0, 6) + '...' + wallet.address.slice(-4),
                      content: comment,
                      createdAt: new Date().toISOString()
                    }
                  ]
                };
              }
              return p;
            });
            setPosts(updatedPosts);
            localStorage.setItem('culture_posts', JSON.stringify(updatedPosts));
          };

          const handleRepost = (postId) => {
            if (!wallet?.address) return;
            const updatedPosts = posts.map(p => {
              if (p.id === postId) {
                const reposts = p.repostedBy || [];
                const hasReposted = reposts.includes(wallet.address);
                return {
                  ...p,
                  reposts: hasReposted ? (p.reposts || 1) - 1 : (p.reposts || 0) + 1,
                  repostedBy: hasReposted
                    ? reposts.filter(r => r !== wallet.address)
                    : [...reposts, wallet.address]
                };
              }
              return p;
            });
            setPosts(updatedPosts);
            localStorage.setItem('culture_posts', JSON.stringify(updatedPosts));
          };

          if (loading) {
            return (
              <div style={{ padding: '136px 40px 60px', textAlign: 'center' }}>
                <p style={{ color: '#888', fontFamily: "'IBM Plex Mono', monospace" }}>
                  Loading the culture feed...
                </p>
              </div>
            );
          }

          return (
            <div style={{ padding: '136px 40px 60px' }}>
              <div style={{ maxWidth: '700px', margin: '0 auto' }}>
                {/* Header */}
                <div style={{ marginBottom: '32px' }}>
                  <h1 style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '48px',
                    fontWeight: 400,
                    color: '#fff',
                    marginBottom: '16px'
                  }}>
                    Culture Feed
                  </h1>
                  <p style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '14px',
                    color: '#888',
                    lineHeight: 1.7
                  }}>
                    See what creators are sharing. Join the conversation.
                  </p>
                </div>

                {/* Filter Tabs */}
                <div style={{
                  display: 'flex',
                  gap: '16px',
                  marginBottom: '24px',
                  borderBottom: '1px solid #1a1a1a',
                  paddingBottom: '16px'
                }}>
                  {['all', 'following', 'cultures'].map(f => (
                    <button
                      key={f}
                      onClick={() => setFilter(f)}
                      style={{
                        background: 'none',
                        border: 'none',
                        color: filter === f ? '#22c55e' : '#666',
                        fontSize: '12px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.1em',
                        textTransform: 'uppercase',
                        cursor: 'pointer',
                        padding: '4px 0',
                        borderBottom: filter === f ? '2px solid #22c55e' : '2px solid transparent'
                      }}
                    >
                      {f}
                    </button>
                  ))}
                </div>

                {/* Posts */}
                {posts.length === 0 ? (
                  <div style={{
                    textAlign: 'center',
                    padding: '60px 20px',
                    background: '#0f0f0f',
                    border: '1px solid #1a1a1a'
                  }}>
                    <div style={{ fontSize: '48px', marginBottom: '16px', opacity: 0.3 }}>📝</div>
                    <p style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '14px',
                      color: '#666'
                    }}>
                      No posts yet. Be the first to share something!
                    </p>
                  </div>
                ) : (
                  posts.map(post => (
                    <PostCard
                      key={post.id}
                      post={post}
                      currentUser={wallet?.address}
                      onLike={handleLike}
                      onComment={handleComment}
                      onRepost={handleRepost}
                    />
                  ))
                )}
              </div>
            </div>
          );
        };

        // Auctions View
        const AuctionsView = () => {
          const [searchQuery, setSearchQuery] = useState('');

          // Filter auctions by culture name, title, or type
          const filteredAuctions = AUCTIONS.filter(auction => {
            if (!searchQuery.trim()) return true;
            const query = searchQuery.toLowerCase().trim();
            return (
              (auction.cultureName && auction.cultureName.toLowerCase().includes(query)) ||
              (auction.title && auction.title.toLowerCase().includes(query)) ||
              (auction.type && auction.type.toLowerCase().includes(query)) ||
              (auction.description && auction.description.toLowerCase().includes(query))
            );
          });

          return (
            <div style={{ padding: '136px 40px 60px' }}>
              <div style={{ marginBottom: '48px' }}>
                <h1 style={{
                  fontFamily: "'Playfair Display', serif",
                  fontSize: '48px',
                  fontWeight: 400,
                  color: '#fff',
                  marginBottom: '16px'
                }}>
                  Open Bidding
                </h1>
                <p style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '14px',
                  color: '#888',
                  maxWidth: '600px',
                  lineHeight: 1.7
                }}>
                  Content is not traded. It is bid on. Winning bids are burned or returned
                  to the creator treasury - never resold.
                </p>
              </div>

              {/* Search */}
              <div style={{ marginBottom: '32px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  background: '#0f0f0f',
                  border: '1px solid #222',
                  padding: '0 16px'
                }}>
                  <span style={{ color: '#666', marginRight: '12px', fontSize: '14px' }}>⌕</span>
                  <input
                    type="text"
                    placeholder="Search by culture name, title, or type..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    style={{
                      flex: 1,
                      padding: '14px 0',
                      background: 'transparent',
                      border: 'none',
                      outline: 'none',
                      color: '#fff',
                      fontSize: '13px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}
                  />
                  {searchQuery && (
                    <button
                      onClick={() => setSearchQuery('')}
                      style={{
                        background: 'transparent',
                        border: 'none',
                        color: '#666',
                        cursor: 'pointer',
                        fontSize: '16px',
                        padding: '4px 8px'
                      }}
                    >
                      ✕
                    </button>
                  )}
                </div>
              </div>

              <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fill, minmax(450px, 1fr))',
                gap: '24px'
              }}>
                {filteredAuctions.map(auction => (
                  <AuctionCard key={auction.id} auction={auction} />
                ))}
              </div>
            </div>
          );
        };

        // Dashboard View - Shows cultures you CREATED (as owner) + Social Hub
        const DashboardView = () => {
          const wallet = useContext(WalletContext);
          const [myCultures, setMyCultures] = useState([]);
          const [loading, setLoading] = useState(true);
          const [searchQuery, setSearchQuery] = useState('');
          const [selectedChartCulture, setSelectedChartCulture] = useState(null);
          const [chartData, setChartData] = useState(null);
          const [chartHeight, setChartHeight] = useState(400);
          const [activeTab, setActiveTab] = useState('overview'); // overview, posts, cultures, settings

          // Profile & Social State
          const [profile, setProfile] = useState(() => {
            if (typeof window !== 'undefined') {
              try {
                const stored = localStorage.getItem('creator_profile_' + wallet?.address);
                return stored ? JSON.parse(stored) : null;
              } catch { return null; }
            }
            return null;
          });
          const [myPosts, setMyPosts] = useState([]);

          // Load profile when wallet changes
          useEffect(() => {
            if (wallet?.address) {
              try {
                const stored = localStorage.getItem('creator_profile_' + wallet.address);
                if (stored) {
                  setProfile(JSON.parse(stored));
                } else {
                  setProfile({ wallet: wallet.address, displayName: '', bio: '', pfp: null, banner: null });
                }
                // Load my posts
                const allPosts = JSON.parse(localStorage.getItem('culture_posts') || '[]');
                const mine = allPosts.filter(p => p.authorWallet === wallet.address);
                mine.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                setMyPosts(mine);
              } catch (e) {
                console.error('[DASHBOARD] Error loading profile:', e);
              }
            }
          }, [wallet?.address]);

          // Save profile changes
          const handleEditProfile = (updates) => {
            const newProfile = { ...profile, ...updates, wallet: wallet?.address };
            setProfile(newProfile);
            localStorage.setItem('creator_profile_' + wallet?.address, JSON.stringify(newProfile));
          };

          // Create a new post
          const handleCreatePost = (postData) => {
            const newPost = {
              id: Date.now().toString(),
              ...postData,
              authorWallet: wallet?.address,
              authorName: profile?.displayName || wallet?.address?.slice(0, 6) + '...' + wallet?.address?.slice(-4),
              authorPfp: profile?.pfp,
              createdAt: new Date().toISOString(),
              likes: [],
              comments: [],
              reposts: 0
            };

            // Save to global posts
            const allPosts = JSON.parse(localStorage.getItem('culture_posts') || '[]');
            allPosts.unshift(newPost);
            localStorage.setItem('culture_posts', JSON.stringify(allPosts));

            // Update local state
            setMyPosts(prev => [newPost, ...prev]);
          };

          // Handle like
          const handleLike = (postId) => {
            if (!wallet?.address) return;
            const allPosts = JSON.parse(localStorage.getItem('culture_posts') || '[]');
            const updatedAll = allPosts.map(p => {
              if (p.id === postId) {
                const likes = p.likes || [];
                const isLiked = likes.includes(wallet.address);
                return { ...p, likes: isLiked ? likes.filter(l => l !== wallet.address) : [...likes, wallet.address] };
              }
              return p;
            });
            localStorage.setItem('culture_posts', JSON.stringify(updatedAll));
            setMyPosts(updatedAll.filter(p => p.authorWallet === wallet.address));
          };

          // Handle comment
          const handleComment = (postId, comment) => {
            if (!wallet?.address) return;
            const allPosts = JSON.parse(localStorage.getItem('culture_posts') || '[]');
            const updatedAll = allPosts.map(p => {
              if (p.id === postId) {
                return {
                  ...p,
                  comments: [...(p.comments || []), {
                    author: wallet.address.slice(0, 6) + '...' + wallet.address.slice(-4),
                    content: comment,
                    createdAt: new Date().toISOString()
                  }]
                };
              }
              return p;
            });
            localStorage.setItem('culture_posts', JSON.stringify(updatedAll));
            setMyPosts(updatedAll.filter(p => p.authorWallet === wallet.address));
          };

          // Handle repost
          const handleRepost = (postId) => {
            if (!wallet?.address) return;
            const allPosts = JSON.parse(localStorage.getItem('culture_posts') || '[]');
            const updatedAll = allPosts.map(p => {
              if (p.id === postId) {
                const reposts = p.repostedBy || [];
                const hasReposted = reposts.includes(wallet.address);
                return {
                  ...p,
                  reposts: hasReposted ? (p.reposts || 1) - 1 : (p.reposts || 0) + 1,
                  repostedBy: hasReposted
                    ? reposts.filter(r => r !== wallet.address)
                    : [...reposts, wallet.address]
                };
              }
              return p;
            });
            localStorage.setItem('culture_posts', JSON.stringify(updatedAll));
            setMyPosts(updatedAll.filter(p => p.authorWallet === wallet.address));
          };

          // Auto-select first culture for chart when cultures load
          useEffect(() => {
            if (myCultures.length > 0 && !selectedChartCulture) {
              const firstWithToken = myCultures.find(c => c.tokenAddress);
              if (firstWithToken) {
                setSelectedChartCulture(firstWithToken);
              }
            }
          }, [myCultures]);

          // Fetch chart data when selected culture changes
          useEffect(() => {
            const fetchChartData = async () => {
              if (!selectedChartCulture?.tokenAddress) {
                setChartData(null);
                return;
              }
              try {
                const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${selectedChartCulture.tokenAddress}`);
                if (res.ok) {
                  const data = await res.json();
                  const pair = data.pairs?.[0];
                  if (pair) {
                    setChartData(pair);
                  }
                }
              } catch (e) {
                console.error('[DASHBOARD] Failed to fetch chart data:', e);
              }
            };
            fetchChartData();
          }, [selectedChartCulture?.tokenAddress]);

          // Fetch cultures I created from API and enrich with live pump.fun data
          useEffect(() => {
            const fetchMyCultures = async () => {
              if (!wallet?.address) {
                setLoading(false);
                return;
              }
              try {
                const res = await fetch('/api/cultures');
                const data = await res.json();
                if (data.success && data.cultures) {
                  // Filter to cultures created by this wallet
                  const owned = data.cultures.filter(c =>
                    c.wallet === wallet.address ||
                    c.creator === wallet.address
                  );
                  console.log('[DASHBOARD] Found', owned.length, 'cultures owned by', wallet.address);

                  // Enrich with live pump.fun data
                  const enriched = await Promise.all(owned.map(async (culture) => {
                    if (!culture.tokenAddress) return culture;
                    try {
                      const pumpRes = await fetch(`/api/pump/coin/${culture.tokenAddress}`);
                      if (pumpRes.ok) {
                        const pumpData = await pumpRes.json();
                        if (pumpData) {
                          return {
                            ...culture,
                            marketCap: pumpData.usd_market_cap || 0,
                            holders: pumpData.holder_count || 0,
                            volume: pumpData.volume_24h || 0
                          };
                        }
                      }
                    } catch (e) {
                      console.error('[DASHBOARD] Failed to enrich', culture.name, e);
                    }
                    return culture;
                  }));

                  setMyCultures(enriched);
                }
              } catch (e) {
                console.error('[DASHBOARD] Error fetching cultures:', e);
              } finally {
                setLoading(false);
              }
            };
            fetchMyCultures();
          }, [wallet?.address]);

          const totalParticipation = {
            culturesCreated: myCultures.length,
            totalHolders: myCultures.reduce((sum, c) => sum + (c.holders || 0), 0),
            totalVolume: myCultures.reduce((sum, c) => sum + (c.volume || 0), 0)
          };

          // Filter by search query (name, ticker, or contract address)
          const filteredCultures = myCultures.filter(c => {
            if (!searchQuery.trim()) return true;
            const query = searchQuery.toLowerCase().trim();
            return (
              (c.name && c.name.toLowerCase().includes(query)) ||
              (c.ticker && c.ticker.toLowerCase().includes(query)) ||
              (c.symbol && c.symbol.toLowerCase().includes(query)) ||
              (c.tokenAddress && c.tokenAddress.toLowerCase().includes(query))
            );
          });

          // Not connected state
          if (!wallet?.address) {
            return (
              <div style={{ padding: '136px 40px 60px', textAlign: 'center' }}>
                <div style={{ maxWidth: '500px', margin: '0 auto' }}>
                  <h1 style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '48px',
                    fontWeight: 400,
                    color: '#fff',
                    marginBottom: '24px'
                  }}>
                    Your Cultures
                  </h1>
                  <p style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '14px',
                    color: '#666',
                    marginBottom: '40px',
                    lineHeight: 1.7
                  }}>
                    Connect your wallet to view your culture holdings and participation standing.
                  </p>
                  <button
                    onClick={wallet?.connect}
                    style={{
                      padding: '16px 40px',
                      background: '#fff',
                      border: 'none',
                      color: '#000',
                      fontSize: '12px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      fontWeight: 600
                    }}
                  >
                    CONNECT WALLET
                  </button>
                </div>
              </div>
            );
          }

          // Loading state
          if (loading) {
            return (
              <div style={{ padding: '136px 40px 60px', textAlign: 'center' }}>
                <p style={{ color: '#888', fontFamily: "'IBM Plex Mono', monospace" }}>Loading your cultures...</p>
              </div>
            );
          }

          // No cultures created yet
          if (myCultures.length === 0) {
            return (
              <div style={{ padding: '136px 40px 60px', textAlign: 'center' }}>
                <div style={{ maxWidth: '500px', margin: '0 auto' }}>
                  <h1 style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '48px',
                    fontWeight: 400,
                    color: '#fff',
                    marginBottom: '24px'
                  }}>
                    No Cultures Created
                  </h1>
                  <p style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '14px',
                    color: '#666',
                    marginBottom: '16px',
                    lineHeight: 1.7
                  }}>
                    You haven't created any cultures yet. Create your first culture coin and build your community.
                  </p>
                  <p style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '12px',
                    color: '#444',
                    marginBottom: '40px'
                  }}>
                    Connected: {wallet.address.slice(0,6)}...{wallet.address.slice(-4)}
                  </p>
                  <button
                    onClick={() => window.location.href = '/culture-coins?view=create'}
                    style={{
                      padding: '16px 40px',
                      background: '#fff',
                      border: 'none',
                      color: '#000',
                      fontSize: '12px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      fontWeight: 600
                    }}
                  >
                    CREATE CULTURE
                  </button>
                </div>
              </div>
            );
          }

          return (
            <div style={{ padding: '136px 40px 60px' }}>
              {/* Creator Profile Header */}
              <CreatorProfileHeader
                profile={profile}
                onEditProfile={handleEditProfile}
                isOwner={true}
                stats={{
                  cultures: myCultures.length,
                  posts: myPosts.length,
                  followers: 0,
                  following: 0
                }}
              />

              {/* Dashboard Tabs */}
              <div style={{
                display: 'flex',
                gap: '24px',
                marginBottom: '32px',
                borderBottom: '1px solid #1a1a1a',
                paddingBottom: '16px'
              }}>
                {[
                  { id: 'overview', label: 'Overview' },
                  { id: 'posts', label: 'My Posts' },
                  { id: 'cultures', label: 'My Cultures' },
                  { id: 'settings', label: 'Settings' }
                ].map(tab => (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    style={{
                      background: 'none',
                      border: 'none',
                      color: activeTab === tab.id ? '#22c55e' : '#666',
                      fontSize: '13px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.05em',
                      cursor: 'pointer',
                      padding: '8px 0',
                      borderBottom: activeTab === tab.id ? '2px solid #22c55e' : '2px solid transparent',
                      transition: 'all 0.2s'
                    }}
                  >
                    {tab.label}
                  </button>
                ))}
              </div>

              {/* Tab Content */}
              {activeTab === 'overview' && (
                <>
                  {/* Post Composer */}
                  <PostComposer
                    onPost={handleCreatePost}
                    profile={profile}
                    cultures={myCultures}
                  />

                  {/* Stats */}
                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: 'repeat(4, 1fr)',
                    gap: '16px',
                    marginBottom: '32px'
                  }}>
                    {[
                      { value: myCultures.length, label: 'CULTURES' },
                      { value: myPosts.length, label: 'POSTS' },
                      { value: totalParticipation.totalHolders, label: 'HOLDERS' },
                      { value: `$${totalParticipation.totalVolume.toLocaleString()}`, label: 'VOLUME' }
                    ].map((stat, i) => (
                      <div key={i} style={{
                        background: '#0f0f0f',
                        border: '1px solid #1a1a1a',
                        padding: '24px',
                        textAlign: 'center'
                      }}>
                        <div style={{
                          fontSize: '28px',
                          color: '#fff',
                          fontFamily: "'IBM Plex Mono', monospace",
                          marginBottom: '6px'
                        }}>
                          {stat.value}
                        </div>
                        <div style={{
                          fontSize: '9px',
                          color: '#666',
                          letterSpacing: '0.15em',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}>
                          {stat.label}
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* Recent Activity - My Posts */}
                  <div style={{ marginBottom: '32px' }}>
                    <h3 style={{
                      fontSize: '12px',
                      letterSpacing: '0.15em',
                      color: '#666',
                      marginBottom: '16px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      RECENT ACTIVITY
                    </h3>
                    {myPosts.length === 0 ? (
                      <div style={{
                        padding: '40px',
                        background: '#0f0f0f',
                        border: '1px solid #1a1a1a',
                        textAlign: 'center'
                      }}>
                        <p style={{
                          color: '#666',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '14px'
                        }}>
                          No posts yet. Share something with your community!
                        </p>
                      </div>
                    ) : (
                      myPosts.slice(0, 3).map(post => (
                        <PostCard
                          key={post.id}
                          post={post}
                          currentUser={wallet?.address}
                          onLike={handleLike}
                          onComment={handleComment}
                          onRepost={handleRepost}
                        />
                      ))
                    )}
                  </div>
                </>
              )}

              {activeTab === 'posts' && (
                <div>
                  <PostComposer
                    onPost={handleCreatePost}
                    profile={profile}
                    cultures={myCultures}
                  />
                  {myPosts.length === 0 ? (
                    <div style={{
                      padding: '60px 40px',
                      background: '#0f0f0f',
                      border: '1px solid #1a1a1a',
                      textAlign: 'center'
                    }}>
                      <div style={{ fontSize: '48px', marginBottom: '16px', opacity: 0.3 }}>📝</div>
                      <p style={{
                        color: '#666',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '14px'
                      }}>
                        No posts yet. Start sharing your journey!
                      </p>
                    </div>
                  ) : (
                    myPosts.map(post => (
                      <PostCard
                        key={post.id}
                        post={post}
                        currentUser={wallet?.address}
                        onLike={handleLike}
                        onComment={handleComment}
                        onRepost={handleRepost}
                      />
                    ))
                  )}
                </div>
              )}

              {activeTab === 'cultures' && (
                <>

              {/* Price Chart - Premium Design */}
              {selectedChartCulture?.tokenAddress && (
                <div style={{
                  marginBottom: '48px',
                  background: 'linear-gradient(180deg, rgba(34, 197, 94, 0.03) 0%, rgba(0,0,0,0) 100%)',
                  border: '1px solid rgba(34, 197, 94, 0.3)',
                  boxShadow: '0 0 30px rgba(34, 197, 94, 0.1), inset 0 0 60px rgba(34, 197, 94, 0.02)',
                  position: 'relative',
                  overflow: 'hidden'
                }}>
                  {/* Top glow line */}
                  <div style={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    right: 0,
                    height: '1px',
                    background: 'linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.5), transparent)'
                  }} />

                  {/* Chart Header */}
                  <div style={{
                    padding: '16px 24px',
                    borderBottom: '1px solid rgba(34, 197, 94, 0.15)',
                    background: 'rgba(0, 0, 0, 0.4)',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    flexWrap: 'wrap',
                    gap: '16px'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
                      <div style={{
                        fontSize: '11px',
                        letterSpacing: '0.15em',
                        color: '#22c55e',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontWeight: 600
                      }}>
                        PRICE CHART
                      </div>

                      {/* Live Price */}
                      {chartData && (
                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                          <span style={{
                            fontSize: '20px',
                            fontWeight: 600,
                            color: '#fff',
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            ${parseFloat(chartData.priceUsd || 0) < 0.0001
                              ? parseFloat(chartData.priceUsd || 0).toExponential(2)
                              : parseFloat(chartData.priceUsd || 0).toFixed(6)}
                          </span>
                          <span style={{
                            fontSize: '13px',
                            fontWeight: 500,
                            padding: '4px 10px',
                            borderRadius: '4px',
                            background: (chartData.priceChange?.h24 || 0) >= 0 ? 'rgba(34,197,94,0.15)' : 'rgba(239,68,68,0.15)',
                            color: (chartData.priceChange?.h24 || 0) >= 0 ? '#22c55e' : '#ef4444'
                          }}>
                            {(chartData.priceChange?.h24 || 0) >= 0 ? '+' : ''}{(chartData.priceChange?.h24 || 0).toFixed(2)}%
                          </span>
                        </div>
                      )}
                    </div>

                    <div style={{ display: 'flex', alignItems: 'center', gap: '24px' }}>
                      {/* Quick Stats */}
                      {chartData && (
                        <div style={{ display: 'flex', alignItems: 'center', gap: '24px', paddingRight: '20px', borderRight: '1px solid #222' }}>
                          <div style={{ textAlign: 'right' }}>
                            <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginBottom: '2px' }}>MCAP</div>
                            <div style={{ fontSize: '13px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                              ${(chartData.marketCap || chartData.fdv || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}
                            </div>
                          </div>
                          <div style={{ textAlign: 'right' }}>
                            <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginBottom: '2px' }}>24H VOL</div>
                            <div style={{ fontSize: '13px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                              ${(chartData.volume?.h24 || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}
                            </div>
                          </div>
                          <div style={{ textAlign: 'right' }}>
                            <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginBottom: '2px' }}>LIQ</div>
                            <div style={{ fontSize: '13px', color: '#22c55e', fontFamily: "'IBM Plex Mono', monospace" }}>
                              ${(chartData.liquidity?.usd || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}
                            </div>
                          </div>
                        </div>
                      )}

                      {/* Size Controls */}
                      <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                        {[300, 400, 550, 700].map(h => (
                          <button
                            key={h}
                            onClick={() => setChartHeight(h)}
                            style={{
                              padding: '6px 12px',
                              fontSize: '10px',
                              borderRadius: '4px',
                              border: chartHeight === h ? '1px solid #22c55e' : '1px solid #333',
                              background: chartHeight === h ? 'rgba(34,197,94,0.15)' : 'transparent',
                              color: chartHeight === h ? '#22c55e' : '#666',
                              cursor: 'pointer',
                              fontFamily: "'IBM Plex Mono', monospace",
                              transition: 'all 0.2s'
                            }}
                          >
                            {h === 300 ? 'S' : h === 400 ? 'M' : h === 550 ? 'L' : 'XL'}
                          </button>
                        ))}
                      </div>
                    </div>
                  </div>

                  {/* Chart Container */}
                  <div style={{ height: chartHeight, background: '#0a0a0a', transition: 'height 0.3s ease' }}>
                    {chartData?.pairAddress ? (
                      <iframe
                        src={`https://dexscreener.com/solana/${chartData.pairAddress}?embed=1&theme=dark&trades=0&info=0`}
                        style={{ width: '100%', height: '100%', border: 'none' }}
                        title="Price Chart"
                      />
                    ) : (
                      <div style={{
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        height: '100%',
                        color: '#666',
                        gap: '12px'
                      }}>
                        <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24" style={{ opacity: 0.3 }}>
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4v16a1 1 0 001 1h14a1 1 0 001-1V4"></path>
                        </svg>
                        <span style={{ fontFamily: "'IBM Plex Mono', monospace", fontSize: '13px' }}>Loading chart...</span>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Search */}
              <div style={{ marginBottom: '24px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  background: '#0f0f0f',
                  border: '1px solid #222',
                  padding: '0 16px'
                }}>
                  <span style={{ color: '#666', marginRight: '12px', fontSize: '14px' }}>⌕</span>
                  <input
                    type="text"
                    placeholder="Search by name, ticker, or contract address..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    style={{
                      flex: 1,
                      padding: '14px 0',
                      background: 'transparent',
                      border: 'none',
                      outline: 'none',
                      color: '#fff',
                      fontSize: '13px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}
                  />
                  {searchQuery && (
                    <button
                      onClick={() => setSearchQuery('')}
                      style={{
                        background: 'transparent',
                        border: 'none',
                        color: '#666',
                        cursor: 'pointer',
                        fontSize: '16px',
                        padding: '4px 8px'
                      }}
                    >
                      ✕
                    </button>
                  )}
                </div>
              </div>

              {/* My Cultures */}
              <div style={{
                fontSize: '10px',
                letterSpacing: '0.15em',
                color: '#666',
                marginBottom: '24px',
                fontFamily: "'IBM Plex Mono', monospace"
              }}>
                YOUR CULTURES {searchQuery && `(${filteredCultures.length} of ${myCultures.length})`}
              </div>

              <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                {filteredCultures.map(culture => (
                  <div
                    key={culture.id || culture.tokenAddress}
                    style={{
                      background: '#0f0f0f',
                      border: '1px solid #1a1a1a',
                      padding: '32px'
                    }}
                  >
                    {/* Header row */}
                    <div style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'flex-start',
                      marginBottom: '24px'
                    }}>
                      <div>
                        <div style={{
                          fontSize: '9px',
                          letterSpacing: '0.15em',
                          color: '#666',
                          marginBottom: '8px',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}>
                          {(culture.category || 'CULTURE').toUpperCase()}
                        </div>
                        <h3 style={{
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '28px',
                          color: '#fff',
                          marginBottom: '8px'
                        }}>
                          {culture.name}
                        </h3>
                        <div style={{
                          display: 'inline-block',
                          background: '#22c55e',
                          color: '#000',
                          fontSize: '11px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          letterSpacing: '0.1em',
                          padding: '4px 12px',
                          fontWeight: 600
                        }}>
                          ${culture.ticker || culture.symbol || 'TOKEN'}
                        </div>
                      </div>

                      <div style={{
                        display: 'inline-block',
                        background: '#1a1a1a',
                        color: '#22c55e',
                        fontSize: '10px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.1em',
                        padding: '6px 12px'
                      }}>
                        OWNER
                      </div>
                    </div>

                    {/* Token address */}
                    {culture.tokenAddress && (
                      <div style={{ marginBottom: '24px' }}>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                          TOKEN ADDRESS
                        </div>
                        <div style={{
                          display: 'flex',
                          alignItems: 'center',
                          gap: '12px',
                          background: '#0a0a0a',
                          padding: '12px 16px',
                          border: '1px solid #222'
                        }}>
                          <span style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '13px',
                            color: '#fff',
                            flex: 1
                          }}>
                            {culture.tokenAddress}
                          </span>
                          <button
                            onClick={() => {
                              navigator.clipboard.writeText(culture.tokenAddress);
                              alert('Copied!');
                            }}
                            style={{
                              background: 'transparent',
                              border: '1px solid #333',
                              color: '#888',
                              padding: '6px 12px',
                              fontSize: '10px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              cursor: 'pointer'
                            }}
                          >
                            COPY
                          </button>
                        </div>
                      </div>
                    )}

                    {/* Stats row */}
                    <div style={{
                      display: 'grid',
                      gridTemplateColumns: 'repeat(4, 1fr)',
                      gap: '24px',
                      marginBottom: '24px'
                    }}>
                      <div>
                        <div style={{ fontSize: '18px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace", marginBottom: '4px' }}>
                          {culture.holders || 0}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>HOLDERS</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '18px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace", marginBottom: '4px' }}>
                          ${(culture.marketCap || 0).toLocaleString()}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>MARKET CAP</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '18px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace", marginBottom: '4px' }}>
                          ${(culture.volume || 0).toLocaleString()}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>VOLUME</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '18px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace", marginBottom: '4px' }}>
                          {culture.createdAt ? new Date(culture.createdAt).toLocaleDateString() : '-'}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>CREATED</div>
                      </div>
                    </div>

                    {/* Action buttons */}
                    <div style={{
                      display: 'flex',
                      gap: '12px',
                      flexWrap: 'wrap'
                    }}>
                      {culture.tokenAddress && (
                        <a
                          href={`https://pump.fun/coin/${culture.tokenAddress}`}
                          target="_blank"
                          rel="noopener noreferrer"
                          style={{
                            padding: '12px 24px',
                            background: '#22c55e',
                            border: 'none',
                            color: '#000',
                            fontSize: '11px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            letterSpacing: '0.1em',
                            cursor: 'pointer',
                            fontWeight: 600,
                            textDecoration: 'none'
                          }}
                        >
                          VIEW ON PUMP.FUN
                        </a>
                      )}
                      <a
                        href={`/culture-coins?view=culture&id=${culture.id || culture.slug}`}
                        style={{
                          padding: '12px 24px',
                          background: 'transparent',
                          border: '1px solid #333',
                          color: '#fff',
                          fontSize: '11px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          letterSpacing: '0.1em',
                          cursor: 'pointer',
                          textDecoration: 'none'
                        }}
                      >
                        VIEW PAGE
                      </a>
                      <button
                        onClick={() => {
                          // TODO: Open settings modal
                          alert('Settings coming soon! For now, contact support to update your culture page.');
                        }}
                        style={{
                          padding: '12px 24px',
                          background: 'transparent',
                          border: '1px solid #333',
                          color: '#888',
                          fontSize: '11px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          letterSpacing: '0.1em',
                          cursor: 'pointer'
                        }}
                      >
                        SETTINGS
                      </button>
                    </div>
                  </div>
                ))}
              </div>

              {/* Create another culture button */}
              <div style={{ marginTop: '32px', textAlign: 'center' }}>
                <button
                  onClick={() => window.location.href = '/culture-coins?view=create'}
                  style={{
                    padding: '16px 40px',
                    background: 'transparent',
                    border: '1px solid #333',
                    color: '#fff',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    letterSpacing: '0.1em',
                    cursor: 'pointer'
                  }}
                >
                  + CREATE ANOTHER CULTURE
                </button>
              </div>
                </>
              )}

              {activeTab === 'settings' && (
                <div style={{
                  background: '#0f0f0f',
                  border: '1px solid #1a1a1a',
                  padding: '32px'
                }}>
                  <h3 style={{
                    fontSize: '12px',
                    letterSpacing: '0.15em',
                    color: '#666',
                    marginBottom: '24px',
                    fontFamily: "'IBM Plex Mono', monospace"
                  }}>
                    PROFILE SETTINGS
                  </h3>

                  <div style={{ marginBottom: '24px' }}>
                    <label style={{
                      display: 'block',
                      fontSize: '11px',
                      color: '#888',
                      marginBottom: '8px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em'
                    }}>
                      DISPLAY NAME
                    </label>
                    <input
                      type="text"
                      value={profile?.displayName || ''}
                      onChange={(e) => handleEditProfile({ displayName: e.target.value })}
                      placeholder="Your display name"
                      style={{
                        width: '100%',
                        maxWidth: '400px',
                        padding: '14px',
                        background: '#0a0a0a',
                        border: '1px solid #222',
                        color: '#fff',
                        fontSize: '15px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        outline: 'none'
                      }}
                    />
                  </div>

                  <div style={{ marginBottom: '24px' }}>
                    <label style={{
                      display: 'block',
                      fontSize: '11px',
                      color: '#888',
                      marginBottom: '8px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em'
                    }}>
                      BIO
                    </label>
                    <textarea
                      value={profile?.bio || ''}
                      onChange={(e) => handleEditProfile({ bio: e.target.value })}
                      placeholder="Tell the world about yourself..."
                      style={{
                        width: '100%',
                        maxWidth: '600px',
                        minHeight: '100px',
                        padding: '14px',
                        background: '#0a0a0a',
                        border: '1px solid #222',
                        color: '#fff',
                        fontSize: '14px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        resize: 'vertical',
                        outline: 'none'
                      }}
                    />
                  </div>

                  <div style={{
                    padding: '20px',
                    background: 'rgba(34, 197, 94, 0.1)',
                    border: '1px solid rgba(34, 197, 94, 0.3)',
                    marginTop: '24px'
                  }}>
                    <div style={{
                      fontSize: '12px',
                      color: '#22c55e',
                      fontFamily: "'IBM Plex Mono', monospace",
                      marginBottom: '8px'
                    }}>
                      CONNECTED WALLET
                    </div>
                    <div style={{
                      fontSize: '14px',
                      color: '#fff',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      {wallet?.address}
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Create Culture Page - Manifesto Style
        const CreateCulturePage = () => {
          const wallet = useContext(WalletContext);
          const [cultureName, setCultureName] = useState('');
          const [creatorName, setCreatorName] = useState('');
          const [cultureEthos, setCultureEthos] = useState(['', '', '']); // Empty - user fills in
          const [isCreating, setIsCreating] = useState(false);

          // Token Icon (required for pump.fun)
          const [tokenIcon, setTokenIcon] = useState(null); // File object
          const [tokenIconPreview, setTokenIconPreview] = useState(''); // Data URL for preview
          const [tokenTicker, setTokenTicker] = useState(''); // Custom ticker
          const [devBuyAmount, setDevBuyAmount] = useState(0); // Initial dev buy in SOL (0-5)
          const [category, setCategory] = useState(''); // Token category

          // Available categories
          const CATEGORIES = [
            { id: 'meme', name: 'Meme', icon: '😂' },
            { id: 'ai', name: 'AI', icon: '🤖' },
            { id: 'utility', name: 'Utility', icon: '🔧' },
            { id: 'finance', name: 'Finance', icon: '💰' },
            { id: 'accounting', name: 'Accounting', icon: '📒' },
            { id: 'tech', name: 'Tech', icon: '💻' },
            { id: 'fitness', name: 'Fitness', icon: '💪' },
            { id: 'wellness', name: 'Health & Wellness', icon: '🧘' },
            { id: 'data', name: 'Data', icon: '📊' },
            { id: 'fashion', name: 'Fashion', icon: '👗' },
            { id: 'music', name: 'Music', icon: '🎵' },
            { id: 'art', name: 'Art', icon: '🎨' },
            { id: 'travel', name: 'Travel', icon: '✈️' },
            { id: 'gaming', name: 'Gaming', icon: '🎮' },
            { id: 'social', name: 'Social', icon: '👥' },
            { id: 'law', name: 'Law', icon: '⚖️' },
            { id: 'environmental', name: 'Environmental', icon: '🌱' },
            { id: 'education', name: 'Education', icon: '📚' },
            { id: 'political', name: 'Political', icon: '🗳️' },
            { id: 'sports', name: 'Sports', icon: '⚽' },
            { id: 'food', name: 'Food & Drink', icon: '🍕' },
            { id: 'other', name: 'Other', icon: '✨' }
          ];

          // Light/Dark mode
          const [lightMode, setLightMode] = useState(false);

          // Vanity Address Mining
          const [vanitySuffix, setVanitySuffix] = useState('');
          const [vanityMining, setVanityMining] = useState(false);
          const [vanityProgress, setVanityProgress] = useState({
            attempts: 0,
            rate: 0,
            elapsed: 0,
            estimatedTime: '',
            difficulty: ''
          });
          const [vanityResult, setVanityResult] = useState(null);
          const [miningWorker, setMiningWorker] = useState(null);

          // Estimate difficulty for vanity suffix (CASE SENSITIVE)
          const estimateVanityDifficulty = (suffix) => {
            if (!suffix) return { attempts: 1, time: 'instant', probability: '100%' };
            // Base58 has 58 characters, case sensitive matching
            const charProbability = 58;
            const attempts = Math.pow(charProbability, suffix.length);
            const attemptsPerSecond = 50000; // browser estimate
            const seconds = attempts / attemptsPerSecond;

            let timeEstimate;
            if (seconds < 60) timeEstimate = `~${Math.round(seconds)} seconds`;
            else if (seconds < 3600) timeEstimate = `~${Math.round(seconds / 60)} minutes`;
            else if (seconds < 86400) timeEstimate = `~${Math.round(seconds / 3600)} hours`;
            else if (seconds < 604800) timeEstimate = `~${Math.round(seconds / 86400)} days`;
            else timeEstimate = `~${Math.round(seconds / 604800)} weeks`;

            return {
              attempts: attempts.toLocaleString(),
              time: timeEstimate,
              probability: `1 in ${attempts.toLocaleString()}`
            };
          };

          // Start vanity mining in web worker
          const startVanityMining = () => {
            if (!vanitySuffix || vanityMining) return;

            setVanityMining(true);
            setVanityProgress({ attempts: 0, rate: 0, elapsed: 0, estimatedTime: estimateVanityDifficulty(vanitySuffix).time, difficulty: estimateVanityDifficulty(vanitySuffix).probability });
            setVanityResult(null);

            // Create inline worker for browser-based mining
            // CASE SENSITIVE - exact match only
            const workerCode = `
              importScripts('https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js');

              const suffix = '${vanitySuffix}';  // Keep exact case user typed
              let attempts = 0;
              const startTime = Date.now();

              function mine() {
                const batchSize = 1000;
                for (let i = 0; i < batchSize; i++) {
                  attempts++;
                  const keypair = solanaWeb3.Keypair.generate();
                  const address = keypair.publicKey.toBase58();

                  // EXACT case match - "moon" only matches "moon", not "MOON" or "mooN"
                  if (address.endsWith(suffix)) {
                    postMessage({
                      type: 'found',
                      address: address,
                      secretKey: Array.from(keypair.secretKey),
                      attempts: attempts,
                      elapsed: (Date.now() - startTime) / 1000
                    });
                    return;
                  }
                }

                // Report progress
                const elapsed = (Date.now() - startTime) / 1000;
                postMessage({
                  type: 'progress',
                  attempts: attempts,
                  rate: Math.round(attempts / elapsed),
                  elapsed: Math.round(elapsed)
                });

                // Continue mining
                setTimeout(mine, 0);
              }

              mine();
            `;

            const blob = new Blob([workerCode], { type: 'application/javascript' });
            const worker = new Worker(URL.createObjectURL(blob));

            worker.onmessage = (e) => {
              if (e.data.type === 'progress') {
                setVanityProgress(prev => ({
                  ...prev,
                  attempts: e.data.attempts,
                  rate: e.data.rate,
                  elapsed: e.data.elapsed
                }));
              } else if (e.data.type === 'found') {
                setVanityResult({
                  address: e.data.address,
                  secretKey: e.data.secretKey,
                  attempts: e.data.attempts,
                  elapsed: e.data.elapsed
                });
                setVanityMining(false);
                worker.terminate();
              }
            };

            setMiningWorker(worker);
          };

          // Stop mining
          const stopVanityMining = () => {
            if (miningWorker) {
              miningWorker.terminate();
              setMiningWorker(null);
            }
            setVanityMining(false);
          };

          // Theme customization
          const [theme, setTheme] = useState({
            bgType: 'solid', // solid, gradient, pattern, image
            bgColor: '#0a0a0a',
            bgGradient: ['#0a0a0a', '#1a1a2e'],
            bgPattern: 'none', // none, dots, grid, diagonal
            bgImage: '',
            bgImageFit: 'cover', // cover, contain, tile, stretch
            accentColor: '#ffffff',
            textColor: '#ffffff',
            cardBg: '#0f0f0f',
            borderColor: '#1a1a1a'
          });

          const patterns = {
            none: 'none',
            dots: 'radial-gradient(circle, #333 1px, transparent 1px)',
            grid: 'linear-gradient(#222 1px, transparent 1px), linear-gradient(90deg, #222 1px, transparent 1px)',
            diagonal: 'repeating-linear-gradient(45deg, #1a1a1a, #1a1a1a 10px, #0f0f0f 10px, #0f0f0f 20px)',
            hearts: 'url("data:image/svg+xml,%3Csvg width=\'40\' height=\'40\' viewBox=\'0 0 40 40\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M20 30l-7-7c-4-4-4-10 0-14s10-4 14 0l-7 7 7 7c4 4 4 10 0 14s-10 4-14 0l7-7z\' fill=\'%23333\' fill-opacity=\'0.3\'/%3E%3C/svg%3E")',
            stars: 'url("data:image/svg+xml,%3Csvg width=\'30\' height=\'30\' viewBox=\'0 0 30 30\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Ctext x=\'10\' y=\'20\' fill=\'%23333\' opacity=\'0.3\'%3E★%3C/text%3E%3C/svg%3E")'
          };

          // Light mode color overrides
          const lightColors = {
            bg: '#f8f9fa',
            cardBg: '#ffffff',
            text: '#1a1a1a',
            textMuted: '#666666',
            border: '#e0e0e0',
            accent: '#1a1a1a',
            inputBg: '#ffffff',
            inputBorder: '#d0d0d0'
          };

          const darkColors = {
            bg: '#0a0a0a',
            cardBg: '#111111',
            text: '#ffffff',
            textMuted: '#888888',
            border: '#333333',
            accent: '#FFD966',
            inputBg: '#111111',
            inputBorder: '#333333'
          };

          const colors = lightMode ? lightColors : darkColors;

          const getBackgroundStyle = () => {
            // If light mode, override with light background
            if (lightMode) {
              return { background: lightColors.bg };
            }

            let bg = {};
            if (theme.bgType === 'solid') {
              bg.background = theme.bgColor;
            } else if (theme.bgType === 'gradient') {
              bg.background = `linear-gradient(135deg, ${theme.bgGradient[0]}, ${theme.bgGradient[1]})`;
            } else if (theme.bgType === 'pattern') {
              bg.background = theme.bgColor;
              if (theme.bgPattern !== 'none') {
                bg.backgroundImage = patterns[theme.bgPattern];
                bg.backgroundSize = theme.bgPattern === 'dots' ? '20px 20px' : theme.bgPattern === 'grid' ? '20px 20px' : 'auto';
              }
            } else if (theme.bgType === 'image' && theme.bgImage) {
              bg.backgroundImage = `url(${theme.bgImage})`;
              // Apply image fit mode
              if (theme.bgImageFit === 'tile') {
                bg.backgroundSize = 'auto';
                bg.backgroundRepeat = 'repeat';
              } else if (theme.bgImageFit === 'contain') {
                bg.backgroundSize = 'contain';
                bg.backgroundRepeat = 'no-repeat';
                bg.backgroundPosition = 'center';
              } else if (theme.bgImageFit === 'stretch') {
                bg.backgroundSize = '100% 100%';
                bg.backgroundRepeat = 'no-repeat';
              } else { // cover (default)
                bg.backgroundSize = 'cover';
                bg.backgroundPosition = 'center';
                bg.backgroundRepeat = 'no-repeat';
              }
            }
            return bg;
          };

          // Editable beliefs
          const [beliefs, setBeliefs] = useState([
            'We prioritize long-term thinking over short-term wins',
            'We value judgment, not volume',
            'Participation matters more than presence',
            'Culture compounds when members contribute'
          ]);

          // Editable unlocks
          const [unlocks, setUnlocks] = useState([
            { title: 'Private Discussions', description: 'Member-only conversations focused on signal, not chatter.' },
            { title: 'Cultural Drops', description: 'Essays, sessions, or artifacts released through auction-style participation.' },
            { title: 'Live Moments', description: 'Scheduled live calls, AMAs, or IRL meetups.' },
            { title: 'Early Access', description: 'First access to new initiatives, tools, or collaborations.' }
          ]);

          // Tiers with content drops
          const [tiers, setTiers] = useState([
            { name: 'Observer', holdingPercent: 0.1, access: 'Read-only access to culture feed', content: [] },
            { name: 'Participant', holdingPercent: 0.5, access: 'Join discussions and auctions', content: [] },
            { name: 'Insider', holdingPercent: 1.5, access: 'Live sessions and early drops', content: [] },
            { name: 'Steward', holdingPercent: 5.0, access: 'Help shape culture direction', content: [] }
          ]);

          const [selectedTierIndex, setSelectedTierIndex] = useState(0);

          // Belief functions
          const updateBelief = (index, value) => {
            const newBeliefs = [...beliefs];
            newBeliefs[index] = value;
            setBeliefs(newBeliefs);
          };

          const addBelief = () => {
            if (beliefs.length < 8) {
              setBeliefs([...beliefs, '']);
            }
          };

          const removeBelief = (index) => {
            if (beliefs.length > 1) {
              setBeliefs(beliefs.filter((_, i) => i !== index));
            }
          };

          // Unlock functions
          const updateUnlock = (index, field, value) => {
            const newUnlocks = [...unlocks];
            newUnlocks[index] = { ...newUnlocks[index], [field]: value };
            setUnlocks(newUnlocks);
          };

          const addUnlock = () => {
            if (unlocks.length < 8) {
              setUnlocks([...unlocks, { title: '', description: '' }]);
            }
          };

          const removeUnlock = (index) => {
            if (unlocks.length > 1) {
              setUnlocks(unlocks.filter((_, i) => i !== index));
            }
          };

          // Tier functions
          const updateTier = (index, field, value) => {
            const newTiers = [...tiers];
            newTiers[index] = { ...newTiers[index], [field]: value };
            setTiers(newTiers);
          };

          const addTier = () => {
            if (tiers.length < 6) {
              const lastPercent = tiers[tiers.length - 1]?.holdingPercent || 0;
              setTiers([...tiers, { name: '', holdingPercent: lastPercent + 2, access: '', content: [] }]);
            }
          };

          const removeTier = (index) => {
            if (tiers.length > 2) {
              setTiers(tiers.filter((_, i) => i !== index));
              if (selectedTierIndex >= tiers.length - 1) {
                setSelectedTierIndex(Math.max(0, tiers.length - 2));
              }
            }
          };

          // Tier content functions
          const addTierContent = (tierIndex, contentType) => {
            const newTiers = [...tiers];
            newTiers[tierIndex].content = [...newTiers[tierIndex].content, {
              type: contentType,
              title: '',
              description: ''
            }];
            setTiers(newTiers);
          };

          const updateTierContent = (tierIndex, contentIndex, field, value) => {
            const newTiers = [...tiers];
            newTiers[tierIndex].content[contentIndex] = {
              ...newTiers[tierIndex].content[contentIndex],
              [field]: value
            };
            setTiers(newTiers);
          };

          const removeTierContent = (tierIndex, contentIndex) => {
            const newTiers = [...tiers];
            newTiers[tierIndex].content = newTiers[tierIndex].content.filter((_, i) => i !== contentIndex);
            setTiers(newTiers);
          };

          // Handle culture creation - REQUIRES PRIVY WALLET
          // State for creation progress
          const [createStatus, setCreateStatus] = useState('');

          const handleCreate = async () => {
            // SECURITY: Require wallet connection
            if (!wallet?.address) {
              alert('Please connect your wallet with Privy to create a culture. This is required for security.');
              wallet?.showModal?.();
              return;
            }

            if (!cultureName.trim()) {
              alert('Please enter a culture name');
              return;
            }
            if (!creatorName.trim()) {
              alert('Please enter your name');
              return;
            }

            // Require token icon for pump.fun
            if (!tokenIcon) {
              alert('Please upload a token icon. This is required to create your token on pump.fun.');
              return;
            }

            // Use custom ticker or generate from culture name
            // Use custom ticker or generate from name - pump.fun max is 8 chars
            const ticker = (tokenTicker.trim() || cultureName).replace(/[^a-zA-Z0-9]/g, '').slice(0, 8) || 'CULTURE';

            setIsCreating(true);
            let tokenAddress = null;
            let txSignature = null;

            try {
              // ═══════════════════════════════════════════════════════════════
              // STEP 1: Create the token on-chain via Pump.fun
              // ═══════════════════════════════════════════════════════════════

              // Check if we have a vanity address mined, otherwise generate random
              let mintSecretKey = vanityResult?.secretKey;
              let mintAddress = vanityResult?.address;

              if (!mintSecretKey) {
                // No vanity mined - generate a random keypair
                console.log('[CREATE CULTURE] No vanity address, generating random mint...');
                setCreateStatus('Generating token address...');
                const randomKeypair = solanaWeb3.Keypair.generate();
                mintSecretKey = Array.from(randomKeypair.secretKey);
                mintAddress = randomKeypair.publicKey.toBase58();
              }

              // Reconstruct keypair from secretKey
              const mintKeypair = solanaWeb3.Keypair.fromSecretKey(
                Uint8Array.from(mintSecretKey)
              );
              console.log('[CREATE CULTURE] Using mint address:', mintKeypair.publicKey.toBase58());

              // Step 1a: Upload metadata to pump.fun IPFS
              setCreateStatus('Step 1/4: Uploading to IPFS...');
              const ethosText = cultureEthos.filter(e => e.trim()).join(' · ');
              const description = `${cultureName}${ethosText ? ' - ' + ethosText : ''}. A Culture Coin on LAUNCHR.`;
              const tokenMetadata = await uploadCultureTokenMetadata(
                cultureName,
                ticker,
                description,
                tokenIcon // Use the uploaded token icon file
              );

              // Step 1b: Get the SIGNING wallet address (must match what we'll use to sign)
              // Always use Phantom/Solflare address for the transaction, same as main site
              let signingWalletAddress = wallet.address;
              if (window.solana?.isPhantom) {
                if (!window.solana.isConnected) {
                  console.log('[CREATE CULTURE] Connecting Phantom for signing...');
                  await window.solana.connect();
                }
                signingWalletAddress = window.solana.publicKey.toBase58();
                console.log('[CREATE CULTURE] Using Phantom address:', signingWalletAddress);
              } else if (window.solflare?.isSolflare) {
                if (!window.solflare.isConnected) {
                  await window.solflare.connect();
                }
                signingWalletAddress = window.solflare.publicKey.toBase58();
                console.log('[CREATE CULTURE] Using Solflare address:', signingWalletAddress);
              } else {
                throw new Error('Please install Phantom or Solflare wallet to create tokens.');
              }

              // Step 1c: Create the token transaction with signing wallet address
              setCreateStatus('Step 2/4: Creating token transaction...');
              const { transaction, connection } = await createCultureTokenTransaction(
                signingWalletAddress, // Use the wallet that will sign
                mintKeypair,
                tokenMetadata,
                devBuyAmount // Initial dev buy in SOL
              );

              // Step 1d: Sign and send the transaction
              setCreateStatus('Step 3/4: ⚡ SIGN IN WALLET - Check Phantom!');
              txSignature = await signAndSendCultureToken(
                transaction,
                connection,
                mintKeypair
              );

              tokenAddress = mintKeypair.publicKey.toBase58();
              console.log('[CREATE CULTURE] Token created on-chain!');
              console.log('[CREATE CULTURE] Token address:', tokenAddress);
              console.log('[CREATE CULTURE] Transaction:', txSignature);

              // Verify we have a valid transaction signature before saving
              if (!txSignature || txSignature.length < 80) {
                throw new Error('Token creation failed - no valid transaction signature received');
              }

              // ═══════════════════════════════════════════════════════════════
              // STEP 2: Save culture data to backend with token address
              // ═══════════════════════════════════════════════════════════════

              setCreateStatus('Step 4/4: Saving culture page...');

              const cultureData = {
                name: cultureName,
                ticker: ticker,
                creatorName: creatorName,
                ethos: cultureEthos.filter(e => e.trim()),
                category: category || 'other',
                theme: theme,
                beliefs: beliefs.filter(b => b.trim()),
                unlocks: unlocks.filter(u => u.title.trim()),
                tiers: tiers.filter(t => t.name.trim()),
                devBuyAmount: devBuyAmount,
                // Token data from on-chain creation
                tokenAddress: tokenAddress,
                vanityAddress: mintAddress || tokenAddress,
                txSignature: txSignature,
                // SECURITY: Include wallet for verification
                wallet: wallet.address
              };

              console.log('[CREATE CULTURE] Sending to API with token:', tokenAddress);

              const response = await fetch('/api/culture/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(cultureData)
              });

              const result = await response.json();

              if (result.success) {
                console.log('[CREATE CULTURE] Success:', result.culture);
                console.log('[CREATE CULTURE] Integrity Hash:', response.headers.get('X-Culture-Hash'));

                // Store the new culture locally for immediate display
                const userCultures = JSON.parse(localStorage.getItem('user_cultures') || '[]');
                userCultures.push(result.culture);
                localStorage.setItem('user_cultures', JSON.stringify(userCultures));

                // Store the just-created culture to show immediately
                localStorage.setItem('just_created_culture', JSON.stringify(result.culture));

                setCreateStatus('🚀 Token LIVE on pump.fun!');

                // Show success with pump.fun link - CLEAR messaging
                alert(`🚀 SUCCESS! Your Culture Coin is LIVE!\n\n` +
                      `Token: ${cultureName} ($${ticker})\n` +
                      `Address: ${tokenAddress.slice(0,6)}...${tokenAddress.slice(-4)}\n\n` +
                      `✅ Token created on Solana\n` +
                      `✅ Listed on pump.fun\n` +
                      `✅ Culture page saved\n\n` +
                      `View on pump.fun:\npump.fun/coin/${tokenAddress}`);

                // Redirect to culture page
                window.location.href = `/culture-coins?show=${result.culture.id}`;
              } else {
                throw new Error(result.error || 'Failed to save culture');
              }

            } catch (error) {
              console.error('[CREATE ERROR]', error);
              setCreateStatus('');

              // Provide helpful error message
              if (error.message.includes('User rejected')) {
                alert('Transaction cancelled. You rejected the transaction in your wallet.');
              } else if (error.message.includes('insufficient')) {
                alert('Insufficient SOL balance. You need SOL to pay for the transaction fee.');
              } else if (tokenAddress && !txSignature) {
                alert('Token creation failed: ' + error.message);
              } else {
                alert('Failed to create culture: ' + error.message);
              }
            } finally {
              setIsCreating(false);
              setCreateStatus('');
            }
          };

          return (
            <div style={{
              minHeight: '100vh',
              ...getBackgroundStyle(),
              color: colors.text
            }}>
              <div style={{ padding: '136px 40px 80px', maxWidth: '900px', margin: '0 auto' }}>

              {/* Light/Dark Mode Toggle */}
              <div style={{
                position: 'fixed',
                top: '110px',
                right: '40px',
                zIndex: 100
              }}>
                <button
                  onClick={() => setLightMode(!lightMode)}
                  style={{
                    width: '48px',
                    height: '48px',
                    borderRadius: '50%',
                    background: lightMode ? '#1a1a1a' : '#ffffff',
                    border: 'none',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '20px',
                    boxShadow: '0 2px 10px rgba(0,0,0,0.2)',
                    transition: 'all 0.3s'
                  }}
                  title={lightMode ? 'Switch to Dark Mode' : 'Switch to Light Mode'}
                >
                  {lightMode ? '🌙' : '☀️'}
                </button>
              </div>

              {/* Getting Started Guide - Collapsible */}
              {(() => {
                const [guideOpen, setGuideOpen] = useState(true);
                return (
                  <div style={{
                    marginBottom: '40px',
                    background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)',
                    border: '1px solid #2a2a4a',
                    borderRadius: '8px',
                    overflow: 'hidden'
                  }}>
                    {/* Guide Header */}
                    <button
                      onClick={() => setGuideOpen(!guideOpen)}
                      style={{
                        width: '100%',
                        padding: '20px 24px',
                        background: 'transparent',
                        border: 'none',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        cursor: 'pointer'
                      }}
                    >
                      <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                        <span style={{
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '20px',
                          color: '#fff'
                        }}>
                          How to Create Your Culture
                        </span>
                        <span style={{
                          background: '#FFD966',
                          color: '#000',
                          padding: '4px 10px',
                          fontSize: '10px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontWeight: 600,
                          letterSpacing: '0.1em',
                          borderRadius: '4px'
                        }}>
                          START HERE
                        </span>
                      </div>
                      <span style={{
                        color: '#888',
                        fontSize: '20px',
                        transform: guideOpen ? 'rotate(180deg)' : 'rotate(0deg)',
                        transition: 'transform 0.2s'
                      }}>▼</span>
                    </button>

                    {/* Guide Content */}
                    {guideOpen && (
                      <div style={{ padding: '0 24px 24px' }}>
                        <div style={{
                          display: 'grid',
                          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                          gap: '20px',
                          marginBottom: '24px'
                        }}>
                          {/* Step 1 */}
                          <div style={{
                            background: 'rgba(0,0,0,0.3)',
                            padding: '20px',
                            borderRadius: '6px',
                            border: '1px solid #333'
                          }}>
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '10px',
                              marginBottom: '12px'
                            }}>
                              <span style={{
                                background: '#FFD966',
                                color: '#000',
                                width: '24px',
                                height: '24px',
                                borderRadius: '50%',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontSize: '12px',
                                fontWeight: 'bold'
                              }}>1</span>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '11px',
                                color: '#FFD966',
                                letterSpacing: '0.1em'
                              }}>CUSTOMIZE</span>
                            </div>
                            <p style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '12px',
                              color: '#aaa',
                              lineHeight: 1.6
                            }}>
                              Make your page your own! Choose colors, backgrounds, and patterns that represent your culture's vibe.
                            </p>
                          </div>

                          {/* Step 2 */}
                          <div style={{
                            background: 'rgba(0,0,0,0.3)',
                            padding: '20px',
                            borderRadius: '6px',
                            border: '1px solid #333'
                          }}>
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '10px',
                              marginBottom: '12px'
                            }}>
                              <span style={{
                                background: '#FFD966',
                                color: '#000',
                                width: '24px',
                                height: '24px',
                                borderRadius: '50%',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontSize: '12px',
                                fontWeight: 'bold'
                              }}>2</span>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '11px',
                                color: '#FFD966',
                                letterSpacing: '0.1em'
                              }}>DEFINE BELIEFS</span>
                            </div>
                            <p style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '12px',
                              color: '#aaa',
                              lineHeight: 1.6
                            }}>
                              What does your culture stand for? Add your core values and beliefs that members will rally around.
                            </p>
                          </div>

                          {/* Step 3 */}
                          <div style={{
                            background: 'rgba(0,0,0,0.3)',
                            padding: '20px',
                            borderRadius: '6px',
                            border: '1px solid #333'
                          }}>
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '10px',
                              marginBottom: '12px'
                            }}>
                              <span style={{
                                background: '#FFD966',
                                color: '#000',
                                width: '24px',
                                height: '24px',
                                borderRadius: '50%',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontSize: '12px',
                                fontWeight: 'bold'
                              }}>3</span>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '11px',
                                color: '#FFD966',
                                letterSpacing: '0.1em'
                              }}>SET TIERS</span>
                            </div>
                            <p style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '12px',
                              color: '#aaa',
                              lineHeight: 1.6
                            }}>
                              Create membership tiers based on token holdings. More tokens = higher tier with exclusive access.
                            </p>
                          </div>

                          {/* Step 4 */}
                          <div style={{
                            background: 'rgba(0,0,0,0.3)',
                            padding: '20px',
                            borderRadius: '6px',
                            border: '1px solid #333'
                          }}>
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '10px',
                              marginBottom: '12px'
                            }}>
                              <span style={{
                                background: '#FFD966',
                                color: '#000',
                                width: '24px',
                                height: '24px',
                                borderRadius: '50%',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontSize: '12px',
                                fontWeight: 'bold'
                              }}>4</span>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '11px',
                                color: '#FFD966',
                                letterSpacing: '0.1em'
                              }}>MINE ADDRESS</span>
                            </div>
                            <p style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '12px',
                              color: '#aaa',
                              lineHeight: 1.6
                            }}>
                              Get a custom token address ending in letters you choose (like "KING"). This takes time but looks amazing!
                            </p>
                          </div>
                        </div>

                        {/* Pro Tips */}
                        <div style={{
                          background: 'rgba(255,217,102,0.1)',
                          border: '1px solid rgba(255,217,102,0.3)',
                          borderRadius: '6px',
                          padding: '16px 20px'
                        }}>
                          <div style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            color: '#FFD966',
                            letterSpacing: '0.15em',
                            marginBottom: '8px'
                          }}>
                            PRO TIP
                          </div>
                          <p style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '12px',
                            color: '#ccc',
                            lineHeight: 1.6
                          }}>
                            Hover over any <span style={{ background: '#333', padding: '2px 6px', borderRadius: '3px' }}>?</span> icon to learn more about that section. Every feature has a tooltip explaining exactly what it does!
                          </p>
                        </div>
                      </div>
                    )}
                  </div>
                );
              })()}

              {/* Culture Identity Header */}
              <div style={{ marginBottom: '80px', textAlign: 'center' }}>
                {/* Culture Name - Large Editable */}
                <input
                  type="text"
                  value={cultureName}
                  onChange={(e) => setCultureName(e.target.value)}
                  placeholder="Your Culture Name"
                  style={{
                    width: '100%',
                    background: 'transparent',
                    border: 'none',
                    borderBottom: '1px solid rgba(255,255,255,0.2)',
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '72px',
                    fontWeight: '400',
                    color: theme.textColor,
                    textAlign: 'center',
                    marginBottom: '24px',
                    outline: 'none',
                    letterSpacing: '-0.02em'
                  }}
                />

                {/* Ethos Taglines */}
                <div style={{
                  display: 'flex',
                  justifyContent: 'center',
                  gap: '32px',
                  flexWrap: 'wrap',
                  marginBottom: '8px'
                }}>
                  {cultureEthos.map((ethos, idx) => (
                    <input
                      key={idx}
                      type="text"
                      value={ethos}
                      onChange={(e) => {
                        const newEthos = [...cultureEthos];
                        newEthos[idx] = e.target.value;
                        setCultureEthos(newEthos);
                      }}
                      placeholder={['CONVICTION', 'PATIENCE', 'SIGNAL'][idx] || `VALUE ${idx + 1}`}
                      style={{
                        background: 'transparent',
                        border: 'none',
                        borderBottom: '1px dashed rgba(255,255,255,0.2)',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '13px',
                        color: ethos ? theme.accentColor : '#666',
                        textAlign: 'center',
                        letterSpacing: '0.2em',
                        textTransform: 'uppercase',
                        outline: 'none',
                        width: '150px',
                        padding: '4px 0'
                      }}
                    />
                  ))}
                </div>
                <p style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '10px',
                  color: '#555',
                  textAlign: 'center',
                  marginBottom: '24px'
                }}>
                  Click to edit your culture's core values
                </p>

                {/* Creator Name */}
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '12px',
                  color: '#666',
                  letterSpacing: '0.1em'
                }}>
                  Created by{' '}
                  <input
                    type="text"
                    value={creatorName}
                    onChange={(e) => setCreatorName(e.target.value)}
                    placeholder="Your Name"
                    style={{
                      background: 'transparent',
                      border: 'none',
                      borderBottom: '1px solid rgba(255,255,255,0.2)',
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '12px',
                      color: theme.accentColor,
                      outline: 'none',
                      width: '120px',
                      letterSpacing: '0.1em'
                    }}
                  />
                </div>
              </div>

              {/* ═══════════════════════════════════════════════════════════════ */}
              {/* TOKEN DETAILS - Icon & Ticker (Required for pump.fun) */}
              {/* ═══════════════════════════════════════════════════════════════ */}
              <div style={{
                marginBottom: '60px',
                padding: '32px',
                background: 'linear-gradient(135deg, rgba(255,217,102,0.1) 0%, rgba(0,0,0,0.5) 100%)',
                border: '2px solid rgba(255,217,102,0.3)',
                backdropFilter: 'blur(10px)',
                borderRadius: '8px'
              }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '8px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: theme.textColor
                  }}>
                    Token Details
                  </span>
                  <span style={{
                    marginLeft: '12px',
                    background: '#FFD966',
                    color: '#000',
                    padding: '4px 10px',
                    fontSize: '10px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontWeight: 600,
                    letterSpacing: '0.1em',
                    borderRadius: '4px'
                  }}>
                    REQUIRED
                  </span>
                </div>
                <p style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '12px',
                  color: '#888',
                  marginBottom: '24px'
                }}>
                  Your culture will launch as a real token on pump.fun. Upload an icon and choose a ticker.
                </p>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '32px' }}>
                  {/* Token Icon Upload */}
                  <div>
                    <SectionHeader
                      title="TOKEN ICON"
                      tooltip="This image will be your token's icon on pump.fun and in wallets. Use a square image, at least 200x200px. PNG or JPG."
                    />
                    <div style={{
                      width: '120px',
                      height: '120px',
                      border: tokenIconPreview ? '2px solid #22c55e' : '2px dashed #444',
                      borderRadius: '50%',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      cursor: 'pointer',
                      overflow: 'hidden',
                      background: tokenIconPreview ? 'transparent' : 'rgba(0,0,0,0.3)',
                      position: 'relative'
                    }}
                    onClick={() => document.getElementById('tokenIconInput').click()}
                    >
                      {tokenIconPreview ? (
                        <img
                          src={tokenIconPreview}
                          alt="Token Icon"
                          style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                        />
                      ) : (
                        <div style={{ textAlign: 'center' }}>
                          <div style={{ fontSize: '32px', marginBottom: '4px' }}>📷</div>
                          <div style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            color: '#666'
                          }}>
                            UPLOAD ICON
                          </div>
                        </div>
                      )}
                      <input
                        type="file"
                        id="tokenIconInput"
                        accept="image/*"
                        style={{ display: 'none' }}
                        onChange={(e) => {
                          const file = e.target.files?.[0];
                          if (file) {
                            setTokenIcon(file);
                            const reader = new FileReader();
                            reader.onload = (ev) => setTokenIconPreview(ev.target.result);
                            reader.readAsDataURL(file);
                          }
                        }}
                      />
                    </div>
                    {tokenIconPreview && (
                      <button
                        onClick={() => { setTokenIcon(null); setTokenIconPreview(''); }}
                        style={{
                          marginTop: '8px',
                          padding: '6px 12px',
                          background: 'transparent',
                          border: '1px solid #444',
                          color: '#888',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '10px',
                          cursor: 'pointer'
                        }}
                      >
                        REMOVE
                      </button>
                    )}
                  </div>

                  {/* Token Ticker */}
                  <div>
                    <SectionHeader
                      title="TOKEN TICKER"
                      tooltip="The ticker symbol for your token (e.g., QUIET, IRON, FORM). Max 10 characters. If left blank, we'll generate one from your culture name."
                    />
                    <input
                      type="text"
                      value={tokenTicker}
                      onChange={(e) => setTokenTicker(e.target.value.replace(/[^a-zA-Z0-9]/g, '').slice(0, 8))}
                      placeholder={cultureName ? cultureName.replace(/[^a-zA-Z0-9]/g, '').slice(0, 8) || 'TICKER' : 'TICKER'}
                      style={{
                        width: '100%',
                        padding: '16px',
                        background: '#111',
                        border: '1px solid #333',
                        color: '#fff',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '24px',
                        fontWeight: 600,
                        letterSpacing: '0.2em',
                        textAlign: 'center',
                        outline: 'none'
                      }}
                    />
                    <p style={{
                      marginTop: '8px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '11px',
                      color: '#666'
                    }}>
                      Your token will be: ${tokenTicker || (cultureName ? cultureName.toUpperCase().replace(/[^A-Z]/g, '').slice(0, 6) : 'TICKER')}
                    </p>
                  </div>
                </div>

                {/* Category Selector */}
                <div style={{ marginTop: '24px' }}>
                  <SectionHeader
                    title="CATEGORY"
                    tooltip="Select the category that best describes your culture coin. This helps users discover your token."
                  />
                  <div style={{
                    display: 'flex',
                    flexWrap: 'wrap',
                    gap: '8px'
                  }}>
                    {CATEGORIES.map(cat => (
                      <button
                        key={cat.id}
                        onClick={() => setCategory(cat.id)}
                        style={{
                          padding: '10px 14px',
                          background: category === cat.id ? 'rgba(255,217,102,0.2)' : '#111',
                          border: category === cat.id ? '2px solid #FFD966' : '1px solid #333',
                          borderRadius: '20px',
                          color: category === cat.id ? '#FFD966' : '#888',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '12px',
                          cursor: 'pointer',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '6px',
                          transition: 'all 0.2s'
                        }}
                      >
                        <span>{cat.icon}</span>
                        <span>{cat.name}</span>
                      </button>
                    ))}
                  </div>
                </div>

                {/* Dev Buy Slider */}
                <div style={{ marginTop: '32px', paddingTop: '24px', borderTop: '1px solid rgba(255,255,255,0.1)' }}>
                  <SectionHeader
                    title="INITIAL DEV BUY"
                    tooltip="Buy tokens at launch to seed initial liquidity. This SOL will be used to purchase your own tokens when the coin is created. (0-5 SOL)"
                  />
                  <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                    <input
                      type="range"
                      min="0"
                      max="5"
                      step="0.1"
                      value={devBuyAmount}
                      onChange={(e) => setDevBuyAmount(parseFloat(e.target.value))}
                      style={{
                        flex: 1,
                        height: '6px',
                        WebkitAppearance: 'none',
                        appearance: 'none',
                        background: `linear-gradient(to right, #FFD966 0%, #FFD966 ${devBuyAmount * 20}%, #333 ${devBuyAmount * 20}%, #333 100%)`,
                        borderRadius: '3px',
                        outline: 'none',
                        cursor: 'pointer'
                      }}
                    />
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}>
                      <input
                        type="number"
                        min="0"
                        max="5"
                        step="0.1"
                        value={devBuyAmount}
                        onChange={(e) => {
                          let val = parseFloat(e.target.value) || 0;
                          if (val < 0) val = 0;
                          if (val > 5) val = 5;
                          setDevBuyAmount(val);
                        }}
                        style={{
                          width: '70px',
                          padding: '10px',
                          background: '#111',
                          border: '1px solid #333',
                          color: '#fff',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '14px',
                          textAlign: 'center',
                          outline: 'none'
                        }}
                      />
                      <span style={{
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '14px',
                        color: '#888'
                      }}>SOL</span>
                    </div>
                  </div>
                  <p style={{
                    marginTop: '8px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '11px',
                    color: '#666'
                  }}>
                    {devBuyAmount > 0
                      ? `You'll spend ${devBuyAmount} SOL to buy tokens at launch`
                      : 'Optional: Buy your own tokens at launch (0-5 SOL)'
                    }
                  </p>
                </div>
              </div>

              {/* Theme Customization Panel */}
              <div style={{
                marginBottom: '60px',
                padding: '32px',
                background: 'rgba(0,0,0,0.5)',
                border: `1px solid ${theme.borderColor}`,
                backdropFilter: 'blur(10px)'
              }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '24px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: theme.textColor
                  }}>
                    Customize Your Page
                  </span>
                  <InfoIcon tooltip="Make your culture page unique! Choose backgrounds, colors, and patterns. This is like your MySpace page - express yourself and attract members who vibe with your aesthetic." />
                </div>

                {/* Background Type */}
                <div style={{ marginBottom: '24px' }}>
                  <SectionHeader
                    title="BACKGROUND TYPE"
                    tooltip="Choose how your page looks: Solid (one color), Gradient (two colors blend), Pattern (repeating designs), or Image (upload your own)."
                  />
                  <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                    {['solid', 'gradient', 'pattern', 'image'].map(type => (
                      <button
                        key={type}
                        onClick={() => setTheme({...theme, bgType: type})}
                        style={{
                          padding: '10px 16px',
                          background: theme.bgType === type ? theme.accentColor : '#111',
                          color: theme.bgType === type ? '#000' : '#888',
                          border: '1px solid #333',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '11px',
                          letterSpacing: '0.1em',
                          cursor: 'pointer',
                          textTransform: 'uppercase'
                        }}
                      >
                        {type}
                      </button>
                    ))}
                  </div>
                </div>

                {/* Solid Color */}
                {theme.bgType === 'solid' && (
                  <div style={{ marginBottom: '24px' }}>
                    <SectionHeader title="BACKGROUND COLOR" tooltip="Click the color box to open a color picker, or type a hex code (like #FF5500) directly." />
                    <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>
                      <input
                        type="color"
                        value={theme.bgColor}
                        onChange={(e) => setTheme({...theme, bgColor: e.target.value})}
                        style={{ width: '50px', height: '40px', border: 'none', cursor: 'pointer' }}
                      />
                      <input
                        type="text"
                        value={theme.bgColor}
                        onChange={(e) => setTheme({...theme, bgColor: e.target.value})}
                        style={{
                          padding: '10px',
                          background: '#111',
                          border: '1px solid #333',
                          color: '#fff',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '12px',
                          width: '100px'
                        }}
                      />
                    </div>
                  </div>
                )}

                {/* Gradient */}
                {theme.bgType === 'gradient' && (
                  <div style={{ marginBottom: '24px' }}>
                    <SectionHeader title="GRADIENT COLORS" tooltip="Pick two colors that will smoothly blend together from top-left to bottom-right. Great for creating depth!" />
                    <div style={{ display: 'flex', gap: '16px', alignItems: 'center' }}>
                      <div>
                        <div style={{ fontSize: '9px', color: '#666', marginBottom: '4px' }}>FROM</div>
                        <input
                          type="color"
                          value={theme.bgGradient[0]}
                          onChange={(e) => setTheme({...theme, bgGradient: [e.target.value, theme.bgGradient[1]]})}
                          style={{ width: '50px', height: '40px', border: 'none', cursor: 'pointer' }}
                        />
                      </div>
                      <div>
                        <div style={{ fontSize: '9px', color: '#666', marginBottom: '4px' }}>TO</div>
                        <input
                          type="color"
                          value={theme.bgGradient[1]}
                          onChange={(e) => setTheme({...theme, bgGradient: [theme.bgGradient[0], e.target.value]})}
                          style={{ width: '50px', height: '40px', border: 'none', cursor: 'pointer' }}
                        />
                      </div>
                    </div>
                  </div>
                )}

                {/* Pattern */}
                {theme.bgType === 'pattern' && (
                  <div style={{ marginBottom: '24px' }}>
                    <SectionHeader title="PATTERN STYLE" tooltip="Choose a repeating pattern: Dots, Grid lines, Diagonal stripes, Hearts, or Stars. Pick a base color below." />
                    <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap', marginBottom: '16px' }}>
                      {Object.keys(patterns).map(p => (
                        <button
                          key={p}
                          onClick={() => setTheme({...theme, bgPattern: p})}
                          style={{
                            padding: '10px 16px',
                            background: theme.bgPattern === p ? '#333' : '#111',
                            color: theme.bgPattern === p ? '#fff' : '#666',
                            border: '1px solid #333',
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '11px',
                            cursor: 'pointer',
                            textTransform: 'capitalize'
                          }}
                        >
                          {p}
                        </button>
                      ))}
                    </div>
                    <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>
                      <span style={{ fontSize: '10px', color: '#666' }}>Base Color:</span>
                      <input
                        type="color"
                        value={theme.bgColor}
                        onChange={(e) => setTheme({...theme, bgColor: e.target.value})}
                        style={{ width: '40px', height: '30px', border: 'none', cursor: 'pointer' }}
                      />
                    </div>
                  </div>
                )}

                {/* Image Upload */}
                {theme.bgType === 'image' && (
                  <div style={{ marginBottom: '24px' }}>
                    <SectionHeader title="BACKGROUND IMAGE" tooltip="Upload an image from your computer. It will fill the entire background. Use high-resolution images for best results!" />
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                      <label
                        style={{
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          gap: '12px',
                          padding: '20px',
                          background: '#111',
                          border: '2px dashed #333',
                          cursor: 'pointer',
                          transition: 'all 0.2s ease'
                        }}
                        onMouseOver={(e) => e.currentTarget.style.borderColor = '#555'}
                        onMouseOut={(e) => e.currentTarget.style.borderColor = '#333'}
                      >
                        <input
                          type="file"
                          accept="image/*"
                          onChange={(e) => {
                            const file = e.target.files[0];
                            if (file) {
                              const reader = new FileReader();
                              reader.onload = (event) => {
                                setTheme({...theme, bgImage: event.target.result});
                              };
                              reader.readAsDataURL(file);
                            }
                          }}
                          style={{ display: 'none' }}
                        />
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#666" strokeWidth="2">
                          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                          <polyline points="17 8 12 3 7 8"/>
                          <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <span style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '12px',
                          color: '#888',
                          letterSpacing: '0.05em'
                        }}>
                          {theme.bgImage ? 'CHANGE IMAGE' : 'UPLOAD IMAGE'}
                        </span>
                      </label>
                      {theme.bgImage && (
                        <div style={{ position: 'relative' }}>
                          <img
                            src={theme.bgImage}
                            alt="Background preview"
                            style={{
                              width: '100%',
                              height: '120px',
                              objectFit: 'cover',
                              border: '1px solid #333'
                            }}
                          />
                          <button
                            onClick={() => setTheme({...theme, bgImage: ''})}
                            style={{
                              position: 'absolute',
                              top: '8px',
                              right: '8px',
                              background: 'rgba(0,0,0,0.7)',
                              border: '1px solid #333',
                              color: '#fff',
                              padding: '4px 8px',
                              fontSize: '10px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              cursor: 'pointer'
                            }}
                          >
                            REMOVE
                          </button>
                        </div>
                      )}
                      {/* Image Fit Options */}
                      {theme.bgImage && (
                        <div style={{ marginTop: '12px' }}>
                          <div style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            color: '#666',
                            marginBottom: '8px',
                            letterSpacing: '0.1em'
                          }}>
                            IMAGE FIT
                          </div>
                          <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                            {[
                              { id: 'cover', label: 'Cover', desc: 'Fill area, crop if needed' },
                              { id: 'contain', label: 'Fit', desc: 'Show full image' },
                              { id: 'tile', label: 'Tile', desc: 'Repeat pattern' },
                              { id: 'stretch', label: 'Stretch', desc: 'Stretch to fill' }
                            ].map(fit => (
                              <button
                                key={fit.id}
                                onClick={() => setTheme({...theme, bgImageFit: fit.id})}
                                title={fit.desc}
                                style={{
                                  padding: '8px 14px',
                                  background: theme.bgImageFit === fit.id ? '#FFD966' : '#111',
                                  color: theme.bgImageFit === fit.id ? '#000' : '#888',
                                  border: theme.bgImageFit === fit.id ? '1px solid #FFD966' : '1px solid #333',
                                  fontFamily: "'IBM Plex Mono', monospace",
                                  fontSize: '11px',
                                  letterSpacing: '0.05em',
                                  cursor: 'pointer',
                                  transition: 'all 0.2s'
                                }}
                              >
                                {fit.label}
                              </button>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {/* Accent & Text Colors */}
                <div style={{ marginBottom: '16px' }}>
                  <SectionHeader title="COLOR SCHEME" tooltip="Accent = buttons & highlights. Text = all text color. Cards = background of content boxes. Borders = lines between sections." />
                </div>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px' }}>
                  <div>
                    <div style={{ fontSize: '9px', letterSpacing: '0.1em', color: '#666', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                      ACCENT
                    </div>
                    <input
                      type="color"
                      value={theme.accentColor}
                      onChange={(e) => setTheme({...theme, accentColor: e.target.value})}
                      style={{ width: '100%', height: '40px', border: 'none', cursor: 'pointer' }}
                    />
                  </div>
                  <div>
                    <div style={{ fontSize: '9px', letterSpacing: '0.1em', color: '#666', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                      TEXT
                    </div>
                    <input
                      type="color"
                      value={theme.textColor}
                      onChange={(e) => setTheme({...theme, textColor: e.target.value})}
                      style={{ width: '100%', height: '40px', border: 'none', cursor: 'pointer' }}
                    />
                  </div>
                  <div>
                    <div style={{ fontSize: '9px', letterSpacing: '0.1em', color: '#666', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                      CARDS
                    </div>
                    <input
                      type="color"
                      value={theme.cardBg}
                      onChange={(e) => setTheme({...theme, cardBg: e.target.value})}
                      style={{ width: '100%', height: '40px', border: 'none', cursor: 'pointer' }}
                    />
                  </div>
                  <div>
                    <div style={{ fontSize: '9px', letterSpacing: '0.1em', color: '#666', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                      BORDERS
                    </div>
                    <input
                      type="color"
                      value={theme.borderColor}
                      onChange={(e) => setTheme({...theme, borderColor: e.target.value})}
                      style={{ width: '100%', height: '40px', border: 'none', cursor: 'pointer' }}
                    />
                  </div>
                </div>
              </div>

              {/* Vanity Address Mining Section */}
              <div style={{
                marginBottom: '60px',
                padding: '32px',
                background: 'rgba(0,0,0,0.5)',
                border: `1px solid ${theme.borderColor}`,
                backdropFilter: 'blur(10px)'
              }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '12px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: theme.textColor
                  }}>
                    Culture Address
                  </span>
                  <InfoIcon tooltip="Every token on Solana has a unique address (like 7xKXt...KING). We can mine a custom address that ends in letters you choose! This is purely cosmetic but looks super professional. Longer suffixes take exponentially longer to find." />
                </div>
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#666',
                  marginBottom: '24px'
                }}>
                  Mine a custom vanity address for your culture token (e.g., ending in "KING")
                </div>

                {/* Suffix Input */}
                <div style={{ marginBottom: '24px' }}>
                  <SectionHeader
                    title="VANITY SUFFIX (what your address ends with)"
                    tooltip="Type 1-6 letters (A-Z) or numbers (1-9). Note: Solana addresses don't use 0, O, I, or L. Longer = harder to find. 3 chars = seconds, 4 chars = minutes, 5+ chars = hours or more!"
                  />
                  <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
                    <input
                      type="text"
                      value={vanitySuffix}
                      onChange={(e) => setVanitySuffix(e.target.value.replace(/[^a-zA-Z1-9]/g, '').slice(0, 6))}
                      placeholder="moon"
                      disabled={vanityMining}
                      maxLength={6}
                      style={{
                        flex: 1,
                        padding: '16px',
                        background: '#111',
                        border: '1px solid #333',
                        color: '#fff',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '18px',
                        letterSpacing: '0.2em',
                        textAlign: 'center'
                      }}
                    />
                    {!vanityMining && !vanityResult && (
                      <button
                        onClick={startVanityMining}
                        disabled={!vanitySuffix}
                        style={{
                          padding: '16px 32px',
                          background: vanitySuffix ? theme.accentColor : '#333',
                          color: vanitySuffix ? '#000' : '#666',
                          border: 'none',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '12px',
                          letterSpacing: '0.1em',
                          cursor: vanitySuffix ? 'pointer' : 'not-allowed'
                        }}
                      >
                        START MINING
                      </button>
                    )}
                    {vanityMining && (
                      <button
                        onClick={stopVanityMining}
                        style={{
                          padding: '16px 32px',
                          background: '#ef4444',
                          color: '#fff',
                          border: 'none',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '12px',
                          letterSpacing: '0.1em',
                          cursor: 'pointer'
                        }}
                      >
                        STOP
                      </button>
                    )}
                  </div>
                </div>

                {/* Difficulty Estimate */}
                {vanitySuffix && !vanityMining && !vanityResult && (
                  <div style={{
                    padding: '16px',
                    background: '#0a0a0a',
                    border: '1px solid #222',
                    marginBottom: '24px'
                  }}>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '16px', textAlign: 'center' }}>
                      <div>
                        <div style={{ fontSize: '18px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {estimateVanityDifficulty(vanitySuffix).probability}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>PROBABILITY</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '18px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {estimateVanityDifficulty(vanitySuffix).time}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>EST. TIME</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '18px', color: vanitySuffix.length <= 3 ? '#22c55e' : vanitySuffix.length <= 5 ? '#f59e0b' : '#ef4444', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanitySuffix.length <= 3 ? 'EASY' : vanitySuffix.length <= 5 ? 'MEDIUM' : 'HARD'}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>DIFFICULTY</div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Mining Progress */}
                {vanityMining && (
                  <div style={{
                    padding: '24px',
                    background: 'linear-gradient(135deg, #1a1a2e, #0a0a0a)',
                    border: '1px solid #333',
                    marginBottom: '24px'
                  }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '16px',
                      marginBottom: '20px'
                    }}>
                      <div style={{
                        width: '12px',
                        height: '12px',
                        borderRadius: '50%',
                        background: '#22c55e',
                        animation: 'pulse 1s infinite'
                      }} />
                      <div style={{
                        fontFamily: "'Playfair Display', serif",
                        fontSize: '20px',
                        color: '#fff'
                      }}>
                        Mining Address ending in "{vanitySuffix}"...
                      </div>
                    </div>

                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px', textAlign: 'center' }}>
                      <div>
                        <div style={{ fontSize: '24px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityProgress.attempts.toLocaleString()}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>ATTEMPTS</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '24px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityProgress.rate.toLocaleString()}/s
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>SPEED</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '24px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityProgress.elapsed}s
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>ELAPSED</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '24px', color: '#f59e0b', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityProgress.estimatedTime}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>EST. TIME</div>
                      </div>
                    </div>

                    {/* Mining Animation Bar */}
                    <div style={{ marginTop: '20px', height: '4px', background: '#222', overflow: 'hidden' }}>
                      <div style={{
                        height: '100%',
                        width: '30%',
                        background: 'linear-gradient(90deg, transparent, #fff, transparent)',
                        animation: 'shimmer 1.5s infinite'
                      }} />
                    </div>
                  </div>
                )}

                {/* Found Result */}
                {vanityResult && (
                  <div style={{
                    padding: '24px',
                    background: 'linear-gradient(135deg, rgba(34,197,94,0.2), rgba(0,0,0,0.5))',
                    border: '1px solid #22c55e'
                  }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '12px',
                      marginBottom: '20px'
                    }}>
                      <div style={{ fontSize: '24px' }}>✓</div>
                      <div style={{
                        fontFamily: "'Playfair Display', serif",
                        fontSize: '20px',
                        color: '#22c55e'
                      }}>
                        Address Found!
                      </div>
                    </div>

                    <div style={{
                      padding: '16px',
                      background: '#0a0a0a',
                      border: '1px solid #222',
                      marginBottom: '16px'
                    }}>
                      <div style={{ fontSize: '10px', color: '#666', letterSpacing: '0.1em', marginBottom: '8px' }}>YOUR CULTURE ADDRESS</div>
                      <div style={{
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '14px',
                        color: '#fff',
                        wordBreak: 'break-all'
                      }}>
                        {vanityResult.address.slice(0, -vanitySuffix.length)}
                        <span style={{ color: '#22c55e', fontWeight: 'bold' }}>{vanityResult.address.slice(-vanitySuffix.length)}</span>
                      </div>
                    </div>

                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '16px', textAlign: 'center' }}>
                      <div>
                        <div style={{ fontSize: '16px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityResult.attempts.toLocaleString()}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>TOTAL ATTEMPTS</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '16px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityResult.elapsed.toFixed(1)}s
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>TIME TAKEN</div>
                      </div>
                    </div>

                    <button
                      onClick={() => { setVanityResult(null); setVanitySuffix(''); }}
                      style={{
                        marginTop: '16px',
                        padding: '12px 24px',
                        background: 'transparent',
                        border: '1px solid #333',
                        color: '#888',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '11px',
                        cursor: 'pointer'
                      }}
                    >
                      MINE ANOTHER
                    </button>
                  </div>
                )}

                <style>{`
                  @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.5; }
                  }
                  @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(400%); }
                  }
                `}</style>
              </div>

              {/* Section: What This Culture Believes - Editable */}
              <div style={{ marginBottom: '80px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '12px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: '#fff'
                  }}>
                    What We Stand For
                  </span>
                  <InfoIcon tooltip="Your culture's core beliefs! These are the values that unite your community. Members will see these before joining - make them clear and inspiring. Good beliefs attract the right people." />
                </div>
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#666',
                  marginBottom: '32px'
                }}>
                  Define the core beliefs of your culture. <span style={{ color: '#888' }}>(Click any belief to edit, use × to remove)</span>
                </div>

                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                  {beliefs.map((belief, i) => (
                    <div
                      key={i}
                      style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '12px'
                      }}
                    >
                      <span style={{ color: '#444', fontSize: '8px' }}>&#9679;</span>
                      <input
                        type="text"
                        value={belief}
                        onChange={(e) => updateBelief(i, e.target.value)}
                        placeholder="Enter a core belief..."
                        style={{
                          flex: 1,
                          padding: '16px 20px',
                          background: '#0f0f0f',
                          border: '1px solid #1a1a1a',
                          color: '#e0e0e0',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '14px',
                          outline: 'none'
                        }}
                      />
                      {beliefs.length > 1 && (
                        <button
                          onClick={() => removeBelief(i)}
                          style={{
                            padding: '8px 12px',
                            background: 'transparent',
                            border: '1px solid #333',
                            color: '#666',
                            fontSize: '16px',
                            cursor: 'pointer'
                          }}
                        >
                          &times;
                        </button>
                      )}
                    </div>
                  ))}
                </div>

                {beliefs.length < 8 && (
                  <button
                    onClick={addBelief}
                    style={{
                      marginTop: '12px',
                      padding: '12px 20px',
                      background: 'transparent',
                      border: '1px dashed #333',
                      color: '#666',
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '12px',
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      width: '100%'
                    }}
                  >
                    + ADD BELIEF
                  </button>
                )}
              </div>

              {/* Section: What Holding Unlocks - Editable */}
              <div style={{ marginBottom: '80px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '12px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: '#fff'
                  }}>
                    What Participation Unlocks
                  </span>
                  <InfoIcon tooltip="What do members get for holding your token? Think: exclusive content, private chats, early access, IRL events, 1-on-1 time, etc. These are the perks that make holding worthwhile!" />
                </div>
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#666',
                  marginBottom: '32px'
                }}>
                  Define what members get access to. <span style={{ color: '#888' }}>(Add a title and description for each perk)</span>
                </div>

                <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                  {unlocks.map((unlock, i) => (
                    <div
                      key={i}
                      style={{
                        padding: '24px',
                        background: '#0a0a0a',
                        border: '1px solid #1a1a1a'
                      }}
                    >
                      <div style={{ display: 'flex', gap: '12px', marginBottom: '12px', alignItems: 'center' }}>
                        <input
                          type="text"
                          value={unlock.title}
                          onChange={(e) => updateUnlock(i, 'title', e.target.value)}
                          placeholder="Unlock Title"
                          style={{
                            flex: 1,
                            padding: '12px 16px',
                            background: '#111',
                            border: '1px solid #222',
                            color: '#fff',
                            fontFamily: "'Playfair Display', serif",
                            fontSize: '18px',
                            outline: 'none'
                          }}
                        />
                        {unlocks.length > 1 && (
                          <button
                            onClick={() => removeUnlock(i)}
                            style={{
                              padding: '8px 12px',
                              background: 'transparent',
                              border: '1px solid #333',
                              color: '#666',
                              fontSize: '16px',
                              cursor: 'pointer'
                            }}
                          >
                            &times;
                          </button>
                        )}
                      </div>
                      <input
                        type="text"
                        value={unlock.description}
                        onChange={(e) => updateUnlock(i, 'description', e.target.value)}
                        placeholder="Describe what this unlocks..."
                        style={{
                          width: '100%',
                          padding: '12px 16px',
                          background: '#111',
                          border: '1px solid #222',
                          color: '#888',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '13px',
                          outline: 'none'
                        }}
                      />
                    </div>
                  ))}
                </div>

                {unlocks.length < 8 && (
                  <button
                    onClick={addUnlock}
                    style={{
                      marginTop: '16px',
                      padding: '14px 24px',
                      background: 'transparent',
                      border: '1px dashed #333',
                      color: '#666',
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '12px',
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      width: '100%'
                    }}
                  >
                    + ADD UNLOCK
                  </button>
                )}
              </div>

              {/* Section: Define Tiers Based on Holdings */}
              <div style={{ marginBottom: '60px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '12px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: '#fff'
                  }}>
                    Define Tiers
                  </span>
                  <InfoIcon tooltip="Tiers are membership levels based on how much of your token someone holds. Example: 'Observer' might need 0.1% of supply, while 'Steward' needs 5%. Higher tiers get more exclusive access and content!" />
                </div>
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#666',
                  marginBottom: '32px'
                }}>
                  Set holding requirements for each access level. <span style={{ color: '#888' }}>(Enter a name, holding %, and what they can access)</span>
                </div>

                <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                  {tiers.map((tier, i) => (
                    <div
                      key={i}
                      style={{
                        padding: '24px',
                        background: '#0a0a0a',
                        border: '1px solid #1a1a1a'
                      }}
                    >
                      <div style={{ display: 'flex', gap: '16px', marginBottom: '16px', alignItems: 'center' }}>
                        {/* Tier Name */}
                        <input
                          type="text"
                          value={tier.name}
                          onChange={(e) => updateTier(i, 'name', e.target.value)}
                          placeholder="Tier Name"
                          style={{
                            flex: 1,
                            padding: '12px 16px',
                            background: '#111',
                            border: '1px solid #222',
                            color: '#fff',
                            fontFamily: "'Playfair Display', serif",
                            fontSize: '18px',
                            outline: 'none'
                          }}
                        />

                        {/* Holding Percent */}
                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                          <input
                            type="number"
                            value={tier.holdingPercent}
                            onChange={(e) => updateTier(i, 'holdingPercent', parseFloat(e.target.value) || 0)}
                            step="0.1"
                            min="0"
                            max="100"
                            style={{
                              width: '80px',
                              padding: '12px',
                              background: '#111',
                              border: '1px solid #222',
                              color: '#fff',
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '14px',
                              textAlign: 'center',
                              outline: 'none'
                            }}
                          />
                          <span style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '12px',
                            color: '#666'
                          }}>
                            % of supply
                          </span>
                        </div>

                        {/* Remove Button */}
                        {tiers.length > 2 && (
                          <button
                            onClick={() => removeTier(i)}
                            style={{
                              padding: '8px 12px',
                              background: 'transparent',
                              border: '1px solid #333',
                              color: '#666',
                              fontSize: '16px',
                              cursor: 'pointer'
                            }}
                          >
                            &times;
                          </button>
                        )}
                      </div>

                      {/* Access Description */}
                      <input
                        type="text"
                        value={tier.access}
                        onChange={(e) => updateTier(i, 'access', e.target.value)}
                        placeholder="What does this tier unlock? (e.g., Read-only access, Join discussions)"
                        style={{
                          width: '100%',
                          padding: '12px 16px',
                          background: '#111',
                          border: '1px solid #222',
                          color: '#888',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '13px',
                          outline: 'none'
                        }}
                      />
                    </div>
                  ))}
                </div>

                {/* Add Tier Button */}
                {tiers.length < 6 && (
                  <button
                    onClick={addTier}
                    style={{
                      marginTop: '16px',
                      padding: '14px 24px',
                      background: 'transparent',
                      border: '1px dashed #333',
                      color: '#666',
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '12px',
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      width: '100%'
                    }}
                  >
                    + ADD TIER
                  </button>
                )}

                {/* Preview Summary */}
                <div style={{
                  marginTop: '32px',
                  padding: '20px 24px',
                  background: '#0f0f0f',
                  border: '1px solid #1a1a1a'
                }}>
                  <div style={{
                    fontSize: '10px',
                    letterSpacing: '0.15em',
                    color: '#666',
                    marginBottom: '16px',
                    fontFamily: "'IBM Plex Mono', monospace"
                  }}>
                    TIER PREVIEW
                  </div>
                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: '12px' }}>
                    {tiers.filter(t => t.name).map((tier, i) => (
                      <div
                        key={i}
                        style={{
                          padding: '8px 16px',
                          background: '#1a1a1a',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '11px',
                          color: '#fff'
                        }}
                      >
                        {tier.name} <span style={{ color: '#666' }}>@ {tier.holdingPercent}%</span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Section: Tier Content Panel */}
              <div style={{ marginBottom: '60px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '12px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: '#fff'
                  }}>
                    Tier Content
                  </span>
                  <InfoIcon tooltip="This is where you drop exclusive content for each tier! Click a tier on the left, then add Essays, Live Sessions, or Drops. Higher tiers can see everything from lower tiers too - it's like a VIP access system!" />
                </div>
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#666',
                  marginBottom: '32px'
                }}>
                  Drop content for each tier. <span style={{ color: '#888' }}>(Select a tier on the left → add content on the right)</span>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: '200px 1fr', gap: '24px' }}>
                  {/* Left Panel - Tier Selection */}
                  <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '8px'
                  }}>
                    {tiers.filter(t => t.name).map((tier, i) => (
                      <button
                        key={i}
                        onClick={() => setSelectedTierIndex(i)}
                        style={{
                          padding: '16px 20px',
                          background: selectedTierIndex === i ? '#1a1a1a' : '#0a0a0a',
                          border: '1px solid',
                          borderColor: selectedTierIndex === i ? '#444' : '#1a1a1a',
                          color: selectedTierIndex === i ? '#fff' : '#888',
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '16px',
                          textAlign: 'left',
                          cursor: 'pointer',
                          position: 'relative'
                        }}
                      >
                        {tier.name}
                        <div style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '10px',
                          color: '#666',
                          marginTop: '4px'
                        }}>
                          {tier.holdingPercent}% • {tier.content?.length || 0} items
                        </div>
                        {selectedTierIndex === i && (
                          <div style={{
                            position: 'absolute',
                            left: 0,
                            top: '50%',
                            transform: 'translateY(-50%)',
                            width: '3px',
                            height: '24px',
                            background: '#fff'
                          }} />
                        )}
                      </button>
                    ))}
                  </div>

                  {/* Right Panel - Content for Selected Tier */}
                  <div style={{
                    background: '#0a0a0a',
                    border: '1px solid #1a1a1a',
                    padding: '24px',
                    minHeight: '300px'
                  }}>
                    <div style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      marginBottom: '24px'
                    }}>
                      <div>
                        <div style={{
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '20px',
                          color: '#fff',
                          marginBottom: '4px'
                        }}>
                          {tiers[selectedTierIndex]?.name || 'Select Tier'} Content
                        </div>
                        <div style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '11px',
                          color: '#666'
                        }}>
                          Content visible to {tiers[selectedTierIndex]?.name} tier and above
                        </div>
                      </div>
                      <div style={{ display: 'flex', gap: '8px' }}>
                        <button
                          onClick={() => addTierContent(selectedTierIndex, 'essay')}
                          style={{
                            padding: '8px 12px',
                            background: '#111',
                            border: '1px solid #333',
                            color: '#888',
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            cursor: 'pointer'
                          }}
                        >
                          + ESSAY
                        </button>
                        <button
                          onClick={() => addTierContent(selectedTierIndex, 'session')}
                          style={{
                            padding: '8px 12px',
                            background: '#111',
                            border: '1px solid #333',
                            color: '#888',
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            cursor: 'pointer'
                          }}
                        >
                          + SESSION
                        </button>
                        <button
                          onClick={() => addTierContent(selectedTierIndex, 'drop')}
                          style={{
                            padding: '8px 12px',
                            background: '#111',
                            border: '1px solid #333',
                            color: '#888',
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            cursor: 'pointer'
                          }}
                        >
                          + DROP
                        </button>
                      </div>
                    </div>

                    {/* Content Items */}
                    {tiers[selectedTierIndex]?.content?.length === 0 ? (
                      <div style={{
                        padding: '60px 20px',
                        textAlign: 'center',
                        border: '1px dashed #222'
                      }}>
                        <div style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '13px',
                          color: '#444',
                          marginBottom: '8px'
                        }}>
                          No content yet
                        </div>
                        <div style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '11px',
                          color: '#333'
                        }}>
                          Add essays, sessions, or drops for this tier
                        </div>
                      </div>
                    ) : (
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                        {tiers[selectedTierIndex]?.content?.map((item, ci) => (
                          <div
                            key={ci}
                            style={{
                              padding: '16px',
                              background: '#111',
                              border: '1px solid #222'
                            }}
                          >
                            <div style={{ display: 'flex', gap: '12px', marginBottom: '12px', alignItems: 'center' }}>
                              <span style={{
                                padding: '4px 8px',
                                background: item.type === 'essay' ? '#1a365d' : item.type === 'session' ? '#322659' : '#1a1a1a',
                                color: item.type === 'essay' ? '#63b3ed' : item.type === 'session' ? '#b794f4' : '#888',
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '9px',
                                letterSpacing: '0.1em',
                                textTransform: 'uppercase'
                              }}>
                                {item.type}
                              </span>
                              <input
                                type="text"
                                value={item.title}
                                onChange={(e) => updateTierContent(selectedTierIndex, ci, 'title', e.target.value)}
                                placeholder="Content title"
                                style={{
                                  flex: 1,
                                  padding: '8px 12px',
                                  background: 'transparent',
                                  border: '1px solid #222',
                                  color: '#fff',
                                  fontFamily: "'IBM Plex Mono', monospace",
                                  fontSize: '13px',
                                  outline: 'none'
                                }}
                              />
                              <button
                                onClick={() => removeTierContent(selectedTierIndex, ci)}
                                style={{
                                  padding: '4px 8px',
                                  background: 'transparent',
                                  border: '1px solid #333',
                                  color: '#666',
                                  fontSize: '14px',
                                  cursor: 'pointer'
                                }}
                              >
                                &times;
                              </button>
                            </div>
                            <input
                              type="text"
                              value={item.description}
                              onChange={(e) => updateTierContent(selectedTierIndex, ci, 'description', e.target.value)}
                              placeholder="Brief description..."
                              style={{
                                width: '100%',
                                padding: '8px 12px',
                                background: 'transparent',
                                border: '1px solid #222',
                                color: '#666',
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '12px',
                                outline: 'none'
                              }}
                            />
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </div>

              {/* CREATE CULTURE BUTTON */}
              <div style={{
                marginTop: '60px',
                marginBottom: '80px',
                textAlign: 'center'
              }}>
                {/* Wallet Connection Status */}
                {!wallet?.address && (
                  <div style={{
                    marginBottom: '24px',
                    padding: '16px 24px',
                    background: 'rgba(239,68,68,0.1)',
                    border: '1px solid rgba(239,68,68,0.3)',
                    display: 'inline-block'
                  }}>
                    <p style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '12px',
                      color: '#ef4444',
                      margin: 0
                    }}>
                      WALLET REQUIRED - Connect with Privy to create your culture
                    </p>
                  </div>
                )}

                {wallet?.address && (
                  <div style={{
                    marginBottom: '24px',
                    padding: '12px 20px',
                    background: 'rgba(34,197,94,0.1)',
                    border: '1px solid rgba(34,197,94,0.3)',
                    display: 'inline-block'
                  }}>
                    <p style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '11px',
                      color: '#22c55e',
                      margin: 0
                    }}>
                      VERIFIED: {wallet.address.slice(0,6)}...{wallet.address.slice(-4)}
                    </p>
                  </div>
                )}

                <div>
                  <button
                    onClick={wallet?.address ? handleCreate : () => wallet?.showModal?.()}
                    disabled={isCreating}
                    style={{
                      padding: '20px 60px',
                      background: isCreating ? '#333' : wallet?.address ? theme.accentColor : '#666',
                      color: isCreating ? '#666' : wallet?.address ? '#000' : '#999',
                      border: 'none',
                      fontFamily: "'Playfair Display', serif",
                      fontSize: '18px',
                      fontWeight: '500',
                      letterSpacing: '0.05em',
                      cursor: isCreating ? 'not-allowed' : 'pointer',
                      transition: 'all 0.2s ease'
                    }}
                  >
                    {isCreating ? (createStatus || 'CREATING...') : wallet?.address ? 'CREATE CULTURE' : 'CONNECT WALLET TO CREATE'}
                  </button>
                </div>
                {/* Creation status display */}
                {isCreating && createStatus && (
                  <div style={{
                    marginTop: '16px',
                    padding: '12px 20px',
                    background: 'rgba(255,217,102,0.1)',
                    border: '1px solid rgba(255,217,102,0.3)',
                    borderRadius: '6px'
                  }}>
                    <p style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '13px',
                      color: '#FFD966',
                      textAlign: 'center',
                      animation: 'pulse 1.5s infinite'
                    }}>
                      {createStatus}
                    </p>
                  </div>
                )}
                <p style={{
                  marginTop: '16px',
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '12px',
                  color: '#666'
                }}>
                  {wallet?.address ? 'Your culture will be live on Solana with a real token on pump.fun' : 'Privy wallet connection required for security'}
                </p>
              </div>
              </div>
            </div>
          );
        };

        // Wallet Select Modal Component
        const WalletSelectModal = ({ onClose, onConnect }) => {
          const hasPhantom = typeof window !== 'undefined' && window.solana?.isPhantom;
          const hasSolflare = typeof window !== 'undefined' && window.solflare?.isSolflare;

          const connectPhantom = async () => {
            try {
              const res = await window.solana.connect();
              onConnect(res.publicKey.toString(), 'phantom');
              onClose();
            } catch (e) { console.error('[PHANTOM]', e); }
          };

          const connectSolflare = async () => {
            try {
              await window.solflare.connect();
              onConnect(window.solflare.publicKey.toString(), 'solflare');
              onClose();
            } catch (e) { console.error('[SOLFLARE]', e); }
          };

          const connectPrivy = () => {
            const w = 420, h = 650;
            const left = (screen.width - w) / 2;
            const top = (screen.height - h) / 2;
            window.open('/auth', 'privy-auth', `width=${w},height=${h},left=${left},top=${top},resizable=yes,scrollbars=yes`);
            onClose();
          };

          return (
            <div
              onClick={(e) => e.target === e.currentTarget && onClose()}
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0,0,0,0.85)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                zIndex: 2000
              }}
            >
              <div style={{
                background: '#111',
                border: '1px solid #222',
                maxWidth: '400px',
                width: '90%'
              }}>
                <div style={{
                  padding: '20px 24px',
                  borderBottom: '1px solid #222',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }}>
                  <span style={{ fontFamily: "'Playfair Display', serif", fontSize: '18px', color: '#fff' }}>
                    Connect Wallet
                  </span>
                  <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#666', fontSize: '24px', cursor: 'pointer' }}>
                    &times;
                  </button>
                </div>
                <div style={{ padding: '24px', display: 'flex', flexDirection: 'column', gap: '12px' }}>
                  <p style={{ color: '#666', fontSize: '13px', fontFamily: "'IBM Plex Mono', monospace", marginBottom: '8px', textAlign: 'center' }}>
                    Choose your wallet to connect
                  </p>
                  <button
                    onClick={connectPrivy}
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '14px',
                      padding: '16px 20px',
                      background: 'rgba(139,92,246,0.15)',
                      border: '1px solid rgba(139,92,246,0.3)',
                      color: '#fff',
                      fontSize: '14px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      cursor: 'pointer',
                      width: '100%'
                    }}
                  >
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                      <rect width="24" height="24" rx="6" fill="#8B5CF6"/>
                      <path d="M12 6L18 10V14L12 18L6 14V10L12 6Z" fill="white"/>
                    </svg>
                    <span style={{ flex: 1, textAlign: 'left' }}>Privy</span>
                    <span style={{ fontSize: '10px', color: '#22c55e', background: 'rgba(34,197,94,0.15)', padding: '4px 8px' }}>
                      EMBEDDED
                    </span>
                  </button>
                  <button
                    onClick={hasPhantom ? connectPhantom : null}
                    disabled={!hasPhantom}
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '14px',
                      padding: '16px 20px',
                      background: '#0a0a0a',
                      border: '1px solid #222',
                      color: hasPhantom ? '#fff' : '#444',
                      fontSize: '14px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      cursor: hasPhantom ? 'pointer' : 'not-allowed',
                      width: '100%',
                      opacity: hasPhantom ? 1 : 0.5
                    }}
                  >
                    <img src="/website/phantom_icon.png" alt="Phantom" style={{ width: '28px', height: '28px', borderRadius: '6px' }} />
                    <span style={{ flex: 1, textAlign: 'left' }}>Phantom</span>
                    <span style={{ fontSize: '10px', color: hasPhantom ? '#22c55e' : '#666' }}>
                      {hasPhantom ? 'DETECTED' : 'NOT INSTALLED'}
                    </span>
                  </button>
                  <button
                    onClick={hasSolflare ? connectSolflare : null}
                    disabled={!hasSolflare}
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '14px',
                      padding: '16px 20px',
                      background: '#0a0a0a',
                      border: '1px solid #222',
                      color: hasSolflare ? '#fff' : '#444',
                      fontSize: '14px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      cursor: hasSolflare ? 'pointer' : 'not-allowed',
                      width: '100%',
                      opacity: hasSolflare ? 1 : 0.5
                    }}
                  >
                    <img src="https://solflare.com/favicon.ico" alt="Solflare" style={{ width: '28px', height: '28px', borderRadius: '6px' }} />
                    <span style={{ flex: 1, textAlign: 'left' }}>Solflare</span>
                    <span style={{ fontSize: '10px', color: hasSolflare ? '#22c55e' : '#666' }}>
                      {hasSolflare ? 'DETECTED' : 'NOT INSTALLED'}
                    </span>
                  </button>
                </div>
              </div>
            </div>
          );
        };

        // Wallet Info Modal
        const WalletInfoModal = ({ address, balance, holdings, onClose, onDisconnect }) => (
          <div
            onClick={(e) => e.target === e.currentTarget && onClose()}
            style={{
              position: 'fixed',
              inset: 0,
              background: 'rgba(0,0,0,0.85)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 2000
            }}
          >
            <div style={{
              background: '#111',
              border: '1px solid #222',
              maxWidth: '400px',
              width: '90%'
            }}>
              <div style={{
                padding: '20px 24px',
                borderBottom: '1px solid #222',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }}>
                <span style={{ fontFamily: "'Playfair Display', serif", fontSize: '18px', color: '#fff' }}>
                  Wallet
                </span>
                <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#666', fontSize: '24px', cursor: 'pointer' }}>
                  &times;
                </button>
              </div>
              <div style={{ padding: '24px' }}>
                <div style={{ marginBottom: '24px' }}>
                  <div style={{ fontSize: '11px', color: '#666', fontFamily: "'IBM Plex Mono', monospace", letterSpacing: '0.1em', marginBottom: '8px' }}>
                    ADDRESS
                  </div>
                  <div style={{ fontSize: '14px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace", wordBreak: 'break-all' }}>
                    {address}
                  </div>
                </div>
                <div style={{ marginBottom: '24px' }}>
                  <div style={{ fontSize: '11px', color: '#666', fontFamily: "'IBM Plex Mono', monospace", letterSpacing: '0.1em', marginBottom: '8px' }}>
                    BALANCE
                  </div>
                  <div style={{ fontSize: '24px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                    {balance.toFixed(4)} SOL
                  </div>
                </div>
                <div style={{ marginBottom: '24px' }}>
                  <div style={{ fontSize: '11px', color: '#666', fontFamily: "'IBM Plex Mono', monospace", letterSpacing: '0.1em', marginBottom: '8px' }}>
                    CULTURES JOINED
                  </div>
                  <div style={{ fontSize: '24px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                    {holdings.length}
                  </div>
                </div>
                <button
                  onClick={onDisconnect}
                  style={{
                    width: '100%',
                    padding: '14px',
                    background: 'transparent',
                    border: '1px solid #ef4444',
                    color: '#ef4444',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    letterSpacing: '0.1em',
                    cursor: 'pointer'
                  }}
                >
                  DISCONNECT
                </button>
              </div>
            </div>
          </div>
        );

        // Notification Component
        const Notification = ({ message, type, onClose }) => {
          useEffect(() => {
            const timer = setTimeout(onClose, 3000);
            return () => clearTimeout(timer);
          }, []);

          return (
            <div style={{
              position: 'fixed',
              bottom: '24px',
              right: '24px',
              padding: '16px 24px',
              background: type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#fff',
              color: '#000',
              fontFamily: "'IBM Plex Mono', monospace",
              fontSize: '13px',
              zIndex: 3000,
              display: 'flex',
              alignItems: 'center',
              gap: '12px'
            }}>
              {message}
              <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#000', cursor: 'pointer', fontSize: '16px' }}>
                &times;
              </button>
            </div>
          );
        };

        // Main App
        function CultureCoinsApp() {
          const [view, setView] = useState('discover');
          const [selectedCulture, setSelectedCulture] = useState(null);

          // Wallet state
          const [walletAddress, setWalletAddress] = useState(null);
          const [walletBalance, setWalletBalance] = useState(0);
          const [walletType, setWalletType] = useState(null); // 'phantom', 'solflare', or 'privy'
          const [showWalletSelect, setShowWalletSelect] = useState(false);
          const [showWalletInfo, setShowWalletInfo] = useState(false);

          // User holdings (persisted in sessionStorage for demo)
          const [userHoldings, setUserHoldings] = useState(() => {
            const saved = sessionStorage.getItem('cc_holdings');
            return saved ? JSON.parse(saved) : [];
          });

          // Notifications
          const [notification, setNotification] = useState(null);

          const showNotification = (message, type = 'success') => {
            setNotification({ message, type });
          };

          // Save holdings to sessionStorage
          useEffect(() => {
            sessionStorage.setItem('cc_holdings', JSON.stringify(userHoldings));
          }, [userHoldings]);

          // Check for just-created culture on page load
          useEffect(() => {
            const params = new URLSearchParams(window.location.search);
            const showId = params.get('show');

            if (showId) {
              // Try to load just-created culture from localStorage
              const justCreated = localStorage.getItem('just_created_culture');
              if (justCreated) {
                try {
                  const culture = JSON.parse(justCreated);
                  if (culture.id === parseInt(showId) || culture.id === showId) {
                    setSelectedCulture(culture);
                    setView('culture');
                    showNotification(`Welcome to ${culture.name}! Your culture is now live.`);
                    // Clear it after showing
                    localStorage.removeItem('just_created_culture');
                    // Clear URL param
                    window.history.replaceState({}, '', '/culture-coins');
                  }
                } catch (e) {
                  console.error('[CULTURE] Error loading just-created:', e);
                }
              }
            }
          }, []);

          // Listen for Privy auth via BroadcastChannel
          useEffect(() => {
            const channel = new BroadcastChannel('launchr-auth');
            channel.onmessage = (e) => {
              if (e.data?.type === 'privy-auth-success' && e.data?.address) {
                handleWalletConnected(e.data.address);
                showNotification('Connected with Privy wallet!');
              }
            };

            window.addEventListener('message', (e) => {
              if (e.data?.type === 'privy-auth-success' && e.data?.address) {
                handleWalletConnected(e.data.address);
                showNotification('Connected with Privy wallet!');
              }
            });

            return () => channel.close();
          }, []);

          const handleWalletConnected = async (address, type = 'privy') => {
            console.log('[WALLET] Connected:', address, 'type:', type);
            setWalletAddress(address);
            setWalletType(type);
            setShowWalletSelect(false);

            // Fetch balance
            try {
              console.log('[BALANCE] Fetching for:', address, 'via', SOLANA_RPC);
              const res = await fetch(SOLANA_RPC, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ jsonrpc: '2.0', id: 1, method: 'getBalance', params: [address] }),
              });
              const data = await res.json();
              console.log('[BALANCE] Response:', data);
              if (data.result?.value !== undefined) {
                const bal = data.result.value / 1e9;
                console.log('[BALANCE] Setting:', bal, 'SOL');
                setWalletBalance(bal);
              } else if (data.error) {
                console.error('[BALANCE] RPC error:', data.error);
              }
            } catch (e) {
              console.error('[BALANCE] Fetch failed:', e);
            }
          };

          const disconnectWallet = () => {
            setWalletAddress(null);
            setWalletBalance(0);
            setWalletType(null);
            setShowWalletInfo(false);
            showNotification('Wallet disconnected');
          };

          const joinCulture = (culture, tier) => {
            if (!walletAddress) {
              setShowWalletSelect(true);
              return;
            }

            const existingIndex = userHoldings.findIndex(h => h.cultureId === culture.id);
            if (existingIndex >= 0) {
              showNotification(`Already a member of ${culture.name}`, 'error');
              return;
            }

            const newHolding = {
              cultureId: culture.id,
              cultureName: culture.name,
              ticker: culture.ticker,
              category: culture.category,
              tier: tier.name,
              percent: tier.percent,
              coins: Math.floor(culture.supply * (tier.percent / 100)),
              joinedAt: Date.now(),
              daysHeld: 0
            };

            setUserHoldings([...userHoldings, newHolding]);
            showNotification(`Joined ${culture.name} as ${tier.name}!`);
          };

          const handleSelectCulture = (culture) => {
            setSelectedCulture(culture);
            setView('culture');
          };

          // Wallet context value
          const walletContextValue = {
            address: walletAddress,
            balance: walletBalance,
            type: walletType, // 'phantom', 'solflare', or 'privy'
            holdings: userHoldings,
            connect: () => setShowWalletSelect(true),
            showModal: () => setShowWalletInfo(true),
            joinCulture,
            showNotification
          };

          return (
            <WalletContext.Provider value={walletContextValue}>
              <div style={{ minHeight: '100vh', background: '#0a0a0a', color: '#fff' }}>
                <Navigation view={view} setView={(v) => { setView(v); setSelectedCulture(null); }} />

                {view === 'discover' && <DiscoveryView onSelectCulture={handleSelectCulture} />}
                {view === 'feed' && <FeedView onSelectCulture={handleSelectCulture} />}
                {view === 'create' && <CreateCulturePage />}
                {view === 'culture' && selectedCulture && (
                  <CulturePage
                    culture={selectedCulture}
                    onBack={() => { setView('discover'); setSelectedCulture(null); }}
                  />
                )}
                {view === 'auctions' && <AuctionsView />}
                {view === 'dashboard' && <DashboardView />}

                {/* Modals */}
                {showWalletSelect && (
                  <WalletSelectModal
                    onClose={() => setShowWalletSelect(false)}
                    onConnect={handleWalletConnected}
                  />
                )}
                {showWalletInfo && walletAddress && (
                  <WalletInfoModal
                    address={walletAddress}
                    balance={walletBalance}
                    holdings={userHoldings}
                    onClose={() => setShowWalletInfo(false)}
                    onDisconnect={disconnectWallet}
                  />
                )}

                {/* Notification */}
                {notification && (
                  <Notification
                    message={notification.message}
                    type={notification.type}
                    onClose={() => setNotification(null)}
                  />
                )}
              </div>
            </WalletContext.Provider>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CultureCoinsApp />);
    </script>
</body>
</html>
