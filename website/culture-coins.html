<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <title>Culture Coins - LAUNCHR (Preview)</title>
    <meta name="description" content="Culture Coins - Participate in communities, not trades.">
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" href="/favicon.ico" type="image/jpeg">
    <link rel="apple-touch-icon" href="/website/logo-icon.jpg">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Solana Web3.js for token creation -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        html, body, #root {
            min-height: 100vh;
            background: #0a0a0a;
        }

        ::selection {
            background: #fff;
            color: #000;
        }

        /* Preview Banner */
        .preview-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #8b5cf6;
            color: #000;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            padding: 8px;
            letter-spacing: 0.1em;
            z-index: 9999;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Responsive Design for Two-Column Layout */
        @media (max-width: 1200px) {
            .two-column-layout {
                grid-template-columns: 1fr !important;
            }
            .trending-column {
                position: relative !important;
                top: auto !important;
                height: auto !important;
                min-height: auto !important;
                margin-bottom: 32px;
            }
        }

        /* Access Gate */
        .access-gate {
            position: fixed;
            inset: 0;
            background: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        .access-box {
            text-align: center;
            max-width: 400px;
            padding: 48px;
        }
        .access-logo {
            width: 64px;
            height: 64px;
            margin-bottom: 32px;
        }
        .access-title {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            color: #fff;
            margin-bottom: 12px;
        }
        .access-subtitle {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            color: #666;
            margin-bottom: 32px;
        }
        .access-input {
            width: 100%;
            padding: 16px 20px;
            background: #111;
            border: 1px solid #333;
            color: #fff;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            text-align: center;
            letter-spacing: 0.1em;
            margin-bottom: 16px;
            outline: none;
            transition: border-color 0.2s;
        }
        .access-input:focus {
            border-color: #8b5cf6;
        }
        .access-input::placeholder {
            color: #444;
        }
        .access-btn {
            width: 100%;
            padding: 16px;
            background: #fff;
            color: #000;
            border: none;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: background 0.2s;
        }
        .access-btn:hover {
            background: #eee;
        }
        .access-error {
            color: #ef4444;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            margin-top: 16px;
        }
        .access-hint {
            color: #333;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            margin-top: 24px;
        }
    </style>
</head>
<body>
    <!-- Access Gate -->
    <div class="access-gate" id="accessGate">
        <div class="access-box">
            <img src="/website/logo-icon.jpg" alt="LAUNCHR" class="access-logo">
            <h1 class="access-title">Culture Coins</h1>
            <p class="access-subtitle">This preview is restricted to team members and testers.</p>
            <input
                type="password"
                class="access-input"
                id="accessCode"
                placeholder="ENTER ACCESS CODE"
                onkeypress="if(event.key === 'Enter') checkAccess()"
                autocomplete="off"
            >
            <button type="button" class="access-btn" id="enterBtn">ENTER</button>
            <div class="access-error" id="accessError"></div>
            <div class="access-hint">Contact team lead for access</div>
        </div>
    </div>

    <div class="preview-banner" id="previewBanner" style="display:none;">PREVIEW MODE - TESTERS ONLY</div>
    <div id="root"></div>

    <script>
        // Access control - runs immediately when DOM is ready
        (function() {
            const ACCESS_CODE = 'MATRIXNOW100!';

            function checkAccess() {
                var input = document.getElementById('accessCode');
                var gate = document.getElementById('accessGate');
                var banner = document.getElementById('previewBanner');
                var error = document.getElementById('accessError');

                if (input && input.value === ACCESS_CODE) {
                    sessionStorage.setItem('cc_access', 'granted');
                    if (gate) gate.style.display = 'none';
                    if (banner) banner.style.display = 'block';
                } else {
                    if (error) error.textContent = 'Invalid access code';
                    if (input) input.value = '';
                }
            }

            // Make checkAccess global for onkeypress
            window.checkAccess = checkAccess;

            // Check if already authenticated this session
            if (sessionStorage.getItem('cc_access') === 'granted') {
                var gate = document.getElementById('accessGate');
                var banner = document.getElementById('previewBanner');
                if (gate) gate.style.display = 'none';
                if (banner) banner.style.display = 'block';
            }

            // Add click handler when DOM is ready
            document.addEventListener('DOMContentLoaded', function() {
                var btn = document.getElementById('enterBtn');
                if (btn) {
                    btn.addEventListener('click', checkAccess);
                }
            });

            // Also try to attach immediately in case DOMContentLoaded already fired
            var btn = document.getElementById('enterBtn');
            if (btn) {
                btn.addEventListener('click', checkAccess);
            }
        })();
    </script>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext, useRef } = React;

        // ═══════════════════════════════════════════════════════════════════
        // SAFE FETCH HELPER - Properly checks response.ok before parsing JSON
        // ═══════════════════════════════════════════════════════════════════
        async function safeFetch(url, options = {}) {
            const response = await fetch(url, options);
            if (!response.ok) {
                const errorText = await response.text().catch(() => 'Unknown error');
                throw new Error(`HTTP ${response.status}: ${errorText}`);
            }
            return response.json();
        }

        // ═══════════════════════════════════════════════════════════════════
        // CIA-LEVEL CLIENT SECURITY - Anti-Tampering & Verification
        // ═══════════════════════════════════════════════════════════════════
        const CultureSecurity = {
            // Nonce storage for replay protection
            usedNonces: new Set(),

            // Generate cryptographic nonce
            generateNonce() {
                const array = new Uint8Array(16);
                crypto.getRandomValues(array);
                return Array.from(array).map(b => b.toString(16).padStart(2, '0')).join('');
            },

            // Hash data using SHA-256
            async hash(data) {
                const encoder = new TextEncoder();
                const dataBuffer = encoder.encode(typeof data === 'string' ? data : JSON.stringify(data));
                const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);
                return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
            },

            // Verify response hasn't been tampered with
            async verifyResponse(response) {
                if (!response.signature || !response.timestamp) return true; // No signature to verify

                // Check response age (max 60 seconds)
                const age = Date.now() - response.timestamp;
                if (age > 60000 || age < -5000) {
                    console.warn('[SECURITY] Response too old or timestamp in future');
                    return false;
                }

                // Check nonce not reused
                if (response.nonce && this.usedNonces.has(response.nonce)) {
                    console.warn('[SECURITY] Nonce reuse detected - possible replay attack');
                    return false;
                }
                if (response.nonce) this.usedNonces.add(response.nonce);

                return true;
            },

            // Create signed request
            async createSecureRequest(data, wallet, signMessage) {
                const timestamp = Date.now();
                const nonce = this.generateNonce();

                const request = {
                    ...data,
                    timestamp,
                    nonce,
                    wallet
                };

                // Sign the request if signMessage function provided
                if (signMessage && wallet) {
                    try {
                        const message = `CULTURE_REQUEST:${nonce}:${timestamp}`;
                        const signature = await signMessage(message);
                        request.signature = signature;
                        request.message = message;
                    } catch (e) {
                        console.warn('[SECURITY] Could not sign request:', e.message);
                    }
                }

                return request;
            },

            // Secure API call with verification
            async secureApiCall(endpoint, method, data, options = {}) {
                const headers = {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-Client-Nonce': this.generateNonce()
                };

                if (options.authToken) {
                    headers['Authorization'] = `Bearer ${options.authToken}`;
                }

                try {
                    const response = await fetch(endpoint, {
                        method,
                        headers,
                        body: method !== 'GET' ? JSON.stringify(data) : undefined,
                        credentials: 'same-origin'
                    });

                    const json = await response.json();

                    // Verify response integrity
                    const verified = await this.verifyResponse(json);
                    if (!verified) {
                        console.error('[SECURITY] Response verification failed');
                        return { success: false, error: 'Response verification failed' };
                    }

                    return json;
                } catch (e) {
                    console.error('[SECURITY] API call failed:', e);
                    return { success: false, error: e.message };
                }
            },

            // Verify tier access with cryptographic proof
            async verifyTierAccess(wallet, cultureId, connection) {
                return this.secureApiCall('/api/culture/verify-access', 'POST', {
                    wallet,
                    cultureId
                });
            },

            // Get authentication challenge
            async getAuthChallenge(wallet, action) {
                return this.secureApiCall('/api/culture/auth-challenge', 'POST', {
                    wallet,
                    action
                });
            },

            // Tamper detection for culture data
            async verifyCultureIntegrity(culture) {
                if (!culture.stateHash) return true; // No hash to verify

                const computedHash = await this.hash({
                    id: culture.id,
                    name: culture.name,
                    creator: culture.creator,
                    tiers: culture.tiers,
                    beliefs: culture.beliefs,
                    unlocks: culture.unlocks,
                    tokenAddress: culture.tokenAddress,
                    createdAt: culture.createdAt
                });

                if (computedHash !== culture.stateHash) {
                    console.error('[SECURITY] Culture data has been tampered with!');
                    return false;
                }

                return true;
            },

            // Clean up old nonces periodically
            cleanupNonces() {
                if (this.usedNonces.size > 1000) {
                    const arr = Array.from(this.usedNonces);
                    this.usedNonces = new Set(arr.slice(-500));
                }
            }
        };

        // Run nonce cleanup every 5 minutes
        setInterval(() => CultureSecurity.cleanupNonces(), 300000);

        // Wallet Context for global state
        const WalletContext = createContext(null);

        // ═══════════════════════════════════════════════════════════════════
        // TOOLTIP COMPONENT - Hover explanations for users
        // ═══════════════════════════════════════════════════════════════════
        const Tooltip = ({ text, children }) => {
          const [show, setShow] = useState(false);
          const [position, setPosition] = useState({ x: 0, y: 0 });

          const handleMouseEnter = (e) => {
            const rect = e.currentTarget.getBoundingClientRect();
            setPosition({ x: rect.left + rect.width / 2, y: rect.top });
            setShow(true);
          };

          return (
            <span
              style={{ position: 'relative', display: 'inline-flex', alignItems: 'center', cursor: 'help' }}
              onMouseEnter={handleMouseEnter}
              onMouseLeave={() => setShow(false)}
            >
              {children}
              {show && (
                <div style={{
                  position: 'fixed',
                  left: position.x,
                  top: position.y - 10,
                  transform: 'translate(-50%, -100%)',
                  background: '#222',
                  border: '1px solid #444',
                  padding: '12px 16px',
                  borderRadius: '4px',
                  maxWidth: '300px',
                  zIndex: 10000,
                  boxShadow: '0 4px 20px rgba(0,0,0,0.5)'
                }}>
                  <div style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '12px',
                    color: '#ccc',
                    lineHeight: 1.6
                  }}>
                    {text}
                  </div>
                  <div style={{
                    position: 'absolute',
                    bottom: '-6px',
                    left: '50%',
                    transform: 'translateX(-50%) rotate(45deg)',
                    width: '10px',
                    height: '10px',
                    background: '#222',
                    borderRight: '1px solid #444',
                    borderBottom: '1px solid #444'
                  }} />
                </div>
              )}
            </span>
          );
        };

        // Info icon for tooltips
        const InfoIcon = ({ tooltip }) => (
          <Tooltip text={tooltip}>
            <span style={{
              display: 'inline-flex',
              alignItems: 'center',
              justifyContent: 'center',
              width: '18px',
              height: '18px',
              borderRadius: '50%',
              border: '1px solid #444',
              fontSize: '11px',
              color: '#888',
              marginLeft: '8px',
              fontFamily: "'IBM Plex Mono', monospace",
              fontWeight: 'bold'
            }}>?</span>
          </Tooltip>
        );

        // Section header with built-in tooltip support
        const SectionHeader = ({ title, tooltip, style = {} }) => (
          <div style={{
            display: 'flex',
            alignItems: 'center',
            fontSize: '10px',
            letterSpacing: '0.15em',
            color: '#666',
            marginBottom: '12px',
            fontFamily: "'IBM Plex Mono', monospace",
            ...style
          }}>
            {title}
            {tooltip && <InfoIcon tooltip={tooltip} />}
          </div>
        );

        // ═══════════════════════════════════════════════════════════════════
        // TRENDING FEED - Tokens + Crypto Twitter (Fortune 500 Design)
        // ═══════════════════════════════════════════════════════════════════
        const TrendingXFeed = ({ lightMode }) => {
          const [activeTab, setActiveTab] = useState('tokens'); // 'tokens' | 'news' | 'ideas'
          const [aiIdeas, setAiIdeas] = useState([]);
          const [ideasLoading, setIdeasLoading] = useState(false);
          const [tokens, setTokens] = useState([]);
          const [trends, setTrends] = useState([]);
          const [loading, setLoading] = useState(true);
          const [lastUpdated, setLastUpdated] = useState(null);
          const [hoveredItem, setHoveredItem] = useState(null);
          // Removed inner collapse - using outer trendingCollapsed instead

          // Launchr Pixel Character Generator - CryptoPunk style faces
          const generatePixelArt = (seed) => {
            const hash = (str) => {
              let h = 0;
              for (let i = 0; i < str.length; i++) h = ((h << 5) - h + str.charCodeAt(i)) | 0;
              return Math.abs(h);
            };
            const h = hash(seed);
            const rand = (n) => hash(seed + n.toString()) % 1000 / 1000;

            // 12x12 pixel canvas
            const p = 4; // pixel size
            let svg = [];

            // Background gradient colors (Launchr vibes)
            const bgColors = ['#1a1a2e', '#16213e', '#0f0f23', '#1e1e3f', '#2d1b4e', '#1b2838'];
            const bg = bgColors[h % bgColors.length];

            // Skin tones
            const skinTones = ['#ffdbac', '#f1c27d', '#e0ac69', '#c68642', '#8d5524', '#6b4423', '#a855f7', '#3b82f6', '#10b981', '#f97316'];
            const skin = skinTones[h % skinTones.length];
            const skinDark = skin.replace(/[0-9a-f]{2}$/i, m => Math.max(0, parseInt(m, 16) - 40).toString(16).padStart(2, '0'));

            // Hair colors (brand purple/cyan instead of gold/coral)
            const hairColors = ['#2c1810', '#4a3728', '#8b4513', '#d4a574', '#8b5cf6', '#06b6d4', '#a855f7', '#3b82f6', '#22c55e', '#ec4899'];
            const hair = hairColors[(h >> 4) % hairColors.length];

            // Eye colors (brand purple instead of gold)
            const eyeColors = ['#3b82f6', '#22c55e', '#8b4513', '#6b7280', '#a855f7', '#ec4899', '#8b5cf6'];
            const eyes = eyeColors[(h >> 8) % eyeColors.length];

            // Draw background
            svg.push(`<rect width="48" height="48" fill="${bg}"/>`);

            // Face shape (rows 3-10, cols 3-9)
            for (let y = 3; y <= 10; y++) {
              for (let x = 3; x <= 9; x++) {
                if (y === 3 && (x === 3 || x === 9)) continue; // rounded corners
                if (y === 10 && (x === 3 || x === 9)) continue;
                svg.push(`<rect x="${x*p}" y="${y*p}" width="${p}" height="${p}" fill="${skin}"/>`);
              }
            }

            // Hair styles based on seed
            const hairStyle = h % 8;
            if (hairStyle === 0) { // Spiky
              for (let x = 3; x <= 9; x++) {
                svg.push(`<rect x="${x*p}" y="${(2 - (x % 2))*p}" width="${p}" height="${p}" fill="${hair}"/>`);
                svg.push(`<rect x="${x*p}" y="${2*p}" width="${p}" height="${p}" fill="${hair}"/>`);
              }
            } else if (hairStyle === 1) { // Mohawk
              for (let y = 0; y <= 3; y++) svg.push(`<rect x="${6*p}" y="${y*p}" width="${p}" height="${p}" fill="${hair}"/>`);
            } else if (hairStyle === 2) { // Side part
              for (let x = 2; x <= 9; x++) svg.push(`<rect x="${x*p}" y="${2*p}" width="${p}" height="${p}" fill="${hair}"/>`);
              for (let y = 2; y <= 5; y++) svg.push(`<rect x="${2*p}" y="${y*p}" width="${p}" height="${p}" fill="${hair}"/>`);
            } else if (hairStyle === 3) { // Bald with headband
              svg.push(`<rect x="${2*p}" y="${3*p}" width="${9*p}" height="${p}" fill="#ff3d8e"/>`);
            } else if (hairStyle === 4) { // Afro
              for (let y = 1; y <= 3; y++) for (let x = 2; x <= 10; x++) svg.push(`<rect x="${x*p}" y="${y*p}" width="${p}" height="${p}" fill="${hair}"/>`);
              svg.push(`<rect x="${2*p}" y="${4*p}" width="${p}" height="${p}" fill="${hair}"/>`);
              svg.push(`<rect x="${10*p}" y="${4*p}" width="${p}" height="${p}" fill="${hair}"/>`);
            } else if (hairStyle === 5) { // Cap (purple brand color)
              for (let x = 2; x <= 10; x++) svg.push(`<rect x="${x*p}" y="${2*p}" width="${p}" height="${p}" fill="#8b5cf6"/>`);
              for (let x = 3; x <= 9; x++) svg.push(`<rect x="${x*p}" y="${1*p}" width="${p}" height="${p}" fill="#8b5cf6"/>`);
              svg.push(`<rect x="${2*p}" y="${3*p}" width="${10*p}" height="${p}" fill="#8b5cf6"/>`);
            } else if (hairStyle === 6) { // Horns (demon - cyan)
              svg.push(`<rect x="${3*p}" y="${1*p}" width="${p}" height="${2*p}" fill="#06b6d4"/>`);
              svg.push(`<rect x="${9*p}" y="${1*p}" width="${p}" height="${2*p}" fill="#06b6d4"/>`);
            } else { // Halo (purple brand color)
              for (let x = 4; x <= 8; x++) svg.push(`<rect x="${x*p}" y="${1*p}" width="${p}" height="${p}" fill="#8b5cf6"/>`);
            }

            // Eyes (row 5-6)
            svg.push(`<rect x="${4*p}" y="${5*p}" width="${2*p}" height="${2*p}" fill="white"/>`);
            svg.push(`<rect x="${7*p}" y="${5*p}" width="${2*p}" height="${2*p}" fill="white"/>`);
            // Pupils
            const lookDir = h % 3; // 0=left, 1=center, 2=right
            svg.push(`<rect x="${(4 + lookDir)*p}" y="${6*p}" width="${p}" height="${p}" fill="${eyes}"/>`);
            svg.push(`<rect x="${(7 + lookDir)*p}" y="${6*p}" width="${p}" height="${p}" fill="${eyes}"/>`);

            // Eyebrows
            if (rand(100) > 0.3) {
              const browColor = hair;
              svg.push(`<rect x="${4*p}" y="${4*p}" width="${2*p}" height="${p}" fill="${browColor}"/>`);
              svg.push(`<rect x="${7*p}" y="${4*p}" width="${2*p}" height="${p}" fill="${browColor}"/>`);
            }

            // Nose
            svg.push(`<rect x="${6*p}" y="${7*p}" width="${p}" height="${p}" fill="${skinDark}"/>`);

            // Mouth styles
            const mouthStyle = (h >> 12) % 5;
            if (mouthStyle === 0) { // Smile
              svg.push(`<rect x="${5*p}" y="${9*p}" width="${3*p}" height="${p}" fill="#1a1a1a"/>`);
            } else if (mouthStyle === 1) { // Grin
              svg.push(`<rect x="${4*p}" y="${9*p}" width="${5*p}" height="${p}" fill="#1a1a1a"/>`);
              svg.push(`<rect x="${5*p}" y="${9*p}" width="${3*p}" height="${p}" fill="#ef4444"/>`);
            } else if (mouthStyle === 2) { // Cigarette
              svg.push(`<rect x="${5*p}" y="${9*p}" width="${2*p}" height="${p}" fill="#1a1a1a"/>`);
              svg.push(`<rect x="${9*p}" y="${8*p}" width="${3*p}" height="${p}" fill="#f5f5dc"/>`);
              svg.push(`<rect x="${11*p}" y="${7*p}" width="${p}" height="${p}" fill="#f97316"/>`);
            } else if (mouthStyle === 3) { // Tongue out
              svg.push(`<rect x="${5*p}" y="${9*p}" width="${3*p}" height="${p}" fill="#1a1a1a"/>`);
              svg.push(`<rect x="${6*p}" y="${10*p}" width="${p}" height="${p}" fill="#ec4899"/>`);
            } else { // Neutral
              svg.push(`<rect x="${5*p}" y="${9*p}" width="${3*p}" height="${p}" fill="#1a1a1a"/>`);
            }

            // Accessories based on seed
            if (rand(200) > 0.7) { // Sunglasses
              svg.push(`<rect x="${3*p}" y="${5*p}" width="${7*p}" height="${2*p}" fill="#1a1a1a"/>`);
              svg.push(`<rect x="${4*p}" y="${5*p}" width="${2*p}" height="${2*p}" fill="#3b82f6" fill-opacity="0.5"/>`);
              svg.push(`<rect x="${7*p}" y="${5*p}" width="${2*p}" height="${2*p}" fill="#3b82f6" fill-opacity="0.5"/>`);
            }
            if (rand(300) > 0.85) { // Earring
              svg.push(`<rect x="${2*p}" y="${6*p}" width="${p}" height="${p}" fill="#ffd966"/>`);
            }
            if (rand(400) > 0.9) { // Laser eyes
              svg.push(`<rect x="${5*p}" y="${6*p}" width="${7*p}" height="${p}" fill="#ef4444" fill-opacity="0.8"/>`);
              svg.push(`<rect x="${8*p}" y="${6*p}" width="${4*p}" height="${p}" fill="#ef4444" fill-opacity="0.8"/>`);
            }

            return `data:image/svg+xml,${encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" shape-rendering="crispEdges">${svg.join('')}</svg>`)}`;
          };

          // Colors based on light/dark mode - GOLD ACCENT ONLY
          const colors = lightMode ? {
            bg: '#ffffff',
            cardBg: '#fafafa',
            border: '#e5e5e5',
            text: '#171717',
            textSecondary: '#404040',
            textMuted: '#737373',
            accent: '#8b5cf6',
            accentAlt: '#06b6d4',
            positive: '#8b5cf6',
            negative: '#ef4444',
            green: '#16a34a',
            red: '#dc2626',
            gradient: 'linear-gradient(135deg, #8b5cf6 0%, #06b6d4 100%)'
          } : {
            bg: '#0a0a0a',
            cardBg: '#0f0f0f',
            border: '#1a1a1a',
            text: '#ffffff',
            textSecondary: '#a0a0a0',
            textMuted: '#666666',
            accent: '#8b5cf6',
            accentAlt: '#06b6d4',
            positive: '#8b5cf6',
            negative: '#ef4444',
            green: '#22c55e',
            red: '#ef4444',
            gradient: 'linear-gradient(135deg, #8b5cf6 0%, #06b6d4 100%)'
          };

          // Fetch REAL trending tokens from our API (DexScreener data)
          useEffect(() => {
            const fetchTokens = async () => {
              try {
                // Use our trending API that fetches real DexScreener data
                const res = await fetch('/api/trending-tokens');
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();

                if (data.success && data.tokens && data.tokens.length > 0) {
                  const tokens = data.tokens.map(token => ({
                    mint: token.mint,
                    name: token.name || 'Unknown',
                    symbol: token.symbol || '???',
                    image: token.image || `https://dd.dexscreener.com/ds-data/tokens/solana/${token.mint}.png`,
                    marketCap: token.marketCap || 0,
                    price: token.price || 0,
                    priceChange: token.priceChange ? token.priceChange.toFixed(1) : '0',
                    priceChange5m: token.priceChange5m || 0,
                    priceChange1h: token.priceChange1h || 0,
                    volume24h: token.volume24h || 0,
                    liquidity: token.liquidity || 0,
                    source: token.source || 'dexscreener'
                  }));
                  setTokens(tokens.slice(0, 25));
                  setLoading(false);
                  return;
                }
              } catch (e) {
                console.error('[TOKENS] Trending API failed:', e);
              }

              // Only if API completely fails, show empty state
              setTokens([]);
              setLoading(false);
            };

            const fetchTrends = async () => {
              try {
                const res = await fetch('/api/x/trending');
                const data = await res.json();
                if (data.success && data.trends) {
                  setTrends(data.trends);
                }
              } catch (e) {
                console.error('[TRENDS] Failed to fetch:', e);
                // Fallback: Today's crypto news headlines
                setTrends([
                  { name: 'Solana hits new ATH volume on DEXs', category: 'BREAKING', volume: '245K', velocity: '+892%', sentiment: 0.89 },
                  { name: 'pump.fun surpasses $500M in fees', category: 'MARKET', volume: '189K', velocity: '+567%', sentiment: 0.84 },
                  { name: 'BONK rallies 40% on whale accumulation', category: 'TRENDING', volume: '156K', velocity: '+445%', sentiment: 0.81 },
                  { name: 'AI agent tokens surge amid hype', category: 'HOT', volume: '134K', velocity: '+678%', sentiment: 0.78 },
                  { name: 'Jupiter DEX volume exceeds Uniswap', category: 'MARKET', volume: '98K', velocity: '+234%', sentiment: 0.72 },
                  { name: 'New memecoin meta: culture coins', category: 'ALPHA', volume: '87K', velocity: '+312%', sentiment: 0.76 },
                  { name: 'Raydium TVL crosses $2B milestone', category: 'DEFI', volume: '76K', velocity: '+156%', sentiment: 0.68 },
                  { name: 'Crypto Twitter buzzing on launches', category: 'SOCIAL', volume: '38K', velocity: '+398%', sentiment: 0.74 }
                ]);
              }
            };

            Promise.all([fetchTokens(), fetchTrends()]).finally(() => {
              setLoading(false);
              setLastUpdated(new Date());
            });

            // Refresh every 30 seconds
            const interval = setInterval(() => {
              fetchTokens();
              fetchTrends();
              setLastUpdated(new Date());
            }, 30000);

            return () => clearInterval(interval);
          }, []);

          // Format market cap
          const formatMcap = (num) => {
            if (!num) return '$0';
            if (num >= 1000000) return `$${(num / 1000000).toFixed(2)}M`;
            if (num >= 1000) return `$${(num / 1000).toFixed(1)}K`;
            return `$${num.toFixed(0)}`;
          };

          // Format price
          const formatPrice = (num) => {
            if (!num) return '$0';
            if (num < 0.00001) return `$${num.toExponential(2)}`;
            if (num < 0.01) return `$${num.toFixed(6)}`;
            if (num < 1) return `$${num.toFixed(4)}`;
            return `$${num.toFixed(2)}`;
          };

          // Generate AI coin ideas using Claude API based on trending tokens and news
          const generateAiIdeas = async () => {
            setIdeasLoading(true);
            try {
              // Call Claude-powered AI endpoint
              const res = await fetch('/api/ai/generate-ideas', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  trendingTokens: tokens.slice(0, 5),
                  trendingNews: trends.slice(0, 5)
                })
              });

              if (res.ok) {
                const data = await res.json();
                if (data.success && data.ideas && data.ideas.length > 0) {
                  console.log('[AI IDEAS] Claude generated', data.ideas.length, 'ideas');
                  setAiIdeas(data.ideas);
                  setIdeasLoading(false);
                  return;
                }
              }
              throw new Error('API response invalid');
            } catch (e) {
              console.log('[AI IDEAS] Claude API failed, using fallback:', e.message);

              // Fallback: Generate ideas locally based on trends
              const themes = tokens.length > 0
                ? tokens.slice(0, 3).map(t => t.name.split(' ')[0])
                : ['Doge', 'Pepe', 'Cat'];
              const newsThemes = trends.length > 0
                ? trends.slice(0, 2).map(t => t.name.split(' ').slice(0, 2).join(' '))
                : ['Crypto Rally', 'New Meta'];

              const generatedIdeas = [
                {
                  name: `${themes[0] || 'Moon'}AI`,
                  ticker: `${(themes[0] || 'MOON').substring(0, 3).toUpperCase()}AI`,
                  description: `AI-powered ${themes[0] || 'community'} token with automated trading signals and community governance`,
                  category: 'AI + Meme',
                  confidence: 87,
                  reasoning: `Combines trending ${themes[0] || 'meme'} narrative with AI agent meta`
                },
                {
                  name: `${newsThemes[0] || 'Trending'} Coin`,
                  ticker: `${(newsThemes[0] || 'TREND').split(' ')[0].substring(0, 4).toUpperCase()}`,
                  description: `Capitalizes on "${newsThemes[0] || 'current trends'}" momentum with community-driven development`,
                  category: 'News Meta',
                  confidence: 82,
                  reasoning: `Direct play on breaking news sentiment`
                },
                {
                  name: 'Culture DAO',
                  ticker: 'CULT',
                  description: 'Decentralized culture curation with tiered membership and exclusive content access',
                  category: 'Social',
                  confidence: 79,
                  reasoning: 'Culture coins gaining traction, DAO structure adds legitimacy'
                },
                {
                  name: `Baby ${themes[1] || 'Doge'}`,
                  ticker: `BABY${(themes[1] || 'DOGE').substring(0, 4).toUpperCase()}`,
                  description: `Community spin-off of popular ${themes[1] || 'meme'} with deflationary mechanics`,
                  category: 'Meme Derivative',
                  confidence: 75,
                  reasoning: `Baby/derivative tokens historically perform well off trending parents`
                },
                {
                  name: 'Solana Sensei',
                  ticker: 'SENSEI',
                  description: 'Educational token rewarding users for learning DeFi and completing quests',
                  category: 'Utility + Meme',
                  confidence: 71,
                  reasoning: 'Gamification + education meta emerging in Solana ecosystem'
                }
              ];

              setAiIdeas(generatedIdeas);
            }
            setIdeasLoading(false);
          };

          // Generate ideas when switching to ideas tab
          useEffect(() => {
            if (activeTab === 'ideas' && aiIdeas.length === 0 && !ideasLoading) {
              generateAiIdeas();
            }
          }, [activeTab]);

          return (
            <div style={{
              background: colors.cardBg,
              border: `1px solid ${colors.border}`,
              height: '100%',
              display: 'flex',
              flexDirection: 'column',
              position: 'relative',
              overflow: 'hidden'
            }}>
              {/* Animated gradient border effect */}
              <div style={{
                position: 'absolute',
                top: 0,
                left: 0,
                right: 0,
                height: '3px',
                background: colors.gradient
              }} />

              {/* Header */}
              <div style={{
                padding: '20px 20px 0',
                borderBottom: `1px solid ${colors.border}`
              }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'space-between',
                  marginBottom: '16px'
                }}>
                  <div>
                    <h2 style={{
                      fontFamily: "'Playfair Display', serif",
                      fontSize: '20px',
                      fontWeight: 500,
                      color: colors.text,
                      margin: 0
                    }}>
                      Trending
                    </h2>
                    <p style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '9px',
                      color: colors.textMuted,
                      margin: '4px 0 0 0',
                      letterSpacing: '0.1em'
                    }}>
                      TOKENS + TODAY'S NEWS
                    </p>
                  </div>

                  {/* Live indicator */}
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    padding: '5px 10px',
                    background: 'rgba(139, 92, 246, 0.1)',
                    borderRadius: '16px'
                  }}>
                    <div style={{
                      width: '6px',
                      height: '6px',
                      borderRadius: '50%',
                      background: '#8b5cf6',
                      animation: 'pulse 1.5s infinite'
                    }} />
                    <span style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '9px',
                      fontWeight: 600,
                      color: '#8b5cf6',
                      letterSpacing: '0.1em'
                    }}>LIVE</span>
                  </div>
                </div>

                {/* Tabs */}
                {true && (
                <div style={{
                  display: 'flex',
                  gap: '0'
                }}>
                  <button
                    onClick={() => setActiveTab('tokens')}
                    style={{
                      flex: 1,
                      padding: '12px 16px',
                      background: activeTab === 'tokens' ? colors.gradient : 'transparent',
                      border: 'none',
                      borderBottom: activeTab === 'tokens' ? 'none' : `2px solid ${colors.border}`,
                      color: activeTab === 'tokens' ? '#000' : colors.textMuted,
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '10px',
                      fontWeight: 600,
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      transition: 'all 0.2s',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '8px'
                    }}
                  >
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 6v12M6 12h12"/>
                    </svg>
                    TOKENS
                  </button>
                  <button
                    onClick={() => setActiveTab('news')}
                    style={{
                      flex: 1,
                      padding: '12px 16px',
                      background: activeTab === 'news' ? colors.gradient : 'transparent',
                      border: 'none',
                      borderBottom: activeTab === 'news' ? 'none' : `2px solid ${colors.border}`,
                      color: activeTab === 'news' ? '#000' : colors.textMuted,
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '10px',
                      fontWeight: 600,
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      transition: 'all 0.2s',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '8px'
                    }}
                  >
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                    NEWS
                  </button>
                  <button
                    onClick={() => setActiveTab('ideas')}
                    style={{
                      flex: 1,
                      padding: '12px 16px',
                      background: activeTab === 'ideas' ? colors.gradient : 'transparent',
                      border: 'none',
                      borderBottom: activeTab === 'ideas' ? 'none' : `2px solid ${colors.border}`,
                      color: activeTab === 'ideas' ? '#000' : colors.textMuted,
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '10px',
                      fontWeight: 600,
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      transition: 'all 0.2s',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '8px'
                    }}
                  >
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                      <circle cx="12" cy="12" r="4"/>
                    </svg>
                    AI IDEAS
                  </button>
                </div>
                )}
              </div>

              {/* Content */}
              {(
              <div style={{
                flex: 1,
                overflowY: 'auto',
                padding: '0'
              }}>
                {loading ? (
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    height: '200px',
                    color: colors.textMuted,
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '12px'
                  }}>
                    <div style={{
                      width: '20px',
                      height: '20px',
                      border: `2px solid ${colors.border}`,
                      borderTopColor: colors.accent,
                      borderRadius: '50%',
                      animation: 'spin 1s linear infinite',
                      marginRight: '12px'
                    }} />
                    Loading...
                  </div>
                ) : activeTab === 'tokens' ? (
                  /* TOKENS TAB */
                  <div>
                    {tokens.map((token, index) => (
                      <a
                        key={token.mint || index}
                        href={`https://pump.fun/${token.mint}`}
                        target="_blank"
                        rel="noopener noreferrer"
                        onMouseEnter={() => setHoveredItem(index)}
                        onMouseLeave={() => setHoveredItem(null)}
                        style={{
                          display: 'flex',
                          alignItems: 'center',
                          padding: '14px 20px',
                          borderBottom: `1px solid ${colors.border}`,
                          textDecoration: 'none',
                          background: hoveredItem === index
                            ? (lightMode ? 'rgba(139, 92, 246, 0.08)' : 'rgba(139, 92, 246, 0.05)')
                            : 'transparent',
                          transition: 'all 0.2s ease',
                          gap: '12px'
                        }}
                      >
                        {/* Rank */}
                        <div style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '10px',
                          color: index < 3 ? colors.accent : colors.textMuted,
                          fontWeight: index < 3 ? 700 : 400,
                          width: '20px'
                        }}>
                          {String(index + 1).padStart(2, '0')}
                        </div>

                        {/* Token Image */}
                        <div style={{
                          width: '36px',
                          height: '36px',
                          borderRadius: '50%',
                          background: colors.border,
                          overflow: 'hidden',
                          flexShrink: 0
                        }}>
                          {token.image && (
                            <img
                              src={token.image}
                              alt={token.name}
                              style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                              onError={(e) => { e.target.style.display = 'none'; }}
                            />
                          )}
                        </div>

                        {/* Token Info */}
                        <div style={{ flex: 1, minWidth: 0 }}>
                          <div style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '6px',
                            marginBottom: '4px'
                          }}>
                            <span style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '13px',
                              fontWeight: 600,
                              color: colors.text,
                              overflow: 'hidden',
                              textOverflow: 'ellipsis',
                              whiteSpace: 'nowrap'
                            }}>
                              {token.name}
                            </span>
                            <span style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '10px',
                              color: colors.textMuted
                            }}>
                              ${token.symbol}
                            </span>
                          </div>
                          <div style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '12px'
                          }}>
                            <span style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '11px',
                              color: colors.textSecondary
                            }}>
                              {formatMcap(token.marketCap)}
                            </span>
                            <span style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '10px',
                              color: colors.textMuted
                            }}>
                              Vol: {formatMcap(token.volume24h || 0)}
                            </span>
                          </div>
                        </div>

                        {/* Price Change */}
                        <div style={{
                          textAlign: 'right'
                        }}>
                          <div style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '12px',
                            fontWeight: 600,
                            color: parseFloat(token.priceChange) >= 0 ? colors.green : colors.red,
                            marginBottom: '2px'
                          }}>
                            {parseFloat(token.priceChange) >= 0 ? '+' : ''}{token.priceChange}%
                          </div>
                          <div style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '9px',
                            color: colors.textMuted
                          }}>
                            24H
                          </div>
                        </div>
                      </a>
                    ))}

                    {tokens.length === 0 && (
                      <div style={{
                        padding: '40px 20px',
                        textAlign: 'center',
                        color: colors.textMuted,
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '12px'
                      }}>
                        No tokens available
                      </div>
                    )}
                  </div>
                ) : activeTab === 'news' ? (
                  /* SOCIAL TAB */
                  <div>
                    {trends.map((trend, index) => (
                      <div
                        key={index}
                        onMouseEnter={() => setHoveredItem(index + 100)}
                        onMouseLeave={() => setHoveredItem(null)}
                        style={{
                          padding: '14px 20px',
                          borderBottom: `1px solid ${colors.border}`,
                          cursor: 'pointer',
                          background: hoveredItem === index + 100
                            ? (lightMode ? 'rgba(139, 92, 246, 0.08)' : 'rgba(139, 92, 246, 0.05)')
                            : 'transparent',
                          transition: 'all 0.2s ease'
                        }}
                        onClick={() => window.open(`https://x.com/search?q=${encodeURIComponent(trend.name)}`, '_blank')}
                      >
                        <div style={{
                          display: 'flex',
                          alignItems: 'flex-start',
                          gap: '12px'
                        }}>
                          {/* Rank */}
                          <div style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            color: index < 3 ? colors.accent : colors.textMuted,
                            fontWeight: index < 3 ? 700 : 400,
                            width: '20px',
                            paddingTop: '2px'
                          }}>
                            {String(index + 1).padStart(2, '0')}
                          </div>

                          <div style={{ flex: 1 }}>
                            {/* Category */}
                            <div style={{
                              fontSize: '9px',
                              letterSpacing: '0.1em',
                              color: colors.accent,
                              marginBottom: '4px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontWeight: 600
                            }}>
                              {trend.category?.toUpperCase() || 'TRENDING'}
                            </div>

                            {/* Topic name */}
                            <div style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '14px',
                              color: colors.text,
                              marginBottom: '6px',
                              fontWeight: 500
                            }}>
                              {trend.name}
                            </div>

                            {/* Volume & Velocity */}
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '12px'
                            }}>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '11px',
                                color: colors.textMuted
                              }}>
                                {trend.volume} posts
                              </span>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '11px',
                                color: parseFloat(trend.velocity) >= 200 ? colors.accent : colors.green,
                                fontWeight: 600
                              }}>
                                {trend.velocity}
                              </span>
                            </div>
                          </div>

                          {/* Sentiment */}
                          <div style={{
                            width: '32px',
                            height: '32px',
                            borderRadius: '50%',
                            border: `2px solid ${trend.sentiment >= 0.7 ? colors.green : trend.sentiment >= 0.4 ? colors.accent : colors.red}`,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            background: `${trend.sentiment >= 0.7 ? colors.green : trend.sentiment >= 0.4 ? colors.accent : colors.red}15`
                          }}>
                            <span style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '9px',
                              fontWeight: 600,
                              color: trend.sentiment >= 0.7 ? colors.green : trend.sentiment >= 0.4 ? colors.accent : colors.red
                            }}>
                              {Math.round(trend.sentiment * 100)}
                            </span>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                ) : activeTab === 'ideas' ? (
                  /* AI IDEAS TAB */
                  <div>
                    {ideasLoading ? (
                      <div style={{
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        height: '200px',
                        color: colors.textMuted,
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '12px'
                      }}>
                        <div style={{
                          width: '20px',
                          height: '20px',
                          border: `2px solid ${colors.border}`,
                          borderTopColor: colors.accent,
                          borderRadius: '50%',
                          animation: 'spin 1s linear infinite',
                          marginRight: '12px'
                        }} />
                        Generating ideas...
                      </div>
                    ) : (
                      <>
                        {/* Refresh Button */}
                        <div style={{ padding: '12px 20px', borderBottom: `1px solid ${colors.border}` }}>
                          <button
                            onClick={() => { setAiIdeas([]); setTimeout(generateAiIdeas, 100); }}
                            disabled={ideasLoading}
                            style={{
                              width: '100%',
                              padding: '10px',
                              background: 'linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(99, 102, 241, 0.1))',
                              border: '1px solid rgba(168, 85, 247, 0.4)',
                              color: '#a855f7',
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '10px',
                              fontWeight: 600,
                              letterSpacing: '0.1em',
                              cursor: 'pointer',
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              gap: '8px'
                            }}
                          >
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                              <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4"/>
                            </svg>
                            REGENERATE IDEAS
                          </button>
                        </div>

                        {/* Ideas List */}
                        {aiIdeas.map((idea, index) => (
                          <div
                            key={index}
                            onMouseEnter={() => setHoveredItem(index + 200)}
                            onMouseLeave={() => setHoveredItem(null)}
                            style={{
                              padding: '16px 20px',
                              borderBottom: `1px solid ${colors.border}`,
                              background: hoveredItem === index + 200
                                ? (lightMode ? 'rgba(168, 85, 247, 0.08)' : 'rgba(168, 85, 247, 0.05)')
                                : 'transparent',
                              transition: 'all 0.2s ease',
                              cursor: 'pointer'
                            }}
                            onClick={() => {
                              // Copy idea to clipboard or trigger launch flow
                              navigator.clipboard.writeText(`${idea.name} ($${idea.ticker}): ${idea.description}`);
                              alert(`Copied "${idea.name}" idea to clipboard!`);
                            }}
                          >
                            <div style={{ display: 'flex', gap: '12px' }}>
                              {/* Custom Launchr Pixel Art Avatar */}
                              <div style={{
                                width: '48px',
                                height: '48px',
                                borderRadius: '8px',
                                background: '#0a0a0a',
                                overflow: 'hidden',
                                flexShrink: 0,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                border: '2px solid rgba(168, 85, 247, 0.5)',
                                boxShadow: '0 4px 12px rgba(168, 85, 247, 0.3), inset 0 0 20px rgba(168, 85, 247, 0.1)'
                              }}>
                                <img
                                  src={generatePixelArt(idea.name + idea.ticker)}
                                  alt={idea.name}
                                  style={{ width: '48px', height: '48px', imageRendering: 'pixelated' }}
                                />
                              </div>

                              {/* Idea Info */}
                              <div style={{ flex: 1, minWidth: 0 }}>
                                <div style={{
                                  display: 'flex',
                                  alignItems: 'center',
                                  gap: '8px',
                                  marginBottom: '4px'
                                }}>
                                  <span style={{
                                    fontFamily: "'IBM Plex Mono', monospace",
                                    fontSize: '13px',
                                    fontWeight: 600,
                                    color: colors.text
                                  }}>
                                    {idea.name}
                                  </span>
                                  <span style={{
                                    fontFamily: "'IBM Plex Mono', monospace",
                                    fontSize: '10px',
                                    color: '#a855f7',
                                    fontWeight: 600
                                  }}>
                                    ${idea.ticker}
                                  </span>
                                  <span style={{
                                    padding: '2px 6px',
                                    background: 'rgba(168, 85, 247, 0.2)',
                                    border: '1px solid rgba(168, 85, 247, 0.3)',
                                    borderRadius: '4px',
                                    fontFamily: "'IBM Plex Mono', monospace",
                                    fontSize: '8px',
                                    color: '#a855f7',
                                    fontWeight: 600
                                  }}>
                                    {idea.category}
                                  </span>
                                </div>

                                <p style={{
                                  fontFamily: "'IBM Plex Mono', monospace",
                                  fontSize: '11px',
                                  color: colors.textMuted,
                                  margin: '0 0 6px 0',
                                  lineHeight: 1.4
                                }}>
                                  {idea.description}
                                </p>

                                <div style={{
                                  display: 'flex',
                                  alignItems: 'center',
                                  gap: '12px'
                                }}>
                                  <span style={{
                                    fontFamily: "'IBM Plex Mono', monospace",
                                    fontSize: '9px',
                                    color: colors.textMuted
                                  }}>
                                    {idea.reasoning}
                                  </span>
                                </div>
                              </div>

                              {/* Confidence Score */}
                              <div style={{
                                width: '40px',
                                height: '40px',
                                borderRadius: '50%',
                                border: `2px solid ${idea.confidence >= 80 ? colors.green : idea.confidence >= 70 ? colors.accent : '#666'}`,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                background: `${idea.confidence >= 80 ? colors.green : idea.confidence >= 70 ? colors.accent : '#666'}15`,
                                flexShrink: 0
                              }}>
                                <span style={{
                                  fontFamily: "'IBM Plex Mono', monospace",
                                  fontSize: '10px',
                                  fontWeight: 700,
                                  color: idea.confidence >= 80 ? colors.green : idea.confidence >= 70 ? colors.accent : '#666'
                                }}>
                                  {idea.confidence}
                                </span>
                              </div>
                            </div>
                          </div>
                        ))}

                        {aiIdeas.length === 0 && (
                          <div style={{
                            padding: '40px 20px',
                            textAlign: 'center',
                            color: colors.textMuted,
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '12px'
                          }}>
                            Click regenerate to get AI-powered coin ideas
                          </div>
                        )}
                      </>
                    )}
                  </div>
                ) : null}
              </div>
              )}

              {/* Footer */}
              <div style={{
                padding: '12px 20px',
                borderTop: `1px solid ${colors.border}`,
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }}>
                <span style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '9px',
                  color: colors.textMuted
                }}>
                  {lastUpdated ? `Updated ${new Date(lastUpdated).toLocaleTimeString()}` : '...'}
                </span>
                <a
                  href={activeTab === 'tokens' ? 'https://pump.fun' : activeTab === 'news' ? 'https://x.com/search?q=solana%20crypto' : '#'}
                  target="_blank"
                  rel="noopener noreferrer"
                  style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '9px',
                    color: activeTab === 'ideas' ? '#a855f7' : colors.accent,
                    textDecoration: 'none',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '4px'
                  }}
                >
                  {activeTab === 'tokens' ? 'PUMP.FUN' : activeTab === 'news' ? 'CRYPTO TWITTER' : 'AI POWERED'}
                  <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M7 17L17 7M17 7H7M17 7V17"/>
                  </svg>
                </a>
              </div>
            </div>
          );
        };

        // Config from server
        const SOLANA_RPC = window.LAUNCHR_CONFIG?.SOLANA_RPC || 'https://api.mainnet-beta.solana.com';

        // ═══════════════════════════════════════════════════════════════════
        // PUMP.FUN TOKEN CREATION - Real on-chain token launch
        // ═══════════════════════════════════════════════════════════════════

        // Upload token metadata to Pump.fun IPFS
        async function uploadCultureTokenMetadata(name, symbol, description, imageFile) {
            console.log('[CULTURE-DEPLOY] Uploading metadata for:', name, symbol);

            if (!imageFile) {
                throw new Error('Token icon is required for pump.fun upload');
            }

            const formData = new FormData();

            // Append the image file directly
            formData.append('file', imageFile, imageFile.name || 'culture-token.png');
            formData.append('name', name);
            formData.append('symbol', symbol);
            formData.append('description', description || `${name} - A Culture Coin on LAUNCHR`);
            formData.append('showName', 'true');

            console.log('[CULTURE-DEPLOY] Uploading to pump.fun IPFS via proxy...');

            // Use server proxy to avoid CORS issues
            const response = await fetch('/api/ipfs-upload', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                const errorText = await response.text();
                console.error('[CULTURE-DEPLOY] IPFS upload failed:', errorText);
                throw new Error('Failed to upload metadata to IPFS: ' + errorText);
            }

            const data = await response.json();
            console.log('[CULTURE-DEPLOY] Metadata uploaded:', data);

            return {
                metadataUri: data.metadataUri,
                metadata: { name, symbol, uri: data.metadataUri }
            };
        }

        // Create token via PumpPortal API
        async function createCultureTokenTransaction(walletAddress, mintKeypair, tokenMetadata, initialBuySOL = 0) {
            const { VersionedTransaction, Connection } = solanaWeb3;
            const connection = new Connection(SOLANA_RPC, 'confirmed');

            const requestBody = {
                publicKey: walletAddress,
                action: 'create',
                tokenMetadata: {
                    name: tokenMetadata.metadata.name,
                    symbol: tokenMetadata.metadata.symbol,
                    uri: tokenMetadata.metadataUri
                },
                mint: mintKeypair.publicKey.toBase58(),
                denominatedInSol: 'true',
                amount: initialBuySOL,
                slippage: 10,
                priorityFee: 0.0005,
                pool: 'pump'
            };

            console.log('[CULTURE-DEPLOY] Creating token via PumpPortal:', requestBody);

            const response = await fetch('https://pumpportal.fun/api/trade-local', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            if (response.status !== 200) {
                const errorText = await response.text();
                throw new Error(`PumpPortal API error: ${response.status} - ${errorText}`);
            }

            // PumpPortal returns raw binary transaction data
            const txBuffer = await response.arrayBuffer();
            console.log('[CULTURE-DEPLOY] Received transaction buffer, size:', txBuffer.byteLength);

            // Deserialize the versioned transaction
            const tx = VersionedTransaction.deserialize(new Uint8Array(txBuffer));
            console.log('[CULTURE-DEPLOY] Transaction deserialized successfully');

            return { transaction: tx, connection, mintKeypair };
        }

        // Sign and send culture token transaction
        // Follows exact same pattern as main launchpad.html
        async function signAndSendCultureToken(tx, connection, mintKeypair) {
            console.log('[CULTURE-DEPLOY] Signing transaction...');

            // Validate inputs
            if (!mintKeypair || !mintKeypair.publicKey || !mintKeypair.secretKey) {
                throw new Error('Invalid mint keypair');
            }
            console.log('[CULTURE-DEPLOY] Mint keypair public key:', mintKeypair.publicKey.toBase58());
            console.log('[CULTURE-DEPLOY] Mint keypair secret key length:', mintKeypair.secretKey.length);

            // Sign with the mint keypair (local signing for the token address)
            console.log('[CULTURE-DEPLOY] Using local mint keypair signing...');
            tx.sign([mintKeypair]);
            console.log('[CULTURE-DEPLOY] Transaction signed with mint keypair');

            // PRE-SIMULATE: Simulate transaction before showing to wallet
            // This helps Phantom understand the transaction and reduces warnings
            console.log('[CULTURE-DEPLOY] Pre-simulating transaction...');
            try {
                const simulation = await connection.simulateTransaction(tx, {
                    sigVerify: false, // Skip signature verification for simulation
                    replaceRecentBlockhash: true
                });
                if (simulation.value.err) {
                    console.warn('[CULTURE-DEPLOY] Simulation warning:', simulation.value.err);
                    // Don't throw - let the user try anyway, just log it
                } else {
                    console.log('[CULTURE-DEPLOY] Pre-simulation successful, units consumed:', simulation.value.unitsConsumed);
                }
            } catch (simErr) {
                console.warn('[CULTURE-DEPLOY] Pre-simulation failed (continuing anyway):', simErr.message);
            }

            let signature;

            // Try Phantom wallet first (same as main launchpad.html)
            if (window.solana?.isPhantom) {
                console.log('[CULTURE-DEPLOY] Using Phantom wallet for signing...');
                const signedTx = await window.solana.signTransaction(tx);
                signature = await connection.sendRawTransaction(signedTx.serialize(), {
                    skipPreflight: false,
                    preflightCommitment: 'confirmed',
                    maxRetries: 3
                });
            }
            // Try Solflare
            else if (window.solflare?.isSolflare) {
                console.log('[CULTURE-DEPLOY] Using Solflare wallet for signing...');
                const signedTx = await window.solflare.signTransaction(tx);
                signature = await connection.sendRawTransaction(signedTx.serialize(), {
                    skipPreflight: false,
                    preflightCommitment: 'confirmed',
                    maxRetries: 3
                });
            }
            else {
                throw new Error('No compatible wallet found. Please install Phantom or Solflare.');
            }

            console.log('[CULTURE-DEPLOY] Transaction sent, signature:', signature);

            // Wait for confirmation
            console.log('[CULTURE-DEPLOY] Waiting for confirmation...');
            const confirmation = await connection.confirmTransaction(signature, 'confirmed');

            if (confirmation.value.err) {
                throw new Error('Transaction failed: ' + JSON.stringify(confirmation.value.err));
            }

            console.log('[CULTURE-DEPLOY] Token created successfully!');
            return signature;
        }

        // Load user-created cultures from localStorage
        const getUserCultures = () => {
          try {
            return JSON.parse(localStorage.getItem('user_cultures') || '[]');
          } catch (e) {
            return [];
          }
        };

        const saveUserCulture = (culture) => {
          const existing = getUserCultures();
          existing.push(culture);
          localStorage.setItem('user_cultures', JSON.stringify(existing));
          return culture;
        };

        // Sample data + user created
        const BASE_CULTURES = [
          {
            id: 1,
            name: "Quiet Capital",
            ticker: "QUIET",
            ethos: "Long-term thinkers. Patient deployers. No noise.",
            category: "Trading & Markets",
            creator: "0x7a3...f291",
            creatorName: "Silent Operator",
            supply: 1000000,
            burned: 127340,
            pillars: [
              "Patience over performance theater",
              "Conviction requires silence",
              "Signal is inverse to volume",
              "Decades, not quarters"
            ],
            tiers: [
              { name: "Observer", percent: 0.1, access: "Read-only feed access", expectation: "Learn quietly" },
              { name: "Participant", percent: 0.5, access: "Bidding rights, weekly threads", expectation: "Contribute signal monthly" },
              { name: "Insider", percent: 1.5, access: "Live sessions, early drops", expectation: "Active participation" },
              { name: "Steward", percent: 5, access: "Direct access, culture shaping", expectation: "Guide new members" }
            ],
            avgHoldDays: 127,
            participationRate: 73,
            holders: 1247,
            activeAuctions: 2
          },
          {
            id: 2,
            name: "Form & Function",
            ticker: "FORM",
            ethos: "Taste is a muscle. Train it daily.",
            category: "Taste & Curation",
            creator: "0x3b1...e892",
            creatorName: "Curator Zero",
            supply: 500000,
            burned: 43200,
            pillars: [
              "Less, but better",
              "Context over content",
              "Edit ruthlessly",
              "Beauty is not optional"
            ],
            tiers: [
              { name: "Observer", percent: 0.2, access: "Weekly curation drops", expectation: "None" },
              { name: "Participant", percent: 1, access: "Submit for review", expectation: "One submission monthly" },
              { name: "Insider", percent: 3, access: "Private collection access", expectation: "Provide feedback" },
              { name: "Steward", percent: 8, access: "Co-curation rights", expectation: "Active curation" }
            ],
            avgHoldDays: 89,
            participationRate: 61,
            holders: 834,
            activeAuctions: 1
          },
          {
            id: 3,
            name: "Iron Protocol",
            ticker: "IRON",
            ethos: "Discipline is freedom. The body keeps score.",
            category: "Fitness & Performance",
            creator: "0x9c4...a123",
            creatorName: "Protocol One",
            supply: 2000000,
            burned: 289000,
            pillars: [
              "Show up before you feel ready",
              "Progressive overload in all things",
              "Recovery is not optional",
              "Numbers don't lie"
            ],
            tiers: [
              { name: "Observer", percent: 0.05, access: "Public programming", expectation: "None" },
              { name: "Participant", percent: 0.25, access: "Full program library", expectation: "Log workouts" },
              { name: "Insider", percent: 1, access: "Form checks, live Q&A", expectation: "Weekly check-ins" },
              { name: "Steward", percent: 3, access: "1:1 programming", expectation: "Mentor newcomers" }
            ],
            avgHoldDays: 201,
            participationRate: 84,
            holders: 2103,
            activeAuctions: 3
          },
          {
            id: 4,
            name: "First Principles",
            ticker: "FIRST",
            ethos: "Think from zero. Build from truth.",
            category: "Mindset & Philosophy",
            creator: "0x2e8...b445",
            creatorName: "Zero Base",
            supply: 750000,
            burned: 67800,
            pillars: [
              "Question the question",
              "Complexity is debt",
              "Mental models compound",
              "Write to think"
            ],
            tiers: [
              { name: "Observer", percent: 0.1, access: "Essay archive", expectation: "None" },
              { name: "Participant", percent: 0.4, access: "Discussion threads", expectation: "One comment weekly" },
              { name: "Insider", percent: 1.2, access: "Draft reviews, AMAs", expectation: "Share frameworks" },
              { name: "Steward", percent: 4, access: "Co-authorship", expectation: "Original contributions" }
            ],
            avgHoldDays: 156,
            participationRate: 68,
            holders: 967,
            activeAuctions: 1
          },
          {
            id: 5,
            name: "Local Maximum",
            ticker: "LOCAL",
            ethos: "Your city. Your people. Your spots.",
            category: "Local & IRL",
            creator: "0x5f2...c789",
            creatorName: "City Scout",
            supply: 300000,
            burned: 18900,
            pillars: [
              "The best things aren't online",
              "Regulars over tourists",
              "Support the neighborhood",
              "Show up in person"
            ],
            tiers: [
              { name: "Observer", percent: 0.15, access: "City guide access", expectation: "None" },
              { name: "Participant", percent: 0.6, access: "Event invites", expectation: "Attend quarterly" },
              { name: "Insider", percent: 2, access: "Private dinners", expectation: "Host one event yearly" },
              { name: "Steward", percent: 6, access: "Location partnerships", expectation: "Active community building" }
            ],
            avgHoldDays: 112,
            participationRate: 79,
            holders: 523,
            activeAuctions: 0
          },
          {
            id: 6,
            name: "Ship Daily",
            ticker: "SHIP",
            ethos: "Momentum over perfection. Build in public.",
            category: "Operator",
            creator: "0x1a7...d234",
            creatorName: "Builder Prime",
            supply: 1500000,
            burned: 198400,
            pillars: [
              "Done beats perfect",
              "Feedback is fuel",
              "Compound in public",
              "Constraints create"
            ],
            tiers: [
              { name: "Observer", percent: 0.08, access: "Build logs", expectation: "None" },
              { name: "Participant", percent: 0.35, access: "Beta access, feedback loops", expectation: "Test and report" },
              { name: "Insider", percent: 1.5, access: "Architecture reviews", expectation: "Ship weekly" },
              { name: "Steward", percent: 4.5, access: "Co-build opportunities", expectation: "Mentor builders" }
            ],
            avgHoldDays: 94,
            participationRate: 91,
            holders: 1876,
            activeAuctions: 4
          }
        ];

        // Combine base cultures with user-created ones
        const CULTURES = [...BASE_CULTURES, ...getUserCultures()];

        const CATEGORIES = [
          { id: 'all', name: 'All Cultures', description: 'Browse all cultures' },
          { id: 'meme', name: 'Meme', description: 'Meme coins and communities' },
          { id: 'ai', name: 'AI', description: 'Artificial intelligence projects' },
          { id: 'utility', name: 'Utility', description: 'Utility-focused tokens' },
          { id: 'finance', name: 'Finance', description: 'DeFi and financial projects' },
          { id: 'accounting', name: 'Accounting', description: 'Accounting and bookkeeping' },
          { id: 'tech', name: 'Tech', description: 'Technology and software' },
          { id: 'fitness', name: 'Fitness', description: 'Fitness and training' },
          { id: 'wellness', name: 'Health & Wellness', description: 'Health and wellness' },
          { id: 'data', name: 'Data', description: 'Data and analytics' },
          { id: 'fashion', name: 'Fashion', description: 'Fashion and style' },
          { id: 'music', name: 'Music', description: 'Music and audio' },
          { id: 'art', name: 'Art', description: 'Art and creativity' },
          { id: 'travel', name: 'Travel', description: 'Travel and exploration' },
          { id: 'gaming', name: 'Gaming', description: 'Gaming communities' },
          { id: 'social', name: 'Social', description: 'Social platforms' },
          { id: 'law', name: 'Law', description: 'Legal and compliance' },
          { id: 'environmental', name: 'Environmental', description: 'Environmental causes' },
          { id: 'education', name: 'Education', description: 'Learning and education' },
          { id: 'political', name: 'Political', description: 'Political movements' },
          { id: 'sports', name: 'Sports', description: 'Sports and athletics' },
          { id: 'food', name: 'Food & Drink', description: 'Food and beverage' },
          { id: 'other', name: 'Other', description: 'Other categories' }
        ];

        const AUCTIONS = [
          {
            id: 1,
            cultureId: 1,
            cultureName: "Quiet Capital",
            title: "The Case for Doing Nothing",
            description: "A framework for strategic patience in volatile markets. When inaction is the highest-conviction trade.",
            type: "Essay",
            minBid: 500,
            currentBid: 2340,
            bidCount: 12,
            endsIn: "2h 14m",
            burnOrReturn: "burn",
            bidder: "0x8f2...a901"
          },
          {
            id: 2,
            cultureId: 1,
            cultureName: "Quiet Capital",
            title: "Q1 Thesis Review - Live Session",
            description: "90-minute breakdown of positions, mistakes, and recalibrations. Unfiltered.",
            type: "Live Session",
            minBid: 1000,
            currentBid: 4120,
            bidCount: 8,
            endsIn: "6h 42m",
            burnOrReturn: "treasury",
            bidder: "0x3c1...b234"
          },
          {
            id: 3,
            cultureId: 3,
            cultureName: "Iron Protocol",
            title: "12-Week Hypertrophy Block",
            description: "Complete programming with progression schemes, deload protocols, and nutrition timing.",
            type: "Program",
            minBid: 250,
            currentBid: 890,
            bidCount: 23,
            endsIn: "18h 03m",
            burnOrReturn: "burn",
            bidder: "0x7e4...c567"
          }
        ];

        // Navigation Component
        const Navigation = ({ view, setView }) => (
          <nav style={{
            position: 'fixed',
            top: '36px',
            left: 0,
            right: 0,
            height: '60px',
            background: '#0a0a0a',
            borderBottom: '1px solid #1a1a1a',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'space-between',
            padding: '0 40px',
            zIndex: 1000,
            fontFamily: "'IBM Plex Mono', monospace"
          }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '32px' }}>
              <a href="/" style={{
                fontSize: '14px',
                fontWeight: 600,
                letterSpacing: '0.15em',
                color: '#fff',
                textDecoration: 'none',
                display: 'flex',
                alignItems: 'center',
                gap: '12px'
              }}>
                <img src="/website/logo-icon.jpg" alt="LAUNCHR" style={{ height: '28px', width: '28px' }} />
                CULTURE COINS
              </a>
              <div style={{ display: 'flex', gap: '24px' }}>
                {['discover', 'feed', 'create', 'auctions', 'dashboard'].map(v => (
                  <button
                    key={v}
                    onClick={() => setView(v)}
                    style={{
                      background: 'none',
                      border: 'none',
                      color: view === v ? '#fff' : '#666',
                      fontSize: '11px',
                      letterSpacing: '0.1em',
                      textTransform: 'uppercase',
                      cursor: 'pointer',
                      padding: '4px 0',
                      borderBottom: view === v ? '1px solid #fff' : '1px solid transparent',
                      transition: 'all 0.2s',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}
                  >
                    {v}
                  </button>
                ))}
              </div>
            </div>
            <WalletButton />
          </nav>
        );

        // Wallet Button Component
        const WalletButton = () => {
          const wallet = useContext(WalletContext);
          console.log('[WALLET-BTN] wallet context:', wallet ? 'present' : 'null', 'connect:', typeof wallet?.connect);

          if (wallet?.address) {
            return (
              <button
                onClick={wallet.showModal}
                style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '10px',
                  padding: '10px 16px',
                  background: '#111',
                  border: '1px solid #333',
                  color: '#fff',
                  fontSize: '12px',
                  fontFamily: "'IBM Plex Mono', monospace",
                  cursor: 'pointer'
                }}
              >
                <div style={{ width: '8px', height: '8px', borderRadius: '50%', background: '#8b5cf6' }} />
                {wallet.address.slice(0,4)}...{wallet.address.slice(-4)}
              </button>
            );
          }

          return (
            <button
              onClick={wallet?.connect}
              style={{
                padding: '10px 20px',
                background: '#fff',
                border: 'none',
                color: '#000',
                fontSize: '11px',
                fontFamily: "'IBM Plex Mono', monospace",
                letterSpacing: '0.1em',
                cursor: 'pointer',
                fontWeight: 600
              }}
            >
              CONNECT
            </button>
          );
        };

        // Discovery View
        const DiscoveryView = ({ onSelectCulture }) => {
          const [selectedCategory, setSelectedCategory] = useState(null);
          const [cultures, setCultures] = useState(CULTURES);
          const [loading, setLoading] = useState(true);
          const [searchQuery, setSearchQuery] = useState('');
          const [trendingCollapsed, setTrendingCollapsed] = useState(window.innerWidth < 768);
          const [isMobile, setIsMobile] = useState(window.innerWidth < 768);

          // Handle window resize for mobile detection
          useEffect(() => {
            const handleResize = () => {
              const mobile = window.innerWidth < 768;
              setIsMobile(mobile);
              if (mobile && !trendingCollapsed) setTrendingCollapsed(true);
            };
            window.addEventListener('resize', handleResize);
            return () => window.removeEventListener('resize', handleResize);
          }, []);

          // Light/Dark Mode State (synced with localStorage)
          const [lightMode, setLightMode] = useState(() => {
            try { return JSON.parse(localStorage.getItem('lightMode') || 'false'); }
            catch { return false; }
          });

          // Colors based on light/dark mode
          const colors = lightMode ? {
            bg: '#fafafa',
            cardBg: '#ffffff',
            border: '#e5e5e5',
            text: '#171717',
            textSecondary: '#404040',
            textMuted: '#737373',
            accent: '#8b5cf6',
            inputBg: '#ffffff',
            inputBorder: '#d4d4d4'
          } : {
            bg: '#0a0a0a',
            cardBg: '#0f0f0f',
            border: '#1a1a1a',
            text: '#ffffff',
            textSecondary: '#a0a0a0',
            textMuted: '#666666',
            accent: '#8b5cf6',
            inputBg: '#111111',
            inputBorder: '#333333'
          };

          // Fetch cultures from API on mount and enrich with live pump.fun data
          useEffect(() => {
            const fetchCultures = async () => {
              try {
                const res = await fetch('/api/cultures');
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();
                if (data.success && data.cultures) {
                  // Merge API cultures with base cultures (API cultures take priority)
                  const apiCultureIds = new Set(data.cultures.map(c => c.id));
                  const baseCulturesFiltered = BASE_CULTURES.filter(c => !apiCultureIds.has(c.id));
                  const allCultures = [...data.cultures, ...baseCulturesFiltered];

                  // Enrich with REAL blockchain data via Helius DAS + DexScreener
                  const enriched = await Promise.all(allCultures.map(async (culture) => {
                    if (!culture.tokenAddress) return culture;
                    try {
                      // Use /api/token endpoint (Helius DAS + DexScreener + pump.fun combined)
                      const tokenRes = await fetch(`/api/token/${culture.tokenAddress}`);
                      if (tokenRes.ok) {
                        const tokenData = await tokenRes.json();
                        if (tokenData) {
                          return {
                            ...culture,
                            marketCap: tokenData.marketCap || 0,
                            volume: tokenData.volume || 0,
                            holders: tokenData.holders || 1,
                            price: tokenData.price || 0,
                            liquidity: tokenData.liquidity || 0,
                            priceChange24h: tokenData.priceChange24h || 0
                          };
                        }
                      }
                    } catch (e) {
                      console.error('[DISCOVER] Failed to enrich', culture.name, e);
                    }
                    return culture;
                  }));

                  setCultures(enriched);
                }
              } catch (e) {
                console.error('[DISCOVER] Failed to fetch cultures:', e);
              } finally {
                setLoading(false);
              }
            };
            fetchCultures();
          }, []);

          // Filter by category and search query (name, ticker, or contract address)
          const filteredCultures = cultures.filter(c => {
            const matchesCategory = !selectedCategory || c.category === selectedCategory;
            if (!searchQuery.trim()) return matchesCategory;

            const query = searchQuery.toLowerCase().trim();
            const matchesSearch =
              (c.name && c.name.toLowerCase().includes(query)) ||
              (c.ticker && c.ticker.toLowerCase().includes(query)) ||
              (c.symbol && c.symbol.toLowerCase().includes(query)) ||
              (c.tokenAddress && c.tokenAddress.toLowerCase().includes(query));

            return matchesCategory && matchesSearch;
          });

          return (
            <div style={{
              padding: '136px 40px 60px',
              background: colors.bg,
              minHeight: '100vh',
              transition: 'all 0.3s ease'
            }}>
              {/* Light/Dark Mode Toggle - Fixed Position */}
              <button
                onClick={() => {
                  const newMode = !lightMode;
                  setLightMode(newMode);
                  localStorage.setItem('lightMode', JSON.stringify(newMode));
                }}
                style={{
                  position: 'fixed',
                  top: '100px',
                  right: '40px',
                  zIndex: 100,
                  width: '44px',
                  height: '44px',
                  borderRadius: '50%',
                  background: lightMode ? '#1a1a1a' : '#ffffff',
                  border: 'none',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  boxShadow: '0 2px 10px rgba(0,0,0,0.2)',
                  transition: 'all 0.3s'
                }}
                title={lightMode ? 'Switch to Dark Mode' : 'Switch to Light Mode'}
              >
                {lightMode ? (
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="#fff" stroke="none">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                  </svg>
                ) : (
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#000" strokeWidth="2">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                  </svg>
                )}
              </button>

              {/* ═══════════════════════════════════════════════════════════════════
                  HERO SECTION - Fortune 500 Level Design
                  ═══════════════════════════════════════════════════════════════════ */}
              <div style={{
                marginBottom: '48px',
                position: 'relative'
              }}>
                {/* Gradient accent line */}
                <div style={{
                  position: 'absolute',
                  top: '-20px',
                  left: 0,
                  width: '120px',
                  height: '4px',
                  background: '#8b5cf6',
                  borderRadius: '2px'
                }} />

                <div style={{
                  display: 'flex',
                  alignItems: 'flex-end',
                  justifyContent: 'space-between',
                  flexWrap: 'wrap',
                  gap: '24px',
                  flexDirection: isMobile ? 'column' : 'row',
                  alignItems: isMobile ? 'stretch' : 'flex-end'
                }}>
                  <div>
                    <div style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '10px',
                      letterSpacing: '0.2em',
                      color: '#8b5cf6',
                      marginBottom: '12px',
                      fontWeight: 600
                    }}>
                      CULTURE COINS
                    </div>
                    <h1 style={{
                      fontFamily: "'Playfair Display', serif",
                      fontSize: isMobile ? '36px' : '56px',
                      fontWeight: 400,
                      color: colors.text,
                      marginBottom: '16px',
                      letterSpacing: '-0.02em',
                      lineHeight: 1.1
                    }}>
                      The Cultural
                      <br />
                      <span style={{
                        background: 'linear-gradient(90deg, #8b5cf6, #06b6d4)',
                        WebkitBackgroundClip: 'text',
                        WebkitTextFillColor: 'transparent',
                        backgroundClip: 'text'
                      }}>Zeitgeist</span>
                    </h1>
                    <p style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: isMobile ? '12px' : '14px',
                      color: colors.textMuted,
                      maxWidth: '500px',
                      lineHeight: 1.8
                    }}>
                      Culture Coins are not traded for profit. They are held to participate,
                      signal belief, and shape a way of life.
                    </p>
                  </div>

                  {/* Quick Stats - Real Data Only */}
                  <div style={{
                    display: 'flex',
                    gap: isMobile ? '16px' : '32px',
                    padding: isMobile ? '16px 20px' : '24px 32px',
                    background: colors.cardBg,
                    border: `1px solid ${colors.border}`,
                    justifyContent: isMobile ? 'space-around' : 'flex-start',
                    width: isMobile ? '100%' : 'auto'
                  }}>
                    <div style={{ textAlign: 'center' }}>
                      <div style={{
                        fontFamily: "'Playfair Display', serif",
                        fontSize: '32px',
                        color: '#8b5cf6',
                        marginBottom: '4px'
                      }}>
                        {filteredCultures.length}
                      </div>
                      <div style={{
                        fontSize: '9px',
                        letterSpacing: '0.1em',
                        color: colors.textMuted,
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        CULTURES
                      </div>
                    </div>
                    <div style={{
                      width: '1px',
                      background: colors.border
                    }} />
                    <div style={{ textAlign: 'center' }}>
                      <div style={{
                        fontFamily: "'Playfair Display', serif",
                        fontSize: '28px',
                        color: colors.text,
                        marginBottom: '4px'
                      }}>
                        BETA
                      </div>
                      <div style={{
                        fontSize: '9px',
                        letterSpacing: '0.1em',
                        color: colors.textMuted,
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        VERSION
                      </div>
                    </div>
                    <div style={{
                      width: '1px',
                      background: colors.border
                    }} />
                    <div style={{ textAlign: 'center' }}>
                      <div style={{
                        fontFamily: "'Playfair Display', serif",
                        fontSize: '32px',
                        color: '#22c55e',
                        marginBottom: '4px'
                      }}>
                        LIVE
                      </div>
                      <div style={{
                        fontSize: '9px',
                        letterSpacing: '0.1em',
                        color: colors.textMuted,
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        STATUS
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* ═══════════════════════════════════════════════════════════════════
                  TWO COLUMN LAYOUT - Trending X Feed + Culture Discovery
                  ═══════════════════════════════════════════════════════════════════ */}
              <div style={{
                display: 'grid',
                gridTemplateColumns: isMobile ? '1fr' : (trendingCollapsed ? '60px 1fr' : '380px 1fr'),
                gap: isMobile ? '16px' : '32px',
                alignItems: 'start',
                transition: 'grid-template-columns 0.3s ease'
              }}>

                {/* LEFT COLUMN - Trending X Feed (Collapsible) */}
                <div style={{
                  position: isMobile ? 'relative' : 'sticky',
                  top: isMobile ? 'auto' : '136px',
                  height: isMobile ? 'auto' : (trendingCollapsed ? 'auto' : 'calc(100vh - 180px)'),
                  minHeight: trendingCollapsed ? 'auto' : (isMobile ? 'auto' : '600px'),
                  transition: 'all 0.3s ease'
                }}>
                  {/* Collapse/Expand Button - Elegant Coral/Gold */}
                  <button
                    onClick={() => setTrendingCollapsed(!trendingCollapsed)}
                    style={{
                      position: trendingCollapsed ? 'relative' : 'absolute',
                      top: trendingCollapsed ? '0' : '8px',
                      right: trendingCollapsed ? 'auto' : '8px',
                      zIndex: 10,
                      width: trendingCollapsed ? '100%' : '32px',
                      minWidth: trendingCollapsed ? '140px' : '32px',
                      height: trendingCollapsed ? '50px' : '32px',
                      background: trendingCollapsed ? '#8b5cf6' : 'rgba(139, 92, 246, 0.2)',
                      border: trendingCollapsed ? 'none' : '1px solid rgba(139, 92, 246, 0.3)',
                      borderRadius: trendingCollapsed ? '8px' : '50%',
                      cursor: 'pointer',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '10px',
                      padding: trendingCollapsed ? '0 20px' : '0',
                      color: trendingCollapsed ? '#000' : '#8b5cf6',
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '11px',
                      fontWeight: 700,
                      letterSpacing: '0.12em'
                    }}
                  >
                    {trendingCollapsed ? (
                      <>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                          <path d="M9 18l6-6-6-6"/>
                        </svg>
                        TRENDING
                      </>
                    ) : (
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <path d="M15 18l-6-6 6-6"/>
                      </svg>
                    )}
                  </button>

                  {/* Trending Panel - Hidden when collapsed */}
                  {!trendingCollapsed && (
                    <TrendingXFeed lightMode={lightMode} />
                  )}
                </div>

                {/* RIGHT COLUMN - Culture Discovery */}
                <div>
                  {/* Search Bar - Premium Design */}
                  <div style={{ marginBottom: '24px' }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      background: colors.cardBg,
                      border: `1px solid ${colors.border}`,
                      padding: '0 20px',
                      transition: 'all 0.2s',
                      position: 'relative',
                      overflow: 'hidden'
                    }}>
                      {/* Animated gradient on focus */}
                      <div style={{
                        position: 'absolute',
                        bottom: 0,
                        left: 0,
                        right: 0,
                        height: '2px',
                        background: '#8b5cf6',
                        transform: searchQuery ? 'scaleX(1)' : 'scaleX(0)',
                        transformOrigin: 'left',
                        transition: 'transform 0.3s ease'
                      }} />
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke={colors.textMuted} strokeWidth="2" style={{ marginRight: '12px' }}>
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                      </svg>
                      <input
                        type="text"
                        placeholder="Search cultures by name, ticker, or contract..."
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        style={{
                          flex: 1,
                          padding: '16px 0',
                          background: 'transparent',
                          border: 'none',
                          outline: 'none',
                          color: colors.text,
                          fontSize: '14px',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}
                      />
                      {searchQuery && (
                        <button
                          onClick={() => setSearchQuery('')}
                          style={{
                            background: colors.border,
                            border: 'none',
                            color: colors.text,
                            cursor: 'pointer',
                            fontSize: '12px',
                            padding: '6px 12px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            borderRadius: '4px'
                          }}
                        >
                          CLEAR
                        </button>
                      )}
                    </div>
                  </div>

                  {/* Categories - Horizontal Scroll */}
                  <div style={{ marginBottom: '32px' }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      marginBottom: '16px'
                    }}>
                      <div style={{
                        fontSize: '10px',
                        letterSpacing: '0.15em',
                        color: colors.textMuted,
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        FILTER BY CATEGORY
                      </div>
                      {selectedCategory && (
                        <button
                          onClick={() => setSelectedCategory(null)}
                          style={{
                            background: 'transparent',
                            border: 'none',
                            color: '#8b5cf6',
                            cursor: 'pointer',
                            fontSize: '10px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            letterSpacing: '0.05em'
                          }}
                        >
                          CLEAR FILTER
                        </button>
                      )}
                    </div>
                    <div style={{
                      display: 'flex',
                      flexWrap: isMobile ? 'nowrap' : 'wrap',
                      gap: '8px',
                      overflowX: isMobile ? 'auto' : 'visible',
                      paddingBottom: isMobile ? '8px' : '0',
                      WebkitOverflowScrolling: 'touch'
                    }}>
                      {CATEGORIES.map(cat => {
                        const isActive = (cat.id === 'all' && !selectedCategory) || selectedCategory === cat.id;
                        return (
                          <button
                            key={cat.id}
                            onClick={() => setSelectedCategory(cat.id === 'all' ? null : cat.id)}
                            style={{
                              padding: isMobile ? '8px 14px' : '10px 18px',
                              flexShrink: 0,
                              background: isActive
                                ? 'linear-gradient(135deg, #8b5cf6, #06b6d4)'
                                : 'transparent',
                              color: isActive ? '#000' : colors.textSecondary,
                              border: '1px solid',
                              borderColor: isActive ? 'transparent' : colors.border,
                              fontSize: '11px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              letterSpacing: '0.05em',
                              cursor: 'pointer',
                              transition: 'all 0.2s',
                              fontWeight: isActive ? 600 : 400
                            }}
                          >
                            {cat.name}
                          </button>
                        );
                      })}
                    </div>
                  </div>

                  {/* Section Header */}
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    marginBottom: '24px',
                    paddingBottom: '16px',
                    borderBottom: `1px solid ${colors.border}`
                  }}>
                    <div>
                      <h2 style={{
                        fontFamily: "'Playfair Display', serif",
                        fontSize: '24px',
                        color: colors.text,
                        marginBottom: '4px'
                      }}>
                        {selectedCategory || 'All Cultures'}
                      </h2>
                      <span style={{
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '12px',
                        color: colors.textMuted
                      }}>
                        {filteredCultures.length} {filteredCultures.length === 1 ? 'culture' : 'cultures'} found
                      </span>
                    </div>
                    <div style={{
                      display: 'flex',
                      gap: '8px'
                    }}>
                      <button style={{
                        padding: '8px 16px',
                        background: colors.cardBg,
                        border: `1px solid ${colors.border}`,
                        color: colors.textSecondary,
                        fontSize: '10px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.05em',
                        cursor: 'pointer'
                      }}>
                        NEWEST
                      </button>
                      <button style={{
                        padding: '8px 16px',
                        background: 'transparent',
                        border: `1px solid ${colors.border}`,
                        color: colors.textMuted,
                        fontSize: '10px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.05em',
                        cursor: 'pointer'
                      }}>
                        TOP
                      </button>
                    </div>
                  </div>

                  {/* Culture Grid */}
                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: isMobile ? '1fr' : 'repeat(auto-fill, minmax(320px, 1fr))',
                    gap: isMobile ? '16px' : '20px'
                  }}>
                    {filteredCultures.map((culture, index) => {
                      // Vibrant accent colors like the reference design
                      const accentColors = ['#06b6d4', '#4ECDC4', '#FF6B9D', '#FFD93D', '#6BCB77', '#9B59B6'];
                      const accentColor = accentColors[index % accentColors.length];

                      return (
                      <div
                        key={culture.id}
                        onClick={() => onSelectCulture(culture)}
                        style={{
                          background: colors.cardBg,
                          border: `1px solid ${colors.border}`,
                          borderTop: `4px solid ${accentColor}`,
                          padding: '24px',
                          paddingTop: '20px',
                          cursor: 'pointer',
                          transition: 'all 0.3s',
                          position: 'relative',
                          overflow: 'hidden'
                        }}
                        onMouseEnter={e => {
                          e.currentTarget.style.transform = 'translateY(-4px)';
                          e.currentTarget.style.boxShadow = `0 12px 32px rgba(0,0,0,0.3)`;
                        }}
                        onMouseLeave={e => {
                          e.currentTarget.style.transform = 'translateY(0)';
                          e.currentTarget.style.boxShadow = 'none';
                        }}
                      >
                        {/* Card Number Badge */}
                        {index < 3 && (
                          <div style={{
                            position: 'absolute',
                            top: '-4px',
                            left: '0',
                            background: accentColor,
                            color: '#000',
                            padding: '8px 12px',
                            fontSize: '14px',
                            fontWeight: 700,
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            {index + 1}
                          </div>
                        )}

                        {/* Category Tag + LIVE Badge */}
                        <div style={{
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'space-between',
                          marginBottom: '12px',
                          marginTop: index < 3 ? '24px' : '0'
                        }}>
                          <div style={{
                            fontSize: '9px',
                            letterSpacing: '0.12em',
                            color: accentColor,
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontWeight: 700,
                            textTransform: 'uppercase'
                          }}>
                            {culture.category?.toUpperCase() || 'CULTURE'}
                          </div>
                          {culture.activeAuctions > 0 && (
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '5px',
                              padding: '3px 8px',
                              background: `${accentColor}20`,
                              borderRadius: '10px'
                            }}>
                              <div style={{
                                width: '6px',
                                height: '6px',
                                borderRadius: '50%',
                                background: accentColor,
                                animation: 'pulse 2s infinite'
                              }} />
                              <span style={{
                                fontSize: '9px',
                                color: accentColor,
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontWeight: 600
                              }}>
                                {culture.activeAuctions} LIVE
                              </span>
                            </div>
                          )}
                        </div>

                        {/* Name & Ticker */}
                        <h3 style={{
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '24px',
                          fontWeight: 500,
                          color: colors.text,
                          marginBottom: '6px'
                        }}>
                          {culture.name}
                        </h3>
                        {culture.ticker && (
                          <div style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '11px',
                            color: colors.textMuted,
                            marginBottom: '12px',
                            letterSpacing: '0.05em'
                          }}>
                            ${culture.ticker}
                          </div>
                        )}

                        {/* Ethos */}
                        <p style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '13px',
                          color: colors.textSecondary,
                          lineHeight: 1.7,
                          marginBottom: '20px',
                          fontStyle: 'italic'
                        }}>
                          "{culture.ethos}"
                        </p>

                        {/* Core Pillar Preview - Vibrant Style */}
                        {culture.pillars && culture.pillars.length > 0 && (
                          <div style={{
                            background: `${accentColor}15`,
                            padding: '14px',
                            marginBottom: '16px'
                          }}>
                            <div style={{
                              fontSize: '8px',
                              color: accentColor,
                              letterSpacing: '0.12em',
                              marginBottom: '8px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontWeight: 700
                            }}>
                              CORE BELIEF
                            </div>
                            <div style={{
                              fontSize: '12px',
                              color: '#fff',
                              fontFamily: "'IBM Plex Mono', monospace",
                              lineHeight: 1.5
                            }}>
                              "{culture.pillars[0]}"
                            </div>
                          </div>
                        )}

                        {/* Stats Grid - Clean */}
                        <div style={{
                          display: 'grid',
                          gridTemplateColumns: 'repeat(3, 1fr)',
                          gap: '12px',
                          borderTop: `1px solid ${colors.border}`,
                          paddingTop: '16px'
                        }}>
                          <div>
                            <div style={{
                              fontSize: '16px',
                              color: '#fff',
                              fontFamily: "'IBM Plex Mono', monospace",
                              marginBottom: '4px',
                              fontWeight: 600
                            }}>
                              {culture.marketCap
                                ? (culture.marketCap >= 1000000
                                    ? `$${(culture.marketCap / 1000000).toFixed(1)}M`
                                    : culture.marketCap >= 1000
                                      ? `$${(culture.marketCap / 1000).toFixed(1)}K`
                                      : `$${culture.marketCap.toFixed(0)}`)
                                : '—'}
                            </div>
                            <div style={{ fontSize: '8px', color: '#666', letterSpacing: '0.1em', fontFamily: "'IBM Plex Mono', monospace" }}>
                              MCAP
                            </div>
                          </div>
                          <div>
                            <div style={{
                              fontSize: '16px',
                              color: '#fff',
                              fontFamily: "'IBM Plex Mono', monospace",
                              marginBottom: '4px',
                              fontWeight: 600
                            }}>
                              {culture.volume
                                ? (culture.volume >= 1000000
                                    ? `$${(culture.volume / 1000000).toFixed(1)}M`
                                    : culture.volume >= 1000
                                      ? `$${(culture.volume / 1000).toFixed(1)}K`
                                      : `$${culture.volume.toFixed(0)}`)
                                : '—'}
                            </div>
                            <div style={{ fontSize: '8px', color: '#666', letterSpacing: '0.1em', fontFamily: "'IBM Plex Mono', monospace" }}>
                              VOLUME
                            </div>
                          </div>
                          <div>
                            <div style={{
                              fontSize: '16px',
                              color: accentColor,
                              fontFamily: "'IBM Plex Mono', monospace",
                              marginBottom: '4px',
                              fontWeight: 700
                            }}>
                              {(culture.holders || 0).toLocaleString()}
                            </div>
                            <div style={{ fontSize: '8px', color: '#666', letterSpacing: '0.1em', fontFamily: "'IBM Plex Mono', monospace" }}>
                              HOLDERS
                            </div>
                          </div>
                        </div>

                        {/* Bottom accent bar */}
                        <div style={{
                          position: 'absolute',
                          bottom: 0,
                          left: 0,
                          right: 0,
                          height: '3px',
                          background: accentColor,
                          opacity: 0.5
                        }} />
                      </div>
                    )})}
                  </div>

                  {/* Empty State */}
                  {filteredCultures.length === 0 && (
                    <div style={{
                      textAlign: 'center',
                      padding: '80px 40px',
                      background: colors.cardBg,
                      border: `1px solid ${colors.border}`
                    }}>
                      <div style={{
                        width: '64px',
                        height: '64px',
                        borderRadius: '50%',
                        background: colors.border,
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        margin: '0 auto 24px'
                      }}>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke={colors.textMuted} strokeWidth="2">
                          <circle cx="11" cy="11" r="8"/>
                          <path d="M21 21l-4.35-4.35"/>
                        </svg>
                      </div>
                      <h3 style={{
                        fontFamily: "'Playfair Display', serif",
                        fontSize: '24px',
                        color: colors.text,
                        marginBottom: '12px'
                      }}>
                        No cultures found
                      </h3>
                      <p style={{
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '13px',
                        color: colors.textMuted,
                        maxWidth: '400px',
                        margin: '0 auto'
                      }}>
                        Try adjusting your search or category filter to discover more cultures.
                      </p>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        };

        // Auction Card Component
        const AuctionCard = ({ auction, compact = false }) => {
          const [bidAmount, setBidAmount] = useState('');
          const [showBidInput, setShowBidInput] = useState(false);

          return (
            <div style={{
              background: '#0f0f0f',
              border: '1px solid #1a1a1a',
              padding: compact ? '24px' : '32px'
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '16px' }}>
                <div>
                  <div style={{
                    fontSize: '9px',
                    letterSpacing: '0.15em',
                    color: '#666',
                    marginBottom: '8px',
                    fontFamily: "'IBM Plex Mono', monospace"
                  }}>
                    {auction.type.toUpperCase()} - {auction.cultureName}
                  </div>
                  <h3 style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: compact ? '18px' : '22px',
                    color: '#fff',
                    marginBottom: '8px'
                  }}>
                    {auction.title}
                  </h3>
                </div>
                <div style={{
                  background: '#1a1a1a',
                  padding: '8px 12px',
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '11px',
                  color: '#fff'
                }}>
                  {auction.endsIn}
                </div>
              </div>

              {!compact && (
                <p style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#888',
                  lineHeight: 1.6,
                  marginBottom: '24px'
                }}>
                  {auction.description}
                </p>
              )}

              <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(3, 1fr)',
                gap: '16px',
                borderTop: '1px solid #1a1a1a',
                paddingTop: '16px',
                marginBottom: '16px'
              }}>
                <div>
                  <div style={{
                    fontSize: compact ? '16px' : '20px',
                    color: '#fff',
                    fontFamily: "'IBM Plex Mono', monospace",
                    marginBottom: '4px'
                  }}>
                    {auction.currentBid.toLocaleString()}
                  </div>
                  <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>
                    CURRENT BID
                  </div>
                </div>
                <div>
                  <div style={{
                    fontSize: compact ? '16px' : '20px',
                    color: '#666',
                    fontFamily: "'IBM Plex Mono', monospace",
                    marginBottom: '4px'
                  }}>
                    {auction.bidCount}
                  </div>
                  <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>
                    BIDS
                  </div>
                </div>
                <div>
                  <div style={{
                    fontSize: compact ? '16px' : '20px',
                    color: auction.burnOrReturn === 'burn' ? '#ef4444' : '#8b5cf6',
                    fontFamily: "'IBM Plex Mono', monospace",
                    marginBottom: '4px'
                  }}>
                    {auction.burnOrReturn === 'burn' ? 'BURN' : 'TREASURY'}
                  </div>
                  <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em' }}>
                    OUTCOME
                  </div>
                </div>
              </div>

              <div style={{
                background: '#0a0a0a',
                padding: '12px 16px',
                marginBottom: '16px',
                fontSize: '11px',
                color: '#666',
                fontFamily: "'IBM Plex Mono', monospace",
                lineHeight: 1.5
              }}>
                {auction.burnOrReturn === 'burn'
                  ? 'Winning bid is burned to strengthen the culture economy.'
                  : 'Winning bid returns to creator treasury for future rewards.'}
              </div>

              {showBidInput ? (
                <div style={{ display: 'flex', gap: '12px' }}>
                  <input
                    type="number"
                    value={bidAmount}
                    onChange={e => setBidAmount(e.target.value)}
                    placeholder={`Min: ${auction.currentBid + 100}`}
                    style={{
                      flex: 1,
                      padding: '12px 16px',
                      background: '#0a0a0a',
                      border: '1px solid #333',
                      color: '#fff',
                      fontSize: '14px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      outline: 'none'
                    }}
                  />
                  <button
                    style={{
                      padding: '12px 24px',
                      background: '#fff',
                      color: '#000',
                      border: 'none',
                      fontSize: '11px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em',
                      cursor: 'pointer'
                    }}
                  >
                    PLACE BID
                  </button>
                </div>
              ) : (
                <button
                  onClick={() => setShowBidInput(true)}
                  style={{
                    width: '100%',
                    padding: '14px',
                    background: 'transparent',
                    color: '#fff',
                    border: '1px solid #333',
                    fontSize: '11px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    letterSpacing: '0.1em',
                    cursor: 'pointer',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={e => e.currentTarget.style.borderColor = '#666'}
                  onMouseLeave={e => e.currentTarget.style.borderColor = '#333'}
                >
                  SIGNAL VALUE
                </button>
              )}
            </div>
          );
        };

        // Culture Page
        const CulturePage = ({ culture, onBack }) => {
          const [showJoinModal, setShowJoinModal] = useState(false);
          const [selectedTier, setSelectedTier] = useState(null);
          const [agreedToTerms, setAgreedToTerms] = useState(false);
          const wallet = useContext(WalletContext);

          // Theme with fallback defaults
          const theme = culture.theme || {};
          const accentColor = theme.accentColor || '#8b5cf6';
          const textColor = theme.textColor || '#ffffff';
          const cardBg = theme.cardBg || '#0f0f0f';
          const borderColor = theme.borderColor || '#1a1a1a';

          // Pattern definitions for themed backgrounds
          const patterns = {
            none: 'none',
            dots: 'radial-gradient(circle, #333 1px, transparent 1px)',
            grid: 'linear-gradient(#222 1px, transparent 1px), linear-gradient(90deg, #222 1px, transparent 1px)',
            diagonal: 'repeating-linear-gradient(45deg, #1a1a1a, #1a1a1a 10px, #0f0f0f 10px, #0f0f0f 20px)',
            hearts: 'url("data:image/svg+xml,%3Csvg width=\'40\' height=\'40\' viewBox=\'0 0 40 40\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M20 30l-7-7c-4-4-4-10 0-14s10-4 14 0l-7 7 7 7c4 4 4 10 0 14s-10 4-14 0l7-7z\' fill=\'%23333\' fill-opacity=\'0.3\'/%3E%3C/svg%3E")',
            stars: 'url("data:image/svg+xml,%3Csvg width=\'30\' height=\'30\' viewBox=\'0 0 30 30\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Ctext x=\'10\' y=\'20\' fill=\'%23333\' opacity=\'0.3\'%3E★%3C/text%3E%3C/svg%3E")'
          };

          // Get background style based on theme settings
          const getBackgroundStyle = () => {
            if (!theme.bgType) {
              return { background: '#0a0a0a' };
            }

            let bg = {};
            if (theme.bgType === 'solid') {
              bg.background = theme.bgColor || '#0a0a0a';
            } else if (theme.bgType === 'gradient') {
              const gradColors = theme.bgGradient || ['#0a0a0a', '#1a1a2e'];
              bg.background = `linear-gradient(135deg, ${gradColors[0]}, ${gradColors[1]})`;
            } else if (theme.bgType === 'pattern') {
              bg.background = theme.bgColor || '#0a0a0a';
              if (theme.bgPattern && theme.bgPattern !== 'none') {
                bg.backgroundImage = patterns[theme.bgPattern];
                bg.backgroundSize = theme.bgPattern === 'dots' ? '20px 20px' : theme.bgPattern === 'grid' ? '20px 20px' : 'auto';
              }
            } else if (theme.bgType === 'image' && theme.bgImage) {
              bg.backgroundImage = `url(${theme.bgImage})`;
              const fit = theme.bgImageFit || 'cover';
              if (fit === 'tile') {
                bg.backgroundSize = 'auto';
                bg.backgroundRepeat = 'repeat';
              } else if (fit === 'contain') {
                bg.backgroundSize = 'contain';
                bg.backgroundRepeat = 'no-repeat';
                bg.backgroundPosition = 'center';
              } else if (fit === 'stretch') {
                bg.backgroundSize = '100% 100%';
                bg.backgroundRepeat = 'no-repeat';
              } else { // cover
                bg.backgroundSize = 'cover';
                bg.backgroundPosition = 'center';
                bg.backgroundRepeat = 'no-repeat';
              }
            }
            return bg;
          };

          const backgroundStyle = getBackgroundStyle();

          // Real-time token data from pump.fun
          const [tokenData, setTokenData] = useState({
            marketCap: 0,
            holders: 0,
            volume: 0,
            loading: true
          });

          // Chart state for DexScreener
          const [chartData, setChartData] = useState(null);
          const [chartHeight, setChartHeight] = useState(400);
          const [showChart, setShowChart] = useState(true);

          // Fetch real token data from pump.fun API
          useEffect(() => {
            const fetchTokenData = async () => {
              if (!culture.tokenAddress) {
                setTokenData(prev => ({ ...prev, loading: false }));
                return;
              }

              try {
                // Fetch from pump.fun API via proxy
                const res = await fetch(`/api/pump/coin/${culture.tokenAddress}`);
                if (res.ok) {
                  const data = await res.json();
                  console.log('[CULTURE] Pump.fun data:', data);
                  if (data) {
                    setTokenData({
                      marketCap: data.usd_market_cap || 0,
                      holders: data.holder_count || 0,
                      volume: data.volume_24h || 0,
                      price: data.price || 0,
                      loading: false
                    });
                  } else {
                    setTokenData(prev => ({ ...prev, loading: false }));
                  }
                } else {
                  setTokenData(prev => ({ ...prev, loading: false }));
                }
              } catch (e) {
                console.error('[CULTURE] Failed to fetch token data:', e);
                setTokenData(prev => ({ ...prev, loading: false }));
              }
            };

            fetchTokenData();
            // Refresh every 30 seconds
            const interval = setInterval(fetchTokenData, 30000);
            return () => clearInterval(interval);
          }, [culture.tokenAddress]);

          // Fetch DexScreener chart data
          useEffect(() => {
            const fetchChartData = async () => {
              if (!culture.tokenAddress) {
                setChartData(null);
                return;
              }
              try {
                const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${culture.tokenAddress}`);
                if (res.ok) {
                  const data = await res.json();
                  const pair = data.pairs?.[0];
                  if (pair) {
                    setChartData({
                      pairAddress: pair.pairAddress,
                      priceUsd: pair.priceUsd,
                      priceChange: pair.priceChange,
                      volume: pair.volume,
                      liquidity: pair.liquidity,
                      marketCap: pair.marketCap || pair.fdv
                    });
                  }
                }
              } catch (e) {
                console.error('[CULTURE] Failed to fetch chart data:', e);
              }
            };
            fetchChartData();
            const interval = setInterval(fetchChartData, 60000);
            return () => clearInterval(interval);
          }, [culture.tokenAddress]);

          // Check if user already has this culture
          const existingHolding = wallet?.holdings?.find(h => h.cultureId === culture.id);
          const userHolding = existingHolding ? {
            percent: existingHolding.percent,
            tier: existingHolding.tier,
            coins: existingHolding.coins
          } : null;

          const cultureAuctions = AUCTIONS.filter(a => a.cultureId === culture.id);

          const handleJoin = () => {
            if (!wallet?.address) {
              wallet?.connect();
              return;
            }
            if (selectedTier && agreedToTerms) {
              wallet.joinCulture(culture, selectedTier);
              setShowJoinModal(false);
              setSelectedTier(null);
              setAgreedToTerms(false);
            }
          };

          // Helper to create accent rgba
          const accentRgba = (opacity) => {
            const hex = accentColor.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            return `rgba(${r}, ${g}, ${b}, ${opacity})`;
          };

          return (
            <div style={{ padding: '136px 40px 60px', minHeight: '100vh', ...backgroundStyle }}>
              <button
                onClick={onBack}
                style={{
                  background: 'none',
                  border: 'none',
                  color: '#666',
                  fontSize: '11px',
                  fontFamily: "'IBM Plex Mono', monospace",
                  letterSpacing: '0.1em',
                  cursor: 'pointer',
                  marginBottom: '40px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px'
                }}
              >
                &#8592; BACK TO CULTURES
              </button>

              <div style={{ maxWidth: '800px', marginBottom: '60px' }}>
                <div style={{
                  fontSize: '10px',
                  letterSpacing: '0.15em',
                  color: '#666',
                  marginBottom: '16px',
                  fontFamily: "'IBM Plex Mono', monospace"
                }}>
                  {culture.category.toUpperCase()}
                </div>

                <h1 style={{
                  fontFamily: "'Playfair Display', serif",
                  fontSize: '56px',
                  fontWeight: 400,
                  color: textColor,
                  marginBottom: '20px',
                  letterSpacing: '-0.02em'
                }}>
                  {culture.name}
                </h1>

                <p style={{
                  fontFamily: "'Playfair Display', serif",
                  fontSize: '24px',
                  fontStyle: 'italic',
                  color: textColor,
                  opacity: 0.8,
                  lineHeight: 1.5,
                  marginBottom: '24px'
                }}>
                  "{culture.ethos}"
                </p>

                <div style={{
                  fontSize: '12px',
                  color: '#666',
                  fontFamily: "'IBM Plex Mono', monospace",
                  marginBottom: '16px'
                }}>
                  Created by {culture.creatorName}
                </div>

                {/* Contract Address (Token Address) */}
                {culture.tokenAddress && (
                  <div style={{
                    display: 'inline-flex',
                    alignItems: 'center',
                    gap: '12px',
                    padding: '12px 16px',
                    background: accentRgba(0.1),
                    border: `1px solid ${accentRgba(0.3)}`,
                    marginBottom: '8px'
                  }}>
                    <div style={{
                      fontSize: '9px',
                      letterSpacing: '0.15em',
                      color: accentColor,
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      CA
                    </div>
                    <div style={{
                      fontSize: '13px',
                      color: textColor,
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.02em'
                    }}>
                      {culture.tokenAddress}
                    </div>
                    <button
                      onClick={() => {
                        navigator.clipboard.writeText(culture.tokenAddress);
                        alert('Address copied to clipboard!');
                      }}
                      style={{
                        background: 'none',
                        border: `1px solid ${accentRgba(0.5)}`,
                        color: accentColor,
                        padding: '4px 8px',
                        fontSize: '9px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        cursor: 'pointer',
                        letterSpacing: '0.1em'
                      }}
                    >
                      COPY
                    </button>
                  </div>
                )}

                {culture.isUserCreated && (
                  <div style={{
                    display: 'block',
                    fontSize: '10px',
                    color: accentColor,
                    fontFamily: "'IBM Plex Mono', monospace",
                    letterSpacing: '0.1em'
                  }}>
                    YOUR CULTURE
                  </div>
                )}

                {/* Edit Culture Button - always visible for culture owners */}
                {(culture.isUserCreated ||
                  culture.creatorAddress === wallet?.address ||
                  culture.creator === wallet?.address ||
                  culture.creatorWallet === wallet?.address ||
                  culture.wallet === wallet?.address) && (
                  <button
                    onClick={() => {
                      localStorage.setItem('edit_culture_data', JSON.stringify(culture));
                      window.location.href = `/culture-coins?view=edit&id=${culture.id || culture.tokenAddress}`;
                    }}
                    style={{
                      marginTop: '16px',
                      padding: '12px 24px',
                      background: accentColor,
                      border: 'none',
                      color: '#000',
                      fontSize: '11px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      fontWeight: 700,
                      display: 'inline-flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}
                  >
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    EDIT CULTURE
                  </button>
                )}
              </div>

              {/* Price Chart - DexScreener Integration */}
              {culture.tokenAddress && showChart && (
                <div style={{
                  marginBottom: '48px',
                  background: `linear-gradient(180deg, ${accentRgba(0.03)} 0%, rgba(0,0,0,0) 100%)`,
                  border: `1px solid ${accentRgba(0.3)}`,
                  boxShadow: `0 0 30px ${accentRgba(0.1)}, inset 0 0 60px ${accentRgba(0.02)}`,
                  position: 'relative',
                  overflow: 'hidden'
                }}>
                  {/* Top glow line */}
                  <div style={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    right: 0,
                    height: '1px',
                    background: `linear-gradient(90deg, transparent, ${accentRgba(0.5)}, transparent)`
                  }} />

                  {/* Chart Header */}
                  <div style={{
                    padding: '16px 24px',
                    borderBottom: `1px solid ${accentRgba(0.15)}`,
                    background: 'rgba(0, 0, 0, 0.4)',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    flexWrap: 'wrap',
                    gap: '16px'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
                      <div style={{
                        fontSize: '11px',
                        letterSpacing: '0.15em',
                        color: accentColor,
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontWeight: 600
                      }}>
                        PRICE CHART
                      </div>

                      {/* Live Price */}
                      {chartData && (
                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                          <span style={{
                            fontSize: '20px',
                            fontWeight: 600,
                            color: '#fff',
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            ${parseFloat(chartData.priceUsd || 0) < 0.0001
                              ? parseFloat(chartData.priceUsd || 0).toExponential(2)
                              : parseFloat(chartData.priceUsd || 0).toFixed(6)}
                          </span>
                          <span style={{
                            fontSize: '13px',
                            fontWeight: 500,
                            padding: '4px 10px',
                            borderRadius: '4px',
                            background: (chartData.priceChange?.h24 || 0) >= 0 ? 'rgba(139,92,246,0.15)' : 'rgba(239,68,68,0.15)',
                            color: (chartData.priceChange?.h24 || 0) >= 0 ? '#8b5cf6' : '#ef4444'
                          }}>
                            {(chartData.priceChange?.h24 || 0) >= 0 ? '+' : ''}{(chartData.priceChange?.h24 || 0).toFixed(2)}%
                          </span>
                        </div>
                      )}
                    </div>

                    <div style={{ display: 'flex', alignItems: 'center', gap: '24px' }}>
                      {/* Quick Stats */}
                      {chartData && (
                        <div style={{ display: 'flex', alignItems: 'center', gap: '24px', paddingRight: '20px', borderRight: '1px solid #222' }}>
                          <div style={{ textAlign: 'right' }}>
                            <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginBottom: '2px' }}>MCAP</div>
                            <div style={{ fontSize: '13px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                              ${(chartData.marketCap || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}
                            </div>
                          </div>
                          <div style={{ textAlign: 'right' }}>
                            <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginBottom: '2px' }}>24H VOL</div>
                            <div style={{ fontSize: '13px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                              ${(chartData.volume?.h24 || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}
                            </div>
                          </div>
                          <div style={{ textAlign: 'right' }}>
                            <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginBottom: '2px' }}>LIQ</div>
                            <div style={{ fontSize: '13px', color: accentColor, fontFamily: "'IBM Plex Mono', monospace" }}>
                              ${(chartData.liquidity?.usd || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}
                            </div>
                          </div>
                        </div>
                      )}

                      {/* Size Controls */}
                      <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                        {[300, 400, 550, 700].map(h => (
                          <button
                            key={h}
                            onClick={() => setChartHeight(h)}
                            style={{
                              padding: '6px 12px',
                              fontSize: '10px',
                              borderRadius: '4px',
                              border: chartHeight === h ? `1px solid ${accentColor}` : '1px solid #333',
                              background: chartHeight === h ? accentRgba(0.15) : 'transparent',
                              color: chartHeight === h ? accentColor : '#666',
                              cursor: 'pointer',
                              fontFamily: "'IBM Plex Mono', monospace",
                              transition: 'all 0.2s'
                            }}
                          >
                            {h === 300 ? 'S' : h === 400 ? 'M' : h === 550 ? 'L' : 'XL'}
                          </button>
                        ))}
                        <button
                          onClick={() => setShowChart(false)}
                          style={{
                            padding: '6px 12px',
                            fontSize: '10px',
                            borderRadius: '4px',
                            border: '1px solid #333',
                            background: 'transparent',
                            color: '#666',
                            cursor: 'pointer',
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}
                        >
                          HIDE
                        </button>
                      </div>
                    </div>
                  </div>

                  {/* Chart Container */}
                  <div style={{ height: chartHeight, background: '#0a0a0a', transition: 'height 0.3s ease' }}>
                    {chartData?.pairAddress ? (
                      <iframe
                        src={`https://dexscreener.com/solana/${chartData.pairAddress}?embed=1&theme=dark&trades=0&info=0`}
                        style={{ width: '100%', height: '100%', border: 'none' }}
                        title="Price Chart"
                      />
                    ) : (
                      <div style={{
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        height: '100%',
                        color: '#666',
                        gap: '12px'
                      }}>
                        <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24" style={{ opacity: 0.3 }}>
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4v16a1 1 0 001 1h14a1 1 0 001-1V4"></path>
                        </svg>
                        <span style={{ fontFamily: "'IBM Plex Mono', monospace", fontSize: '13px' }}>Loading chart...</span>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Show Chart Button (when hidden) */}
              {culture.tokenAddress && !showChart && (
                <button
                  onClick={() => setShowChart(true)}
                  style={{
                    marginBottom: '32px',
                    padding: '12px 24px',
                    background: 'transparent',
                    border: `1px solid ${accentRgba(0.3)}`,
                    color: accentColor,
                    fontSize: '11px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    letterSpacing: '0.1em',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}
                >
                  <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4v16a1 1 0 001 1h14a1 1 0 001-1V4"></path>
                  </svg>
                  SHOW PRICE CHART
                </button>
              )}

              <div style={{ display: 'grid', gridTemplateColumns: '1fr 400px', gap: '60px' }}>
                <div>
                  {/* Pillars */}
                  <div style={{ marginBottom: '48px' }}>
                    <div style={{
                      fontSize: '10px',
                      letterSpacing: '0.15em',
                      color: '#666',
                      marginBottom: '24px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      WHAT THIS CULTURE BELIEVES
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                      {culture.pillars.map((pillar, i) => (
                        <div
                          key={i}
                          style={{
                            padding: '20px 24px',
                            background: cardBg,
                            border: `1px solid ${borderColor}`,
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '14px',
                            color: textColor,
                            lineHeight: 1.5
                          }}
                        >
                          {pillar}
                        </div>
                      ))}
                    </div>
                  </div>

                  {/* Tiers */}
                  <div style={{ marginBottom: '48px' }}>
                    <div style={{
                      fontSize: '10px',
                      letterSpacing: '0.15em',
                      color: '#666',
                      marginBottom: '24px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      CULTURE TIERS
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                      {culture.tiers.map((tier, i) => {
                        const isUserTier = userHolding && tier.name === userHolding.tier;
                        return (
                          <div
                            key={i}
                            style={{
                              padding: '24px',
                              background: isUserTier ? cardBg : (theme.bgColor || '#0a0a0a'),
                              border: '1px solid',
                              borderColor: isUserTier ? accentRgba(0.5) : borderColor,
                              position: 'relative'
                            }}
                          >
                            {isUserTier && (
                              <div style={{
                                position: 'absolute',
                                top: '-1px',
                                right: '24px',
                                background: accentColor,
                                color: '#000',
                                fontSize: '9px',
                                fontFamily: "'IBM Plex Mono', monospace",
                                letterSpacing: '0.1em',
                                padding: '4px 10px'
                              }}>
                                YOUR TIER
                              </div>
                            )}
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'baseline', marginBottom: '12px' }}>
                              <span style={{
                                fontFamily: "'Playfair Display', serif",
                                fontSize: '20px',
                                color: textColor
                              }}>
                                {tier.name}
                              </span>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '12px',
                                color: '#666'
                              }}>
                                {tier.percent}% of supply
                              </span>
                            </div>
                            <div style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '12px',
                              color: textColor,
                              opacity: 0.7,
                              marginBottom: '8px'
                            }}>
                              Access: {tier.access}
                            </div>
                            <div style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '11px',
                              color: '#666'
                            }}>
                              Expected: {tier.expectation}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* Unlocks - What Participation Unlocks */}
                  {culture.unlocks && culture.unlocks.length > 0 && (
                    <div style={{ marginBottom: '48px' }}>
                      <div style={{
                        fontSize: '10px',
                        letterSpacing: '0.15em',
                        color: '#666',
                        marginBottom: '24px',
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        WHAT PARTICIPATION UNLOCKS
                      </div>
                      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px' }}>
                        {culture.unlocks.map((unlock, i) => (
                          <div
                            key={i}
                            style={{
                              padding: '24px',
                              background: cardBg,
                              border: `1px solid ${borderColor}`
                            }}
                          >
                            <div style={{
                              fontFamily: "'Playfair Display', serif",
                              fontSize: '18px',
                              color: textColor,
                              marginBottom: '12px'
                            }}>
                              {unlock.title}
                            </div>
                            <div style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '12px',
                              color: textColor,
                              opacity: 0.7,
                              lineHeight: 1.6
                            }}>
                              {unlock.description}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Auctions */}
                  {cultureAuctions.length > 0 && (
                    <div>
                      <div style={{
                        fontSize: '10px',
                        letterSpacing: '0.15em',
                        color: '#666',
                        marginBottom: '24px',
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        OPEN BIDDING
                      </div>
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                        {cultureAuctions.map(auction => (
                          <AuctionCard key={auction.id} auction={auction} compact />
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                {/* Right Column */}
                <div>
                  <div style={{
                    background: cardBg,
                    border: `1px solid ${borderColor}`,
                    padding: '32px',
                    marginBottom: '24px'
                  }}>
                    <div style={{
                      fontSize: '10px',
                      letterSpacing: '0.15em',
                      color: '#666',
                      marginBottom: '20px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      JOIN THE CULTURE
                    </div>

                    {userHolding ? (
                      <div style={{
                        padding: '16px',
                        background: accentRgba(0.15),
                        border: `1px solid ${accentRgba(0.3)}`,
                        marginBottom: '16px',
                        textAlign: 'center'
                      }}>
                        <div style={{
                          fontSize: '10px',
                          letterSpacing: '0.1em',
                          color: accentColor,
                          fontFamily: "'IBM Plex Mono', monospace",
                          marginBottom: '8px'
                        }}>
                          YOU ARE A MEMBER
                        </div>
                        <div style={{
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '18px',
                          color: textColor
                        }}>
                          {userHolding.tier}
                        </div>
                        <div style={{
                          fontSize: '11px',
                          color: '#888',
                          fontFamily: "'IBM Plex Mono', monospace",
                          marginTop: '4px'
                        }}>
                          {userHolding.percent}% ({userHolding.coins.toLocaleString()} coins)
                        </div>
                      </div>
                    ) : (
                      <button
                        onClick={() => setShowJoinModal(true)}
                        style={{
                          width: '100%',
                          padding: '16px',
                          background: accentColor,
                          color: '#000',
                          border: 'none',
                          fontSize: '12px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          letterSpacing: '0.1em',
                          cursor: 'pointer',
                          marginBottom: '16px'
                        }}
                      >
                        ACQUIRE ACCESS
                      </button>
                    )}

                    <p style={{
                      fontSize: '11px',
                      color: '#666',
                      fontFamily: "'IBM Plex Mono', monospace",
                      lineHeight: 1.6,
                      textAlign: 'center'
                    }}>
                      {userHolding ? 'Welcome to the culture.' : 'This is participation, not a trade.'}
                    </p>
                  </div>

                  {/* Economics */}
                  <div style={{
                    background: theme.bgColor || '#0a0a0a',
                    border: `1px solid ${borderColor}`,
                    padding: '32px'
                  }}>
                    <div style={{
                      fontSize: '10px',
                      letterSpacing: '0.15em',
                      color: '#666',
                      marginBottom: '24px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      CULTURE ECONOMICS
                    </div>

                    <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
                      {/* Market Cap - LIVE from pump.fun */}
                      <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                        <span style={{ fontSize: '12px', color: '#666', fontFamily: "'IBM Plex Mono', monospace" }}>Market Cap</span>
                        <span style={{ fontSize: '14px', color: accentColor, fontFamily: "'IBM Plex Mono', monospace" }}>
                          {tokenData.loading ? '...' : `$${tokenData.marketCap.toLocaleString(undefined, {maximumFractionDigits: 0})}`}
                        </span>
                      </div>

                      {/* Holders - LIVE from pump.fun */}
                      <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                        <span style={{ fontSize: '12px', color: '#666', fontFamily: "'IBM Plex Mono', monospace" }}>Holders</span>
                        <span style={{ fontSize: '14px', color: textColor, fontFamily: "'IBM Plex Mono', monospace" }}>
                          {tokenData.loading ? '...' : tokenData.holders.toLocaleString()}
                        </span>
                      </div>

                      <div style={{ borderTop: `1px solid ${borderColor}`, paddingTop: '20px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px' }}>
                          <span style={{ fontSize: '12px', color: '#666', fontFamily: "'IBM Plex Mono', monospace" }}>Total Supply</span>
                          <span style={{ fontSize: '14px', color: textColor, fontFamily: "'IBM Plex Mono', monospace" }}>{(culture.supply || 1000000000).toLocaleString()}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px' }}>
                          <span style={{ fontSize: '12px', color: '#666', fontFamily: "'IBM Plex Mono', monospace" }}>Total Burned</span>
                          <span style={{ fontSize: '14px', color: '#ef4444', fontFamily: "'IBM Plex Mono', monospace" }}>{(culture.burned || 0).toLocaleString()}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                          <span style={{ fontSize: '12px', color: '#666', fontFamily: "'IBM Plex Mono', monospace" }}>Circulating</span>
                          <span style={{ fontSize: '14px', color: textColor, fontFamily: "'IBM Plex Mono', monospace" }}>{((culture.supply || 1000000000) - (culture.burned || 0)).toLocaleString()}</span>
                        </div>
                      </div>

                      {culture.tokenAddress && (
                        <div style={{ borderTop: `1px solid ${borderColor}`, paddingTop: '20px' }}>
                          <a
                            href={`https://pump.fun/coin/${culture.tokenAddress}`}
                            target="_blank"
                            rel="noopener noreferrer"
                            style={{
                              display: 'block',
                              textAlign: 'center',
                              padding: '12px',
                              background: accentColor,
                              color: '#000',
                              fontSize: '11px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              letterSpacing: '0.1em',
                              textDecoration: 'none',
                              fontWeight: 600
                            }}
                          >
                            VIEW ON PUMP.FUN
                          </a>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </div>

              {/* Join Modal */}
              {showJoinModal && (
                <div style={{
                  position: 'fixed',
                  inset: 0,
                  background: 'rgba(0,0,0,0.9)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  zIndex: 2000
                }}>
                  <div style={{
                    background: theme.bgColor || '#0a0a0a',
                    border: `1px solid ${borderColor}`,
                    padding: '48px',
                    maxWidth: '500px',
                    width: '100%'
                  }}>
                    <h2 style={{
                      fontFamily: "'Playfair Display', serif",
                      fontSize: '28px',
                      color: textColor,
                      marginBottom: '24px'
                    }}>
                      Join {culture.name}
                    </h2>

                    <div style={{
                      background: cardBg,
                      border: `1px solid ${borderColor}`,
                      padding: '20px',
                      marginBottom: '24px'
                    }}>
                      <p style={{
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '13px',
                        color: textColor,
                        opacity: 0.7,
                        lineHeight: 1.7
                      }}>
                        "{culture.ethos}"
                      </p>
                    </div>

                    {/* Tier Selection */}
                    <div style={{ marginBottom: '24px' }}>
                      <div style={{
                        fontSize: '10px',
                        letterSpacing: '0.15em',
                        color: '#666',
                        marginBottom: '12px',
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        SELECT YOUR TIER
                      </div>
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                        {culture.tiers.map((tier, i) => (
                          <button
                            key={i}
                            onClick={() => setSelectedTier(tier)}
                            style={{
                              padding: '14px 16px',
                              background: selectedTier?.name === tier.name ? cardBg : (theme.bgColor || '#0a0a0a'),
                              border: '1px solid',
                              borderColor: selectedTier?.name === tier.name ? accentColor : borderColor,
                              color: textColor,
                              textAlign: 'left',
                              cursor: 'pointer',
                              display: 'flex',
                              justifyContent: 'space-between',
                              alignItems: 'center'
                            }}
                          >
                            <span style={{ fontFamily: "'Playfair Display', serif", fontSize: '16px' }}>
                              {tier.name}
                            </span>
                            <span style={{ fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', color: '#888' }}>
                              {tier.percent}% of supply
                            </span>
                          </button>
                        ))}
                      </div>
                    </div>

                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px' }}>
                      <input
                        type="checkbox"
                        id="understand"
                        checked={agreedToTerms}
                        onChange={(e) => setAgreedToTerms(e.target.checked)}
                        style={{ width: '18px', height: '18px', accentColor: accentColor }}
                      />
                      <label htmlFor="understand" style={{
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '12px',
                        color: '#888',
                        cursor: 'pointer'
                      }}>
                        I understand this is participation, not a trade.
                      </label>
                    </div>

                    <div style={{ display: 'flex', gap: '12px' }}>
                      <button
                        onClick={() => { setShowJoinModal(false); setSelectedTier(null); setAgreedToTerms(false); }}
                        style={{
                          flex: 1,
                          padding: '14px',
                          background: 'transparent',
                          color: '#888',
                          border: `1px solid ${borderColor}`,
                          fontSize: '12px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          letterSpacing: '0.1em',
                          cursor: 'pointer'
                        }}
                      >
                        CANCEL
                      </button>
                      <button
                        onClick={handleJoin}
                        disabled={!selectedTier || !agreedToTerms}
                        style={{
                          flex: 1,
                          padding: '14px',
                          background: (selectedTier && agreedToTerms) ? accentColor : '#333',
                          color: (selectedTier && agreedToTerms) ? '#000' : '#666',
                          border: 'none',
                          fontSize: '12px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          letterSpacing: '0.1em',
                          cursor: (selectedTier && agreedToTerms) ? 'pointer' : 'not-allowed'
                        }}
                      >
                        {wallet?.address ? 'ENTER THE CULTURE' : 'CONNECT WALLET'}
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // ═══════════════════════════════════════════════════════════════════════════
        // WEB3 SOCIAL PLATFORM - CULTURE CREATOR HUB
        // MySpace for Crypto - Customizable profiles, posts, media, timeline
        // ═══════════════════════════════════════════════════════════════════════════

        // Post Card Component - Displays individual posts in the feed
        const PostCard = ({ post, onLike, onComment, onRepost, currentUser }) => {
          const [showComments, setShowComments] = useState(false);
          const [newComment, setNewComment] = useState('');
          const isLiked = post.likes?.includes(currentUser);
          const isReposted = post.repostedBy?.includes(currentUser);
          const timeAgo = (date) => {
            const seconds = Math.floor((new Date() - new Date(date)) / 1000);
            if (seconds < 60) return 'just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
          };

          return (
            <div style={{
              background: '#0f0f0f',
              border: '1px solid #1a1a1a',
              marginBottom: '16px',
              overflow: 'hidden'
            }}>
              {/* Post Header */}
              <div style={{
                padding: '16px 20px',
                display: 'flex',
                alignItems: 'center',
                gap: '12px',
                borderBottom: '1px solid #1a1a1a'
              }}>
                <div style={{
                  width: '44px',
                  height: '44px',
                  borderRadius: '50%',
                  overflow: 'hidden',
                  border: '2px solid #8b5cf6',
                  background: 'linear-gradient(135deg, #8b5cf6, #06b6d4)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  flexShrink: 0
                }}>
                  {post.authorPfp ? (
                    <img
                      src={post.authorPfp}
                      alt=""
                      style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                      onError={(e) => { e.target.style.display = 'none'; e.target.nextSibling.style.display = 'flex'; }}
                    />
                  ) : null}
                  <span style={{
                    display: post.authorPfp ? 'none' : 'flex',
                    color: '#0a0a0a',
                    fontSize: '14px',
                    fontWeight: 700,
                    fontFamily: "'IBM Plex Mono', monospace"
                  }}>
                    {(post.authorName || 'A').charAt(0).toUpperCase()}
                  </span>
                </div>
                <div style={{ flex: 1 }}>
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}>
                    <span style={{
                      fontFamily: "'Playfair Display', serif",
                      fontSize: '16px',
                      color: '#fff'
                    }}>
                      {post.authorName || 'Anonymous'}
                    </span>
                    {post.cultureName && (
                      <span style={{
                        fontSize: '10px',
                        padding: '2px 8px',
                        background: 'rgba(139, 92, 246, 0.2)',
                        color: '#8b5cf6',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.05em'
                      }}>
                        ${post.cultureTicker}
                      </span>
                    )}
                  </div>
                  <div style={{
                    fontSize: '11px',
                    color: '#666',
                    fontFamily: "'IBM Plex Mono', monospace"
                  }}>
                    {timeAgo(post.createdAt)}
                  </div>
                </div>
              </div>

              {/* Post Content */}
              <div style={{ padding: '20px' }}>
                {post.content && (
                  <p style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '14px',
                    color: '#e5e5e5',
                    lineHeight: 1.7,
                    marginBottom: post.media ? '16px' : 0,
                    whiteSpace: 'pre-wrap'
                  }}>
                    {post.content}
                  </p>
                )}

                {/* Media (Image/Video) */}
                {post.media && post.mediaType === 'image' && (
                  <img
                    src={post.media}
                    alt="Post media"
                    style={{
                      width: '100%',
                      maxHeight: '500px',
                      objectFit: 'cover',
                      borderRadius: '8px'
                    }}
                  />
                )}
                {post.media && post.mediaType === 'video' && (
                  <video
                    src={post.media}
                    controls
                    style={{
                      width: '100%',
                      maxHeight: '500px',
                      borderRadius: '8px'
                    }}
                  />
                )}
                {post.embedUrl && (
                  <iframe
                    src={post.embedUrl}
                    style={{
                      width: '100%',
                      height: '315px',
                      border: 'none',
                      borderRadius: '8px'
                    }}
                    allowFullScreen
                  />
                )}
              </div>

              {/* Post Actions */}
              <div style={{
                padding: '12px 20px',
                borderTop: '1px solid #1a1a1a',
                display: 'flex',
                gap: '24px'
              }}>
                <button
                  onClick={() => onLike?.(post.id)}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: isLiked ? '#8b5cf6' : '#666',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    transition: 'color 0.2s'
                  }}
                >
                  <svg width="16" height="16" viewBox="0 0 24 24" fill={isLiked ? 'currentColor' : 'none'} stroke="currentColor" strokeWidth="2">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                  </svg>
                  {post.likes?.length || 0}
                </button>
                <button
                  onClick={() => setShowComments(!showComments)}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: '#666',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px'
                  }}
                >
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                  </svg>
                  {post.comments?.length || 0}
                </button>
                <button
                  onClick={() => onRepost?.(post.id)}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: isReposted ? '#8b5cf6' : '#666',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    transition: 'color 0.2s'
                  }}
                >
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M17 1l4 4-4 4"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/>
                    <path d="M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>
                  </svg>
                  {post.reposts || 0}
                </button>
              </div>

              {/* Comments Section */}
              {showComments && (
                <div style={{
                  padding: '16px 20px',
                  borderTop: '1px solid #1a1a1a',
                  background: '#0a0a0a'
                }}>
                  {post.comments?.map((comment, i) => (
                    <div key={i} style={{
                      padding: '12px 0',
                      borderBottom: i < post.comments.length - 1 ? '1px solid #1a1a1a' : 'none'
                    }}>
                      <div style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        marginBottom: '6px'
                      }}>
                        <span style={{
                          fontSize: '13px',
                          color: '#fff',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}>
                          {comment.author}
                        </span>
                        <span style={{ fontSize: '10px', color: '#444' }}>•</span>
                        <span style={{ fontSize: '10px', color: '#666' }}>
                          {timeAgo(comment.createdAt)}
                        </span>
                      </div>
                      <p style={{
                        fontSize: '13px',
                        color: '#999',
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        {comment.content}
                      </p>
                    </div>
                  ))}

                  {/* Add Comment */}
                  <div style={{
                    display: 'flex',
                    gap: '12px',
                    marginTop: '12px'
                  }}>
                    <input
                      type="text"
                      value={newComment}
                      onChange={(e) => setNewComment(e.target.value)}
                      placeholder="Write a comment..."
                      style={{
                        flex: 1,
                        padding: '10px 14px',
                        background: '#111',
                        border: '1px solid #222',
                        color: '#fff',
                        fontSize: '13px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        outline: 'none'
                      }}
                    />
                    <button
                      onClick={() => {
                        if (newComment.trim()) {
                          onComment?.(post.id, newComment);
                          setNewComment('');
                        }
                      }}
                      style={{
                        padding: '10px 16px',
                        background: '#8b5cf6',
                        border: 'none',
                        color: '#000',
                        fontSize: '11px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontWeight: 600,
                        cursor: 'pointer'
                      }}
                    >
                      POST
                    </button>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Post Composer Component - Create new posts
        const PostComposer = ({ onPost, profile, cultures }) => {
          const [content, setContent] = useState('');
          const [mediaPreview, setMediaPreview] = useState(null);
          const [mediaType, setMediaType] = useState(null);
          const [selectedCulture, setSelectedCulture] = useState(null);
          const [showCultureSelect, setShowCultureSelect] = useState(false);
          const fileInputRef = useRef(null);
          const videoInputRef = useRef(null);

          // Upload limits for production stability
          const MAX_VIDEO_SIZE = 50 * 1024 * 1024; // 50MB max for videos
          const MAX_IMAGE_SIZE = 5 * 1024 * 1024;  // 5MB max for images

          const handleImageSelect = (e) => {
            const file = e.target.files[0];
            if (file) {
              // Check file size limit
              if (file.size > MAX_IMAGE_SIZE) {
                alert(`Image too large. Maximum size: 5MB\nYour file: ${(file.size / 1024 / 1024).toFixed(1)}MB`);
                e.target.value = '';
                return;
              }
              const reader = new FileReader();
              reader.onload = (e) => {
                setMediaPreview(e.target.result);
                setMediaType('image');
              };
              reader.readAsDataURL(file);
            }
          };

          const handleVideoSelect = (e) => {
            const file = e.target.files[0];
            if (file) {
              // Check file size limit
              if (file.size > MAX_VIDEO_SIZE) {
                alert(`Video too large. Maximum size: 50MB\nYour file: ${(file.size / 1024 / 1024).toFixed(1)}MB`);
                e.target.value = '';
                return;
              }
              const reader = new FileReader();
              reader.onload = (e) => {
                setMediaPreview(e.target.result);
                setMediaType('video');
              };
              reader.readAsDataURL(file);
            }
          };

          const clearMedia = () => {
            setMediaPreview(null);
            setMediaType(null);
          };

          const handlePost = () => {
            if (content.trim() || mediaPreview) {
              onPost({
                content: content.trim(),
                media: mediaPreview,
                mediaType,
                cultureId: selectedCulture?.id,
                cultureName: selectedCulture?.name,
                cultureTicker: selectedCulture?.ticker
              });
              setContent('');
              clearMedia();
              setSelectedCulture(null);
            }
          };

          return (
            <div style={{
              background: '#0f0f0f',
              border: '1px solid #1a1a1a',
              marginBottom: '24px'
            }}>
              <div style={{ padding: '20px' }}>
                <div style={{ display: 'flex', gap: '12px' }}>
                  <div style={{
                    width: '48px',
                    height: '48px',
                    borderRadius: '50%',
                    background: profile?.pfp ? `url(${profile.pfp}) center/cover` : 'linear-gradient(135deg, #8b5cf6, #06b6d4)',
                    border: '2px solid #8b5cf6',
                    flexShrink: 0
                  }} />
                  <div style={{ flex: 1 }}>
                    <textarea
                      value={content}
                      onChange={(e) => setContent(e.target.value)}
                      placeholder="What's happening in your culture?"
                      style={{
                        width: '100%',
                        minHeight: '80px',
                        padding: '12px',
                        background: '#0a0a0a',
                        border: '1px solid #222',
                        color: '#fff',
                        fontSize: '15px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        resize: 'vertical',
                        outline: 'none'
                      }}
                    />

                    {/* Media Preview */}
                    {mediaPreview && (
                      <div style={{ position: 'relative', marginTop: '12px' }}>
                        {mediaType === 'image' ? (
                          <img
                            src={mediaPreview}
                            alt="Preview"
                            style={{
                              maxWidth: '100%',
                              maxHeight: '300px',
                              borderRadius: '8px'
                            }}
                          />
                        ) : (
                          <video
                            src={mediaPreview}
                            controls
                            style={{
                              maxWidth: '100%',
                              maxHeight: '300px',
                              borderRadius: '8px'
                            }}
                          />
                        )}
                        <button
                          onClick={clearMedia}
                          style={{
                            position: 'absolute',
                            top: '8px',
                            right: '8px',
                            width: '28px',
                            height: '28px',
                            borderRadius: '50%',
                            background: 'rgba(0,0,0,0.8)',
                            border: 'none',
                            color: '#fff',
                            cursor: 'pointer',
                            fontSize: '14px'
                          }}
                        >
                          ✕
                        </button>
                      </div>
                    )}

                    {/* Selected Culture Tag */}
                    {selectedCulture && (
                      <div style={{
                        display: 'inline-flex',
                        alignItems: 'center',
                        gap: '8px',
                        padding: '6px 12px',
                        background: 'rgba(139, 92, 246, 0.15)',
                        border: '1px solid rgba(139, 92, 246, 0.3)',
                        marginTop: '12px'
                      }}>
                        <span style={{
                          fontSize: '12px',
                          color: '#8b5cf6',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}>
                          ${selectedCulture.ticker}
                        </span>
                        <button
                          onClick={() => setSelectedCulture(null)}
                          style={{
                            background: 'none',
                            border: 'none',
                            color: '#8b5cf6',
                            cursor: 'pointer',
                            padding: 0,
                            fontSize: '12px'
                          }}
                        >
                          ✕
                        </button>
                      </div>
                    )}
                  </div>
                </div>
              </div>

              {/* Action Bar */}
              <div style={{
                padding: '12px 20px',
                borderTop: '1px solid #1a1a1a',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }}>
                <div style={{ display: 'flex', gap: '16px' }}>
                  <input
                    type="file"
                    ref={fileInputRef}
                    accept="image/*"
                    onChange={handleImageSelect}
                    style={{ display: 'none' }}
                  />
                  <button
                    onClick={() => fileInputRef.current?.click()}
                    style={{
                      background: 'none',
                      border: 'none',
                      color: '#666',
                      cursor: 'pointer',
                      fontSize: '18px',
                      padding: '4px'
                    }}
                    title="Add image"
                  >
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/>
                    </svg>
                  </button>

                  <input
                    type="file"
                    ref={videoInputRef}
                    accept="video/*"
                    onChange={handleVideoSelect}
                    style={{ display: 'none' }}
                  />
                  <button
                    onClick={() => videoInputRef.current?.click()}
                    style={{
                      background: 'none',
                      border: 'none',
                      color: '#666',
                      cursor: 'pointer',
                      fontSize: '18px',
                      padding: '4px'
                    }}
                    title="Add video"
                  >
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                    </svg>
                  </button>

                  {/* Create Auction Button */}
                  <button
                    onClick={() => setShowAuctionModal && setShowAuctionModal(true)}
                    style={{
                      background: 'none',
                      border: '1px solid #333',
                      color: '#8b5cf6',
                      cursor: 'pointer',
                      fontSize: '10px',
                      padding: '6px 12px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.05em',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '6px'
                    }}
                    title="Create auction"
                  >
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                      <path d="M2 17l10 5 10-5"/>
                      <path d="M2 12l10 5 10-5"/>
                    </svg>
                    AUCTION
                  </button>

                  {cultures?.length > 0 && (
                    <div style={{ position: 'relative' }}>
                      <button
                        onClick={() => setShowCultureSelect(!showCultureSelect)}
                        style={{
                          background: 'none',
                          border: 'none',
                          color: '#666',
                          cursor: 'pointer',
                          fontSize: '14px',
                          padding: '4px',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}
                        title="Tag a culture"
                      >
                        #culture
                      </button>
                      {showCultureSelect && (
                        <div style={{
                          position: 'absolute',
                          top: '100%',
                          left: 0,
                          background: '#111',
                          border: '1px solid #222',
                          minWidth: '200px',
                          zIndex: 100
                        }}>
                          {cultures.map(c => (
                            <button
                              key={c.id}
                              onClick={() => {
                                setSelectedCulture(c);
                                setShowCultureSelect(false);
                              }}
                              style={{
                                display: 'block',
                                width: '100%',
                                padding: '10px 12px',
                                background: 'none',
                                border: 'none',
                                borderBottom: '1px solid #1a1a1a',
                                color: '#fff',
                                textAlign: 'left',
                                cursor: 'pointer',
                                fontSize: '13px',
                                fontFamily: "'IBM Plex Mono', monospace"
                              }}
                            >
                              {c.name} <span style={{ color: '#666' }}>${c.ticker}</span>
                            </button>
                          ))}
                        </div>
                      )}
                    </div>
                  )}
                </div>

                <button
                  onClick={handlePost}
                  disabled={!content.trim() && !mediaPreview}
                  style={{
                    padding: '10px 24px',
                    background: (content.trim() || mediaPreview) ? '#8b5cf6' : '#222',
                    border: 'none',
                    color: (content.trim() || mediaPreview) ? '#000' : '#666',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontWeight: 600,
                    letterSpacing: '0.05em',
                    cursor: (content.trim() || mediaPreview) ? 'pointer' : 'not-allowed'
                  }}
                >
                  POST
                </button>
              </div>
            </div>
          );
        };

        // Creator Profile Header - Customizable profile section
        const CreatorProfileHeader = ({ profile, onEditProfile, isOwner, stats }) => {
          const [isEditing, setIsEditing] = useState(false);
          const [editName, setEditName] = useState(profile?.displayName || '');
          const [editBio, setEditBio] = useState(profile?.bio || '');
          const pfpInputRef = useRef(null);
          const bannerInputRef = useRef(null);

          const handlePfpUpload = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                onEditProfile?.({ pfp: e.target.result });
              };
              reader.readAsDataURL(file);
            }
          };

          const handleBannerUpload = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                onEditProfile?.({ banner: e.target.result });
              };
              reader.readAsDataURL(file);
            }
          };

          return (
            <div style={{
              background: '#0f0f0f',
              border: '1px solid #1a1a1a',
              marginBottom: '24px',
              overflow: 'hidden'
            }}>
              {/* Banner - 1500x500 recommended (3:1 ratio like Twitter/X) */}
              <div
                style={{
                  height: '250px',
                  width: '100%',
                  backgroundImage: profile?.banner ? `url(${profile.banner})` : 'linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%)',
                  backgroundSize: 'cover',
                  backgroundPosition: 'center center',
                  backgroundRepeat: 'no-repeat',
                  position: 'relative'
                }}
              >
                {isOwner && (
                  <>
                    <input
                      type="file"
                      ref={bannerInputRef}
                      accept="image/*"
                      onChange={handleBannerUpload}
                      style={{ display: 'none' }}
                    />
                    <label
                      onClick={(e) => {
                        e.preventDefault();
                        bannerInputRef.current?.click();
                      }}
                      style={{
                        position: 'absolute',
                        bottom: '16px',
                        right: '16px',
                        padding: '10px 20px',
                        background: 'rgba(0,0,0,0.9)',
                        border: '1px solid #8b5cf6',
                        color: '#8b5cf6',
                        fontSize: '12px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        cursor: 'pointer',
                        letterSpacing: '0.05em',
                        display: 'inline-block',
                        zIndex: 10
                      }}
                    >
                      EDIT BANNER
                    </label>
                  </>
                )}
              </div>

              {/* Profile Info */}
              <div style={{ padding: '0 24px 24px', position: 'relative' }}>
                {/* PFP */}
                <div style={{
                  position: 'relative',
                  width: '100px',
                  marginTop: '-50px'
                }}>
                  <div style={{
                    width: '100px',
                    height: '100px',
                    borderRadius: '50%',
                    background: profile?.pfp
                      ? `url(${profile.pfp}) center/cover`
                      : 'linear-gradient(135deg, #8b5cf6, #06b6d4)',
                    border: '4px solid #0f0f0f',
                    boxShadow: '0 0 20px rgba(139, 92, 246, 0.3)'
                  }} />
                  {isOwner && (
                    <>
                      <input
                        type="file"
                        ref={pfpInputRef}
                        accept="image/*"
                        onChange={handlePfpUpload}
                        style={{ display: 'none' }}
                      />
                      <button
                        onClick={() => pfpInputRef.current?.click()}
                        style={{
                          position: 'absolute',
                          bottom: '4px',
                          right: '4px',
                          width: '32px',
                          height: '32px',
                          borderRadius: '50%',
                          background: '#8b5cf6',
                          border: 'none',
                          color: '#000',
                          cursor: 'pointer',
                          fontSize: '14px',
                          fontWeight: 'bold'
                        }}
                      >
                        +
                      </button>
                    </>
                  )}
                </div>

                {/* Name & Bio */}
                <div style={{ marginTop: '16px' }}>
                  {isEditing ? (
                    <div style={{ marginBottom: '16px' }}>
                      <input
                        type="text"
                        value={editName}
                        onChange={(e) => setEditName(e.target.value)}
                        placeholder="Display name"
                        style={{
                          width: '100%',
                          padding: '12px',
                          background: '#0a0a0a',
                          border: '1px solid #222',
                          color: '#fff',
                          fontSize: '18px',
                          fontFamily: "'Playfair Display', serif",
                          marginBottom: '12px',
                          outline: 'none'
                        }}
                      />
                      <textarea
                        value={editBio}
                        onChange={(e) => setEditBio(e.target.value)}
                        placeholder="Tell the world about yourself..."
                        style={{
                          width: '100%',
                          minHeight: '80px',
                          padding: '12px',
                          background: '#0a0a0a',
                          border: '1px solid #222',
                          color: '#fff',
                          fontSize: '14px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          resize: 'vertical',
                          outline: 'none'
                        }}
                      />
                      <div style={{ display: 'flex', gap: '12px', marginTop: '12px' }}>
                        <button
                          onClick={() => {
                            onEditProfile?.({ displayName: editName, bio: editBio });
                            setIsEditing(false);
                          }}
                          style={{
                            padding: '10px 20px',
                            background: '#8b5cf6',
                            border: 'none',
                            color: '#000',
                            fontSize: '12px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontWeight: 600,
                            cursor: 'pointer'
                          }}
                        >
                          SAVE
                        </button>
                        <button
                          onClick={() => setIsEditing(false)}
                          style={{
                            padding: '10px 20px',
                            background: 'transparent',
                            border: '1px solid #333',
                            color: '#888',
                            fontSize: '12px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            cursor: 'pointer'
                          }}
                        >
                          CANCEL
                        </button>
                      </div>
                    </div>
                  ) : (
                    <>
                      <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '8px' }}>
                        <h2 style={{
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '28px',
                          fontWeight: 400,
                          color: '#fff',
                          margin: 0
                        }}>
                          {profile?.displayName || 'Anonymous Creator'}
                        </h2>
                        {isOwner && (
                          <button
                            onClick={() => setIsEditing(true)}
                            style={{
                              background: 'none',
                              border: '1px solid #333',
                              color: '#888',
                              padding: '6px 12px',
                              fontSize: '11px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              cursor: 'pointer'
                            }}
                          >
                            EDIT
                          </button>
                        )}
                      </div>
                      {profile?.wallet && (
                        <div style={{
                          fontSize: '12px',
                          color: '#666',
                          fontFamily: "'IBM Plex Mono', monospace",
                          marginBottom: '12px'
                        }}>
                          {profile.wallet.slice(0, 6)}...{profile.wallet.slice(-4)}
                        </div>
                      )}
                      {profile?.bio && (
                        <p style={{
                          fontSize: '14px',
                          color: '#999',
                          fontFamily: "'IBM Plex Mono', monospace",
                          lineHeight: 1.6,
                          maxWidth: '600px'
                        }}>
                          {profile.bio}
                        </p>
                      )}
                    </>
                  )}
                </div>

                {/* Stats Row */}
                <div style={{
                  display: 'flex',
                  gap: '32px',
                  marginTop: '20px',
                  paddingTop: '20px',
                  borderTop: '1px solid #1a1a1a'
                }}>
                  {[
                    { value: stats?.cultures || 0, label: 'Cultures' },
                    { value: stats?.posts || 0, label: 'Posts' },
                    { value: stats?.followers || 0, label: 'Followers' },
                    { value: stats?.following || 0, label: 'Following' }
                  ].map((stat, i) => (
                    <div key={i}>
                      <div style={{
                        fontSize: '20px',
                        fontWeight: 600,
                        color: '#fff',
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        {stat.value}
                      </div>
                      <div style={{
                        fontSize: '11px',
                        color: '#666',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.05em'
                      }}>
                        {stat.label}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          );
        };

        // Community Feed View - Shows all posts from all creators
        const FeedView = ({ onSelectCulture }) => {
          const wallet = useContext(WalletContext);
          const [posts, setPosts] = useState([]);
          const [loading, setLoading] = useState(true);

          // Light/Dark Mode State (synced with localStorage)
          const [lightMode, setLightMode] = useState(() => {
            try { return JSON.parse(localStorage.getItem('lightMode') || 'false'); }
            catch { return false; }
          });

          // Colors based on light/dark mode
          const colors = lightMode ? {
            bg: '#fafafa',
            cardBg: '#ffffff',
            border: '#e5e5e5',
            text: '#171717',
            textSecondary: '#404040',
            textMuted: '#737373',
            accent: '#8b5cf6',
            inputBg: '#ffffff',
            inputBorder: '#d4d4d4'
          } : {
            bg: '#0a0a0a',
            cardBg: '#0f0f0f',
            border: '#1a1a1a',
            text: '#ffffff',
            textSecondary: '#a0a0a0',
            textMuted: '#666666',
            accent: '#8b5cf6',
            inputBg: '#111111',
            inputBorder: '#333333'
          };

          // Block list stored locally - users can block wallets they don't want to see
          const [blockedUsers, setBlockedUsers] = useState(() => {
            try { return JSON.parse(localStorage.getItem('blocked_users') || '[]'); }
            catch { return []; }
          });

          const blockUser = (walletToBlock) => {
            if (!walletToBlock || blockedUsers.includes(walletToBlock)) return;
            const newBlocked = [...blockedUsers, walletToBlock];
            setBlockedUsers(newBlocked);
            localStorage.setItem('blocked_users', JSON.stringify(newBlocked));
            setPosts(prev => prev.filter(p => p.authorWallet !== walletToBlock));
          };

          // Load posts from SERVER ONLY - single source of truth for ALL users
          useEffect(() => {
            const loadPosts = async () => {
              try {
                // SERVER IS SINGLE SOURCE OF TRUTH
                const apiRes = await fetch('/api/posts?limit=200');
                if (!apiRes.ok) throw new Error(`HTTP ${apiRes.status}`);
                const apiData = await apiRes.json();
                console.log('[FEED] Server returned', apiData.posts?.length || 0, 'posts');

                if (apiData.success && apiData.posts) {
                  const serverPosts = apiData.posts.map(p => {
                    const wallet = p.authorWallet || p.author_wallet || '';
                    // Get display name - check server first, then try to enrich from localStorage
                    let name = p.authorName || p.author_name || p.display_name;
                    let pfp = p.authorPfp || p.author_pfp || p.authorAvatar || p.pfp;

                    // If no name from server, try localStorage profile
                    if (!name && wallet) {
                      try {
                        const profile = JSON.parse(localStorage.getItem('creator_profile_' + wallet) || 'null');
                        if (profile?.displayName) {
                          name = profile.displayName;
                          pfp = profile.pfp || pfp;
                        }
                      } catch (e) {}
                    }

                    // Final fallback to truncated wallet
                    if (!name) {
                      name = wallet ? wallet.slice(0, 6) + '...' + wallet.slice(-4) : 'Anonymous';
                    }

                    return {
                      id: p.id,
                      authorWallet: wallet,
                      authorName: name,
                      authorPfp: pfp,
                      content: p.content,
                      media: p.mediaUrl ? [p.mediaUrl] : (p.media_urls ? JSON.parse(p.media_urls) : []),
                      likes: Array.isArray(p.likes) ? p.likes : (p.liked_by ? JSON.parse(p.liked_by) : []),
                      reposts: p.reposts || 0,
                      repostedBy: Array.isArray(p.repostedBy) ? p.repostedBy : (p.reposted_by ? JSON.parse(p.reposted_by) : []),
                      comments: p.comments || [],
                      createdAt: p.createdAt || p.created_at,
                      cultureId: p.cultureId || p.culture_id
                    };
                  });

                  // Filter out blocked users
                  const blocked = JSON.parse(localStorage.getItem('blocked_users') || '[]');
                  const filteredPosts = serverPosts.filter(p => !blocked.includes(p.authorWallet));

                  // Sort by newest first
                  filteredPosts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                  console.log('[FEED] Displaying', filteredPosts.length, 'posts after filtering');
                  setPosts(filteredPosts);
                }
              } catch (e) {
                console.error('[FEED] Error loading posts:', e);
              } finally {
                setLoading(false);
              }
            };
            loadPosts();
            // Refresh every 15 seconds for real-time feel
            const interval = setInterval(loadPosts, 15000);
            return () => clearInterval(interval);
          }, []);

          const handleLike = async (postId) => {
            if (!wallet?.address) return;
            // Optimistic UI update
            const updatedPosts = posts.map(p => {
              if (p.id === postId) {
                const likes = p.likes || [];
                const isLiked = likes.includes(wallet.address);
                return {
                  ...p,
                  likes: isLiked
                    ? likes.filter(l => l !== wallet.address)
                    : [...likes, wallet.address]
                };
              }
              return p;
            });
            setPosts(updatedPosts);
            // Sync to server (all users will see the update)
            try {
              const res = await fetch(`/api/posts/${postId}/like`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ wallet: wallet.address })
              });
              const data = await res.json();
              if (data.success) {
                // Update with server's authoritative like list
                setPosts(prev => prev.map(p => p.id === postId ? { ...p, likes: data.likes } : p));
              }
            } catch (e) {
              console.error('[LIKE] Sync failed:', e);
            }
          };

          const handleComment = async (postId, comment) => {
            if (!wallet?.address || !comment.trim()) return;
            // Get commenter's display name from profile for optimistic UI
            let commenterName = 'Anonymous';
            try {
              const profile = JSON.parse(localStorage.getItem('creator_profile_' + wallet.address) || 'null');
              if (profile?.displayName) commenterName = profile.displayName;
              else if (profile?.username) commenterName = profile.username;
            } catch (e) {}
            // Optimistic UI update
            const newComment = {
              author: commenterName,
              authorWallet: wallet.address,
              content: comment,
              createdAt: new Date().toISOString()
            };
            setPosts(prev => prev.map(p => {
              if (p.id === postId) {
                return { ...p, comments: [...(p.comments || []), newComment] };
              }
              return p;
            }));
            // Sync to server (all users will see the comment)
            try {
              const res = await fetch(`/api/posts/${postId}/comment`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ authorWallet: wallet.address, content: comment })
              });
              const data = await res.json();
              if (data.success && data.comment) {
                // Update with server's comment (includes proper ID)
                setPosts(prev => prev.map(p => {
                  if (p.id === postId) {
                    const comments = (p.comments || []).filter(c => c.createdAt !== newComment.createdAt);
                    return { ...p, comments: [...comments, data.comment] };
                  }
                  return p;
                }));
              }
            } catch (e) {
              console.error('[COMMENT] Sync failed:', e);
            }
          };

          const handleRepost = async (postId) => {
            if (!wallet?.address) return;
            // Optimistic UI update
            const updatedPosts = posts.map(p => {
              if (p.id === postId) {
                const reposts = p.repostedBy || [];
                const hasReposted = reposts.includes(wallet.address);
                return {
                  ...p,
                  reposts: hasReposted ? (p.reposts || 1) - 1 : (p.reposts || 0) + 1,
                  repostedBy: hasReposted
                    ? reposts.filter(r => r !== wallet.address)
                    : [...reposts, wallet.address]
                };
              }
              return p;
            });
            setPosts(updatedPosts);
            // Sync to server (all users will see the repost)
            try {
              const res = await fetch(`/api/posts/${postId}/repost`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ wallet: wallet.address })
              });
              const data = await res.json();
              if (data.success) {
                // Update with server's authoritative repost data
                setPosts(prev => prev.map(p => p.id === postId ? { ...p, reposts: data.reposts, repostedBy: data.repostedBy } : p));
              }
            } catch (e) {
              console.error('[REPOST] Sync failed:', e);
            }
          };

          if (loading) {
            return (
              <div style={{ padding: '136px 40px 60px', textAlign: 'center' }}>
                <p style={{ color: '#888', fontFamily: "'IBM Plex Mono', monospace" }}>
                  Loading the culture feed...
                </p>
              </div>
            );
          }

          return (
            <div style={{
              padding: '136px 40px 60px',
              background: colors.bg,
              minHeight: '100vh',
              transition: 'all 0.3s ease'
            }}>
              {/* Light/Dark Mode Toggle */}
              <button
                onClick={() => {
                  const newMode = !lightMode;
                  setLightMode(newMode);
                  localStorage.setItem('lightMode', JSON.stringify(newMode));
                }}
                style={{
                  position: 'fixed',
                  top: '100px',
                  right: '40px',
                  zIndex: 100,
                  width: '44px',
                  height: '44px',
                  borderRadius: '50%',
                  background: lightMode ? '#1a1a1a' : '#ffffff',
                  border: 'none',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  boxShadow: '0 2px 10px rgba(0,0,0,0.2)',
                  transition: 'all 0.3s'
                }}
                title={lightMode ? 'Switch to Dark Mode' : 'Switch to Light Mode'}
              >
                {lightMode ? (
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="#fff" stroke="none">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                  </svg>
                ) : (
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#000" strokeWidth="2">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                  </svg>
                )}
              </button>

              <div style={{ maxWidth: '700px', margin: '0 auto' }}>
                {/* Header */}
                <div style={{ marginBottom: '32px' }}>
                  <h1 style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '48px',
                    fontWeight: 400,
                    color: colors.text,
                    marginBottom: '16px'
                  }}>
                    Culture Feed
                  </h1>
                  <p style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '14px',
                    color: colors.textMuted,
                    lineHeight: 1.7
                  }}>
                    See what creators are sharing. Join the conversation.
                  </p>
                </div>

                {/* Feed Stats Bar */}
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'space-between',
                  marginBottom: '24px',
                  paddingBottom: '16px',
                  borderBottom: `1px solid ${colors.border}`
                }}>
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}>
                    <div style={{
                      width: '8px',
                      height: '8px',
                      borderRadius: '50%',
                      background: '#8b5cf6',
                      animation: 'pulse 1.5s infinite'
                    }} />
                    <span style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '12px',
                      color: colors.textMuted,
                      letterSpacing: '0.05em'
                    }}>
                      {posts.length} POSTS • ALL CREATORS
                    </span>
                  </div>
                  <button
                    onClick={() => window.location.reload()}
                    style={{
                      background: 'none',
                      border: `1px solid ${colors.border}`,
                      color: colors.textMuted,
                      fontSize: '10px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em',
                      padding: '6px 12px',
                      cursor: 'pointer'
                    }}
                  >
                    REFRESH
                  </button>
                </div>

                {/* Posts */}
                {posts.length === 0 ? (
                  <div style={{
                    textAlign: 'center',
                    padding: '60px 20px',
                    background: colors.cardBg,
                    border: `1px solid ${colors.border}`
                  }}>
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#666" strokeWidth="1" style={{ marginBottom: '16px', opacity: 0.3 }}>
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>
                    </svg>
                    <p style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '14px',
                      color: '#666'
                    }}>
                      No posts yet. Be the first to share something!
                    </p>
                  </div>
                ) : (
                  posts.map(post => (
                    <PostCard
                      key={post.id}
                      post={post}
                      currentUser={wallet?.address}
                      onLike={handleLike}
                      onComment={handleComment}
                      onRepost={handleRepost}
                    />
                  ))
                )}
              </div>
            </div>
          );
        };

        // Auctions View
        const AuctionsView = () => {
          const [searchQuery, setSearchQuery] = useState('');

          // Filter auctions by culture name, title, or type
          const filteredAuctions = AUCTIONS.filter(auction => {
            if (!searchQuery.trim()) return true;
            const query = searchQuery.toLowerCase().trim();
            return (
              (auction.cultureName && auction.cultureName.toLowerCase().includes(query)) ||
              (auction.title && auction.title.toLowerCase().includes(query)) ||
              (auction.type && auction.type.toLowerCase().includes(query)) ||
              (auction.description && auction.description.toLowerCase().includes(query))
            );
          });

          return (
            <div style={{ padding: '136px 40px 60px' }}>
              <div style={{ marginBottom: '48px' }}>
                <h1 style={{
                  fontFamily: "'Playfair Display', serif",
                  fontSize: '48px',
                  fontWeight: 400,
                  color: '#fff',
                  marginBottom: '16px'
                }}>
                  Open Bidding
                </h1>
                <p style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '14px',
                  color: '#888',
                  maxWidth: '600px',
                  lineHeight: 1.7
                }}>
                  Content is not traded. It is bid on. Winning bids are burned or returned
                  to the creator treasury - never resold.
                </p>
              </div>

              {/* Search */}
              <div style={{ marginBottom: '32px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  background: '#0f0f0f',
                  border: '1px solid #222',
                  padding: '0 16px'
                }}>
                  <span style={{ color: '#666', marginRight: '12px', fontSize: '14px' }}>⌕</span>
                  <input
                    type="text"
                    placeholder="Search by culture name, title, or type..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    style={{
                      flex: 1,
                      padding: '14px 0',
                      background: 'transparent',
                      border: 'none',
                      outline: 'none',
                      color: '#fff',
                      fontSize: '13px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}
                  />
                  {searchQuery && (
                    <button
                      onClick={() => setSearchQuery('')}
                      style={{
                        background: 'transparent',
                        border: 'none',
                        color: '#666',
                        cursor: 'pointer',
                        fontSize: '16px',
                        padding: '4px 8px'
                      }}
                    >
                      ✕
                    </button>
                  )}
                </div>
              </div>

              <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fill, minmax(450px, 1fr))',
                gap: '24px'
              }}>
                {filteredAuctions.map(auction => (
                  <AuctionCard key={auction.id} auction={auction} />
                ))}
              </div>
            </div>
          );
        };

        // Dashboard View - Shows cultures you CREATED (as owner) + Social Hub
        const DashboardView = () => {
          const wallet = useContext(WalletContext);
          const [myCultures, setMyCultures] = useState([]);
          const [loading, setLoading] = useState(true);
          const [searchQuery, setSearchQuery] = useState('');
          const [selectedChartCulture, setSelectedChartCulture] = useState(null);
          const [chartData, setChartData] = useState(null);
          const [chartHeight, setChartHeight] = useState(400);
          const [activeTab, setActiveTab] = useState('overview'); // overview, posts, cultures, settings
          const [toolsExpanded, setToolsExpanded] = useState(true); // Collapsible tools section

          // Light/Dark Mode State
          const [lightMode, setLightMode] = useState(() => {
            try { return JSON.parse(localStorage.getItem('lightMode') || 'false'); }
            catch { return false; }
          });

          // TEK Integration State
          const [tekAllocations, setTekAllocations] = useState({
            marketMaking: 25,
            buybackBurn: 25,
            liquidity: 25,
            creatorRevenue: 25
          });
          const [lpBurnEnabled, setLpBurnEnabled] = useState(true);
          const [autoRebalance, setAutoRebalance] = useState(false);
          const [tekAutomationRunning, setTekAutomationRunning] = useState(false);
          const [tekLoading, setTekLoading] = useState(false);
          const [tekStatus, setTekStatus] = useState('');
          const [selectedTekCulture, setSelectedTekCulture] = useState(null);
          const [tekStats, setTekStats] = useState({ claimed: 0, distributed: 0, pending: 0, holderPool: 0 });

          // PK + CA Ownership Verification (like main dashboard)
          const [showVerifyModal, setShowVerifyModal] = useState(false);
          const [verifyPrivateKey, setVerifyPrivateKey] = useState('');
          const [verifyTokenMint, setVerifyTokenMint] = useState('');
          const [verifyStatus, setVerifyStatus] = useState('');
          const [verifyLoading, setVerifyLoading] = useState(false);
          const [verifiedCultures, setVerifiedCultures] = useState(new Set()); // Token addresses that have been verified
          const [pendingEditCulture, setPendingEditCulture] = useState(null);

          // Verify ownership using PK + CA before allowing edit
          const verifyOwnership = async () => {
            if (!verifyPrivateKey.trim() || !verifyTokenMint.trim()) {
              setVerifyStatus('Enter both Private Key and Token CA');
              return;
            }
            setVerifyLoading(true);
            setVerifyStatus('Verifying ownership...');
            try {
              const res = await fetch('/api/configure', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  privateKey: verifyPrivateKey.trim(),
                  tokenMint: verifyTokenMint.trim()
                })
              });
              const data = await res.json();
              if (data.success) {
                // Add to verified cultures
                setVerifiedCultures(prev => new Set([...prev, verifyTokenMint.trim()]));
                setVerifyStatus('✓ Ownership verified!');
                // If there's a pending edit, proceed to it
                if (pendingEditCulture) {
                  setTimeout(() => {
                    localStorage.setItem('edit_culture_data', JSON.stringify(pendingEditCulture));
                    window.location.href = `/culture-coins?view=edit&id=${pendingEditCulture.id || pendingEditCulture.tokenAddress}`;
                  }, 1000);
                }
              } else {
                setVerifyStatus('✗ ' + (data.error || 'Verification failed - ensure you own this token'));
              }
            } catch (e) {
              setVerifyStatus('✗ Error: ' + e.message);
            }
            setVerifyLoading(false);
          };

          // Handle edit button click - requires verification first
          const handleEditCulture = (culture) => {
            const tokenAddress = culture.tokenAddress || culture.id;
            // Check if already verified
            if (verifiedCultures.has(tokenAddress)) {
              localStorage.setItem('edit_culture_data', JSON.stringify(culture));
              window.location.href = `/culture-coins?view=edit&id=${culture.id || tokenAddress}`;
              return;
            }
            // Need verification first
            setPendingEditCulture(culture);
            setVerifyTokenMint(tokenAddress || '');
            setVerifyPrivateKey('');
            setVerifyStatus('');
            setShowVerifyModal(true);
          };

          // TEK Functions
          const updateTekAllocation = (key, value) => {
            const numVal = Math.max(0, Math.min(100, parseInt(value) || 0));
            setTekAllocations(prev => ({ ...prev, [key]: numVal }));
          };

          const getTekTotal = () => {
            return Object.values(tekAllocations).reduce((a, b) => a + b, 0);
          };

          const saveTekAllocations = async () => {
            if (!selectedTekCulture?.tokenAddress) {
              setTekStatus('Select a culture with a token first');
              return;
            }
            if (getTekTotal() !== 100) {
              setTekStatus('Allocations must total 100%');
              return;
            }
            setTekLoading(true);
            setTekStatus('Saving allocations...');
            try {
              const res = await fetch('/api/allocations', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  mint: selectedTekCulture.tokenAddress,
                  wallet: wallet?.address,
                  allocations: tekAllocations
                })
              });
              const data = await res.json();
              if (data.success) {
                setTekStatus('Allocations saved!');
              } else {
                setTekStatus('Error: ' + (data.error || 'Failed to save'));
              }
            } catch (e) {
              setTekStatus('Error: ' + e.message);
            }
            setTekLoading(false);
          };

          const toggleTekLpBurn = async (enabled) => {
            if (!selectedTekCulture?.tokenAddress) return;
            setLpBurnEnabled(enabled);
            try {
              await fetch('/api/feature', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  mint: selectedTekCulture.tokenAddress,
                  wallet: wallet?.address,
                  feature: 'burnLP',
                  enabled
                })
              });
              setTekStatus(enabled ? 'LP Burn enabled' : 'LP Burn disabled');
            } catch (e) {
              setTekStatus('Error: ' + e.message);
              setLpBurnEnabled(!enabled);
            }
          };

          const toggleTekAutoRebalance = async (enabled) => {
            if (!selectedTekCulture?.tokenAddress) return;
            setAutoRebalance(enabled);
            try {
              await fetch('/api/feature', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  mint: selectedTekCulture.tokenAddress,
                  wallet: wallet?.address,
                  feature: 'autoRebalance',
                  enabled
                })
              });
              setTekStatus(enabled ? 'Auto-rebalance enabled' : 'Auto-rebalance disabled');
            } catch (e) {
              setTekStatus('Error: ' + e.message);
              setAutoRebalance(!enabled);
            }
          };

          // Fetch TEK stats when token is selected
          useEffect(() => {
            const fetchTekStats = async () => {
              if (!selectedTekCulture?.tokenAddress) return;
              try {
                const res = await fetch(`/api/stats?mint=${selectedTekCulture.tokenAddress}`);
                const data = await res.json();
                if (data.success) {
                  setTekStats({
                    claimed: data.totalClaimed || 0,
                    distributed: data.totalDistributed || 0,
                    pending: data.pending || 0,
                    holderPool: data.holderPool || 0
                  });
                }
              } catch (e) {
                console.log('[TEK] Stats fetch failed:', e);
              }
            };
            fetchTekStats();
            const interval = setInterval(fetchTekStats, 30000);
            return () => clearInterval(interval);
          }, [selectedTekCulture?.tokenAddress]);

          const startTekAutomation = async () => {
            if (!selectedTekCulture?.tokenAddress) {
              setTekStatus('Select a culture with a token first');
              return;
            }
            setTekLoading(true);
            setTekStatus('Starting automation...');
            try {
              const res = await fetch('/api/auto/start', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  mint: selectedTekCulture.tokenAddress,
                  wallet: wallet?.address
                })
              });
              const data = await res.json();
              if (data.success) {
                setTekAutomationRunning(true);
                setTekStatus('Automation started!');
              } else {
                setTekStatus('Error: ' + (data.error || 'Failed to start'));
              }
            } catch (e) {
              setTekStatus('Error: ' + e.message);
            }
            setTekLoading(false);
          };

          const stopTekAutomation = async () => {
            setTekLoading(true);
            setTekStatus('Stopping automation...');
            try {
              const res = await fetch('/api/auto/stop', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  mint: selectedTekCulture?.tokenAddress,
                  wallet: wallet?.address
                })
              });
              const data = await res.json();
              if (data.success) {
                setTekAutomationRunning(false);
                setTekStatus('Automation stopped');
              } else {
                setTekStatus('Error: ' + (data.error || 'Failed to stop'));
              }
            } catch (e) {
              setTekStatus('Error: ' + e.message);
            }
            setTekLoading(false);
          };

          const runSmartOptimizer = async () => {
            if (!selectedTekCulture?.tokenAddress) {
              setTekStatus('Select a culture with a token first');
              return;
            }
            setTekLoading(true);
            setTekStatus('Running AI analysis...');
            try {
              // Fetch market data from DexScreener
              let marketData = { rsi: 50, tokenPrice: 0, priceChange24h: 0, volume24h: 0, marketCap: 0 };
              try {
                const dexRes = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${selectedTekCulture.tokenAddress}`);
                if (dexRes.ok) {
                  const dexData = await dexRes.json();
                  const pair = dexData.pairs?.[0];
                  if (pair) {
                    marketData = {
                      ...marketData,
                      tokenPrice: parseFloat(pair.priceUsd) || 0,
                      priceChange24h: pair.priceChange?.h24 || 0,
                      volume24h: pair.volume?.h24 || 0,
                      marketCap: pair.marketCap || pair.fdv || 0
                    };
                  }
                }
              } catch (e) { console.log('DexScreener fetch failed:', e); }

              const res = await fetch('/api/ai/optimize', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  mint: selectedTekCulture.tokenAddress,
                  wallet: wallet?.address,
                  rsi: marketData.rsi,
                  tokenPrice: marketData.tokenPrice,
                  priceChange24h: marketData.priceChange24h,
                  volume24h: marketData.volume24h,
                  marketCap: marketData.marketCap
                })
              });
              const data = await res.json();
              if (data.success && data.allocations) {
                setTekAllocations({
                  marketMaking: data.allocations.marketMaking || 25,
                  buybackBurn: data.allocations.buybackBurn || 25,
                  liquidity: data.allocations.liquidity || 25,
                  creatorRevenue: data.allocations.creatorRevenue || 25
                });
                setTekStatus(`AI optimized! ${data.reasoning || 'Allocations updated based on market conditions.'}`);
              } else {
                setTekStatus('Error: ' + (data.error || 'Optimization failed'));
              }
            } catch (e) {
              setTekStatus('Error: ' + e.message);
            }
            setTekLoading(false);
          };

          // State for all tokens created by this wallet (from /api/my-tokens)
          const [myTokens, setMyTokens] = useState([]);
          const [tokensLoading, setTokensLoading] = useState(false);

          // Fetch all tokens created by connected wallet (same as main dashboard)
          useEffect(() => {
            const fetchMyTokens = async () => {
              if (!wallet?.address) {
                setMyTokens([]);
                return;
              }
              setTokensLoading(true);
              try {
                console.log('[TEK] Fetching tokens for wallet:', wallet.address);
                const res = await fetch(`/api/my-tokens?wallet=${wallet.address}`);
                const data = await res.json();
                const tokens = data.tokens || [];
                console.log('[TEK] Found', tokens.length, 'tokens');
                setMyTokens(tokens);

                // Auto-select first token if none selected
                if (tokens.length > 0 && !selectedTekCulture) {
                  setSelectedTekCulture({
                    tokenAddress: tokens[0].mint,
                    name: tokens[0].name,
                    ticker: tokens[0].symbol,
                    image: tokens[0].image
                  });
                }
              } catch (e) {
                console.error('[TEK] Failed to fetch tokens:', e);
                setMyTokens([]);
              }
              setTokensLoading(false);
            };

            fetchMyTokens();
          }, [wallet?.address]);

          // Auto-select TEK culture when cultures load (fallback to cultures if no tokens)
          useEffect(() => {
            if (myTokens.length === 0 && myCultures.length > 0 && !selectedTekCulture) {
              const withToken = myCultures.find(c => c.tokenAddress);
              if (withToken) {
                setSelectedTekCulture(withToken);
                setSelectedChartCulture(withToken); // Also set chart culture
              }
            }
          }, [myCultures, myTokens]);

          // Dashboard Colors - Wall Street x Solana (Elegant Coral/Gold)
          const dashColors = lightMode ? {
            bg: '#fafafa',
            cardBg: '#ffffff',
            border: '#e5e5e5',
            text: '#171717',
            textSecondary: '#404040',
            textMuted: '#737373',
            accent: '#8b5cf6',
            accentAlt: '#06b6d4',
            cyan: '#06b6d4',
            coral: '#06b6d4', // Alias for backwards compat
            peach: '#FFAB91',
            purple: '#8b5cf6',
            gold: '#8b5cf6', // Alias for backwards compat
            inputBg: '#ffffff',
            inputBorder: '#d4d4d4',
            gradient: 'linear-gradient(135deg, #8b5cf6 0%, #06b6d4 100%)',
            gradientSubtle: 'linear-gradient(135deg, rgba(6,182,212,0.1) 0%, rgba(139,92,246,0.1) 100%)'
          } : {
            bg: '#0a0a0a',
            cardBg: '#0f0f0f',
            border: '#1a1a1a',
            text: '#ffffff',
            textSecondary: '#a0a0a0',
            textMuted: '#666666',
            accent: '#8b5cf6',
            accentAlt: '#06b6d4',
            cyan: '#06b6d4',
            coral: '#06b6d4', // Alias for backwards compat
            peach: '#FFAB91',
            purple: '#8b5cf6',
            gold: '#8b5cf6', // Alias for backwards compat
            inputBg: '#111111',
            inputBorder: '#333333',
            gradient: 'linear-gradient(135deg, #8b5cf6 0%, #06b6d4 100%)',
            gradientSubtle: 'linear-gradient(135deg, rgba(6,182,212,0.08) 0%, rgba(139,92,246,0.08) 100%)'
          };

          // Import Existing Coin Modal State
          const [showImportModal, setShowImportModal] = useState(false);
          const [importTokenAddress, setImportTokenAddress] = useState('');
          const [importLoading, setImportLoading] = useState(false);
          const [importedTokenData, setImportedTokenData] = useState(null);

          // Profile & Social State
          const [profile, setProfile] = useState(() => {
            if (typeof window !== 'undefined') {
              try {
                const stored = localStorage.getItem('creator_profile_' + wallet?.address);
                return stored ? JSON.parse(stored) : null;
              } catch { return null; }
            }
            return null;
          });
          const [myPosts, setMyPosts] = useState([]);

          // Load profile when wallet changes and sync to server
          useEffect(() => {
            if (wallet?.address) {
              try {
                const stored = localStorage.getItem('creator_profile_' + wallet.address);
                // Also load dashboard theme separately in case profile doesn't have it
                const dashTheme = JSON.parse(localStorage.getItem('dashboard_theme') || '{}');
                let profileData;
                if (stored) {
                  profileData = JSON.parse(stored);
                  // Merge dashboard theme into profile if profile doesn't have theme
                  setProfile({ ...profileData, theme: profileData.theme || dashTheme });
                } else {
                  profileData = { wallet: wallet.address, displayName: '', bio: '', pfp: null, banner: null, theme: dashTheme };
                  setProfile(profileData);
                }

                // AUTO-GENERATE PFP if user doesn't have one (NFT-worthy 512x512)
                if (!profileData.pfp) {
                  fetch(`/api/profile/auto-pfp?wallet=${wallet.address}`)
                    .then(res => res.json())
                    .then(data => {
                      if (data.pfp) {
                        console.log('[PFP] Auto-generated NFT-worthy PFP');
                        const updatedProfile = { ...profileData, pfp: data.pfp };
                        setProfile(prev => ({ ...prev, pfp: data.pfp }));
                        localStorage.setItem('creator_profile_' + wallet.address, JSON.stringify(updatedProfile));
                        // Also sync to server
                        fetch('/api/profile', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({
                            wallet: wallet.address,
                            displayName: updatedProfile.displayName || '',
                            avatar: data.pfp
                          })
                        }).catch(e => console.log('[PFP] Server sync failed:', e));
                      }
                    })
                    .catch(e => console.log('[PFP] Auto-generate failed:', e));
                }

                // Sync profile to server on load (ensures SQLite has the display name)
                if (profileData.displayName || profileData.pfp) {
                  fetch('/api/profile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                      wallet: wallet.address,
                      displayName: profileData.displayName || '',
                      username: profileData.username || '',
                      bio: profileData.bio || '',
                      avatar: profileData.pfp || null
                    })
                  }).catch(e => console.log('[PROFILE] Sync on load failed:', e));
                }
                // Load ALL posts from everyone
                const allPosts = JSON.parse(localStorage.getItem('culture_posts') || '[]');
                // Enrich posts with profile display names
                const enrichedPosts = allPosts.map(post => {
                  if (post.authorWallet) {
                    try {
                      const profile = JSON.parse(localStorage.getItem('creator_profile_' + post.authorWallet) || 'null');
                      if (profile?.displayName) {
                        return { ...post, authorName: profile.displayName, authorPfp: profile.pfp || post.authorPfp };
                      }
                    } catch (e) {}
                  }
                  return post;
                });
                enrichedPosts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                setMyPosts(enrichedPosts);
              } catch (e) {
                console.error('[DASHBOARD] Error loading profile:', e);
              }
            }
          }, [wallet?.address]);

          // Save profile changes - syncs to server so all users see display name
          const handleEditProfile = async (updates) => {
            if (!wallet?.address) return;
            const newProfile = { ...profile, ...updates, wallet: wallet.address };
            setProfile(newProfile);
            localStorage.setItem('creator_profile_' + wallet.address, JSON.stringify(newProfile));
            // Sync to server so posts show correct username
            try {
              await fetch('/api/profile', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  wallet: wallet.address,
                  displayName: newProfile.displayName || '',
                  username: newProfile.username || '',
                  bio: newProfile.bio || '',
                  avatar: newProfile.pfp || null
                })
              });
              console.log('[PROFILE] Synced to server:', newProfile.displayName);
            } catch (e) {
              console.error('[PROFILE] Server sync failed:', e);
            }
          };

          // Create a new post
          const handleCreatePost = async (postData) => {
            const newPost = {
              id: Date.now().toString(),
              ...postData,
              authorWallet: wallet?.address,
              authorName: profile?.displayName || wallet?.address?.slice(0, 6) + '...' + wallet?.address?.slice(-4),
              authorPfp: profile?.pfp,
              createdAt: new Date().toISOString(),
              likes: [],
              comments: [],
              reposts: 0
            };

            // Save to server API first
            try {
              const apiRes = await fetch('/api/posts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  authorWallet: wallet?.address,
                  cultureId: postData.cultureId,
                  content: postData.content,
                  mediaUrls: postData.media ? [postData.media] : []
                })
              });
              const apiData = await apiRes.json();
              if (apiData.success) {
                console.log('[POST] Saved to server:', apiData.post?.id);
                newPost.id = apiData.post?.id || newPost.id;
              }
            } catch (e) {
              console.error('[POST] Server save failed:', e);
            }

            // Also save to localStorage for backward compat
            const allPosts = JSON.parse(localStorage.getItem('culture_posts') || '[]');
            allPosts.unshift(newPost);
            localStorage.setItem('culture_posts', JSON.stringify(allPosts));

            // Update local state
            setMyPosts(prev => [newPost, ...prev]);
          };

          // Handle like
          const handleLike = (postId) => {
            if (!wallet?.address) return;
            const allPosts = JSON.parse(localStorage.getItem('culture_posts') || '[]');
            const updatedAll = allPosts.map(p => {
              if (p.id === postId) {
                const likes = p.likes || [];
                const isLiked = likes.includes(wallet.address);
                return { ...p, likes: isLiked ? likes.filter(l => l !== wallet.address) : [...likes, wallet.address] };
              }
              return p;
            });
            localStorage.setItem('culture_posts', JSON.stringify(updatedAll));
            setMyPosts(updatedAll.filter(p => p.authorWallet === wallet.address));
          };

          // Handle comment
          const handleComment = (postId, comment) => {
            if (!wallet?.address) return;
            const allPosts = JSON.parse(localStorage.getItem('culture_posts') || '[]');
            const updatedAll = allPosts.map(p => {
              if (p.id === postId) {
                return {
                  ...p,
                  comments: [...(p.comments || []), {
                    author: wallet.address.slice(0, 6) + '...' + wallet.address.slice(-4),
                    content: comment,
                    createdAt: new Date().toISOString()
                  }]
                };
              }
              return p;
            });
            localStorage.setItem('culture_posts', JSON.stringify(updatedAll));
            setMyPosts(updatedAll.filter(p => p.authorWallet === wallet.address));
          };

          // Handle repost
          const handleRepost = (postId) => {
            if (!wallet?.address) return;
            const allPosts = JSON.parse(localStorage.getItem('culture_posts') || '[]');
            const updatedAll = allPosts.map(p => {
              if (p.id === postId) {
                const reposts = p.repostedBy || [];
                const hasReposted = reposts.includes(wallet.address);
                return {
                  ...p,
                  reposts: hasReposted ? (p.reposts || 1) - 1 : (p.reposts || 0) + 1,
                  repostedBy: hasReposted
                    ? reposts.filter(r => r !== wallet.address)
                    : [...reposts, wallet.address]
                };
              }
              return p;
            });
            localStorage.setItem('culture_posts', JSON.stringify(updatedAll));
            setMyPosts(updatedAll.filter(p => p.authorWallet === wallet.address));
          };

          // Auto-select first culture for chart when cultures load
          useEffect(() => {
            if (myCultures.length > 0 && !selectedChartCulture) {
              const firstWithToken = myCultures.find(c => c.tokenAddress);
              if (firstWithToken) {
                setSelectedChartCulture(firstWithToken);
              }
            }
          }, [myCultures]);

          // Fetch chart data when selected culture changes
          useEffect(() => {
            const fetchChartData = async () => {
              if (!selectedChartCulture?.tokenAddress) {
                setChartData(null);
                return;
              }
              try {
                const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${selectedChartCulture.tokenAddress}`);
                if (res.ok) {
                  const data = await res.json();
                  const pair = data.pairs?.[0];
                  if (pair) {
                    setChartData(pair);
                  }
                }
              } catch (e) {
                console.error('[DASHBOARD] Failed to fetch chart data:', e);
              }
            };
            fetchChartData();
          }, [selectedChartCulture?.tokenAddress]);

          // Fetch ALL coins created by this wallet from pump.fun + our cultures API
          useEffect(() => {
            const fetchMyCultures = async () => {
              if (!wallet?.address) {
                setLoading(false);
                return;
              }
              try {
                console.log('[DASHBOARD] Fetching coins for wallet:', wallet.address);

                // Fetch from BOTH sources in parallel
                const [culturesRes, pumpCoinsRes] = await Promise.all([
                  fetch('/api/cultures'),
                  fetch(`/api/pump/coins-by-creator?wallet=${wallet.address}`)
                ]);

                const culturesData = await culturesRes.json();
                const pumpCoins = await pumpCoinsRes.json();

                console.log('[DASHBOARD] Our cultures:', culturesData?.cultures?.length || 0);
                console.log('[DASHBOARD] Pump.fun coins:', pumpCoins?.length || 0);

                // Get our saved cultures for this wallet
                const ourCultures = (culturesData?.cultures || []).filter(c =>
                  c.wallet === wallet.address ||
                  c.creator === wallet.address ||
                  c.creatorWallet === wallet.address
                );

                // Create a map of token addresses we already have
                const existingTokens = new Set(ourCultures.map(c => c.tokenAddress).filter(Boolean));

                // Convert pump.fun coins to culture format (for ones we don't already have)
                const pumpCultures = (pumpCoins || [])
                  .filter(coin => !existingTokens.has(coin.mint))
                  .map(coin => ({
                    id: `pump_${coin.mint}`,
                    name: coin.name || 'Unnamed Token',
                    ticker: coin.symbol || 'TOKEN',
                    tokenAddress: coin.mint,
                    creator: wallet.address,
                    creatorWallet: wallet.address,
                    creatorName: coin.creator_username || 'Creator',
                    marketCap: coin.usd_market_cap || 0,
                    holders: coin.holder_count || 0,
                    volume: coin.volume_24h || 0,
                    imageUri: coin.image_uri,
                    description: coin.description,
                    createdAt: coin.created_timestamp ? new Date(coin.created_timestamp).toISOString() : new Date().toISOString(),
                    // Mark as needing culture setup
                    needsCultureSetup: true,
                    // Default empty culture data
                    theme: {},
                    beliefs: [],
                    unlocks: [],
                    tiers: [],
                    ethos: coin.description || ''
                  }));

                // Merge and enrich with live pump.fun data
                const allCultures = [...ourCultures, ...pumpCultures];

                const enriched = await Promise.all(allCultures.map(async (culture) => {
                  if (!culture.tokenAddress) return culture;
                  // Skip enrichment if we already have pump data
                  if (culture.marketCap && culture.holders) return culture;
                  try {
                    const pumpRes = await fetch(`/api/pump/coin/${culture.tokenAddress}`);
                    if (pumpRes.ok) {
                      const pumpData = await pumpRes.json();
                      if (pumpData) {
                        return {
                          ...culture,
                          marketCap: pumpData.usd_market_cap || culture.marketCap || 0,
                          holders: pumpData.holder_count || culture.holders || 0,
                          volume: pumpData.volume_24h || culture.volume || 0,
                          imageUri: pumpData.image_uri || culture.imageUri
                        };
                      }
                    }
                  } catch (e) {
                    console.error('[DASHBOARD] Failed to enrich', culture.name, e);
                  }
                  return culture;
                }));

                console.log('[DASHBOARD] Total cultures after merge:', enriched.length);
                setMyCultures(enriched);
              } catch (e) {
                console.error('[DASHBOARD] Error fetching cultures:', e);
              } finally {
                setLoading(false);
              }
            };
            fetchMyCultures();
          }, [wallet?.address]);

          // Combine counts from myCultures + myTokens (deduplicated)
          const totalParticipation = React.useMemo(() => {
            // Build deduplicated set of all token addresses
            const tokenAddrs = new Set();
            myCultures.forEach(c => { if (c.tokenAddress) tokenAddrs.add(c.tokenAddress); });
            myTokens.forEach(t => { if (t.mint) tokenAddrs.add(t.mint); });

            // Total unique cultures/tokens
            const totalCount = Math.max(tokenAddrs.size, myCultures.length, myTokens.length);

            // Sum stats from both sources
            const holdersFromCultures = myCultures.reduce((sum, c) => sum + (c.holders || 0), 0);
            const holdersFromTokens = myTokens.reduce((sum, t) => sum + (t.holders || 0), 0);
            const volumeFromCultures = myCultures.reduce((sum, c) => sum + (c.volume || 0), 0);
            const volumeFromTokens = myTokens.reduce((sum, t) => sum + (t.volume || 0), 0);

            return {
              culturesCreated: totalCount,
              totalHolders: Math.max(holdersFromCultures, holdersFromTokens),
              totalVolume: Math.max(volumeFromCultures, volumeFromTokens)
            };
          }, [myCultures, myTokens]);

          // Import existing coin from multiple sources (pump.fun, DexScreener, Jupiter)
          const handleImportCoin = async () => {
            const mint = importTokenAddress.trim();
            if (!mint) {
              alert('Please enter a token address');
              return;
            }

            setImportLoading(true);
            try {
              // Fetch from multiple sources in parallel (like main dashboard)
              const [pumpRes, dexRes, jupRes] = await Promise.all([
                fetch(`/api/pump/coin/${mint}`).catch(() => null),
                fetch(`https://api.dexscreener.com/latest/dex/tokens/${mint}`).catch(() => null),
                fetch(`https://lite-api.jup.ag/tokens/v2/search?query=${mint}`).catch(() => null)
              ]);

              let tokenData = null;

              // Try pump.fun first
              if (pumpRes?.ok) {
                const pumpData = await pumpRes.json();
                if (pumpData?.mint) {
                  tokenData = {
                    mint: pumpData.mint,
                    name: pumpData.name || 'Unknown',
                    symbol: pumpData.symbol || '???',
                    image: pumpData.image_uri || pumpData.image || null,
                    marketCap: pumpData.usd_market_cap || 0,
                    holders: pumpData.holder_count || 0,
                    source: 'pump.fun'
                  };
                }
              }

              // Fallback to DexScreener
              if (!tokenData && dexRes?.ok) {
                const dexData = await dexRes.json();
                const pair = dexData.pairs?.[0];
                if (pair) {
                  tokenData = {
                    mint: mint,
                    name: pair.baseToken?.name || 'Unknown',
                    symbol: pair.baseToken?.symbol || '???',
                    image: pair.info?.imageUrl || null,
                    marketCap: pair.marketCap || pair.fdv || 0,
                    holders: 0,
                    source: 'dexscreener'
                  };
                }
              }

              // Fallback to Jupiter
              if (!tokenData && jupRes?.ok) {
                const jupArr = await jupRes.json();
                const jupToken = Array.isArray(jupArr) ? jupArr.find(t => t.address === mint || t.id === mint) : null;
                if (jupToken) {
                  tokenData = {
                    mint: mint,
                    name: jupToken.name || 'Unknown',
                    symbol: jupToken.symbol || '???',
                    image: jupToken.logoURI || null,
                    marketCap: 0,
                    holders: jupToken.holderCount || 0,
                    source: 'jupiter'
                  };
                }
              }

              // Last resort: create minimal entry with just the mint
              if (!tokenData) {
                tokenData = {
                  mint: mint,
                  name: 'Token ' + mint.slice(0, 6),
                  symbol: mint.slice(0, 4).toUpperCase(),
                  image: null,
                  marketCap: 0,
                  holders: 0,
                  source: 'manual'
                };
              }

              setImportedTokenData(tokenData);
            } catch (e) {
              console.error('[IMPORT] Error:', e);
              alert('Failed to find token: ' + e.message);
              setImportedTokenData(null);
            } finally {
              setImportLoading(false);
            }
          };

          const handleConfirmImport = async () => {
            if (!importedTokenData) return;

            try {
              // Create culture entry for this existing token
              const cultureData = {
                name: importedTokenData.name || 'Imported Token',
                ticker: importedTokenData.symbol || 'TOKEN',
                creatorName: profile?.displayName || wallet.address.slice(0, 8),
                ethos: [],
                category: 'other',
                theme: {},
                beliefs: [],
                unlocks: [],
                tiers: [
                  { name: 'Observer', holdingPercent: 0.1, access: 'Read-only access', content: [] },
                  { name: 'Participant', holdingPercent: 0.5, access: 'Join discussions', content: [] }
                ],
                tokenAddress: importedTokenData.mint,
                vanityAddress: importedTokenData.mint,
                wallet: wallet.address,
                isImported: true // Mark as imported, not created through our flow
              };

              const response = await fetch('/api/culture/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(cultureData)
              });

              const result = await response.json();
              if (result.success) {
                // Add to local cultures
                setMyCultures(prev => [...prev, result.culture]);
                setShowImportModal(false);
                setImportTokenAddress('');
                setImportedTokenData(null);
                alert('Token imported successfully! You can now edit its culture page.');
              } else {
                throw new Error(result.error || 'Failed to import');
              }
            } catch (e) {
              alert('Failed to import token: ' + e.message);
            }
          };

          // Combine myCultures with myTokens for complete list
          // myTokens comes from local tracker, myCultures from pump.fun API + our cultures
          const allMyCultures = React.useMemo(() => {
            const cultureMap = new Map();

            // First add myCultures (has full culture data)
            myCultures.forEach(c => {
              const key = c.tokenAddress || c.id;
              if (key) cultureMap.set(key, c);
            });

            // Then add myTokens that aren't already in myCultures
            myTokens.forEach(t => {
              if (!cultureMap.has(t.mint)) {
                cultureMap.set(t.mint, {
                  id: `token_${t.mint}`,
                  name: t.name || 'Unnamed Token',
                  ticker: t.symbol || 'TOKEN',
                  tokenAddress: t.mint,
                  imageUri: t.image,
                  marketCap: t.mcap || 0,
                  holders: t.holders || 0,
                  volume: t.volume || 0,
                  needsCultureSetup: true,
                  theme: {},
                  beliefs: [],
                  unlocks: [],
                  tiers: []
                });
              }
            });

            return Array.from(cultureMap.values());
          }, [myCultures, myTokens]);

          // Filter by search query (name, ticker, or contract address)
          const filteredCultures = allMyCultures.filter(c => {
            if (!searchQuery.trim()) return true;
            const query = searchQuery.toLowerCase().trim();
            return (
              (c.name && c.name.toLowerCase().includes(query)) ||
              (c.ticker && c.ticker.toLowerCase().includes(query)) ||
              (c.symbol && c.symbol.toLowerCase().includes(query)) ||
              (c.tokenAddress && c.tokenAddress.toLowerCase().includes(query))
            );
          });

          // Not connected state - Login Screen
          if (!wallet?.address) {
            return (
              <div style={{
                padding: '136px 40px 60px',
                minHeight: '100vh',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                background: 'linear-gradient(180deg, #0a0a0a 0%, #0f0f0f 50%, #0a0a0a 100%)'
              }}>
                <div style={{
                  maxWidth: '450px',
                  textAlign: 'center',
                  padding: '60px 40px',
                  background: 'rgba(15, 15, 15, 0.8)',
                  border: '1px solid #1a1a1a',
                  boxShadow: '0 0 60px rgba(139, 92, 246, 0.05)'
                }}>
                  <div style={{
                    width: '80px',
                    height: '80px',
                    margin: '0 auto 32px',
                    borderRadius: '50%',
                    background: '#8b5cf6',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center'
                  }}>
                    <svg width="36" height="36" viewBox="0 0 24 24" fill="#000" stroke="none">
                      <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                    </svg>
                  </div>
                  <h1 style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '36px',
                    fontWeight: 400,
                    color: '#fff',
                    marginBottom: '16px'
                  }}>
                    Welcome to Culture Coins
                  </h1>
                  <p style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '13px',
                    color: '#888',
                    marginBottom: '12px',
                    lineHeight: 1.8
                  }}>
                    Your Web3 social space for crypto creators.
                  </p>
                  <p style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '12px',
                    color: '#555',
                    marginBottom: '40px',
                    lineHeight: 1.7
                  }}>
                    Connect your wallet to access your personal dashboard, create cultures, post content, and connect with the community.
                  </p>
                  <button
                    onClick={wallet?.connect}
                    style={{
                      padding: '18px 50px',
                      background: '#8b5cf6',
                      border: 'none',
                      color: '#000',
                      fontSize: '13px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      fontWeight: 700,
                      transition: 'all 0.3s'
                    }}
                  >
                    CONNECT WALLET TO ENTER
                  </button>
                  <p style={{
                    marginTop: '24px',
                    fontSize: '10px',
                    color: '#444',
                    fontFamily: "'IBM Plex Mono', monospace"
                  }}>
                    Supports Phantom, Solflare, and other Solana wallets
                  </p>
                </div>
              </div>
            );
          }

          // Loading state
          if (loading) {
            return (
              <div style={{ padding: '136px 40px 60px', textAlign: 'center' }}>
                <p style={{ color: '#888', fontFamily: "'IBM Plex Mono', monospace" }}>Loading your cultures...</p>
              </div>
            );
          }

          return (
            <div style={{
              padding: '136px 40px 60px',
              background: dashColors.bg,
              minHeight: '100vh',
              color: dashColors.text,
              transition: 'all 0.3s ease'
            }}>
              {/* Creator Profile Header */}
              <CreatorProfileHeader
                profile={profile}
                onEditProfile={handleEditProfile}
                isOwner={true}
                stats={{
                  cultures: totalParticipation.culturesCreated,
                  posts: myPosts.length,
                  followers: 0,
                  following: 0
                }}
              />

              {/* Dashboard Tabs */}
              <div style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '32px',
                borderBottom: `1px solid ${dashColors.border}`,
                paddingBottom: '16px'
              }}>
                <div style={{ display: 'flex', gap: '24px' }}>
                  {[
                    { id: 'overview', label: 'Overview' },
                    { id: 'posts', label: 'My Posts' },
                    { id: 'cultures', label: 'My Cultures' },
                    { id: 'tek', label: 'TEK Engine' },
                    { id: 'settings', label: 'Settings' }
                  ].map(tab => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      style={{
                        background: 'none',
                        border: 'none',
                        color: activeTab === tab.id ? dashColors.accent : dashColors.textMuted,
                        fontSize: '13px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.05em',
                        cursor: 'pointer',
                        padding: '8px 0',
                        borderBottom: activeTab === tab.id ? `2px solid ${dashColors.accent}` : '2px solid transparent',
                        transition: 'all 0.2s'
                      }}
                    >
                      {tab.label}
                    </button>
                  ))}
                </div>

                {/* Light/Dark Mode Toggle */}
                <button
                  onClick={() => {
                    const newMode = !lightMode;
                    setLightMode(newMode);
                    localStorage.setItem('lightMode', JSON.stringify(newMode));
                  }}
                  style={{
                    padding: '8px 12px',
                    background: lightMode ? '#e5e5e5' : 'transparent',
                    border: `1px solid ${lightMode ? '#d4d4d4' : '#333'}`,
                    color: lightMode ? '#333' : '#888',
                    fontSize: '11px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}
                  title="Toggle light/dark mode"
                >
                  {lightMode ? (
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                  ) : (
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <circle cx="12" cy="12" r="5"/>
                      <line x1="12" y1="1" x2="12" y2="3"/>
                      <line x1="12" y1="21" x2="12" y2="23"/>
                      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                      <line x1="1" y1="12" x2="3" y2="12"/>
                      <line x1="21" y1="12" x2="23" y2="12"/>
                      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                  )}
                </button>
              </div>

              {/* Collapsible Tools & Data Section */}
              <div style={{
                marginBottom: '32px',
                background: dashColors.cardBg,
                border: `1px solid ${dashColors.border}`
              }}>
                <button
                  onClick={() => setToolsExpanded(!toolsExpanded)}
                  style={{
                    width: '100%',
                    padding: '16px 20px',
                    background: 'none',
                    border: 'none',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    cursor: 'pointer',
                    borderBottom: toolsExpanded ? `1px solid ${dashColors.border}` : 'none'
                  }}
                >
                  <span style={{
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '11px',
                    color: dashColors.accent,
                    letterSpacing: '0.15em'
                  }}>
                    DASHBOARD TOOLS & INTEGRATIONS
                  </span>
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke={dashColors.textMuted}
                    strokeWidth="2"
                    style={{
                      transform: toolsExpanded ? 'rotate(180deg)' : 'rotate(0deg)',
                      transition: 'transform 0.2s'
                    }}
                  >
                    <polyline points="6 9 12 15 18 9"/>
                  </svg>
                </button>

                {toolsExpanded && (
                  <div style={{ padding: '20px' }}>
                    {/* Stats Grid */}
                    <div style={{
                      display: 'grid',
                      gridTemplateColumns: 'repeat(4, 1fr)',
                      gap: '16px',
                      marginBottom: '24px'
                    }}>
                      {[
                        { value: totalParticipation.culturesCreated, label: 'CULTURES', color: dashColors.coral },
                        { value: myPosts.length, label: 'POSTS', color: dashColors.peach },
                        { value: totalParticipation.totalHolders, label: 'HOLDERS', color: dashColors.gold },
                        { value: `$${totalParticipation.totalVolume.toLocaleString()}`, label: 'VOLUME', color: dashColors.accent }
                      ].map((stat, i) => (
                        <div key={i} style={{
                          background: dashColors.gradientSubtle,
                          border: `1px solid ${dashColors.border}`,
                          padding: '20px',
                          textAlign: 'center',
                          borderRadius: '6px',
                          boxShadow: '0 2px 12px rgba(6, 182, 212, 0.05)'
                        }}>
                          <div style={{
                            fontSize: '28px',
                            color: stat.color,
                            fontFamily: "'IBM Plex Mono', monospace",
                            marginBottom: '4px',
                            fontWeight: 700,
                            textShadow: `0 0 20px ${stat.color}40`
                          }}>
                            {stat.value}
                          </div>
                          <div style={{
                            fontSize: '9px',
                            color: dashColors.textMuted,
                            letterSpacing: '0.15em',
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            {stat.label}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>

              {/* Tab Content */}
              {activeTab === 'overview' && (
                <>
                  {/* Post Composer */}
                  <PostComposer
                    onPost={handleCreatePost}
                    profile={profile}
                    cultures={myCultures}
                  />

                  {/* Recent Activity - My Posts */}
                  <div style={{ marginBottom: '32px' }}>
                    <h3 style={{
                      fontSize: '12px',
                      letterSpacing: '0.15em',
                      color: '#666',
                      marginBottom: '16px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      RECENT ACTIVITY
                    </h3>
                    {myPosts.length === 0 ? (
                      <div style={{
                        padding: '40px',
                        background: '#0f0f0f',
                        border: '1px solid #1a1a1a',
                        textAlign: 'center'
                      }}>
                        <p style={{
                          color: '#666',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '14px'
                        }}>
                          No posts yet. Share something with your community!
                        </p>
                      </div>
                    ) : (
                      myPosts.slice(0, 3).map(post => (
                        <PostCard
                          key={post.id}
                          post={post}
                          currentUser={wallet?.address}
                          onLike={handleLike}
                          onComment={handleComment}
                          onRepost={handleRepost}
                        />
                      ))
                    )}
                  </div>
                </>
              )}

              {activeTab === 'posts' && (
                <div>
                  <PostComposer
                    onPost={handleCreatePost}
                    profile={profile}
                    cultures={myCultures}
                  />
                  {myPosts.length === 0 ? (
                    <div style={{
                      padding: '60px 40px',
                      background: '#0f0f0f',
                      border: '1px solid #1a1a1a',
                      textAlign: 'center'
                    }}>
                      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#666" strokeWidth="1" style={{ marginBottom: '16px', opacity: 0.3 }}>
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>
                    </svg>
                      <p style={{
                        color: '#666',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '14px'
                      }}>
                        No posts yet. Start sharing your journey!
                      </p>
                    </div>
                  ) : (
                    myPosts.map(post => (
                      <PostCard
                        key={post.id}
                        post={post}
                        currentUser={wallet?.address}
                        onLike={handleLike}
                        onComment={handleComment}
                        onRepost={handleRepost}
                      />
                    ))
                  )}
                </div>
              )}

              {activeTab === 'cultures' && (
                <>

              {/* Price Chart - Premium Design */}
              {selectedChartCulture?.tokenAddress && (
                <div style={{
                  marginBottom: '48px',
                  background: 'linear-gradient(180deg, rgba(139, 92, 246, 0.03) 0%, rgba(0,0,0,0) 100%)',
                  border: '1px solid rgba(139, 92, 246, 0.3)',
                  boxShadow: '0 0 30px rgba(139, 92, 246, 0.1), inset 0 0 60px rgba(139, 92, 246, 0.02)',
                  position: 'relative',
                  overflow: 'hidden'
                }}>
                  {/* Top glow line */}
                  <div style={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    right: 0,
                    height: '1px',
                    background: 'linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.5), transparent)'
                  }} />

                  {/* Chart Header */}
                  <div style={{
                    padding: '16px 24px',
                    borderBottom: '1px solid rgba(139, 92, 246, 0.15)',
                    background: 'rgba(0, 0, 0, 0.4)',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    flexWrap: 'wrap',
                    gap: '16px'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
                      <div style={{
                        fontSize: '11px',
                        letterSpacing: '0.15em',
                        color: '#8b5cf6',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontWeight: 600
                      }}>
                        PRICE CHART
                      </div>

                      {/* Live Price */}
                      {chartData && (
                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                          <span style={{
                            fontSize: '20px',
                            fontWeight: 600,
                            color: '#fff',
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            ${parseFloat(chartData.priceUsd || 0) < 0.0001
                              ? parseFloat(chartData.priceUsd || 0).toExponential(2)
                              : parseFloat(chartData.priceUsd || 0).toFixed(6)}
                          </span>
                          <span style={{
                            fontSize: '13px',
                            fontWeight: 500,
                            padding: '4px 10px',
                            borderRadius: '4px',
                            background: (chartData.priceChange?.h24 || 0) >= 0 ? 'rgba(139,92,246,0.15)' : 'rgba(239,68,68,0.15)',
                            color: (chartData.priceChange?.h24 || 0) >= 0 ? '#8b5cf6' : '#ef4444'
                          }}>
                            {(chartData.priceChange?.h24 || 0) >= 0 ? '+' : ''}{(chartData.priceChange?.h24 || 0).toFixed(2)}%
                          </span>
                        </div>
                      )}
                    </div>

                    <div style={{ display: 'flex', alignItems: 'center', gap: '24px' }}>
                      {/* Quick Stats */}
                      {chartData && (
                        <div style={{ display: 'flex', alignItems: 'center', gap: '24px', paddingRight: '20px', borderRight: '1px solid #222' }}>
                          <div style={{ textAlign: 'right' }}>
                            <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginBottom: '2px' }}>MCAP</div>
                            <div style={{ fontSize: '13px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                              ${(chartData.marketCap || chartData.fdv || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}
                            </div>
                          </div>
                          <div style={{ textAlign: 'right' }}>
                            <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginBottom: '2px' }}>24H VOL</div>
                            <div style={{ fontSize: '13px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                              ${(chartData.volume?.h24 || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}
                            </div>
                          </div>
                          <div style={{ textAlign: 'right' }}>
                            <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginBottom: '2px' }}>LIQ</div>
                            <div style={{ fontSize: '13px', color: '#8b5cf6', fontFamily: "'IBM Plex Mono', monospace" }}>
                              ${(chartData.liquidity?.usd || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}
                            </div>
                          </div>
                        </div>
                      )}

                      {/* Size Controls */}
                      <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                        {[300, 400, 550, 700].map(h => (
                          <button
                            key={h}
                            onClick={() => setChartHeight(h)}
                            style={{
                              padding: '6px 12px',
                              fontSize: '10px',
                              borderRadius: '4px',
                              border: chartHeight === h ? '1px solid #8b5cf6' : '1px solid #333',
                              background: chartHeight === h ? 'rgba(139,92,246,0.15)' : 'transparent',
                              color: chartHeight === h ? '#8b5cf6' : '#666',
                              cursor: 'pointer',
                              fontFamily: "'IBM Plex Mono', monospace",
                              transition: 'all 0.2s'
                            }}
                          >
                            {h === 300 ? 'S' : h === 400 ? 'M' : h === 550 ? 'L' : 'XL'}
                          </button>
                        ))}
                      </div>
                    </div>
                  </div>

                  {/* Chart Container */}
                  <div style={{ height: chartHeight, background: '#0a0a0a', transition: 'height 0.3s ease' }}>
                    {chartData?.pairAddress ? (
                      <iframe
                        src={`https://dexscreener.com/solana/${chartData.pairAddress}?embed=1&theme=dark&trades=0&info=0`}
                        style={{ width: '100%', height: '100%', border: 'none' }}
                        title="Price Chart"
                      />
                    ) : (
                      <div style={{
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        height: '100%',
                        color: '#666',
                        gap: '12px'
                      }}>
                        <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24" style={{ opacity: 0.3 }}>
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4v16a1 1 0 001 1h14a1 1 0 001-1V4"></path>
                        </svg>
                        <span style={{ fontFamily: "'IBM Plex Mono', monospace", fontSize: '13px' }}>Loading chart...</span>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Search */}
              <div style={{ marginBottom: '24px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  background: '#0f0f0f',
                  border: '1px solid #222',
                  padding: '0 16px'
                }}>
                  <span style={{ color: '#666', marginRight: '12px', fontSize: '14px' }}>⌕</span>
                  <input
                    type="text"
                    placeholder="Search by name, ticker, or contract address..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    style={{
                      flex: 1,
                      padding: '14px 0',
                      background: 'transparent',
                      border: 'none',
                      outline: 'none',
                      color: '#fff',
                      fontSize: '13px',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}
                  />
                  {searchQuery && (
                    <button
                      onClick={() => setSearchQuery('')}
                      style={{
                        background: 'transparent',
                        border: 'none',
                        color: '#666',
                        cursor: 'pointer',
                        fontSize: '16px',
                        padding: '4px 8px'
                      }}
                    >
                      ✕
                    </button>
                  )}
                </div>
              </div>

              {/* My Cultures */}
              <div style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '24px'
              }}>
                <div style={{
                  fontSize: '10px',
                  letterSpacing: '0.15em',
                  color: '#666',
                  fontFamily: "'IBM Plex Mono', monospace"
                }}>
                  YOUR CULTURES {filteredCultures.length > 0 && `(${filteredCultures.length})`}
                </div>
                {/* Refresh button to re-fetch coins */}
                <button
                  onClick={() => {
                    setLoading(true);
                    setMyCultures([]);
                    // Trigger re-fetch by toggling a state
                    setTimeout(() => {
                      window.location.reload();
                    }, 100);
                  }}
                  style={{
                    padding: '8px 16px',
                    background: 'transparent',
                    border: `1px solid ${dashColors.border}`,
                    color: dashColors.textMuted,
                    fontSize: '10px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    letterSpacing: '0.1em',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}
                >
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M23 4v6h-6"></path>
                    <path d="M1 20v-6h6"></path>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                  </svg>
                  REFRESH
                </button>
              </div>

              <div style={{ display: 'flex', flexDirection: 'column', gap: '32px' }}>
                {loading && (
                  <div style={{
                    textAlign: 'center',
                    padding: '60px 40px',
                    background: dashColors.cardBg,
                    border: `1px solid ${dashColors.border}`
                  }}>
                    <div style={{ fontSize: '14px', color: dashColors.accent, fontFamily: "'IBM Plex Mono', monospace", marginBottom: '16px' }}>
                      Loading your cultures...
                    </div>
                    <p style={{ fontSize: '12px', color: dashColors.textMuted }}>
                      Fetching all tokens you've created from pump.fun
                    </p>
                  </div>
                )}
                {!loading && filteredCultures.length === 0 && (
                  <div style={{
                    textAlign: 'center',
                    padding: '60px 40px',
                    background: dashColors.cardBg,
                    border: `1px solid ${dashColors.border}`
                  }}>
                    <div style={{ fontSize: '14px', color: dashColors.textMuted, fontFamily: "'IBM Plex Mono', monospace", marginBottom: '16px' }}>
                      No tokens found for this wallet
                    </div>
                    <p style={{ fontSize: '12px', color: dashColors.textMuted, marginBottom: '24px' }}>
                      Tokens you create on pump.fun will automatically appear here.<br/>
                      You can then add culture info like beliefs, tiers, and themes.
                    </p>
                    <a
                      href="/culture-coins?view=create"
                      style={{
                        display: 'inline-block',
                        padding: '12px 24px',
                        background: dashColors.accent,
                        color: '#000',
                        textDecoration: 'none',
                        fontSize: '11px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.1em',
                        fontWeight: 600
                      }}
                    >
                      CREATE NEW CULTURE
                    </a>
                  </div>
                )}

                {filteredCultures.map(culture => {
                  const cTheme = culture.theme || {};
                  const cAccent = cTheme.accentColor || '#8b5cf6';
                  const cCardBg = cTheme.cardBg || '#0f0f0f';
                  const cBorder = cTheme.borderColor || '#1a1a1a';
                  const hasCultureData = culture.beliefs?.length > 0 || culture.tiers?.length > 0 || culture.ethos;

                  const getBannerStyle = () => {
                    if (cTheme.bgType === 'image' && cTheme.bgImage) {
                      return { backgroundImage: `url(${cTheme.bgImage})`, backgroundSize: 'cover', backgroundPosition: 'center' };
                    } else if (cTheme.bgType === 'gradient' && cTheme.bgGradient) {
                      return { background: `linear-gradient(135deg, ${cTheme.bgGradient[0]}, ${cTheme.bgGradient[1]})` };
                    } else if (culture.imageUri) {
                      return { backgroundImage: `url(${culture.imageUri})`, backgroundSize: 'cover', backgroundPosition: 'center' };
                    }
                    return { background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%)' };
                  };

                  return (
                  <div
                    key={culture.id || culture.tokenAddress}
                    style={{
                      background: cCardBg,
                      border: `1px solid ${cBorder}`,
                      overflow: 'hidden'
                    }}
                  >
                    {/* Banner with token icon */}
                    <div style={{
                      height: '140px',
                      ...getBannerStyle(),
                      position: 'relative',
                      display: 'flex',
                      alignItems: 'flex-end',
                      padding: '16px'
                    }}>
                      {/* Token Icon */}
                      {culture.imageUri && (
                        <img
                          src={culture.imageUri}
                          alt={culture.name}
                          style={{
                            width: '64px',
                            height: '64px',
                            borderRadius: '12px',
                            border: '3px solid #0f0f0f',
                            objectFit: 'cover'
                          }}
                        />
                      )}
                      {/* Status badges */}
                      <div style={{ position: 'absolute', top: '12px', right: '12px', display: 'flex', gap: '8px' }}>
                        {culture.needsCultureSetup && (
                          <div style={{
                            background: '#f59e0b',
                            color: '#000',
                            fontSize: '9px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            letterSpacing: '0.1em',
                            padding: '6px 12px',
                            fontWeight: 600
                          }}>
                            NEEDS SETUP
                          </div>
                        )}
                        <div style={{
                          background: 'rgba(0,0,0,0.8)',
                          color: cAccent,
                          fontSize: '9px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          letterSpacing: '0.1em',
                          padding: '6px 12px'
                        }}>
                          OWNER
                        </div>
                      </div>
                    </div>

                    <div style={{ padding: '24px 32px 32px' }}>
                      {/* Header */}
                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '20px' }}>
                        <div>
                          <div style={{ fontSize: '9px', letterSpacing: '0.15em', color: '#666', marginBottom: '6px', fontFamily: "'IBM Plex Mono', monospace" }}>
                            {(culture.category || 'CULTURE').toUpperCase()}
                          </div>
                          <h3 style={{ fontFamily: "'Playfair Display', serif", fontSize: '26px', color: cTheme.textColor || '#fff', marginBottom: '8px' }}>
                            {culture.name}
                          </h3>
                          <div style={{ display: 'inline-block', background: cAccent, color: '#000', fontSize: '11px', fontFamily: "'IBM Plex Mono', monospace", letterSpacing: '0.1em', padding: '4px 12px', fontWeight: 600 }}>
                            ${culture.ticker || culture.symbol || 'TOKEN'}
                          </div>
                        </div>
                      </div>

                      {/* Description/Ethos - Elegant */}
                      {(culture.description || culture.ethos) && (
                        <div style={{ marginBottom: '20px', padding: '18px', background: 'linear-gradient(135deg, rgba(6,182,212,0.03) 0%, rgba(139,92,246,0.03) 100%)', border: '1px solid rgba(255,171,145,0.15)', borderRadius: '4px' }}>
                          <div style={{ fontSize: '9px', color: '#FFAB91', letterSpacing: '0.1em', marginBottom: '10px', fontFamily: "'IBM Plex Mono', monospace" }}>
                            DESCRIPTION
                          </div>
                          <p style={{ fontSize: '13px', color: '#ddd', lineHeight: 1.7, fontFamily: "'IBM Plex Mono', monospace" }}>
                            {(culture.description || culture.ethos || '').slice(0, 200)}{(culture.description || culture.ethos || '').length > 200 ? '...' : ''}
                          </p>
                        </div>
                      )}

                      {/* Token Address - Elegant */}
                      {culture.tokenAddress && (
                        <div style={{ marginBottom: '20px' }}>
                          <div style={{ fontSize: '9px', color: '#8b5cf6', letterSpacing: '0.1em', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                            TOKEN ADDRESS
                          </div>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '8px', background: 'rgba(139,92,246,0.03)', padding: '12px 14px', border: '1px solid rgba(139,92,246,0.15)', borderRadius: '4px' }}>
                            <span style={{ fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px', color: '#fff', flex: 1, overflow: 'hidden', textOverflow: 'ellipsis' }}>
                              {culture.tokenAddress}
                            </span>
                            <button onClick={() => { navigator.clipboard.writeText(culture.tokenAddress); }} style={{ background: 'rgba(139,92,246,0.1)', border: '1px solid rgba(139,92,246,0.3)', color: '#8b5cf6', padding: '6px 12px', fontSize: '9px', fontFamily: "'IBM Plex Mono', monospace", cursor: 'pointer', letterSpacing: '0.05em' }}>
                              COPY
                            </button>
                          </div>
                        </div>
                      )}

                      {/* Stats Grid - Coral/Gold Elegant */}
                      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px', marginBottom: '20px', padding: '16px', background: 'linear-gradient(135deg, rgba(6,182,212,0.05) 0%, rgba(139,92,246,0.05) 100%)', border: '1px solid rgba(6,182,212,0.15)', borderRadius: '6px' }}>
                        <div style={{ textAlign: 'center' }}>
                          <div style={{ fontSize: '20px', color: '#06b6d4', fontFamily: "'IBM Plex Mono', monospace", marginBottom: '4px', fontWeight: 700 }}>{culture.holders || 0}</div>
                          <div style={{ fontSize: '9px', color: '#888', letterSpacing: '0.1em' }}>HOLDERS</div>
                        </div>
                        <div style={{ textAlign: 'center' }}>
                          <div style={{ fontSize: '20px', color: '#FFAB91', fontFamily: "'IBM Plex Mono', monospace", marginBottom: '4px', fontWeight: 700 }}>${(culture.marketCap || 0).toLocaleString()}</div>
                          <div style={{ fontSize: '9px', color: '#888', letterSpacing: '0.1em' }}>MCAP</div>
                        </div>
                        <div style={{ textAlign: 'center' }}>
                          <div style={{ fontSize: '20px', color: '#8b5cf6', fontFamily: "'IBM Plex Mono', monospace", marginBottom: '4px', fontWeight: 700 }}>${(culture.volume || 0).toLocaleString()}</div>
                          <div style={{ fontSize: '9px', color: '#888', letterSpacing: '0.1em' }}>VOLUME</div>
                        </div>
                        <div style={{ textAlign: 'center' }}>
                          <div style={{ fontSize: '20px', color: '#8b5cf6', fontFamily: "'IBM Plex Mono', monospace", marginBottom: '4px', fontWeight: 700 }}>{culture.tiers?.length || 0}</div>
                          <div style={{ fontSize: '9px', color: '#888', letterSpacing: '0.1em' }}>TIERS</div>
                        </div>
                      </div>

                      {/* Culture Data Summary - Coral/Peach/Gold */}
                      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '12px', marginBottom: '20px' }}>
                        <div style={{ padding: '14px', background: culture.beliefs?.length > 0 ? 'rgba(6,182,212,0.08)' : '#0a0a0a', border: `1px solid ${culture.beliefs?.length > 0 ? 'rgba(6,182,212,0.25)' : '#222'}`, borderRadius: '4px', textAlign: 'center' }}>
                          <div style={{ fontSize: '9px', color: culture.beliefs?.length > 0 ? '#06b6d4' : '#666', letterSpacing: '0.1em', marginBottom: '6px' }}>BELIEFS</div>
                          <div style={{ fontSize: '18px', color: culture.beliefs?.length > 0 ? '#06b6d4' : '#fff', fontFamily: "'IBM Plex Mono', monospace", fontWeight: 700 }}>{culture.beliefs?.length || 0}</div>
                        </div>
                        <div style={{ padding: '14px', background: culture.unlocks?.length > 0 ? 'rgba(255,171,145,0.08)' : '#0a0a0a', border: `1px solid ${culture.unlocks?.length > 0 ? 'rgba(255,171,145,0.25)' : '#222'}`, borderRadius: '4px', textAlign: 'center' }}>
                          <div style={{ fontSize: '9px', color: culture.unlocks?.length > 0 ? '#FFAB91' : '#666', letterSpacing: '0.1em', marginBottom: '6px' }}>UNLOCKS</div>
                          <div style={{ fontSize: '18px', color: culture.unlocks?.length > 0 ? '#FFAB91' : '#fff', fontFamily: "'IBM Plex Mono', monospace", fontWeight: 700 }}>{culture.unlocks?.length || 0}</div>
                        </div>
                        <div style={{ padding: '14px', background: cTheme.accentColor ? 'rgba(139,92,246,0.08)' : '#0a0a0a', border: `1px solid ${cTheme.accentColor ? 'rgba(139,92,246,0.25)' : '#222'}`, borderRadius: '4px', textAlign: 'center' }}>
                          <div style={{ fontSize: '9px', color: cTheme.accentColor ? '#8b5cf6' : '#666', letterSpacing: '0.1em', marginBottom: '6px' }}>THEME</div>
                          <div style={{ fontSize: '18px', color: cTheme.accentColor ? '#8b5cf6' : '#fff', fontFamily: "'IBM Plex Mono', monospace", fontWeight: 700 }}>{cTheme.accentColor ? '✓' : '—'}</div>
                        </div>
                      </div>

                      {/* Action Buttons - Clean Style */}
                      <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
                        {culture.needsCultureSetup ? (
                          <button
                            onClick={() => handleEditCulture(culture)}
                            style={{
                              padding: '14px 28px',
                              background: '#f59e0b',
                              border: 'none',
                              color: '#000',
                              fontSize: '11px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              letterSpacing: '0.1em',
                              cursor: 'pointer',
                              fontWeight: 700
                            }}
                          >
                            SETUP CULTURE PAGE
                          </button>
                        ) : (
                          <button
                            onClick={() => handleEditCulture(culture)}
                            style={{
                              padding: '14px 28px',
                              background: '#8b5cf6',
                              border: 'none',
                              color: '#000',
                              fontSize: '11px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              letterSpacing: '0.1em',
                              cursor: 'pointer',
                              fontWeight: 700
                            }}
                          >
                            EDIT CULTURE
                          </button>
                        )}
                        {culture.tokenAddress && (
                          <a
                            href={`https://pump.fun/coin/${culture.tokenAddress}`}
                            target="_blank"
                            rel="noopener noreferrer"
                            style={{
                              padding: '14px 24px',
                              background: 'transparent',
                              border: '1px solid #333',
                              color: '#fff',
                              fontSize: '11px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              letterSpacing: '0.1em',
                              cursor: 'pointer',
                              textDecoration: 'none',
                              display: 'flex',
                              alignItems: 'center',
                              gap: '8px'
                            }}
                          >
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                              <polyline points="15 3 21 3 21 9"/>
                              <line x1="10" y1="14" x2="21" y2="3"/>
                            </svg>
                            PUMP.FUN
                          </a>
                        )}
                        <a
                          href={`/culture-coins?view=culture&id=${culture.id || culture.slug || culture.tokenAddress}`}
                          style={{
                            padding: '14px 24px',
                            background: 'transparent',
                            border: '1px solid #333',
                            color: '#fff',
                            fontSize: '11px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            letterSpacing: '0.1em',
                            cursor: 'pointer',
                            textDecoration: 'none'
                          }}
                        >
                          VIEW PAGE
                        </a>
                      </div>
                    </div>
                  </div>
                  );
                })}
              </div>

              {/* Create another culture button */}
              <div style={{ marginTop: '32px', textAlign: 'center' }}>
                <button
                  onClick={() => window.location.href = '/culture-coins?view=create'}
                  style={{
                    padding: '16px 40px',
                    background: 'transparent',
                    border: '1px solid #333',
                    color: '#fff',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    letterSpacing: '0.1em',
                    cursor: 'pointer'
                  }}
                >
                  + CREATE ANOTHER CULTURE
                </button>
              </div>
                </>
              )}

              {activeTab === 'tek' && (
                <div style={{
                  background: dashColors.cardBg,
                  border: `1px solid ${dashColors.border}`,
                  padding: '24px'
                }}>
                  {/* TEK Engine Header */}
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    marginBottom: '24px',
                    paddingBottom: '16px',
                    borderBottom: `1px solid ${dashColors.border}`
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <div style={{
                        width: '40px',
                        height: '40px',
                        background: dashColors.gradient,
                        borderRadius: '8px',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center'
                      }}>
                        <svg width="20" height="20" fill="#0a0a0a" viewBox="0 0 24 24">
                          <path d="M13 2L4 14h7v8l9-12h-7l2-8h-2z"/>
                        </svg>
                      </div>
                      <div>
                        <div style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '16px',
                          fontWeight: 700,
                          color: dashColors.accent,
                          letterSpacing: '0.08em'
                        }}>
                          TEK ENGINE
                        </div>
                        <div style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '11px',
                          color: dashColors.textMuted
                        }}>
                          Automated Fee Distribution
                        </div>
                      </div>
                    </div>

                    {/* Token Selector */}
                    <div>
                      {tokensLoading ? (
                        <span style={{
                          padding: '10px 16px',
                          background: '#111',
                          border: '1px solid #333',
                          color: '#666',
                          fontSize: '11px',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}>
                          Loading tokens...
                        </span>
                      ) : myTokens.length > 0 ? (
                        <select
                          value={selectedTekCulture?.tokenAddress || ''}
                          onChange={(e) => {
                            const token = myTokens.find(t => t.mint === e.target.value);
                            if (token) {
                              const culture = {
                                tokenAddress: token.mint,
                                name: token.name,
                                ticker: token.symbol,
                                image: token.image
                              };
                              setSelectedTekCulture(culture);
                              setSelectedChartCulture(culture);
                            }
                          }}
                          style={{
                            padding: '10px 16px',
                            background: '#0a0a0a',
                            border: '1px solid #333',
                            color: '#fff',
                            fontSize: '12px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            cursor: 'pointer',
                            minWidth: '200px'
                          }}
                        >
                          <option value="">Select a token</option>
                          {myTokens.map(token => (
                            <option key={token.mint} value={token.mint}>
                              {token.symbol} - {token.name}
                            </option>
                          ))}
                        </select>
                      ) : (
                        <span style={{
                          padding: '10px 16px',
                          background: '#111',
                          border: '1px solid #333',
                          color: '#666',
                          fontSize: '11px',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}>
                          No tokens found
                        </span>
                      )}
                    </div>
                  </div>

                  {selectedTekCulture ? (
                    <>
                    {/* Stats Grid - Culture Coins Style */}
                    <div style={{
                      display: 'grid',
                      gridTemplateColumns: 'repeat(4, 1fr)',
                      gap: '16px',
                      marginBottom: '24px'
                    }}>
                      {[
                        { label: 'Total Claimed', value: tekStats.claimed, color: dashColors.accent, suffix: ' SOL' },
                        { label: 'To Holder Pool', value: tekStats.holderPool, color: dashColors.coral, suffix: ' SOL', sub: '1% of fees' },
                        { label: 'Distributed', value: tekStats.distributed, color: '#4ade80', suffix: ' SOL', sub: '99% to allocation' },
                        { label: 'Pending', value: tekStats.pending, color: dashColors.peach, suffix: ' SOL', sub: 'Auto-claims every 10m' }
                      ].map((stat, i) => (
                        <div key={i} style={{
                          background: dashColors.cardBg,
                          border: `1px solid ${dashColors.border}`,
                          padding: '20px',
                          textAlign: 'center'
                        }}>
                          <div style={{
                            fontSize: '10px',
                            letterSpacing: '0.1em',
                            color: dashColors.textMuted,
                            marginBottom: '8px',
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            {stat.label}
                          </div>
                          <div style={{
                            fontSize: '24px',
                            fontWeight: 700,
                            color: stat.color,
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            {typeof stat.value === 'number' ? stat.value.toFixed(4) : stat.value}{stat.suffix}
                          </div>
                          {stat.sub && (
                            <div style={{
                              fontSize: '10px',
                              color: dashColors.textMuted,
                              marginTop: '4px',
                              fontFamily: "'IBM Plex Mono', monospace"
                            }}>
                              {stat.sub}
                            </div>
                          )}
                        </div>
                      ))}
                    </div>

                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '24px' }}>
                      {/* Left Column - Fee Allocations */}
                      <div style={{
                        background: '#0a0a0a',
                        border: '1px solid #1a1a1a',
                        padding: '20px'
                      }}>
                        <div style={{
                          fontSize: '11px',
                          letterSpacing: '0.15em',
                          color: dashColors.accent,
                          marginBottom: '16px',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}>
                          FEE ALLOCATIONS
                        </div>
                        <div style={{
                          fontSize: '10px',
                          color: '#666',
                          marginBottom: '16px',
                          fontFamily: "'IBM Plex Mono', monospace"
                        }}>
                          Total: <span style={{ color: getTekTotal() === 100 ? '#4ade80' : '#ef4444', fontWeight: 600 }}>{getTekTotal()}%</span> {getTekTotal() !== 100 && '(must equal 100%)'}
                        </div>

                        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                          {[
                            { key: 'marketMaking', label: 'Market Making', color: '#4ade80', icon: '📈' },
                            { key: 'buybackBurn', label: 'Buyback & Burn', color: '#f97316', icon: '🔥' },
                            { key: 'liquidity', label: 'Liquidity', color: '#3b82f6', icon: '💧' },
                            { key: 'creatorRevenue', label: 'Creator Revenue', color: '#a855f7', icon: '💰' }
                          ].map(item => (
                            <div key={item.key} style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '12px',
                              padding: '12px',
                              background: `${item.color}08`,
                              border: `1px solid ${item.color}30`
                            }}>
                              <span style={{ fontSize: '14px' }}>{item.icon}</span>
                              <div style={{ flex: 1 }}>
                                <div style={{
                                  fontSize: '11px',
                                  color: item.color,
                                  fontFamily: "'IBM Plex Mono', monospace",
                                  marginBottom: '4px'
                                }}>
                                  {item.label}
                                </div>
                              </div>
                              <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                                <input
                                  type="number"
                                  min="0"
                                  max="100"
                                  value={tekAllocations[item.key]}
                                  onChange={(e) => setTekAllocations(prev => ({
                                    ...prev,
                                    [item.key]: Math.max(0, Math.min(100, parseInt(e.target.value) || 0))
                                  }))}
                                  style={{
                                    width: '60px',
                                    padding: '8px',
                                    background: '#0a0a0a',
                                    border: '1px solid #333',
                                    color: item.color,
                                    fontSize: '14px',
                                    fontWeight: 600,
                                    textAlign: 'center',
                                    fontFamily: "'IBM Plex Mono', monospace"
                                  }}
                                />
                                <span style={{ color: '#666', fontSize: '12px' }}>%</span>
                              </div>
                            </div>
                          ))}
                        </div>

                        <button
                          onClick={saveTekAllocations}
                          disabled={tekLoading || getTekTotal() !== 100}
                          style={{
                            width: '100%',
                            padding: '12px',
                            marginTop: '16px',
                            background: getTekTotal() === 100 ? '#8b5cf6' : '#333',
                            border: 'none',
                            color: getTekTotal() === 100 ? '#0a0a0a' : '#666',
                            fontSize: '11px',
                            fontWeight: 700,
                            fontFamily: "'IBM Plex Mono', monospace",
                            letterSpacing: '0.1em',
                            cursor: getTekTotal() === 100 ? 'pointer' : 'not-allowed',
                            opacity: tekLoading ? 0.5 : 1
                          }}
                        >
                          {tekLoading ? 'SAVING...' : 'SAVE ALLOCATIONS'}
                        </button>
                      </div>

                      {/* Right Column - Controls & Status */}
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                        {/* LP Burn Toggle */}
                        <div style={{
                          background: 'rgba(239, 68, 68, 0.08)',
                          border: '1px solid rgba(239, 68, 68, 0.3)',
                          padding: '16px',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'space-between'
                        }}>
                          <div>
                            <div style={{
                              fontSize: '12px',
                              fontWeight: 600,
                              color: '#fff',
                              display: 'flex',
                              alignItems: 'center',
                              gap: '8px',
                              fontFamily: "'IBM Plex Mono', monospace"
                            }}>
                              <span>🔥</span> LP BURN
                            </div>
                            <div style={{ fontSize: '10px', color: '#666', marginTop: '4px' }}>
                              Lock liquidity forever
                            </div>
                          </div>
                          <label style={{ position: 'relative', display: 'inline-block', width: '48px', height: '26px', cursor: 'pointer' }}>
                            <input
                              type="checkbox"
                              checked={lpBurnEnabled}
                              onChange={(e) => toggleTekLpBurn(e.target.checked)}
                              style={{ opacity: 0, width: 0, height: 0 }}
                            />
                            <span style={{
                              position: 'absolute',
                              cursor: 'pointer',
                              top: 0,
                              left: 0,
                              right: 0,
                              bottom: 0,
                              background: lpBurnEnabled ? '#ef4444' : '#333',
                              transition: '0.3s',
                              borderRadius: '26px'
                            }}>
                              <span style={{
                                position: 'absolute',
                                content: '',
                                height: '20px',
                                width: '20px',
                                left: lpBurnEnabled ? '25px' : '3px',
                                bottom: '3px',
                                background: '#fff',
                                transition: '0.3s',
                                borderRadius: '50%'
                              }}/>
                            </span>
                          </label>
                        </div>

                        {/* Auto-Rebalance Toggle */}
                        <div style={{
                          background: 'rgba(74, 222, 128, 0.08)',
                          border: '1px solid rgba(74, 222, 128, 0.3)',
                          padding: '16px',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'space-between'
                        }}>
                          <div>
                            <div style={{
                              fontSize: '12px',
                              fontWeight: 600,
                              color: '#fff',
                              display: 'flex',
                              alignItems: 'center',
                              gap: '8px',
                              fontFamily: "'IBM Plex Mono', monospace"
                            }}>
                              <span>⚡</span> AUTO-REBALANCE
                            </div>
                            <div style={{ fontSize: '10px', color: '#666', marginTop: '4px' }}>
                              Automatically adjust allocations
                            </div>
                          </div>
                          <label style={{ position: 'relative', display: 'inline-block', width: '48px', height: '26px', cursor: 'pointer' }}>
                            <input
                              type="checkbox"
                              checked={autoRebalance}
                              onChange={(e) => toggleTekAutoRebalance(e.target.checked)}
                              style={{ opacity: 0, width: 0, height: 0 }}
                            />
                            <span style={{
                              position: 'absolute',
                              cursor: 'pointer',
                              top: 0,
                              left: 0,
                              right: 0,
                              bottom: 0,
                              background: autoRebalance ? '#4ade80' : '#333',
                              transition: '0.3s',
                              borderRadius: '26px'
                            }}>
                              <span style={{
                                position: 'absolute',
                                content: '',
                                height: '20px',
                                width: '20px',
                                left: autoRebalance ? '25px' : '3px',
                                bottom: '3px',
                                background: '#fff',
                                transition: '0.3s',
                                borderRadius: '50%'
                              }}/>
                            </span>
                          </label>
                        </div>

                        {/* Smart Optimizer */}
                        <div style={{
                          background: 'rgba(168, 85, 247, 0.08)',
                          border: '1px solid rgba(168, 85, 247, 0.3)',
                          padding: '16px'
                        }}>
                          <div style={{
                            fontSize: '11px',
                            fontWeight: 600,
                            letterSpacing: '0.15em',
                            color: '#a855f7',
                            marginBottom: '8px',
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            SMART OPTIMIZER
                          </div>
                          <p style={{
                            fontSize: '10px',
                            color: '#666',
                            marginBottom: '12px',
                            lineHeight: 1.5,
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            AI analyzes market conditions and optimizes your fee allocations automatically.
                          </p>
                          <button
                            onClick={runSmartOptimizer}
                            disabled={tekLoading}
                            style={{
                              width: '100%',
                              padding: '12px',
                              background: '#a855f7',
                              border: 'none',
                              color: '#fff',
                              fontSize: '11px',
                              fontWeight: 600,
                              fontFamily: "'IBM Plex Mono', monospace",
                              letterSpacing: '0.1em',
                              cursor: 'pointer',
                              opacity: tekLoading ? 0.5 : 1
                            }}
                          >
                            {tekLoading ? 'ANALYZING...' : 'RUN ANALYSIS'}
                          </button>
                        </div>

                        {/* TEK Status & Actions */}
                        <div style={{
                          background: '#0a0a0a',
                          border: '1px solid #1a1a1a',
                          padding: '16px'
                        }}>
                          <div style={{
                            fontSize: '11px',
                            letterSpacing: '0.15em',
                            color: dashColors.accent,
                            marginBottom: '12px',
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            TEK STATUS
                          </div>
                          <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '16px' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                              <span style={{ color: '#666', fontSize: '11px', fontFamily: "'IBM Plex Mono', monospace" }}>Engine Status</span>
                              <span style={{ color: tekAutomationRunning ? '#4ade80' : '#ef4444', fontSize: '11px', fontFamily: "'IBM Plex Mono', monospace" }}>
                                ● {tekAutomationRunning ? 'RUNNING' : 'STOPPED'}
                              </span>
                            </div>
                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                              <span style={{ color: '#666', fontSize: '11px', fontFamily: "'IBM Plex Mono', monospace" }}>Total Distributed</span>
                              <span style={{ color: dashColors.accent, fontSize: '11px', fontFamily: "'IBM Plex Mono', monospace" }}>{tekStats.distributed.toFixed(4)} SOL</span>
                            </div>
                            {tekStatus && (
                              <div style={{
                                fontSize: '10px',
                                color: tekStatus.includes('Error') ? '#ef4444' : '#4ade80',
                                fontFamily: "'IBM Plex Mono', monospace",
                                padding: '8px',
                                background: tekStatus.includes('Error') ? 'rgba(239,68,68,0.1)' : 'rgba(74,222,128,0.1)',
                                border: `1px solid ${tekStatus.includes('Error') ? 'rgba(239,68,68,0.3)' : 'rgba(74,222,128,0.3)'}`
                              }}>
                                {tekStatus}
                              </div>
                            )}
                          </div>

                          {/* Action Buttons */}
                          <div style={{ display: 'flex', gap: '8px', marginBottom: '12px' }}>
                            <button
                              onClick={startTekAutomation}
                              disabled={tekLoading || tekAutomationRunning}
                              style={{
                                flex: 1,
                                padding: '10px',
                                background: tekAutomationRunning ? '#1a1a1a' : dashColors.accent,
                                border: 'none',
                                color: tekAutomationRunning ? '#666' : '#0a0a0a',
                                fontSize: '10px',
                                fontWeight: 700,
                                fontFamily: "'IBM Plex Mono', monospace",
                                letterSpacing: '0.08em',
                                cursor: tekAutomationRunning ? 'not-allowed' : 'pointer'
                              }}
                            >
                              START
                            </button>
                            <button
                              onClick={stopTekAutomation}
                              disabled={tekLoading || !tekAutomationRunning}
                              style={{
                                flex: 1,
                                padding: '10px',
                                background: !tekAutomationRunning ? '#1a1a1a' : dashColors.coral,
                                border: 'none',
                                color: !tekAutomationRunning ? '#666' : '#fff',
                                fontSize: '10px',
                                fontWeight: 700,
                                fontFamily: "'IBM Plex Mono', monospace",
                                letterSpacing: '0.08em',
                                cursor: !tekAutomationRunning ? 'not-allowed' : 'pointer'
                              }}
                            >
                              STOP
                            </button>
                          </div>

                          <button
                            onClick={async () => {
                              if (!selectedTekCulture?.tokenAddress) return;
                              setTekLoading(true);
                              setTekStatus('Claiming fees...');
                              try {
                                const res = await fetch('/api/claim', {
                                  method: 'POST',
                                  headers: { 'Content-Type': 'application/json' },
                                  body: JSON.stringify({ mint: selectedTekCulture.tokenAddress, wallet: wallet?.address })
                                });
                                const data = await res.json();
                                setTekStatus(data.success ? `Claimed ${data.amount || 0} SOL!` : 'Error: ' + (data.error || 'Failed'));
                              } catch (e) { setTekStatus('Error: ' + e.message); }
                              setTekLoading(false);
                            }}
                            disabled={tekLoading}
                            style={{
                              width: '100%',
                              padding: '12px',
                              background: dashColors.gradient,
                              border: 'none',
                              color: '#0a0a0a',
                              fontSize: '11px',
                              fontWeight: 700,
                              fontFamily: "'IBM Plex Mono', monospace",
                              letterSpacing: '0.1em',
                              cursor: 'pointer',
                              marginBottom: '8px'
                            }}
                          >
                            {tekLoading ? 'PROCESSING...' : 'CLAIM NOW'}
                          </button>

                          <button
                            onClick={async () => {
                              if (!selectedTekCulture?.tokenAddress) return;
                              setTekLoading(true);
                              setTekStatus('Distributing...');
                              try {
                                const res = await fetch('/api/distribute', {
                                  method: 'POST',
                                  headers: { 'Content-Type': 'application/json' },
                                  body: JSON.stringify({ mint: selectedTekCulture.tokenAddress, wallet: wallet?.address, allocations: tekAllocations })
                                });
                                const data = await res.json();
                                setTekStatus(data.success ? 'Distribution complete!' : 'Error: ' + (data.error || 'Failed'));
                              } catch (e) { setTekStatus('Error: ' + e.message); }
                              setTekLoading(false);
                            }}
                            disabled={tekLoading}
                            style={{
                              width: '100%',
                              padding: '12px',
                              background: dashColors.coral,
                              border: 'none',
                              color: '#fff',
                              fontSize: '11px',
                              fontWeight: 700,
                              fontFamily: "'IBM Plex Mono', monospace",
                              letterSpacing: '0.1em',
                              cursor: 'pointer'
                            }}
                          >
                            DISTRIBUTE NOW
                          </button>
                        </div>
                      </div>
                    </div>
                    </>
                  ) : (
                    <div style={{
                      padding: '60px 40px',
                      background: '#0a0a0a',
                      border: '1px solid #1a1a1a',
                      textAlign: 'center'
                    }}>
                      <svg width="48" height="48" fill="none" stroke="#666" strokeWidth="1" style={{ marginBottom: '16px', opacity: 0.3 }} viewBox="0 0 24 24">
                        <path d="M13 2L4 14h7v8l9-12h-7l2-8h-2z"/>
                      </svg>
                      <p style={{
                        color: '#666',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '14px',
                        marginBottom: '8px'
                      }}>
                        Select a token above to configure TEK Engine
                      </p>
                      <p style={{
                        color: '#444',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '11px'
                      }}>
                        TEK automatically distributes trading fees based on your allocation settings
                      </p>
                    </div>
                  )}
                </div>
              )}

              {activeTab === 'settings' && (
                <div style={{
                  background: dashColors.cardBg,
                  border: `1px solid ${dashColors.border}`,
                  padding: '32px'
                }}>
                  {/* Profile Picture & Banner Section */}
                  <h3 style={{
                    fontSize: '12px',
                    letterSpacing: '0.15em',
                    color: dashColors.accent,
                    marginBottom: '24px',
                    fontFamily: "'IBM Plex Mono', monospace"
                  }}>
                    PROFILE PICTURE & BANNER
                  </h3>

                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: '200px 1fr',
                    gap: '32px',
                    marginBottom: '40px'
                  }}>
                    {/* PFP Section */}
                    <div>
                      <div style={{
                        width: '128px',
                        height: '128px',
                        borderRadius: '50%',
                        background: dashColors.border,
                        overflow: 'hidden',
                        marginBottom: '16px',
                        border: `3px solid ${dashColors.accent}`
                      }}>
                        {profile?.pfp ? (
                          <img
                            src={profile.pfp}
                            alt="Profile"
                            style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                          />
                        ) : (
                          <div style={{
                            width: '100%',
                            height: '100%',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: dashColors.textMuted,
                            fontSize: '12px',
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            NO PFP
                          </div>
                        )}
                      </div>
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                        <button
                          onClick={async () => {
                            // Generate new 2-bit pixel PFP
                            try {
                              const seed = Date.now().toString();
                              const res = await fetch('/api/generate-pfp', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ wallet: wallet?.address, seed })
                              });
                              const data = await res.json();
                              if (data.success && data.pfp) {
                                handleEditProfile({ pfp: data.pfp });
                              }
                            } catch (e) {
                              console.error('[PFP] Generation failed:', e);
                            }
                          }}
                          style={{
                            padding: '10px 16px',
                            background: dashColors.accent,
                            border: 'none',
                            color: '#000',
                            fontSize: '10px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            cursor: 'pointer',
                            letterSpacing: '0.1em',
                            fontWeight: 600
                          }}
                        >
                          GENERATE PIXEL PFP
                        </button>
                        <label style={{
                          padding: '10px 16px',
                          background: 'transparent',
                          border: `1px solid ${dashColors.border}`,
                          color: dashColors.textSecondary,
                          fontSize: '10px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          cursor: 'pointer',
                          letterSpacing: '0.1em',
                          textAlign: 'center'
                        }}>
                          UPLOAD IMAGE
                          <input
                            type="file"
                            accept="image/*"
                            style={{ display: 'none' }}
                            onChange={(e) => {
                              const file = e.target.files?.[0];
                              if (file) {
                                const reader = new FileReader();
                                reader.onload = (ev) => {
                                  handleEditProfile({ pfp: ev.target.result });
                                };
                                reader.readAsDataURL(file);
                              }
                            }}
                          />
                        </label>
                      </div>
                    </div>

                    {/* Banner Section */}
                    <div>
                      <div style={{
                        width: '100%',
                        height: '150px',
                        background: profile?.banner ? `url(${profile.banner}) center/cover` : dashColors.border,
                        borderRadius: '8px',
                        marginBottom: '16px',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center'
                      }}>
                        {!profile?.banner && (
                          <span style={{
                            color: dashColors.textMuted,
                            fontSize: '12px',
                            fontFamily: "'IBM Plex Mono', monospace"
                          }}>
                            NO BANNER SET
                          </span>
                        )}
                      </div>
                      <label style={{
                        display: 'inline-block',
                        padding: '10px 20px',
                        background: 'transparent',
                        border: `1px solid ${dashColors.border}`,
                        color: dashColors.textSecondary,
                        fontSize: '10px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        cursor: 'pointer',
                        letterSpacing: '0.1em'
                      }}>
                        UPLOAD BANNER
                        <input
                          type="file"
                          accept="image/*"
                          style={{ display: 'none' }}
                          onChange={(e) => {
                            const file = e.target.files?.[0];
                            if (file) {
                              const reader = new FileReader();
                              reader.onload = (ev) => {
                                handleEditProfile({ banner: ev.target.result });
                              };
                              reader.readAsDataURL(file);
                            }
                          }}
                        />
                      </label>
                      {profile?.banner && (
                        <button
                          onClick={() => handleEditProfile({ banner: null })}
                          style={{
                            marginLeft: '12px',
                            padding: '10px 20px',
                            background: 'transparent',
                            border: `1px solid #ef4444`,
                            color: '#ef4444',
                            fontSize: '10px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            cursor: 'pointer',
                            letterSpacing: '0.1em'
                          }}
                        >
                          REMOVE
                        </button>
                      )}
                    </div>
                  </div>

                  {/* Basic Profile Info */}
                  <h3 style={{
                    fontSize: '12px',
                    letterSpacing: '0.15em',
                    color: dashColors.textMuted,
                    marginBottom: '24px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    borderTop: `1px solid ${dashColors.border}`,
                    paddingTop: '32px'
                  }}>
                    PROFILE INFORMATION
                  </h3>

                  <div style={{ marginBottom: '24px' }}>
                    <label style={{
                      display: 'block',
                      fontSize: '11px',
                      color: dashColors.textMuted,
                      marginBottom: '8px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em'
                    }}>
                      DISPLAY NAME
                    </label>
                    <input
                      type="text"
                      value={profile?.displayName || ''}
                      onChange={(e) => handleEditProfile({ displayName: e.target.value })}
                      placeholder="Your display name"
                      style={{
                        width: '100%',
                        maxWidth: '400px',
                        padding: '14px',
                        background: dashColors.inputBg,
                        border: `1px solid ${dashColors.inputBorder}`,
                        color: dashColors.text,
                        fontSize: '15px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        outline: 'none'
                      }}
                    />
                  </div>

                  <div style={{ marginBottom: '24px' }}>
                    <label style={{
                      display: 'block',
                      fontSize: '11px',
                      color: dashColors.textMuted,
                      marginBottom: '8px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em'
                    }}>
                      BIO
                    </label>
                    <textarea
                      value={profile?.bio || ''}
                      onChange={(e) => handleEditProfile({ bio: e.target.value })}
                      placeholder="Tell the world about yourself..."
                      style={{
                        width: '100%',
                        maxWidth: '600px',
                        minHeight: '100px',
                        padding: '14px',
                        background: dashColors.inputBg,
                        border: `1px solid ${dashColors.inputBorder}`,
                        color: dashColors.text,
                        fontSize: '14px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        resize: 'vertical',
                        outline: 'none'
                      }}
                    />
                  </div>

                  {/* Personalization Section */}
                  <h3 style={{
                    fontSize: '12px',
                    letterSpacing: '0.15em',
                    color: '#666',
                    marginBottom: '24px',
                    marginTop: '40px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    borderTop: '1px solid #222',
                    paddingTop: '40px'
                  }}>
                    PERSONALIZATION
                  </h3>

                  {/* Light/Dark Mode Toggle */}
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    padding: '16px 20px',
                    background: '#0a0a0a',
                    border: '1px solid #222',
                    marginBottom: '20px',
                    maxWidth: '400px'
                  }}>
                    <div>
                      <div style={{
                        fontSize: '13px',
                        color: '#fff',
                        fontFamily: "'IBM Plex Mono', monospace",
                        marginBottom: '4px'
                      }}>
                        Theme Mode
                      </div>
                      <div style={{
                        fontSize: '11px',
                        color: '#666',
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        Switch between light and dark mode
                      </div>
                    </div>
                    <button
                      onClick={() => {
                        const newMode = !lightMode;
                        setLightMode(newMode);
                        localStorage.setItem('lightMode', JSON.stringify(newMode));
                      }}
                      style={{
                        padding: '10px 20px',
                        background: lightMode ? '#e5e5e5' : '#1a1a1a',
                        border: `1px solid ${lightMode ? '#d4d4d4' : '#333'}`,
                        color: lightMode ? '#333' : '#fff',
                        fontSize: '11px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        cursor: 'pointer',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px'
                      }}
                    >
                      {lightMode ? (
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                      ) : (
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                          <circle cx="12" cy="12" r="5"/>
                          <line x1="12" y1="1" x2="12" y2="3"/>
                          <line x1="12" y1="21" x2="12" y2="23"/>
                          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                          <line x1="1" y1="12" x2="3" y2="12"/>
                          <line x1="21" y1="12" x2="23" y2="12"/>
                          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                        </svg>
                      )}
                      {lightMode ? 'SWITCH TO DARK' : 'SWITCH TO LIGHT'}
                    </button>
                  </div>

                  {/* Dashboard Background */}
                  <div style={{ marginBottom: '24px', maxWidth: '600px' }}>
                    <label style={{
                      display: 'block',
                      fontSize: '11px',
                      color: '#888',
                      marginBottom: '12px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em'
                    }}>
                      DASHBOARD BACKGROUND
                    </label>
                    <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                      {['solid', 'gradient', 'pattern'].map(type => (
                        <button
                          key={type}
                          onClick={() => {
                            const dashTheme = JSON.parse(localStorage.getItem('dashboard_theme') || '{}');
                            dashTheme.bgType = type;
                            localStorage.setItem('dashboard_theme', JSON.stringify(dashTheme));
                            handleEditProfile({ theme: dashTheme });
                          }}
                          style={{
                            padding: '10px 16px',
                            background: profile?.theme?.bgType === type ? '#8b5cf6' : '#0a0a0a',
                            border: '1px solid',
                            borderColor: profile?.theme?.bgType === type ? '#8b5cf6' : '#333',
                            color: profile?.theme?.bgType === type ? '#000' : '#888',
                            fontSize: '11px',
                            fontFamily: "'IBM Plex Mono', monospace",
                            cursor: 'pointer',
                            textTransform: 'uppercase'
                          }}
                        >
                          {type}
                        </button>
                      ))}
                    </div>
                  </div>

                  {/* Accent Color */}
                  <div style={{ marginBottom: '24px', maxWidth: '400px' }}>
                    <label style={{
                      display: 'block',
                      fontSize: '11px',
                      color: '#888',
                      marginBottom: '12px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      letterSpacing: '0.1em'
                    }}>
                      ACCENT COLOR
                    </label>
                    <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                      {['#8b5cf6', '#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b', '#ef4444', '#ffffff'].map(color => (
                        <button
                          key={color}
                          onClick={() => {
                            const dashTheme = JSON.parse(localStorage.getItem('dashboard_theme') || '{}');
                            dashTheme.accentColor = color;
                            localStorage.setItem('dashboard_theme', JSON.stringify(dashTheme));
                            handleEditProfile({ theme: dashTheme });
                          }}
                          style={{
                            width: '36px',
                            height: '36px',
                            background: color,
                            border: profile?.theme?.accentColor === color ? '3px solid #fff' : '1px solid #333',
                            cursor: 'pointer',
                            borderRadius: '4px'
                          }}
                          title={color}
                        />
                      ))}
                    </div>
                  </div>

                  {/* Connected Wallet */}
                  <div style={{
                    padding: '20px',
                    background: 'rgba(139, 92, 246, 0.1)',
                    border: '1px solid rgba(139, 92, 246, 0.3)',
                    marginTop: '40px'
                  }}>
                    <div style={{
                      fontSize: '12px',
                      color: '#8b5cf6',
                      fontFamily: "'IBM Plex Mono', monospace",
                      marginBottom: '8px'
                    }}>
                      CONNECTED WALLET
                    </div>
                    <div style={{
                      fontSize: '14px',
                      color: '#fff',
                      fontFamily: "'IBM Plex Mono', monospace"
                    }}>
                      {wallet?.address}
                    </div>
                  </div>
                </div>
              )}

              {/* PK + CA Ownership Verification Modal */}
              {showVerifyModal && (
                <div style={{
                  position: 'fixed',
                  top: 0,
                  left: 0,
                  right: 0,
                  bottom: 0,
                  background: 'rgba(0,0,0,0.9)',
                  zIndex: 9999,
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center'
                }}>
                  <div style={{
                    background: '#0a0a0a',
                    border: '1px solid #06b6d4',
                    padding: '32px',
                    maxWidth: '500px',
                    width: '90%',
                    boxShadow: '0 8px 32px rgba(6, 182, 212, 0.3)'
                  }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
                      <div style={{
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '14px',
                        background: 'linear-gradient(135deg, #8b5cf6, #06b6d4)',
                        WebkitBackgroundClip: 'text',
                        WebkitTextFillColor: 'transparent',
                        fontWeight: 700,
                        letterSpacing: '0.1em'
                      }}>
                        VERIFY OWNERSHIP
                      </div>
                      <button
                        onClick={() => { setShowVerifyModal(false); setPendingEditCulture(null); }}
                        style={{ background: 'transparent', border: 'none', color: '#666', fontSize: '20px', cursor: 'pointer' }}
                      >×</button>
                    </div>

                    <p style={{ fontSize: '12px', color: '#888', marginBottom: '20px', fontFamily: "'IBM Plex Mono', monospace", lineHeight: 1.6 }}>
                      To edit this culture, verify you own the token by entering your Private Key and Contract Address.
                    </p>

                    {pendingEditCulture && (
                      <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '20px', padding: '12px', background: '#111', border: '1px solid #222' }}>
                        {pendingEditCulture.imageUri && (
                          <img src={pendingEditCulture.imageUri} alt="" style={{ width: '40px', height: '40px', borderRadius: '8px' }} />
                        )}
                        <div>
                          <div style={{ color: '#fff', fontFamily: "'IBM Plex Mono', monospace", fontSize: '14px' }}>{pendingEditCulture.name}</div>
                          <div style={{ color: '#8b5cf6', fontFamily: "'IBM Plex Mono', monospace", fontSize: '11px' }}>${pendingEditCulture.ticker || pendingEditCulture.symbol}</div>
                        </div>
                      </div>
                    )}

                    <div style={{ marginBottom: '16px' }}>
                      <div style={{ fontSize: '9px', color: '#06b6d4', letterSpacing: '0.1em', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                        TOKEN CONTRACT ADDRESS (CA)
                      </div>
                      <input
                        type="text"
                        value={verifyTokenMint}
                        onChange={(e) => setVerifyTokenMint(e.target.value)}
                        placeholder="Token mint address..."
                        style={{
                          width: '100%',
                          padding: '12px',
                          background: '#111',
                          border: '1px solid #333',
                          color: '#fff',
                          fontSize: '11px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          boxSizing: 'border-box'
                        }}
                      />
                    </div>

                    <div style={{ marginBottom: '20px' }}>
                      <div style={{ fontSize: '9px', color: '#06b6d4', letterSpacing: '0.1em', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                        PRIVATE KEY (PK)
                      </div>
                      <input
                        type="password"
                        value={verifyPrivateKey}
                        onChange={(e) => setVerifyPrivateKey(e.target.value)}
                        placeholder="Your wallet private key (base58)..."
                        style={{
                          width: '100%',
                          padding: '12px',
                          background: '#111',
                          border: '1px solid #333',
                          color: '#fff',
                          fontSize: '11px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          boxSizing: 'border-box'
                        }}
                      />
                      <div style={{ fontSize: '10px', color: '#666', marginTop: '6px', fontFamily: "'IBM Plex Mono', monospace" }}>
                        ⚠️ Your private key is used locally to verify ownership. Never share it.
                      </div>
                    </div>

                    {verifyStatus && (
                      <div style={{
                        padding: '12px',
                        marginBottom: '16px',
                        background: verifyStatus.includes('✓') ? 'rgba(139, 92, 246, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                        border: `1px solid ${verifyStatus.includes('✓') ? 'rgba(139, 92, 246, 0.3)' : 'rgba(239, 68, 68, 0.3)'}`,
                        color: verifyStatus.includes('✓') ? '#8b5cf6' : '#ef4444',
                        fontSize: '11px',
                        fontFamily: "'IBM Plex Mono', monospace"
                      }}>
                        {verifyStatus}
                      </div>
                    )}

                    <button
                      onClick={verifyOwnership}
                      disabled={verifyLoading || !verifyPrivateKey.trim() || !verifyTokenMint.trim()}
                      style={{
                        width: '100%',
                        padding: '14px',
                        background: (verifyPrivateKey.trim() && verifyTokenMint.trim()) ? '#8b5cf6' : '#333',
                        border: 'none',
                        color: (verifyPrivateKey.trim() && verifyTokenMint.trim()) ? '#000' : '#666',
                        fontSize: '11px',
                        fontFamily: "'IBM Plex Mono', monospace",
                        letterSpacing: '0.1em',
                        fontWeight: 700,
                        cursor: (verifyPrivateKey.trim() && verifyTokenMint.trim()) ? 'pointer' : 'not-allowed'
                      }}
                    >
                      {verifyLoading ? 'VERIFYING...' : 'VERIFY & EDIT CULTURE'}
                    </button>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Create Culture Page - Manifesto Style (also handles Edit mode)
        const CreateCulturePage = ({ editMode = false }) => {
          const wallet = useContext(WalletContext);
          const [editCultureId, setEditCultureId] = useState(null);
          const [cultureName, setCultureName] = useState('');
          const [creatorName, setCreatorName] = useState('');
          const [cultureEthos, setCultureEthos] = useState(['', '', '']); // Empty - user fills in
          const [isCreating, setIsCreating] = useState(false);

          // Token Icon (required for pump.fun)
          const [tokenIcon, setTokenIcon] = useState(null); // File object
          const [tokenIconPreview, setTokenIconPreview] = useState(''); // Data URL for preview
          const [tokenTicker, setTokenTicker] = useState(''); // Custom ticker
          const [devBuyAmount, setDevBuyAmount] = useState(0); // Initial dev buy in SOL (0-5)

          // Load culture data when in edit mode
          useEffect(() => {
            if (editMode) {
              try {
                const editData = JSON.parse(localStorage.getItem('edit_culture_data') || 'null');
                console.log('[EDIT] Loading culture data:', editData);
                if (editData) {
                  setEditCultureId(editData.id || editData.tokenAddress);
                  setCultureName(editData.name || '');
                  setCreatorName(editData.creatorName || editData.creator_username || '');

                  // Handle ethos - could be string or array
                  if (editData.ethos) {
                    if (Array.isArray(editData.ethos)) {
                      setCultureEthos(editData.ethos.length ? editData.ethos : ['', '', '']);
                    } else if (typeof editData.ethos === 'string') {
                      // Split by | or newlines
                      const ethosArray = editData.ethos.split(/\s*\|\s*|\n/).filter(e => e.trim());
                      setCultureEthos(ethosArray.length ? ethosArray : ['', '', '']);
                    }
                  }

                  setTokenTicker(editData.ticker || editData.symbol || '');
                  setCategory(editData.category || '');

                  // Load token icon preview if available
                  if (editData.imageUri || editData.image_uri) {
                    setTokenIconPreview(editData.imageUri || editData.image_uri);
                  }

                  // Load theme
                  if (editData.theme && Object.keys(editData.theme).length > 0) {
                    setTheme(prev => ({ ...prev, ...editData.theme }));
                  }

                  // Load beliefs - might be in pillars field (from server)
                  const beliefsData = editData.beliefs || editData.pillars || [];
                  if (beliefsData.length > 0) {
                    setBeliefs(beliefsData);
                  }

                  // Load tiers - convert percent to holdingPercent if needed
                  const tiersData = editData.tiers || [];
                  if (tiersData.length > 0) {
                    const normalizedTiers = tiersData.map(t => ({
                      name: t.name || '',
                      holdingPercent: t.holdingPercent || t.percent || 0.1,
                      access: t.access || t.expectation || '',
                      content: t.content || []
                    }));
                    setTiers(normalizedTiers);
                  }

                  // Load unlocks
                  if (editData.unlocks && editData.unlocks.length > 0) {
                    setUnlocks(editData.unlocks);
                  }

                  console.log('[EDIT] Data loaded successfully');
                }
              } catch (e) {
                console.error('[EDIT] Error loading culture data:', e);
              }
            }
          }, [editMode]);
          const [category, setCategory] = useState(''); // Token category

          // Available categories
          const CATEGORIES = [
            { id: 'meme', name: 'Meme' },
            { id: 'ai', name: 'AI' },
            { id: 'utility', name: 'Utility' },
            { id: 'finance', name: 'Finance' },
            { id: 'accounting', name: 'Accounting' },
            { id: 'tech', name: 'Tech' },
            { id: 'fitness', name: 'Fitness' },
            { id: 'wellness', name: 'Health & Wellness' },
            { id: 'data', name: 'Data' },
            { id: 'fashion', name: 'Fashion' },
            { id: 'music', name: 'Music' },
            { id: 'art', name: 'Art' },
            { id: 'travel', name: 'Travel' },
            { id: 'gaming', name: 'Gaming' },
            { id: 'social', name: 'Social' },
            { id: 'law', name: 'Law' },
            { id: 'environmental', name: 'Environmental' },
            { id: 'education', name: 'Education' },
            { id: 'political', name: 'Political' },
            { id: 'sports', name: 'Sports' },
            { id: 'food', name: 'Food & Drink' },
            { id: 'other', name: 'Other' }
          ];

          // Light/Dark mode
          const [lightMode, setLightMode] = useState(() => {
            try {
              return JSON.parse(localStorage.getItem('lightMode') || 'false');
            } catch { return false; }
          });

          // Vanity Address Mining
          const [vanitySuffix, setVanitySuffix] = useState('');
          const [vanityMining, setVanityMining] = useState(false);
          const [vanityProgress, setVanityProgress] = useState({
            attempts: 0,
            rate: 0,
            elapsed: 0,
            estimatedTime: '',
            difficulty: ''
          });
          const [vanityResult, setVanityResult] = useState(null);
          const [miningWorker, setMiningWorker] = useState(null);

          // Estimate difficulty for vanity suffix (CASE SENSITIVE)
          const estimateVanityDifficulty = (suffix) => {
            if (!suffix) return { attempts: 1, time: 'instant', probability: '100%' };
            // Base58 has 58 characters, case sensitive matching
            const charProbability = 58;
            const attempts = Math.pow(charProbability, suffix.length);
            const attemptsPerSecond = 50000; // browser estimate
            const seconds = attempts / attemptsPerSecond;

            let timeEstimate;
            if (seconds < 60) timeEstimate = `~${Math.round(seconds)} seconds`;
            else if (seconds < 3600) timeEstimate = `~${Math.round(seconds / 60)} minutes`;
            else if (seconds < 86400) timeEstimate = `~${Math.round(seconds / 3600)} hours`;
            else if (seconds < 604800) timeEstimate = `~${Math.round(seconds / 86400)} days`;
            else timeEstimate = `~${Math.round(seconds / 604800)} weeks`;

            return {
              attempts: attempts.toLocaleString(),
              time: timeEstimate,
              probability: `1 in ${attempts.toLocaleString()}`
            };
          };

          // Start vanity mining in web worker
          const startVanityMining = () => {
            if (!vanitySuffix || vanityMining) return;

            setVanityMining(true);
            setVanityProgress({ attempts: 0, rate: 0, elapsed: 0, estimatedTime: estimateVanityDifficulty(vanitySuffix).time, difficulty: estimateVanityDifficulty(vanitySuffix).probability });
            setVanityResult(null);

            // Create inline worker for browser-based mining
            // CASE SENSITIVE - exact match only
            const workerCode = `
              importScripts('https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js');

              const suffix = '${vanitySuffix}';  // Keep exact case user typed
              let attempts = 0;
              const startTime = Date.now();

              function mine() {
                const batchSize = 1000;
                for (let i = 0; i < batchSize; i++) {
                  attempts++;
                  const keypair = solanaWeb3.Keypair.generate();
                  const address = keypair.publicKey.toBase58();

                  // EXACT case match - "moon" only matches "moon", not "MOON" or "mooN"
                  if (address.endsWith(suffix)) {
                    postMessage({
                      type: 'found',
                      address: address,
                      secretKey: Array.from(keypair.secretKey),
                      attempts: attempts,
                      elapsed: (Date.now() - startTime) / 1000
                    });
                    return;
                  }
                }

                // Report progress
                const elapsed = (Date.now() - startTime) / 1000;
                postMessage({
                  type: 'progress',
                  attempts: attempts,
                  rate: Math.round(attempts / elapsed),
                  elapsed: Math.round(elapsed)
                });

                // Continue mining
                setTimeout(mine, 0);
              }

              mine();
            `;

            const blob = new Blob([workerCode], { type: 'application/javascript' });
            const worker = new Worker(URL.createObjectURL(blob));

            worker.onmessage = (e) => {
              if (e.data.type === 'progress') {
                setVanityProgress(prev => ({
                  ...prev,
                  attempts: e.data.attempts,
                  rate: e.data.rate,
                  elapsed: e.data.elapsed
                }));
              } else if (e.data.type === 'found') {
                setVanityResult({
                  address: e.data.address,
                  secretKey: e.data.secretKey,
                  attempts: e.data.attempts,
                  elapsed: e.data.elapsed
                });
                setVanityMining(false);
                worker.terminate();
              }
            };

            setMiningWorker(worker);
          };

          // Stop mining
          const stopVanityMining = () => {
            if (miningWorker) {
              miningWorker.terminate();
              setMiningWorker(null);
            }
            setVanityMining(false);
          };

          // Theme customization
          const [theme, setTheme] = useState({
            bgType: 'solid', // solid, gradient, pattern, image
            bgColor: '#0a0a0a',
            bgGradient: ['#0a0a0a', '#1a1a2e'],
            bgPattern: 'none', // none, dots, grid, diagonal
            bgImage: '',
            bgImageFit: 'cover', // cover, contain, tile, stretch
            accentColor: '#ffffff',
            textColor: '#ffffff',
            cardBg: '#0f0f0f',
            borderColor: '#1a1a1a'
          });

          const patterns = {
            none: 'none',
            dots: 'radial-gradient(circle, #333 1px, transparent 1px)',
            grid: 'linear-gradient(#222 1px, transparent 1px), linear-gradient(90deg, #222 1px, transparent 1px)',
            diagonal: 'repeating-linear-gradient(45deg, #1a1a1a, #1a1a1a 10px, #0f0f0f 10px, #0f0f0f 20px)',
            hearts: 'url("data:image/svg+xml,%3Csvg width=\'40\' height=\'40\' viewBox=\'0 0 40 40\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M20 30l-7-7c-4-4-4-10 0-14s10-4 14 0l-7 7 7 7c4 4 4 10 0 14s-10 4-14 0l7-7z\' fill=\'%23333\' fill-opacity=\'0.3\'/%3E%3C/svg%3E")',
            stars: 'url("data:image/svg+xml,%3Csvg width=\'30\' height=\'30\' viewBox=\'0 0 30 30\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Ctext x=\'10\' y=\'20\' fill=\'%23333\' opacity=\'0.3\'%3E★%3C/text%3E%3C/svg%3E")'
          };

          // ═══════════════════════════════════════════════════════════════════════════
          // WORLD-CLASS COLOR SYSTEM - Comprehensive Light/Dark Mode
          // Designed with WCAG 2.1 AA contrast ratios and perceptual color science
          // ═══════════════════════════════════════════════════════════════════════════

          const lightColors = {
            // Base surfaces - Using warm neutrals for reduced eye strain
            bg: '#fafaf9',                    // Warm white background
            bgElevated: '#ffffff',            // Cards, modals, elevated surfaces
            bgSubtle: '#f5f5f4',              // Secondary backgrounds
            bgMuted: '#e7e5e4',               // Tertiary surfaces, dividers

            // Card surfaces with elevation
            cardBg: '#ffffff',
            cardBgHover: '#fafaf9',
            cardShadow: '0 1px 3px rgba(0,0,0,0.08), 0 4px 12px rgba(0,0,0,0.04)',
            cardShadowHover: '0 4px 12px rgba(0,0,0,0.12), 0 8px 24px rgba(0,0,0,0.08)',

            // Text hierarchy - Proper contrast ratios
            text: '#171717',                  // Primary text - 15:1 ratio
            textSecondary: '#404040',         // Secondary text - 10:1 ratio
            textMuted: '#737373',             // Tertiary text - 4.5:1 ratio
            textDisabled: '#a3a3a3',          // Disabled text
            textInverse: '#ffffff',           // Text on dark backgrounds

            // Borders and dividers
            border: '#e5e5e5',
            borderStrong: '#d4d4d4',
            borderSubtle: '#f0f0f0',
            divider: '#e7e5e4',

            // Interactive elements
            accent: '#0f172a',                // Primary actions
            accentHover: '#1e293b',
            accentActive: '#334155',
            accentSubtle: '#f1f5f9',

            // Form elements
            inputBg: '#ffffff',
            inputBgHover: '#fafaf9',
            inputBgFocus: '#ffffff',
            inputBorder: '#d4d4d4',
            inputBorderHover: '#a3a3a3',
            inputBorderFocus: '#0f172a',
            inputPlaceholder: '#a3a3a3',

            // Semantic colors - Accessible contrast
            success: '#15803d',               // Green - passes AA
            successBg: '#dcfce7',
            successBorder: '#86efac',
            warning: '#b45309',               // Amber - passes AA
            warningBg: '#fef3c7',
            warningBorder: '#fcd34d',
            error: '#dc2626',                 // Red - passes AA
            errorBg: '#fee2e2',
            errorBorder: '#fca5a5',
            info: '#0369a1',                  // Blue - passes AA
            infoBg: '#e0f2fe',
            infoBorder: '#7dd3fc',

            // Interactive feedback
            hoverOverlay: 'rgba(0,0,0,0.04)',
            activeOverlay: 'rgba(0,0,0,0.08)',
            focusRing: 'rgba(15,23,42,0.4)',

            // Scrollbar
            scrollThumb: '#d4d4d4',
            scrollTrack: '#f5f5f4'
          };

          const darkColors = {
            // Base surfaces - Rich, layered dark palette
            bg: '#09090b',                    // True dark background
            bgElevated: '#18181b',            // Cards, elevated surfaces
            bgSubtle: '#27272a',              // Secondary backgrounds
            bgMuted: '#3f3f46',               // Tertiary surfaces

            // Card surfaces with elevation
            cardBg: '#18181b',
            cardBgHover: '#27272a',
            cardShadow: '0 1px 3px rgba(0,0,0,0.3), 0 4px 12px rgba(0,0,0,0.2)',
            cardShadowHover: '0 4px 12px rgba(0,0,0,0.4), 0 8px 24px rgba(0,0,0,0.3)',

            // Text hierarchy - Optimized for OLED/dark screens
            text: '#fafafa',                  // Primary text
            textSecondary: '#d4d4d8',         // Secondary text
            textMuted: '#a1a1aa',             // Tertiary text
            textDisabled: '#52525b',          // Disabled text
            textInverse: '#09090b',           // Text on light backgrounds

            // Borders and dividers
            border: '#3f3f46',
            borderStrong: '#52525b',
            borderSubtle: '#27272a',
            divider: '#27272a',

            // Interactive elements
            accent: '#fafafa',                // Primary actions - white for dark mode
            accentHover: '#e4e4e7',
            accentActive: '#d4d4d8',
            accentSubtle: '#27272a',

            // Form elements
            inputBg: '#18181b',
            inputBgHover: '#27272a',
            inputBgFocus: '#18181b',
            inputBorder: '#3f3f46',
            inputBorderHover: '#52525b',
            inputBorderFocus: '#fafafa',
            inputPlaceholder: '#71717a',

            // Semantic colors - Adjusted for dark mode visibility
            success: '#8b5cf6',               // Brighter green for dark
            successBg: 'rgba(139,92,246,0.15)',
            successBorder: 'rgba(139,92,246,0.4)',
            warning: '#fbbf24',               // Bright amber
            warningBg: 'rgba(251,191,36,0.15)',
            warningBorder: 'rgba(251,191,36,0.4)',
            error: '#ef4444',                 // Bright red
            errorBg: 'rgba(239,68,68,0.15)',
            errorBorder: 'rgba(239,68,68,0.4)',
            info: '#38bdf8',                  // Bright blue
            infoBg: 'rgba(56,189,248,0.15)',
            infoBorder: 'rgba(56,189,248,0.4)',

            // Interactive feedback
            hoverOverlay: 'rgba(255,255,255,0.05)',
            activeOverlay: 'rgba(255,255,255,0.1)',
            focusRing: 'rgba(250,250,250,0.4)',

            // Scrollbar
            scrollThumb: '#52525b',
            scrollTrack: '#18181b'
          };

          const colors = lightMode ? lightColors : darkColors;

          // CSS custom properties for global theme access
          React.useEffect(() => {
            const root = document.documentElement;
            Object.entries(colors).forEach(([key, value]) => {
              root.style.setProperty(`--color-${key}`, value);
            });
            // Add transition for smooth mode switching
            root.style.setProperty('--theme-transition', 'background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease');
          }, [lightMode]);

          const getBackgroundStyle = () => {
            // If light mode, override with light background
            if (lightMode) {
              return { background: lightColors.bg };
            }

            let bg = {};
            if (theme.bgType === 'solid') {
              bg.background = theme.bgColor;
            } else if (theme.bgType === 'gradient') {
              bg.background = `linear-gradient(135deg, ${theme.bgGradient[0]}, ${theme.bgGradient[1]})`;
            } else if (theme.bgType === 'pattern') {
              bg.background = theme.bgColor;
              if (theme.bgPattern !== 'none') {
                bg.backgroundImage = patterns[theme.bgPattern];
                bg.backgroundSize = theme.bgPattern === 'dots' ? '20px 20px' : theme.bgPattern === 'grid' ? '20px 20px' : 'auto';
              }
            } else if (theme.bgType === 'image' && theme.bgImage) {
              bg.backgroundImage = `url(${theme.bgImage})`;
              // Apply image fit mode
              if (theme.bgImageFit === 'tile') {
                bg.backgroundSize = 'auto';
                bg.backgroundRepeat = 'repeat';
              } else if (theme.bgImageFit === 'contain') {
                bg.backgroundSize = 'contain';
                bg.backgroundRepeat = 'no-repeat';
                bg.backgroundPosition = 'center';
              } else if (theme.bgImageFit === 'stretch') {
                bg.backgroundSize = '100% 100%';
                bg.backgroundRepeat = 'no-repeat';
              } else { // cover (default)
                bg.backgroundSize = 'cover';
                bg.backgroundPosition = 'center';
                bg.backgroundRepeat = 'no-repeat';
              }
            }
            return bg;
          };

          // Editable beliefs
          const [beliefs, setBeliefs] = useState([
            'We prioritize long-term thinking over short-term wins',
            'We value judgment, not volume',
            'Participation matters more than presence',
            'Culture compounds when members contribute'
          ]);

          // Editable unlocks
          const [unlocks, setUnlocks] = useState([
            { title: 'Private Discussions', description: 'Member-only conversations focused on signal, not chatter.' },
            { title: 'Cultural Drops', description: 'Essays, sessions, or artifacts released through auction-style participation.' },
            { title: 'Live Moments', description: 'Scheduled live calls, AMAs, or IRL meetups.' },
            { title: 'Early Access', description: 'First access to new initiatives, tools, or collaborations.' }
          ]);

          // Tiers with content drops
          const [tiers, setTiers] = useState([
            { name: 'Observer', holdingPercent: 0.1, access: 'Read-only access to culture feed', content: [] },
            { name: 'Participant', holdingPercent: 0.5, access: 'Join discussions and auctions', content: [] },
            { name: 'Insider', holdingPercent: 1.5, access: 'Live sessions and early drops', content: [] },
            { name: 'Steward', holdingPercent: 5.0, access: 'Help shape culture direction', content: [] }
          ]);

          const [selectedTierIndex, setSelectedTierIndex] = useState(0);

          // Belief functions
          const updateBelief = (index, value) => {
            const newBeliefs = [...beliefs];
            newBeliefs[index] = value;
            setBeliefs(newBeliefs);
          };

          const addBelief = () => {
            if (beliefs.length < 8) {
              setBeliefs([...beliefs, '']);
            }
          };

          const removeBelief = (index) => {
            if (beliefs.length > 1) {
              setBeliefs(beliefs.filter((_, i) => i !== index));
            }
          };

          // Unlock functions
          const updateUnlock = (index, field, value) => {
            const newUnlocks = [...unlocks];
            newUnlocks[index] = { ...newUnlocks[index], [field]: value };
            setUnlocks(newUnlocks);
          };

          const addUnlock = () => {
            if (unlocks.length < 8) {
              setUnlocks([...unlocks, { title: '', description: '' }]);
            }
          };

          const removeUnlock = (index) => {
            if (unlocks.length > 1) {
              setUnlocks(unlocks.filter((_, i) => i !== index));
            }
          };

          // Tier functions
          const updateTier = (index, field, value) => {
            const newTiers = [...tiers];
            newTiers[index] = { ...newTiers[index], [field]: value };
            setTiers(newTiers);
          };

          const addTier = () => {
            if (tiers.length < 6) {
              const lastPercent = tiers[tiers.length - 1]?.holdingPercent || 0;
              setTiers([...tiers, { name: '', holdingPercent: lastPercent + 2, access: '', content: [] }]);
            }
          };

          const removeTier = (index) => {
            if (tiers.length > 2) {
              setTiers(tiers.filter((_, i) => i !== index));
              if (selectedTierIndex >= tiers.length - 1) {
                setSelectedTierIndex(Math.max(0, tiers.length - 2));
              }
            }
          };

          // Tier content functions
          const addTierContent = (tierIndex, contentType) => {
            const newTiers = [...tiers];
            newTiers[tierIndex].content = [...newTiers[tierIndex].content, {
              type: contentType,
              title: '',
              description: ''
            }];
            setTiers(newTiers);
          };

          const updateTierContent = (tierIndex, contentIndex, field, value) => {
            const newTiers = [...tiers];
            newTiers[tierIndex].content[contentIndex] = {
              ...newTiers[tierIndex].content[contentIndex],
              [field]: value
            };
            setTiers(newTiers);
          };

          const removeTierContent = (tierIndex, contentIndex) => {
            const newTiers = [...tiers];
            newTiers[tierIndex].content = newTiers[tierIndex].content.filter((_, i) => i !== contentIndex);
            setTiers(newTiers);
          };

          // Handle culture creation - REQUIRES PRIVY WALLET
          // State for creation progress
          const [createStatus, setCreateStatus] = useState('');

          const handleCreate = async () => {
            // SECURITY: Require wallet connection
            if (!wallet?.address) {
              alert('Please connect your wallet with Privy to create a culture. This is required for security.');
              wallet?.showModal?.();
              return;
            }

            if (!cultureName.trim()) {
              alert('Please enter a culture name');
              return;
            }
            if (!creatorName.trim()) {
              alert('Please enter your name');
              return;
            }

            // Require token icon for pump.fun
            if (!tokenIcon) {
              alert('Please upload a token icon. This is required to create your token on pump.fun.');
              return;
            }

            // Use custom ticker or generate from culture name
            // Use custom ticker or generate from name - pump.fun max is 8 chars
            const ticker = (tokenTicker.trim() || cultureName).replace(/[^a-zA-Z0-9]/g, '').slice(0, 8) || 'CULTURE';

            setIsCreating(true);
            let tokenAddress = null;
            let txSignature = null;

            try {
              // ═══════════════════════════════════════════════════════════════
              // STEP 1: Create the token on-chain via Pump.fun
              // ═══════════════════════════════════════════════════════════════

              // Check if we have a vanity address mined, otherwise generate random
              let mintSecretKey = vanityResult?.secretKey;
              let mintAddress = vanityResult?.address;

              if (!mintSecretKey) {
                // No vanity mined - generate a random keypair
                console.log('[CREATE CULTURE] No vanity address, generating random mint...');
                setCreateStatus('Generating token address...');
                const randomKeypair = solanaWeb3.Keypair.generate();
                mintSecretKey = Array.from(randomKeypair.secretKey);
                mintAddress = randomKeypair.publicKey.toBase58();
              }

              // Reconstruct keypair from secretKey
              const mintKeypair = solanaWeb3.Keypair.fromSecretKey(
                Uint8Array.from(mintSecretKey)
              );
              console.log('[CREATE CULTURE] Using mint address:', mintKeypair.publicKey.toBase58());

              // Step 1a: Upload metadata to pump.fun IPFS
              setCreateStatus('Step 1/4: Uploading to IPFS...');
              const ethosText = cultureEthos.filter(e => e.trim()).join(' · ');
              const description = `${cultureName}${ethosText ? ' - ' + ethosText : ''}. A Culture Coin on LAUNCHR.`;
              const tokenMetadata = await uploadCultureTokenMetadata(
                cultureName,
                ticker,
                description,
                tokenIcon // Use the uploaded token icon file
              );

              // Step 1b: Get the SIGNING wallet address (must match what we'll use to sign)
              // Always use Phantom/Solflare address for the transaction, same as main site
              let signingWalletAddress = wallet.address;
              if (window.solana?.isPhantom) {
                if (!window.solana.isConnected) {
                  console.log('[CREATE CULTURE] Connecting Phantom for signing...');
                  await window.solana.connect();
                }
                signingWalletAddress = window.solana.publicKey.toBase58();
                console.log('[CREATE CULTURE] Using Phantom address:', signingWalletAddress);
              } else if (window.solflare?.isSolflare) {
                if (!window.solflare.isConnected) {
                  await window.solflare.connect();
                }
                signingWalletAddress = window.solflare.publicKey.toBase58();
                console.log('[CREATE CULTURE] Using Solflare address:', signingWalletAddress);
              } else {
                throw new Error('Please install Phantom or Solflare wallet to create tokens.');
              }

              // Step 1c: Create the token transaction with signing wallet address
              setCreateStatus('Step 2/4: Creating token transaction...');
              const { transaction, connection } = await createCultureTokenTransaction(
                signingWalletAddress, // Use the wallet that will sign
                mintKeypair,
                tokenMetadata,
                devBuyAmount // Initial dev buy in SOL
              );

              // Step 1d: Sign and send the transaction
              setCreateStatus('Step 3/4: SIGN IN WALLET - Check Phantom!');
              txSignature = await signAndSendCultureToken(
                transaction,
                connection,
                mintKeypair
              );

              tokenAddress = mintKeypair.publicKey.toBase58();
              console.log('[CREATE CULTURE] Token created on-chain!');
              console.log('[CREATE CULTURE] Token address:', tokenAddress);
              console.log('[CREATE CULTURE] Transaction:', txSignature);

              // Verify we have a valid transaction signature before saving
              if (!txSignature || txSignature.length < 80) {
                throw new Error('Token creation failed - no valid transaction signature received');
              }

              // ═══════════════════════════════════════════════════════════════
              // STEP 2: Save culture data to backend with token address
              // ═══════════════════════════════════════════════════════════════

              setCreateStatus('Step 4/4: Saving culture page...');

              const cultureData = {
                name: cultureName,
                ticker: ticker,
                creatorName: creatorName,
                ethos: cultureEthos.filter(e => e.trim()),
                category: category || 'other',
                theme: theme,
                beliefs: beliefs.filter(b => b.trim()),
                unlocks: unlocks.filter(u => u.title.trim()),
                tiers: tiers.filter(t => t.name.trim()),
                devBuyAmount: devBuyAmount,
                // Token data from on-chain creation
                tokenAddress: tokenAddress,
                vanityAddress: mintAddress || tokenAddress,
                txSignature: txSignature,
                // SECURITY: Include wallet for verification
                wallet: wallet.address
              };

              console.log('[CREATE CULTURE] Sending to API with token:', tokenAddress);

              const response = await fetch('/api/culture/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(cultureData)
              });

              const result = await response.json();

              if (result.success) {
                console.log('[CREATE CULTURE] Success:', result.culture);
                console.log('[CREATE CULTURE] Integrity Hash:', response.headers.get('X-Culture-Hash'));

                // Store the new culture locally for immediate display
                const userCultures = JSON.parse(localStorage.getItem('user_cultures') || '[]');
                userCultures.push(result.culture);
                localStorage.setItem('user_cultures', JSON.stringify(userCultures));

                // Store the just-created culture to show immediately
                localStorage.setItem('just_created_culture', JSON.stringify(result.culture));

                setCreateStatus('Token LIVE on pump.fun!');

                // Show success with pump.fun link - CLEAR messaging
                alert(`SUCCESS! Your Culture Coin is LIVE!\n\n` +
                      `Token: ${cultureName} ($${ticker})\n` +
                      `Address: ${tokenAddress.slice(0,6)}...${tokenAddress.slice(-4)}\n\n` +
                      `[OK] Token created on Solana\n` +
                      `[OK] Listed on pump.fun\n` +
                      `[OK] Culture page saved\n\n` +
                      `View on pump.fun:\npump.fun/coin/${tokenAddress}`);

                // Redirect to culture page
                window.location.href = `/culture-coins?show=${result.culture.id}`;
              } else {
                throw new Error(result.error || 'Failed to save culture');
              }

            } catch (error) {
              console.error('[CREATE ERROR]', error);
              setCreateStatus('');

              // Provide helpful error message
              if (error.message.includes('User rejected')) {
                alert('Transaction cancelled. You rejected the transaction in your wallet.');
              } else if (error.message.includes('insufficient')) {
                alert('Insufficient SOL balance. You need SOL to pay for the transaction fee.');
              } else if (tokenAddress && !txSignature) {
                alert('Token creation failed: ' + error.message);
              } else {
                alert('Failed to create culture: ' + error.message);
              }
            } finally {
              setIsCreating(false);
              setCreateStatus('');
            }
          };

          // Handle culture update (edit mode)
          const handleUpdate = async () => {
            if (!wallet?.address) {
              alert('Please connect your wallet to update this culture.');
              return;
            }

            if (!editCultureId) {
              alert('No culture ID found for update.');
              return;
            }

            setIsCreating(true);
            setCreateStatus('Updating culture...');

            try {
              // Get token address from edit data
              const editData = JSON.parse(localStorage.getItem('edit_culture_data') || '{}');
              const tokenAddress = editData.tokenAddress || editData.mint || null;

              const cultureData = {
                id: editCultureId,
                tokenAddress: tokenAddress,
                name: cultureName,
                ticker: tokenTicker || editData.ticker || editData.symbol,
                creatorName: creatorName,
                ethos: cultureEthos.filter(e => e.trim()),
                category: category || 'other',
                theme: theme,
                beliefs: beliefs.filter(b => b.trim()),
                unlocks: unlocks.filter(u => u.title.trim()),
                tiers: tiers.filter(t => t.name.trim()),
                wallet: wallet.address
              };

              console.log('[UPDATE CULTURE] Sending update:', cultureData);

              const response = await fetch('/api/culture/update', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(cultureData)
              });

              const result = await response.json();

              if (result.success) {
                console.log('[UPDATE CULTURE] Success:', result.culture);
                setCreateStatus('Culture updated!');

                // Clear edit data
                localStorage.removeItem('edit_culture_data');

                alert('Culture updated successfully!');

                // Redirect to dashboard
                window.location.href = '/culture-coins?view=dashboard';
              } else {
                throw new Error(result.error || 'Failed to update culture');
              }
            } catch (error) {
              console.error('[UPDATE ERROR]', error);
              alert('Failed to update culture: ' + error.message);
            } finally {
              setIsCreating(false);
              setCreateStatus('');
            }
          };

          return (
            <div style={{
              minHeight: '100vh',
              ...getBackgroundStyle(),
              color: colors.text
            }}>
              <div style={{ padding: '136px 40px 80px', maxWidth: '900px', margin: '0 auto' }}>

              {/* Light/Dark Mode Toggle */}
              <div style={{
                position: 'fixed',
                top: '110px',
                right: '40px',
                zIndex: 100
              }}>
                <button
                  onClick={() => setLightMode(!lightMode)}
                  style={{
                    width: '48px',
                    height: '48px',
                    borderRadius: '50%',
                    background: lightMode ? '#1a1a1a' : '#ffffff',
                    border: 'none',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '20px',
                    boxShadow: '0 2px 10px rgba(0,0,0,0.2)',
                    transition: 'all 0.3s'
                  }}
                  title={lightMode ? 'Switch to Dark Mode' : 'Switch to Light Mode'}
                >
                  {lightMode ? (
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                  ) : (
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                  )}
                </button>
              </div>

              {/* Getting Started Guide - Collapsible */}
              {(() => {
                const [guideOpen, setGuideOpen] = useState(true);
                return (
                  <div style={{
                    marginBottom: '40px',
                    background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)',
                    border: '1px solid #2a2a4a',
                    borderRadius: '8px',
                    overflow: 'hidden'
                  }}>
                    {/* Guide Header */}
                    <button
                      onClick={() => setGuideOpen(!guideOpen)}
                      style={{
                        width: '100%',
                        padding: '20px 24px',
                        background: 'transparent',
                        border: 'none',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        cursor: 'pointer'
                      }}
                    >
                      <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                        <span style={{
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '20px',
                          color: '#fff'
                        }}>
                          How to Create Your Culture
                        </span>
                        <span style={{
                          background: '#8b5cf6',
                          color: '#000',
                          padding: '4px 10px',
                          fontSize: '10px',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontWeight: 600,
                          letterSpacing: '0.1em',
                          borderRadius: '4px'
                        }}>
                          START HERE
                        </span>
                      </div>
                      <span style={{
                        color: '#888',
                        fontSize: '20px',
                        transform: guideOpen ? 'rotate(180deg)' : 'rotate(0deg)',
                        transition: 'transform 0.2s'
                      }}>▼</span>
                    </button>

                    {/* Guide Content */}
                    {guideOpen && (
                      <div style={{ padding: '0 24px 24px' }}>
                        <div style={{
                          display: 'grid',
                          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                          gap: '20px',
                          marginBottom: '24px'
                        }}>
                          {/* Step 1 */}
                          <div style={{
                            background: 'rgba(0,0,0,0.3)',
                            padding: '20px',
                            borderRadius: '6px',
                            border: '1px solid #333'
                          }}>
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '10px',
                              marginBottom: '12px'
                            }}>
                              <span style={{
                                background: '#8b5cf6',
                                color: '#000',
                                width: '24px',
                                height: '24px',
                                borderRadius: '50%',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontSize: '12px',
                                fontWeight: 'bold'
                              }}>1</span>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '11px',
                                color: '#8b5cf6',
                                letterSpacing: '0.1em'
                              }}>CUSTOMIZE</span>
                            </div>
                            <p style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '12px',
                              color: '#aaa',
                              lineHeight: 1.6
                            }}>
                              Make your page your own! Choose colors, backgrounds, and patterns that represent your culture's vibe.
                            </p>
                          </div>

                          {/* Step 2 */}
                          <div style={{
                            background: 'rgba(0,0,0,0.3)',
                            padding: '20px',
                            borderRadius: '6px',
                            border: '1px solid #333'
                          }}>
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '10px',
                              marginBottom: '12px'
                            }}>
                              <span style={{
                                background: '#8b5cf6',
                                color: '#000',
                                width: '24px',
                                height: '24px',
                                borderRadius: '50%',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontSize: '12px',
                                fontWeight: 'bold'
                              }}>2</span>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '11px',
                                color: '#8b5cf6',
                                letterSpacing: '0.1em'
                              }}>DEFINE BELIEFS</span>
                            </div>
                            <p style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '12px',
                              color: '#aaa',
                              lineHeight: 1.6
                            }}>
                              What does your culture stand for? Add your core values and beliefs that members will rally around.
                            </p>
                          </div>

                          {/* Step 3 */}
                          <div style={{
                            background: 'rgba(0,0,0,0.3)',
                            padding: '20px',
                            borderRadius: '6px',
                            border: '1px solid #333'
                          }}>
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '10px',
                              marginBottom: '12px'
                            }}>
                              <span style={{
                                background: '#8b5cf6',
                                color: '#000',
                                width: '24px',
                                height: '24px',
                                borderRadius: '50%',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontSize: '12px',
                                fontWeight: 'bold'
                              }}>3</span>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '11px',
                                color: '#8b5cf6',
                                letterSpacing: '0.1em'
                              }}>SET TIERS</span>
                            </div>
                            <p style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '12px',
                              color: '#aaa',
                              lineHeight: 1.6
                            }}>
                              Create membership tiers based on token holdings. More tokens = higher tier with exclusive access.
                            </p>
                          </div>

                          {/* Step 4 */}
                          <div style={{
                            background: 'rgba(0,0,0,0.3)',
                            padding: '20px',
                            borderRadius: '6px',
                            border: '1px solid #333'
                          }}>
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '10px',
                              marginBottom: '12px'
                            }}>
                              <span style={{
                                background: '#8b5cf6',
                                color: '#000',
                                width: '24px',
                                height: '24px',
                                borderRadius: '50%',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontSize: '12px',
                                fontWeight: 'bold'
                              }}>4</span>
                              <span style={{
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '11px',
                                color: '#8b5cf6',
                                letterSpacing: '0.1em'
                              }}>MINE ADDRESS</span>
                            </div>
                            <p style={{
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '12px',
                              color: '#aaa',
                              lineHeight: 1.6
                            }}>
                              Get a custom token address ending in letters you choose (like "KING"). This takes time but looks amazing!
                            </p>
                          </div>
                        </div>

                        {/* Pro Tips */}
                        <div style={{
                          background: 'rgba(139,92,246,0.1)',
                          border: '1px solid rgba(139,92,246,0.3)',
                          borderRadius: '6px',
                          padding: '16px 20px'
                        }}>
                          <div style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            color: '#8b5cf6',
                            letterSpacing: '0.15em',
                            marginBottom: '8px'
                          }}>
                            PRO TIP
                          </div>
                          <p style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '12px',
                            color: '#ccc',
                            lineHeight: 1.6
                          }}>
                            Hover over any <span style={{ background: '#333', padding: '2px 6px', borderRadius: '3px' }}>?</span> icon to learn more about that section. Every feature has a tooltip explaining exactly what it does!
                          </p>
                        </div>
                      </div>
                    )}
                  </div>
                );
              })()}

              {/* Culture Identity Header */}
              <div style={{ marginBottom: '80px', textAlign: 'center' }}>
                {/* Culture Name - Large Editable */}
                <input
                  type="text"
                  value={cultureName}
                  onChange={(e) => setCultureName(e.target.value)}
                  placeholder="Your Culture Name"
                  style={{
                    width: '100%',
                    background: 'transparent',
                    border: 'none',
                    borderBottom: '1px solid rgba(255,255,255,0.2)',
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '72px',
                    fontWeight: '400',
                    color: theme.textColor,
                    textAlign: 'center',
                    marginBottom: '24px',
                    outline: 'none',
                    letterSpacing: '-0.02em'
                  }}
                />

                {/* Ethos Taglines */}
                <div style={{
                  display: 'flex',
                  justifyContent: 'center',
                  gap: '32px',
                  flexWrap: 'wrap',
                  marginBottom: '8px'
                }}>
                  {cultureEthos.map((ethos, idx) => (
                    <input
                      key={idx}
                      type="text"
                      value={ethos}
                      onChange={(e) => {
                        const newEthos = [...cultureEthos];
                        newEthos[idx] = e.target.value;
                        setCultureEthos(newEthos);
                      }}
                      placeholder={['CONVICTION', 'PATIENCE', 'SIGNAL'][idx] || `VALUE ${idx + 1}`}
                      style={{
                        background: 'transparent',
                        border: 'none',
                        borderBottom: '1px dashed rgba(255,255,255,0.2)',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '13px',
                        color: ethos ? theme.accentColor : '#666',
                        textAlign: 'center',
                        letterSpacing: '0.2em',
                        textTransform: 'uppercase',
                        outline: 'none',
                        width: '150px',
                        padding: '4px 0'
                      }}
                    />
                  ))}
                </div>
                <p style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '10px',
                  color: '#555',
                  textAlign: 'center',
                  marginBottom: '24px'
                }}>
                  Click to edit your culture's core values
                </p>

                {/* Creator Name */}
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '12px',
                  color: '#666',
                  letterSpacing: '0.1em'
                }}>
                  Created by{' '}
                  <input
                    type="text"
                    value={creatorName}
                    onChange={(e) => setCreatorName(e.target.value)}
                    placeholder="Your Name"
                    style={{
                      background: 'transparent',
                      border: 'none',
                      borderBottom: '1px solid rgba(255,255,255,0.2)',
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '12px',
                      color: theme.accentColor,
                      outline: 'none',
                      width: '120px',
                      letterSpacing: '0.1em'
                    }}
                  />
                </div>
              </div>

              {/* ═══════════════════════════════════════════════════════════════ */}
              {/* TOKEN DETAILS - Icon & Ticker (Required for pump.fun) */}
              {/* ═══════════════════════════════════════════════════════════════ */}
              <div style={{
                marginBottom: '60px',
                padding: '32px',
                background: 'linear-gradient(135deg, rgba(139,92,246,0.1) 0%, rgba(0,0,0,0.5) 100%)',
                border: '2px solid rgba(139,92,246,0.3)',
                backdropFilter: 'blur(10px)',
                borderRadius: '8px'
              }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '8px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: theme.textColor
                  }}>
                    Token Details
                  </span>
                  <span style={{
                    marginLeft: '12px',
                    background: '#8b5cf6',
                    color: '#000',
                    padding: '4px 10px',
                    fontSize: '10px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontWeight: 600,
                    letterSpacing: '0.1em',
                    borderRadius: '4px'
                  }}>
                    REQUIRED
                  </span>
                </div>
                <p style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '12px',
                  color: '#888',
                  marginBottom: '24px'
                }}>
                  Your culture will launch as a real token on pump.fun. Upload an icon and choose a ticker.
                </p>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '32px' }}>
                  {/* Token Icon Upload */}
                  <div>
                    <SectionHeader
                      title="TOKEN ICON"
                      tooltip="This image will be your token's icon on pump.fun and in wallets. Use a square image, at least 200x200px. PNG or JPG."
                    />
                    <div style={{
                      width: '120px',
                      height: '120px',
                      border: tokenIconPreview ? '2px solid #8b5cf6' : '2px dashed #444',
                      borderRadius: '50%',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      cursor: 'pointer',
                      overflow: 'hidden',
                      background: tokenIconPreview ? 'transparent' : 'rgba(0,0,0,0.3)',
                      position: 'relative'
                    }}
                    onClick={() => document.getElementById('tokenIconInput').click()}
                    >
                      {tokenIconPreview ? (
                        <img
                          src={tokenIconPreview}
                          alt="Token Icon"
                          style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                        />
                      ) : (
                        <div style={{ textAlign: 'center' }}>
                          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#666" strokeWidth="2" style={{ marginBottom: '4px' }}>
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/>
                          </svg>
                          <div style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            color: '#666'
                          }}>
                            UPLOAD ICON
                          </div>
                        </div>
                      )}
                      <input
                        type="file"
                        id="tokenIconInput"
                        accept="image/*"
                        style={{ display: 'none' }}
                        onChange={(e) => {
                          const file = e.target.files?.[0];
                          if (file) {
                            setTokenIcon(file);
                            const reader = new FileReader();
                            reader.onload = (ev) => setTokenIconPreview(ev.target.result);
                            reader.readAsDataURL(file);
                          }
                        }}
                      />
                    </div>
                    {tokenIconPreview && (
                      <button
                        onClick={() => { setTokenIcon(null); setTokenIconPreview(''); }}
                        style={{
                          marginTop: '8px',
                          padding: '6px 12px',
                          background: 'transparent',
                          border: '1px solid #444',
                          color: '#888',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '10px',
                          cursor: 'pointer'
                        }}
                      >
                        REMOVE
                      </button>
                    )}
                  </div>

                  {/* Token Ticker */}
                  <div>
                    <SectionHeader
                      title="TOKEN TICKER"
                      tooltip="The ticker symbol for your token (e.g., QUIET, IRON, FORM). Max 10 characters. If left blank, we'll generate one from your culture name."
                    />
                    <input
                      type="text"
                      value={tokenTicker}
                      onChange={(e) => setTokenTicker(e.target.value.replace(/[^a-zA-Z0-9]/g, '').slice(0, 8))}
                      placeholder={cultureName ? cultureName.replace(/[^a-zA-Z0-9]/g, '').slice(0, 8) || 'TICKER' : 'TICKER'}
                      style={{
                        width: '100%',
                        padding: '16px',
                        background: '#111',
                        border: '1px solid #333',
                        color: '#fff',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '24px',
                        fontWeight: 600,
                        letterSpacing: '0.2em',
                        textAlign: 'center',
                        outline: 'none'
                      }}
                    />
                    <p style={{
                      marginTop: '8px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '11px',
                      color: '#666'
                    }}>
                      Your token will be: ${tokenTicker || (cultureName ? cultureName.toUpperCase().replace(/[^A-Z]/g, '').slice(0, 6) : 'TICKER')}
                    </p>
                  </div>
                </div>

                {/* Category Selector */}
                <div style={{ marginTop: '24px' }}>
                  <SectionHeader
                    title="CATEGORY"
                    tooltip="Select the category that best describes your culture coin. This helps users discover your token."
                  />
                  <div style={{
                    display: 'flex',
                    flexWrap: 'wrap',
                    gap: '8px'
                  }}>
                    {CATEGORIES.map(cat => (
                      <button
                        key={cat.id}
                        onClick={() => setCategory(cat.id)}
                        style={{
                          padding: '10px 14px',
                          background: category === cat.id ? 'rgba(139,92,246,0.2)' : '#111',
                          border: category === cat.id ? '2px solid #8b5cf6' : '1px solid #333',
                          borderRadius: '20px',
                          color: category === cat.id ? '#8b5cf6' : '#888',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '12px',
                          cursor: 'pointer',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '6px',
                          transition: 'all 0.2s'
                        }}
                      >
                        <span>{cat.name}</span>
                      </button>
                    ))}
                  </div>
                </div>

                {/* Dev Buy Slider */}
                <div style={{ marginTop: '32px', paddingTop: '24px', borderTop: '1px solid rgba(255,255,255,0.1)' }}>
                  <SectionHeader
                    title="INITIAL DEV BUY"
                    tooltip="Buy tokens at launch to seed initial liquidity. This SOL will be used to purchase your own tokens when the coin is created. (0-5 SOL)"
                  />
                  <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                    <input
                      type="range"
                      min="0"
                      max="5"
                      step="0.1"
                      value={devBuyAmount}
                      onChange={(e) => setDevBuyAmount(parseFloat(e.target.value))}
                      style={{
                        flex: 1,
                        height: '6px',
                        WebkitAppearance: 'none',
                        appearance: 'none',
                        background: `linear-gradient(to right, #8b5cf6 0%, #8b5cf6 ${devBuyAmount * 20}%, #333 ${devBuyAmount * 20}%, #333 100%)`,
                        borderRadius: '3px',
                        outline: 'none',
                        cursor: 'pointer'
                      }}
                    />
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}>
                      <input
                        type="number"
                        min="0"
                        max="5"
                        step="0.1"
                        value={devBuyAmount}
                        onChange={(e) => {
                          let val = parseFloat(e.target.value) || 0;
                          if (val < 0) val = 0;
                          if (val > 5) val = 5;
                          setDevBuyAmount(val);
                        }}
                        style={{
                          width: '70px',
                          padding: '10px',
                          background: '#111',
                          border: '1px solid #333',
                          color: '#fff',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '14px',
                          textAlign: 'center',
                          outline: 'none'
                        }}
                      />
                      <span style={{
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '14px',
                        color: '#888'
                      }}>SOL</span>
                    </div>
                  </div>
                  <p style={{
                    marginTop: '8px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    fontSize: '11px',
                    color: '#666'
                  }}>
                    {devBuyAmount > 0
                      ? `You'll spend ${devBuyAmount} SOL to buy tokens at launch`
                      : 'Optional: Buy your own tokens at launch (0-5 SOL)'
                    }
                  </p>
                </div>
              </div>

              {/* Theme Customization Panel */}
              <div style={{
                marginBottom: '60px',
                padding: '32px',
                background: 'rgba(0,0,0,0.5)',
                border: `1px solid ${theme.borderColor}`,
                backdropFilter: 'blur(10px)'
              }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '24px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: theme.textColor
                  }}>
                    Customize Your Page
                  </span>
                  <InfoIcon tooltip="Make your culture page unique! Choose backgrounds, colors, and patterns. This is like your MySpace page - express yourself and attract members who vibe with your aesthetic." />
                </div>

                {/* Background Type */}
                <div style={{ marginBottom: '24px' }}>
                  <SectionHeader
                    title="BACKGROUND TYPE"
                    tooltip="Choose how your page looks: Solid (one color), Gradient (two colors blend), Pattern (repeating designs), or Image (upload your own)."
                  />
                  <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                    {['solid', 'gradient', 'pattern', 'image'].map(type => (
                      <button
                        key={type}
                        onClick={() => setTheme({...theme, bgType: type})}
                        style={{
                          padding: '10px 16px',
                          background: theme.bgType === type ? theme.accentColor : '#111',
                          color: theme.bgType === type ? '#000' : '#888',
                          border: '1px solid #333',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '11px',
                          letterSpacing: '0.1em',
                          cursor: 'pointer',
                          textTransform: 'uppercase'
                        }}
                      >
                        {type}
                      </button>
                    ))}
                  </div>
                </div>

                {/* Solid Color */}
                {theme.bgType === 'solid' && (
                  <div style={{ marginBottom: '24px' }}>
                    <SectionHeader title="BACKGROUND COLOR" tooltip="Click the color box to open a color picker, or type a hex code (like #FF5500) directly." />
                    <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>
                      <input
                        type="color"
                        value={theme.bgColor}
                        onChange={(e) => setTheme({...theme, bgColor: e.target.value})}
                        style={{ width: '50px', height: '40px', border: 'none', cursor: 'pointer' }}
                      />
                      <input
                        type="text"
                        value={theme.bgColor}
                        onChange={(e) => setTheme({...theme, bgColor: e.target.value})}
                        style={{
                          padding: '10px',
                          background: '#111',
                          border: '1px solid #333',
                          color: '#fff',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '12px',
                          width: '100px'
                        }}
                      />
                    </div>
                  </div>
                )}

                {/* Gradient */}
                {theme.bgType === 'gradient' && (
                  <div style={{ marginBottom: '24px' }}>
                    <SectionHeader title="GRADIENT COLORS" tooltip="Pick two colors that will smoothly blend together from top-left to bottom-right. Great for creating depth!" />
                    <div style={{ display: 'flex', gap: '16px', alignItems: 'center' }}>
                      <div>
                        <div style={{ fontSize: '9px', color: '#666', marginBottom: '4px' }}>FROM</div>
                        <input
                          type="color"
                          value={theme.bgGradient[0]}
                          onChange={(e) => setTheme({...theme, bgGradient: [e.target.value, theme.bgGradient[1]]})}
                          style={{ width: '50px', height: '40px', border: 'none', cursor: 'pointer' }}
                        />
                      </div>
                      <div>
                        <div style={{ fontSize: '9px', color: '#666', marginBottom: '4px' }}>TO</div>
                        <input
                          type="color"
                          value={theme.bgGradient[1]}
                          onChange={(e) => setTheme({...theme, bgGradient: [theme.bgGradient[0], e.target.value]})}
                          style={{ width: '50px', height: '40px', border: 'none', cursor: 'pointer' }}
                        />
                      </div>
                    </div>
                  </div>
                )}

                {/* Pattern */}
                {theme.bgType === 'pattern' && (
                  <div style={{ marginBottom: '24px' }}>
                    <SectionHeader title="PATTERN STYLE" tooltip="Choose a repeating pattern: Dots, Grid lines, Diagonal stripes, Hearts, or Stars. Pick a base color below." />
                    <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap', marginBottom: '16px' }}>
                      {Object.keys(patterns).map(p => (
                        <button
                          key={p}
                          onClick={() => setTheme({...theme, bgPattern: p})}
                          style={{
                            padding: '10px 16px',
                            background: theme.bgPattern === p ? '#333' : '#111',
                            color: theme.bgPattern === p ? '#fff' : '#666',
                            border: '1px solid #333',
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '11px',
                            cursor: 'pointer',
                            textTransform: 'capitalize'
                          }}
                        >
                          {p}
                        </button>
                      ))}
                    </div>
                    <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>
                      <span style={{ fontSize: '10px', color: '#666' }}>Base Color:</span>
                      <input
                        type="color"
                        value={theme.bgColor}
                        onChange={(e) => setTheme({...theme, bgColor: e.target.value})}
                        style={{ width: '40px', height: '30px', border: 'none', cursor: 'pointer' }}
                      />
                    </div>
                  </div>
                )}

                {/* Image Upload */}
                {theme.bgType === 'image' && (
                  <div style={{ marginBottom: '24px' }}>
                    <SectionHeader title="BACKGROUND IMAGE" tooltip="Upload an image from your computer. It will fill the entire background. Use high-resolution images for best results!" />
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                      <label
                        style={{
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          gap: '12px',
                          padding: '20px',
                          background: '#111',
                          border: '2px dashed #333',
                          cursor: 'pointer',
                          transition: 'all 0.2s ease'
                        }}
                        onMouseOver={(e) => e.currentTarget.style.borderColor = '#555'}
                        onMouseOut={(e) => e.currentTarget.style.borderColor = '#333'}
                      >
                        <input
                          type="file"
                          accept="image/*"
                          onChange={(e) => {
                            const file = e.target.files[0];
                            if (file) {
                              const reader = new FileReader();
                              reader.onload = (event) => {
                                setTheme({...theme, bgImage: event.target.result});
                              };
                              reader.readAsDataURL(file);
                            }
                          }}
                          style={{ display: 'none' }}
                        />
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#666" strokeWidth="2">
                          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                          <polyline points="17 8 12 3 7 8"/>
                          <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <span style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '12px',
                          color: '#888',
                          letterSpacing: '0.05em'
                        }}>
                          {theme.bgImage ? 'CHANGE IMAGE' : 'UPLOAD IMAGE'}
                        </span>
                      </label>
                      {theme.bgImage && (
                        <div style={{ position: 'relative' }}>
                          <img
                            src={theme.bgImage}
                            alt="Background preview"
                            style={{
                              width: '100%',
                              height: '120px',
                              objectFit: 'cover',
                              border: '1px solid #333'
                            }}
                          />
                          <button
                            onClick={() => setTheme({...theme, bgImage: ''})}
                            style={{
                              position: 'absolute',
                              top: '8px',
                              right: '8px',
                              background: 'rgba(0,0,0,0.7)',
                              border: '1px solid #333',
                              color: '#fff',
                              padding: '4px 8px',
                              fontSize: '10px',
                              fontFamily: "'IBM Plex Mono', monospace",
                              cursor: 'pointer'
                            }}
                          >
                            REMOVE
                          </button>
                        </div>
                      )}
                      {/* Image Fit Options */}
                      {theme.bgImage && (
                        <div style={{ marginTop: '12px' }}>
                          <div style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            color: '#666',
                            marginBottom: '8px',
                            letterSpacing: '0.1em'
                          }}>
                            IMAGE FIT
                          </div>
                          <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                            {[
                              { id: 'cover', label: 'Cover', desc: 'Fill area, crop if needed' },
                              { id: 'contain', label: 'Fit', desc: 'Show full image' },
                              { id: 'tile', label: 'Tile', desc: 'Repeat pattern' },
                              { id: 'stretch', label: 'Stretch', desc: 'Stretch to fill' }
                            ].map(fit => (
                              <button
                                key={fit.id}
                                onClick={() => setTheme({...theme, bgImageFit: fit.id})}
                                title={fit.desc}
                                style={{
                                  padding: '8px 14px',
                                  background: theme.bgImageFit === fit.id ? '#8b5cf6' : '#111',
                                  color: theme.bgImageFit === fit.id ? '#000' : '#888',
                                  border: theme.bgImageFit === fit.id ? '1px solid #8b5cf6' : '1px solid #333',
                                  fontFamily: "'IBM Plex Mono', monospace",
                                  fontSize: '11px',
                                  letterSpacing: '0.05em',
                                  cursor: 'pointer',
                                  transition: 'all 0.2s'
                                }}
                              >
                                {fit.label}
                              </button>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {/* Accent & Text Colors */}
                <div style={{ marginBottom: '16px' }}>
                  <SectionHeader title="COLOR SCHEME" tooltip="Accent = buttons & highlights. Text = all text color. Cards = background of content boxes. Borders = lines between sections." />
                </div>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px' }}>
                  <div>
                    <div style={{ fontSize: '9px', letterSpacing: '0.1em', color: '#666', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                      ACCENT
                    </div>
                    <input
                      type="color"
                      value={theme.accentColor}
                      onChange={(e) => setTheme({...theme, accentColor: e.target.value})}
                      style={{ width: '100%', height: '40px', border: 'none', cursor: 'pointer' }}
                    />
                  </div>
                  <div>
                    <div style={{ fontSize: '9px', letterSpacing: '0.1em', color: '#666', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                      TEXT
                    </div>
                    <input
                      type="color"
                      value={theme.textColor}
                      onChange={(e) => setTheme({...theme, textColor: e.target.value})}
                      style={{ width: '100%', height: '40px', border: 'none', cursor: 'pointer' }}
                    />
                  </div>
                  <div>
                    <div style={{ fontSize: '9px', letterSpacing: '0.1em', color: '#666', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                      CARDS
                    </div>
                    <input
                      type="color"
                      value={theme.cardBg}
                      onChange={(e) => setTheme({...theme, cardBg: e.target.value})}
                      style={{ width: '100%', height: '40px', border: 'none', cursor: 'pointer' }}
                    />
                  </div>
                  <div>
                    <div style={{ fontSize: '9px', letterSpacing: '0.1em', color: '#666', marginBottom: '8px', fontFamily: "'IBM Plex Mono', monospace" }}>
                      BORDERS
                    </div>
                    <input
                      type="color"
                      value={theme.borderColor}
                      onChange={(e) => setTheme({...theme, borderColor: e.target.value})}
                      style={{ width: '100%', height: '40px', border: 'none', cursor: 'pointer' }}
                    />
                  </div>
                </div>
              </div>

              {/* Vanity Address Mining Section */}
              <div style={{
                marginBottom: '60px',
                padding: '32px',
                background: 'rgba(0,0,0,0.5)',
                border: `1px solid ${theme.borderColor}`,
                backdropFilter: 'blur(10px)'
              }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '12px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: theme.textColor
                  }}>
                    Culture Address
                  </span>
                  <InfoIcon tooltip="Every token on Solana has a unique address (like 7xKXt...KING). We can mine a custom address that ends in letters you choose! This is purely cosmetic but looks super professional. Longer suffixes take exponentially longer to find." />
                </div>
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#666',
                  marginBottom: '24px'
                }}>
                  Mine a custom vanity address for your culture token (e.g., ending in "KING")
                </div>

                {/* Suffix Input */}
                <div style={{ marginBottom: '24px' }}>
                  <SectionHeader
                    title="VANITY SUFFIX (what your address ends with)"
                    tooltip="Type 1-6 letters (A-Z) or numbers (1-9). Note: Solana addresses don't use 0, O, I, or L. Longer = harder to find. 3 chars = seconds, 4 chars = minutes, 5+ chars = hours or more!"
                  />
                  <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
                    <input
                      type="text"
                      value={vanitySuffix}
                      onChange={(e) => setVanitySuffix(e.target.value.replace(/[^a-zA-Z1-9]/g, '').slice(0, 6))}
                      placeholder="moon"
                      disabled={vanityMining}
                      maxLength={6}
                      style={{
                        flex: 1,
                        padding: '16px',
                        background: '#111',
                        border: '1px solid #333',
                        color: '#fff',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '18px',
                        letterSpacing: '0.2em',
                        textAlign: 'center'
                      }}
                    />
                    {!vanityMining && !vanityResult && (
                      <button
                        onClick={startVanityMining}
                        disabled={!vanitySuffix}
                        style={{
                          padding: '16px 32px',
                          background: vanitySuffix ? theme.accentColor : '#333',
                          color: vanitySuffix ? '#000' : '#666',
                          border: 'none',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '12px',
                          letterSpacing: '0.1em',
                          cursor: vanitySuffix ? 'pointer' : 'not-allowed'
                        }}
                      >
                        START MINING
                      </button>
                    )}
                    {vanityMining && (
                      <button
                        onClick={stopVanityMining}
                        style={{
                          padding: '16px 32px',
                          background: '#ef4444',
                          color: '#fff',
                          border: 'none',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '12px',
                          letterSpacing: '0.1em',
                          cursor: 'pointer'
                        }}
                      >
                        STOP
                      </button>
                    )}
                  </div>
                </div>

                {/* Difficulty Estimate */}
                {vanitySuffix && !vanityMining && !vanityResult && (
                  <div style={{
                    padding: '16px',
                    background: '#0a0a0a',
                    border: '1px solid #222',
                    marginBottom: '24px'
                  }}>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '16px', textAlign: 'center' }}>
                      <div>
                        <div style={{ fontSize: '18px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {estimateVanityDifficulty(vanitySuffix).probability}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>PROBABILITY</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '18px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {estimateVanityDifficulty(vanitySuffix).time}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>EST. TIME</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '18px', color: vanitySuffix.length <= 3 ? '#8b5cf6' : vanitySuffix.length <= 5 ? '#f59e0b' : '#ef4444', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanitySuffix.length <= 3 ? 'EASY' : vanitySuffix.length <= 5 ? 'MEDIUM' : 'HARD'}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>DIFFICULTY</div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Mining Progress */}
                {vanityMining && (
                  <div style={{
                    padding: '24px',
                    background: 'linear-gradient(135deg, #1a1a2e, #0a0a0a)',
                    border: '1px solid #333',
                    marginBottom: '24px'
                  }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '16px',
                      marginBottom: '20px'
                    }}>
                      <div style={{
                        width: '12px',
                        height: '12px',
                        borderRadius: '50%',
                        background: '#8b5cf6',
                        animation: 'pulse 1s infinite'
                      }} />
                      <div style={{
                        fontFamily: "'Playfair Display', serif",
                        fontSize: '20px',
                        color: '#fff'
                      }}>
                        Mining Address ending in "{vanitySuffix}"...
                      </div>
                    </div>

                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px', textAlign: 'center' }}>
                      <div>
                        <div style={{ fontSize: '24px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityProgress.attempts.toLocaleString()}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>ATTEMPTS</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '24px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityProgress.rate.toLocaleString()}/s
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>SPEED</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '24px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityProgress.elapsed}s
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>ELAPSED</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '24px', color: '#f59e0b', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityProgress.estimatedTime}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>EST. TIME</div>
                      </div>
                    </div>

                    {/* Mining Animation Bar */}
                    <div style={{ marginTop: '20px', height: '4px', background: '#222', overflow: 'hidden' }}>
                      <div style={{
                        height: '100%',
                        width: '30%',
                        background: 'linear-gradient(90deg, transparent, #fff, transparent)',
                        animation: 'shimmer 1.5s infinite'
                      }} />
                    </div>
                  </div>
                )}

                {/* Found Result */}
                {vanityResult && (
                  <div style={{
                    padding: '24px',
                    background: 'linear-gradient(135deg, rgba(139,92,246,0.2), rgba(0,0,0,0.5))',
                    border: '1px solid #8b5cf6'
                  }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '12px',
                      marginBottom: '20px'
                    }}>
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" strokeWidth="3">
                        <polyline points="20 6 9 17 4 12"/>
                      </svg>
                      <div style={{
                        fontFamily: "'Playfair Display', serif",
                        fontSize: '20px',
                        color: '#8b5cf6'
                      }}>
                        Address Found!
                      </div>
                    </div>

                    <div style={{
                      padding: '16px',
                      background: '#0a0a0a',
                      border: '1px solid #222',
                      marginBottom: '16px'
                    }}>
                      <div style={{ fontSize: '10px', color: '#666', letterSpacing: '0.1em', marginBottom: '8px' }}>YOUR CULTURE ADDRESS</div>
                      <div style={{
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '14px',
                        color: '#fff',
                        wordBreak: 'break-all'
                      }}>
                        {vanityResult.address.slice(0, -vanitySuffix.length)}
                        <span style={{ color: '#8b5cf6', fontWeight: 'bold' }}>{vanityResult.address.slice(-vanitySuffix.length)}</span>
                      </div>
                    </div>

                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '16px', textAlign: 'center' }}>
                      <div>
                        <div style={{ fontSize: '16px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityResult.attempts.toLocaleString()}
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>TOTAL ATTEMPTS</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '16px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                          {vanityResult.elapsed.toFixed(1)}s
                        </div>
                        <div style={{ fontSize: '9px', color: '#666', letterSpacing: '0.1em', marginTop: '4px' }}>TIME TAKEN</div>
                      </div>
                    </div>

                    <button
                      onClick={() => { setVanityResult(null); setVanitySuffix(''); }}
                      style={{
                        marginTop: '16px',
                        padding: '12px 24px',
                        background: 'transparent',
                        border: '1px solid #333',
                        color: '#888',
                        fontFamily: "'IBM Plex Mono', monospace",
                        fontSize: '11px',
                        cursor: 'pointer'
                      }}
                    >
                      MINE ANOTHER
                    </button>
                  </div>
                )}

                <style>{`
                  @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.5; }
                  }
                  @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(400%); }
                  }
                `}</style>
              </div>

              {/* Section: What This Culture Believes - Editable */}
              <div style={{ marginBottom: '80px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '12px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: '#fff'
                  }}>
                    What We Stand For
                  </span>
                  <InfoIcon tooltip="Your culture's core beliefs! These are the values that unite your community. Members will see these before joining - make them clear and inspiring. Good beliefs attract the right people." />
                </div>
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#666',
                  marginBottom: '32px'
                }}>
                  Define the core beliefs of your culture. <span style={{ color: '#888' }}>(Click any belief to edit, use × to remove)</span>
                </div>

                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                  {beliefs.map((belief, i) => (
                    <div
                      key={i}
                      style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '12px'
                      }}
                    >
                      <span style={{ color: '#444', fontSize: '8px' }}>&#9679;</span>
                      <input
                        type="text"
                        value={belief}
                        onChange={(e) => updateBelief(i, e.target.value)}
                        placeholder="Enter a core belief..."
                        style={{
                          flex: 1,
                          padding: '16px 20px',
                          background: '#0f0f0f',
                          border: '1px solid #1a1a1a',
                          color: '#e0e0e0',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '14px',
                          outline: 'none'
                        }}
                      />
                      {beliefs.length > 1 && (
                        <button
                          onClick={() => removeBelief(i)}
                          style={{
                            padding: '8px 12px',
                            background: 'transparent',
                            border: '1px solid #333',
                            color: '#666',
                            fontSize: '16px',
                            cursor: 'pointer'
                          }}
                        >
                          &times;
                        </button>
                      )}
                    </div>
                  ))}
                </div>

                {beliefs.length < 8 && (
                  <button
                    onClick={addBelief}
                    style={{
                      marginTop: '12px',
                      padding: '12px 20px',
                      background: 'transparent',
                      border: '1px dashed #333',
                      color: '#666',
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '12px',
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      width: '100%'
                    }}
                  >
                    + ADD BELIEF
                  </button>
                )}
              </div>

              {/* Section: What Holding Unlocks - Editable */}
              <div style={{ marginBottom: '80px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '12px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: '#fff'
                  }}>
                    What Participation Unlocks
                  </span>
                  <InfoIcon tooltip="What do members get for holding your token? Think: exclusive content, private chats, early access, IRL events, 1-on-1 time, etc. These are the perks that make holding worthwhile!" />
                </div>
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#666',
                  marginBottom: '32px'
                }}>
                  Define what members get access to. <span style={{ color: '#888' }}>(Add a title and description for each perk)</span>
                </div>

                <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                  {unlocks.map((unlock, i) => (
                    <div
                      key={i}
                      style={{
                        padding: '24px',
                        background: '#0a0a0a',
                        border: '1px solid #1a1a1a'
                      }}
                    >
                      <div style={{ display: 'flex', gap: '12px', marginBottom: '12px', alignItems: 'center' }}>
                        <input
                          type="text"
                          value={unlock.title}
                          onChange={(e) => updateUnlock(i, 'title', e.target.value)}
                          placeholder="Unlock Title"
                          style={{
                            flex: 1,
                            padding: '12px 16px',
                            background: '#111',
                            border: '1px solid #222',
                            color: '#fff',
                            fontFamily: "'Playfair Display', serif",
                            fontSize: '18px',
                            outline: 'none'
                          }}
                        />
                        {unlocks.length > 1 && (
                          <button
                            onClick={() => removeUnlock(i)}
                            style={{
                              padding: '8px 12px',
                              background: 'transparent',
                              border: '1px solid #333',
                              color: '#666',
                              fontSize: '16px',
                              cursor: 'pointer'
                            }}
                          >
                            &times;
                          </button>
                        )}
                      </div>
                      <input
                        type="text"
                        value={unlock.description}
                        onChange={(e) => updateUnlock(i, 'description', e.target.value)}
                        placeholder="Describe what this unlocks..."
                        style={{
                          width: '100%',
                          padding: '12px 16px',
                          background: '#111',
                          border: '1px solid #222',
                          color: '#888',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '13px',
                          outline: 'none'
                        }}
                      />
                    </div>
                  ))}
                </div>

                {unlocks.length < 8 && (
                  <button
                    onClick={addUnlock}
                    style={{
                      marginTop: '16px',
                      padding: '14px 24px',
                      background: 'transparent',
                      border: '1px dashed #333',
                      color: '#666',
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '12px',
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      width: '100%'
                    }}
                  >
                    + ADD UNLOCK
                  </button>
                )}
              </div>

              {/* Section: Define Tiers Based on Holdings */}
              <div style={{ marginBottom: '60px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '12px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: '#fff'
                  }}>
                    Define Tiers
                  </span>
                  <InfoIcon tooltip="Tiers are membership levels based on how much of your token someone holds. Example: 'Observer' might need 0.1% of supply, while 'Steward' needs 5%. Higher tiers get more exclusive access and content!" />
                </div>
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#666',
                  marginBottom: '32px'
                }}>
                  Set holding requirements for each access level. <span style={{ color: '#888' }}>(Enter a name, holding %, and what they can access)</span>
                </div>

                <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                  {tiers.map((tier, i) => (
                    <div
                      key={i}
                      style={{
                        padding: '24px',
                        background: '#0a0a0a',
                        border: '1px solid #1a1a1a'
                      }}
                    >
                      <div style={{ display: 'flex', gap: '16px', marginBottom: '16px', alignItems: 'center' }}>
                        {/* Tier Name */}
                        <input
                          type="text"
                          value={tier.name}
                          onChange={(e) => updateTier(i, 'name', e.target.value)}
                          placeholder="Tier Name"
                          style={{
                            flex: 1,
                            padding: '12px 16px',
                            background: '#111',
                            border: '1px solid #222',
                            color: '#fff',
                            fontFamily: "'Playfair Display', serif",
                            fontSize: '18px',
                            outline: 'none'
                          }}
                        />

                        {/* Holding Percent */}
                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                          <input
                            type="number"
                            value={tier.holdingPercent}
                            onChange={(e) => updateTier(i, 'holdingPercent', parseFloat(e.target.value) || 0)}
                            step="0.1"
                            min="0"
                            max="100"
                            style={{
                              width: '80px',
                              padding: '12px',
                              background: '#111',
                              border: '1px solid #222',
                              color: '#fff',
                              fontFamily: "'IBM Plex Mono', monospace",
                              fontSize: '14px',
                              textAlign: 'center',
                              outline: 'none'
                            }}
                          />
                          <span style={{
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '12px',
                            color: '#666'
                          }}>
                            % of supply
                          </span>
                        </div>

                        {/* Remove Button */}
                        {tiers.length > 2 && (
                          <button
                            onClick={() => removeTier(i)}
                            style={{
                              padding: '8px 12px',
                              background: 'transparent',
                              border: '1px solid #333',
                              color: '#666',
                              fontSize: '16px',
                              cursor: 'pointer'
                            }}
                          >
                            &times;
                          </button>
                        )}
                      </div>

                      {/* Access Description */}
                      <input
                        type="text"
                        value={tier.access}
                        onChange={(e) => updateTier(i, 'access', e.target.value)}
                        placeholder="What does this tier unlock? (e.g., Read-only access, Join discussions)"
                        style={{
                          width: '100%',
                          padding: '12px 16px',
                          background: '#111',
                          border: '1px solid #222',
                          color: '#888',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '13px',
                          outline: 'none'
                        }}
                      />
                    </div>
                  ))}
                </div>

                {/* Add Tier Button */}
                {tiers.length < 6 && (
                  <button
                    onClick={addTier}
                    style={{
                      marginTop: '16px',
                      padding: '14px 24px',
                      background: 'transparent',
                      border: '1px dashed #333',
                      color: '#666',
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '12px',
                      letterSpacing: '0.1em',
                      cursor: 'pointer',
                      width: '100%'
                    }}
                  >
                    + ADD TIER
                  </button>
                )}

                {/* Preview Summary */}
                <div style={{
                  marginTop: '32px',
                  padding: '20px 24px',
                  background: '#0f0f0f',
                  border: '1px solid #1a1a1a'
                }}>
                  <div style={{
                    fontSize: '10px',
                    letterSpacing: '0.15em',
                    color: '#666',
                    marginBottom: '16px',
                    fontFamily: "'IBM Plex Mono', monospace"
                  }}>
                    TIER PREVIEW
                  </div>
                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: '12px' }}>
                    {tiers.filter(t => t.name).map((tier, i) => (
                      <div
                        key={i}
                        style={{
                          padding: '8px 16px',
                          background: '#1a1a1a',
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '11px',
                          color: '#fff'
                        }}
                      >
                        {tier.name} <span style={{ color: '#666' }}>@ {tier.holdingPercent}%</span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Section: Tier Content Panel */}
              <div style={{ marginBottom: '60px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  marginBottom: '12px'
                }}>
                  <span style={{
                    fontFamily: "'Playfair Display', serif",
                    fontSize: '28px',
                    color: '#fff'
                  }}>
                    Tier Content
                  </span>
                  <InfoIcon tooltip="This is where you drop exclusive content for each tier! Click a tier on the left, then add Essays, Live Sessions, or Drops. Higher tiers can see everything from lower tiers too - it's like a VIP access system!" />
                </div>
                <div style={{
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '13px',
                  color: '#666',
                  marginBottom: '32px'
                }}>
                  Drop content for each tier. <span style={{ color: '#888' }}>(Select a tier on the left → add content on the right)</span>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: '200px 1fr', gap: '24px' }}>
                  {/* Left Panel - Tier Selection */}
                  <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '8px'
                  }}>
                    {tiers.filter(t => t.name).map((tier, i) => (
                      <button
                        key={i}
                        onClick={() => setSelectedTierIndex(i)}
                        style={{
                          padding: '16px 20px',
                          background: selectedTierIndex === i ? '#1a1a1a' : '#0a0a0a',
                          border: '1px solid',
                          borderColor: selectedTierIndex === i ? '#444' : '#1a1a1a',
                          color: selectedTierIndex === i ? '#fff' : '#888',
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '16px',
                          textAlign: 'left',
                          cursor: 'pointer',
                          position: 'relative'
                        }}
                      >
                        {tier.name}
                        <div style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '10px',
                          color: '#666',
                          marginTop: '4px'
                        }}>
                          {tier.holdingPercent}% • {tier.content?.length || 0} items
                        </div>
                        {selectedTierIndex === i && (
                          <div style={{
                            position: 'absolute',
                            left: 0,
                            top: '50%',
                            transform: 'translateY(-50%)',
                            width: '3px',
                            height: '24px',
                            background: '#fff'
                          }} />
                        )}
                      </button>
                    ))}
                  </div>

                  {/* Right Panel - Content for Selected Tier */}
                  <div style={{
                    background: '#0a0a0a',
                    border: '1px solid #1a1a1a',
                    padding: '24px',
                    minHeight: '300px'
                  }}>
                    <div style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      marginBottom: '24px'
                    }}>
                      <div>
                        <div style={{
                          fontFamily: "'Playfair Display', serif",
                          fontSize: '20px',
                          color: '#fff',
                          marginBottom: '4px'
                        }}>
                          {tiers[selectedTierIndex]?.name || 'Select Tier'} Content
                        </div>
                        <div style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '11px',
                          color: '#666'
                        }}>
                          Content visible to {tiers[selectedTierIndex]?.name} tier and above
                        </div>
                      </div>
                      <div style={{ display: 'flex', gap: '8px' }}>
                        <button
                          onClick={() => addTierContent(selectedTierIndex, 'essay')}
                          style={{
                            padding: '8px 12px',
                            background: '#111',
                            border: '1px solid #333',
                            color: '#888',
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            cursor: 'pointer'
                          }}
                        >
                          + ESSAY
                        </button>
                        <button
                          onClick={() => addTierContent(selectedTierIndex, 'session')}
                          style={{
                            padding: '8px 12px',
                            background: '#111',
                            border: '1px solid #333',
                            color: '#888',
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            cursor: 'pointer'
                          }}
                        >
                          + SESSION
                        </button>
                        <button
                          onClick={() => addTierContent(selectedTierIndex, 'drop')}
                          style={{
                            padding: '8px 12px',
                            background: '#111',
                            border: '1px solid #333',
                            color: '#888',
                            fontFamily: "'IBM Plex Mono', monospace",
                            fontSize: '10px',
                            cursor: 'pointer'
                          }}
                        >
                          + DROP
                        </button>
                      </div>
                    </div>

                    {/* Content Items */}
                    {tiers[selectedTierIndex]?.content?.length === 0 ? (
                      <div style={{
                        padding: '60px 20px',
                        textAlign: 'center',
                        border: '1px dashed #222'
                      }}>
                        <div style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '13px',
                          color: '#444',
                          marginBottom: '8px'
                        }}>
                          No content yet
                        </div>
                        <div style={{
                          fontFamily: "'IBM Plex Mono', monospace",
                          fontSize: '11px',
                          color: '#333'
                        }}>
                          Add essays, sessions, or drops for this tier
                        </div>
                      </div>
                    ) : (
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                        {tiers[selectedTierIndex]?.content?.map((item, ci) => (
                          <div
                            key={ci}
                            style={{
                              padding: '16px',
                              background: '#111',
                              border: '1px solid #222'
                            }}
                          >
                            <div style={{ display: 'flex', gap: '12px', marginBottom: '12px', alignItems: 'center' }}>
                              <span style={{
                                padding: '4px 8px',
                                background: item.type === 'essay' ? '#1a365d' : item.type === 'session' ? '#322659' : '#1a1a1a',
                                color: item.type === 'essay' ? '#63b3ed' : item.type === 'session' ? '#b794f4' : '#888',
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '9px',
                                letterSpacing: '0.1em',
                                textTransform: 'uppercase'
                              }}>
                                {item.type}
                              </span>
                              <input
                                type="text"
                                value={item.title}
                                onChange={(e) => updateTierContent(selectedTierIndex, ci, 'title', e.target.value)}
                                placeholder="Content title"
                                style={{
                                  flex: 1,
                                  padding: '8px 12px',
                                  background: 'transparent',
                                  border: '1px solid #222',
                                  color: '#fff',
                                  fontFamily: "'IBM Plex Mono', monospace",
                                  fontSize: '13px',
                                  outline: 'none'
                                }}
                              />
                              <button
                                onClick={() => removeTierContent(selectedTierIndex, ci)}
                                style={{
                                  padding: '4px 8px',
                                  background: 'transparent',
                                  border: '1px solid #333',
                                  color: '#666',
                                  fontSize: '14px',
                                  cursor: 'pointer'
                                }}
                              >
                                &times;
                              </button>
                            </div>
                            <input
                              type="text"
                              value={item.description}
                              onChange={(e) => updateTierContent(selectedTierIndex, ci, 'description', e.target.value)}
                              placeholder="Brief description..."
                              style={{
                                width: '100%',
                                padding: '8px 12px',
                                background: 'transparent',
                                border: '1px solid #222',
                                color: '#666',
                                fontFamily: "'IBM Plex Mono', monospace",
                                fontSize: '12px',
                                outline: 'none'
                              }}
                            />
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </div>

              {/* CREATE CULTURE BUTTON */}
              <div style={{
                marginTop: '60px',
                marginBottom: '80px',
                textAlign: 'center'
              }}>
                {/* Wallet Connection Status */}
                {!wallet?.address && (
                  <div style={{
                    marginBottom: '24px',
                    padding: '16px 24px',
                    background: 'rgba(239,68,68,0.1)',
                    border: '1px solid rgba(239,68,68,0.3)',
                    display: 'inline-block'
                  }}>
                    <p style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '12px',
                      color: '#ef4444',
                      margin: 0
                    }}>
                      WALLET REQUIRED - Connect with Privy to create your culture
                    </p>
                  </div>
                )}

                {wallet?.address && (
                  <div style={{
                    marginBottom: '24px',
                    padding: '12px 20px',
                    background: 'rgba(139,92,246,0.1)',
                    border: '1px solid rgba(139,92,246,0.3)',
                    display: 'inline-block'
                  }}>
                    <p style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '11px',
                      color: '#8b5cf6',
                      margin: 0
                    }}>
                      VERIFIED: {wallet.address.slice(0,6)}...{wallet.address.slice(-4)}
                    </p>
                  </div>
                )}

                <div>
                  <button
                    onClick={wallet?.address ? (editMode ? handleUpdate : handleCreate) : () => wallet?.showModal?.()}
                    disabled={isCreating}
                    style={{
                      padding: '20px 60px',
                      background: isCreating ? '#333' : wallet?.address ? (editMode ? '#8b5cf6' : theme.accentColor) : '#666',
                      color: isCreating ? '#666' : wallet?.address ? '#000' : '#999',
                      border: 'none',
                      fontFamily: "'Playfair Display', serif",
                      fontSize: '18px',
                      fontWeight: '500',
                      letterSpacing: '0.05em',
                      cursor: isCreating ? 'not-allowed' : 'pointer',
                      transition: 'all 0.2s ease'
                    }}
                  >
                    {isCreating ? (createStatus || (editMode ? 'UPDATING...' : 'CREATING...')) : wallet?.address ? (editMode ? 'SAVE CHANGES' : 'CREATE CULTURE') : 'CONNECT WALLET'}
                  </button>
                </div>
                {/* Creation status display */}
                {isCreating && createStatus && (
                  <div style={{
                    marginTop: '16px',
                    padding: '12px 20px',
                    background: 'rgba(139,92,246,0.1)',
                    border: '1px solid rgba(139,92,246,0.3)',
                    borderRadius: '6px'
                  }}>
                    <p style={{
                      fontFamily: "'IBM Plex Mono', monospace",
                      fontSize: '13px',
                      color: '#8b5cf6',
                      textAlign: 'center',
                      animation: 'pulse 1.5s infinite'
                    }}>
                      {createStatus}
                    </p>
                  </div>
                )}
                <p style={{
                  marginTop: '16px',
                  fontFamily: "'IBM Plex Mono', monospace",
                  fontSize: '12px',
                  color: '#666'
                }}>
                  {wallet?.address ? 'Your culture will be live on Solana with a real token on pump.fun' : 'Privy wallet connection required for security'}
                </p>
              </div>
              </div>
            </div>
          );
        };

        // Wallet Select Modal Component
        const WalletSelectModal = ({ onClose, onConnect }) => {
          console.log('[WALLET-MODAL] Rendering WalletSelectModal');
          const hasPhantom = typeof window !== 'undefined' && window.solana?.isPhantom;
          const hasSolflare = typeof window !== 'undefined' && window.solflare?.isSolflare;
          console.log('[WALLET-MODAL] hasPhantom:', hasPhantom, 'hasSolflare:', hasSolflare);

          const connectPhantom = async () => {
            console.log('[PHANTOM] Connecting...');
            try {
              const res = await window.solana.connect();
              console.log('[PHANTOM] Connected:', res.publicKey.toString());
              onConnect(res.publicKey.toString(), 'phantom');
              onClose();
            } catch (e) { console.error('[PHANTOM] Error:', e); }
          };

          const connectSolflare = async () => {
            try {
              await window.solflare.connect();
              onConnect(window.solflare.publicKey.toString(), 'solflare');
              onClose();
            } catch (e) { console.error('[SOLFLARE]', e); }
          };

          const connectPrivy = () => {
            console.log('[PRIVY] Opening auth popup...');
            const w = 420, h = 650;
            const left = (screen.width - w) / 2;
            const top = (screen.height - h) / 2;
            const popup = window.open('/auth', 'privy-auth', `width=${w},height=${h},left=${left},top=${top},resizable=yes,scrollbars=yes`);
            console.log('[PRIVY] Popup opened:', popup ? 'success' : 'blocked');
            onClose();
          };

          return (
            <div
              onClick={(e) => e.target === e.currentTarget && onClose()}
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0,0,0,0.85)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                zIndex: 2000
              }}
            >
              <div style={{
                background: '#111',
                border: '1px solid #222',
                maxWidth: '400px',
                width: '90%'
              }}>
                <div style={{
                  padding: '20px 24px',
                  borderBottom: '1px solid #222',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }}>
                  <span style={{ fontFamily: "'Playfair Display', serif", fontSize: '18px', color: '#fff' }}>
                    Connect Wallet
                  </span>
                  <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#666', fontSize: '24px', cursor: 'pointer' }}>
                    &times;
                  </button>
                </div>
                <div style={{ padding: '24px', display: 'flex', flexDirection: 'column', gap: '12px' }}>
                  <p style={{ color: '#666', fontSize: '13px', fontFamily: "'IBM Plex Mono', monospace", marginBottom: '8px', textAlign: 'center' }}>
                    Choose your wallet to connect
                  </p>
                  <button
                    onClick={connectPrivy}
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '14px',
                      padding: '16px 20px',
                      background: 'rgba(139,92,246,0.15)',
                      border: '1px solid rgba(139,92,246,0.3)',
                      color: '#fff',
                      fontSize: '14px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      cursor: 'pointer',
                      width: '100%'
                    }}
                  >
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                      <rect width="24" height="24" rx="6" fill="#8B5CF6"/>
                      <path d="M12 6L18 10V14L12 18L6 14V10L12 6Z" fill="white"/>
                    </svg>
                    <span style={{ flex: 1, textAlign: 'left' }}>Privy</span>
                    <span style={{ fontSize: '10px', color: '#8b5cf6', background: 'rgba(139,92,246,0.15)', padding: '4px 8px' }}>
                      EMBEDDED
                    </span>
                  </button>
                  <button
                    onClick={hasPhantom ? connectPhantom : null}
                    disabled={!hasPhantom}
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '14px',
                      padding: '16px 20px',
                      background: '#0a0a0a',
                      border: '1px solid #222',
                      color: hasPhantom ? '#fff' : '#444',
                      fontSize: '14px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      cursor: hasPhantom ? 'pointer' : 'not-allowed',
                      width: '100%',
                      opacity: hasPhantom ? 1 : 0.5
                    }}
                  >
                    <img src="/website/phantom_icon.png" alt="Phantom" style={{ width: '28px', height: '28px', borderRadius: '6px' }} />
                    <span style={{ flex: 1, textAlign: 'left' }}>Phantom</span>
                    <span style={{ fontSize: '10px', color: hasPhantom ? '#8b5cf6' : '#666' }}>
                      {hasPhantom ? 'DETECTED' : 'NOT INSTALLED'}
                    </span>
                  </button>
                  <button
                    onClick={hasSolflare ? connectSolflare : null}
                    disabled={!hasSolflare}
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '14px',
                      padding: '16px 20px',
                      background: '#0a0a0a',
                      border: '1px solid #222',
                      color: hasSolflare ? '#fff' : '#444',
                      fontSize: '14px',
                      fontFamily: "'IBM Plex Mono', monospace",
                      cursor: hasSolflare ? 'pointer' : 'not-allowed',
                      width: '100%',
                      opacity: hasSolflare ? 1 : 0.5
                    }}
                  >
                    <img src="https://solflare.com/favicon.ico" alt="Solflare" style={{ width: '28px', height: '28px', borderRadius: '6px' }} />
                    <span style={{ flex: 1, textAlign: 'left' }}>Solflare</span>
                    <span style={{ fontSize: '10px', color: hasSolflare ? '#8b5cf6' : '#666' }}>
                      {hasSolflare ? 'DETECTED' : 'NOT INSTALLED'}
                    </span>
                  </button>
                </div>
              </div>
            </div>
          );
        };

        // Wallet Info Modal
        const WalletInfoModal = ({ address, balance, holdings, onClose, onDisconnect }) => (
          <div
            onClick={(e) => e.target === e.currentTarget && onClose()}
            style={{
              position: 'fixed',
              inset: 0,
              background: 'rgba(0,0,0,0.85)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 2000
            }}
          >
            <div style={{
              background: '#111',
              border: '1px solid #222',
              maxWidth: '400px',
              width: '90%'
            }}>
              <div style={{
                padding: '20px 24px',
                borderBottom: '1px solid #222',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }}>
                <span style={{ fontFamily: "'Playfair Display', serif", fontSize: '18px', color: '#fff' }}>
                  Wallet
                </span>
                <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#666', fontSize: '24px', cursor: 'pointer' }}>
                  &times;
                </button>
              </div>
              <div style={{ padding: '24px' }}>
                <div style={{ marginBottom: '24px' }}>
                  <div style={{ fontSize: '11px', color: '#666', fontFamily: "'IBM Plex Mono', monospace", letterSpacing: '0.1em', marginBottom: '8px' }}>
                    ADDRESS
                  </div>
                  <div style={{ fontSize: '14px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace", wordBreak: 'break-all' }}>
                    {address}
                  </div>
                </div>
                <div style={{ marginBottom: '24px' }}>
                  <div style={{ fontSize: '11px', color: '#666', fontFamily: "'IBM Plex Mono', monospace", letterSpacing: '0.1em', marginBottom: '8px' }}>
                    BALANCE
                  </div>
                  <div style={{ fontSize: '24px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                    {balance.toFixed(4)} SOL
                  </div>
                </div>
                <div style={{ marginBottom: '24px' }}>
                  <div style={{ fontSize: '11px', color: '#666', fontFamily: "'IBM Plex Mono', monospace", letterSpacing: '0.1em', marginBottom: '8px' }}>
                    CULTURES JOINED
                  </div>
                  <div style={{ fontSize: '24px', color: '#fff', fontFamily: "'IBM Plex Mono', monospace" }}>
                    {holdings.length}
                  </div>
                </div>
                <button
                  onClick={onDisconnect}
                  style={{
                    width: '100%',
                    padding: '14px',
                    background: 'transparent',
                    border: '1px solid #ef4444',
                    color: '#ef4444',
                    fontSize: '12px',
                    fontFamily: "'IBM Plex Mono', monospace",
                    letterSpacing: '0.1em',
                    cursor: 'pointer'
                  }}
                >
                  DISCONNECT
                </button>
              </div>
            </div>
          </div>
        );

        // Notification Component
        const Notification = ({ message, type, onClose }) => {
          useEffect(() => {
            const timer = setTimeout(onClose, 3000);
            return () => clearTimeout(timer);
          }, []);

          return (
            <div style={{
              position: 'fixed',
              bottom: '24px',
              right: '24px',
              padding: '16px 24px',
              background: type === 'success' ? '#8b5cf6' : type === 'error' ? '#ef4444' : '#fff',
              color: '#000',
              fontFamily: "'IBM Plex Mono', monospace",
              fontSize: '13px',
              zIndex: 3000,
              display: 'flex',
              alignItems: 'center',
              gap: '12px'
            }}>
              {message}
              <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#000', cursor: 'pointer', fontSize: '16px' }}>
                &times;
              </button>
            </div>
          );
        };

        // Main App
        function CultureCoinsApp() {
          const [view, setView] = useState('discover');
          const [selectedCulture, setSelectedCulture] = useState(null);

          // Wallet state
          const [walletAddress, setWalletAddress] = useState(null);
          const [walletBalance, setWalletBalance] = useState(0);
          const [walletType, setWalletType] = useState(null); // 'phantom', 'solflare', or 'privy'
          const [showWalletSelect, setShowWalletSelect] = useState(false);
          const [showWalletInfo, setShowWalletInfo] = useState(false);

          // User holdings (persisted in sessionStorage for demo)
          const [userHoldings, setUserHoldings] = useState(() => {
            const saved = sessionStorage.getItem('cc_holdings');
            return saved ? JSON.parse(saved) : [];
          });

          // Notifications
          const [notification, setNotification] = useState(null);

          const showNotification = (message, type = 'success') => {
            setNotification({ message, type });
          };

          // Save holdings to sessionStorage
          useEffect(() => {
            sessionStorage.setItem('cc_holdings', JSON.stringify(userHoldings));
          }, [userHoldings]);

          // Check for URL parameters on page load (view, show, id)
          useEffect(() => {
            const params = new URLSearchParams(window.location.search);
            const viewParam = params.get('view');
            const showId = params.get('show');

            // Handle view parameter (edit, dashboard, create, etc.)
            if (viewParam) {
              console.log('[APP] View param:', viewParam);
              if (['edit', 'create', 'dashboard', 'discover', 'feed', 'auctions'].includes(viewParam)) {
                setView(viewParam);
                // Don't clear URL for edit (need to keep params)
                if (viewParam !== 'edit') {
                  window.history.replaceState({}, '', '/culture-coins');
                }
              }
            }

            // Handle show parameter (show just-created culture)
            if (showId) {
              // Try to load just-created culture from localStorage
              const justCreated = localStorage.getItem('just_created_culture');
              if (justCreated) {
                try {
                  const culture = JSON.parse(justCreated);
                  if (culture.id === parseInt(showId) || culture.id === showId) {
                    setSelectedCulture(culture);
                    setView('culture');
                    showNotification(`Welcome to ${culture.name}! Your culture is now live.`);
                    // Clear it after showing
                    localStorage.removeItem('just_created_culture');
                    // Clear URL param
                    window.history.replaceState({}, '', '/culture-coins');
                  }
                } catch (e) {
                  console.error('[CULTURE] Error loading just-created:', e);
                }
              }
            }
          }, []);

          // Listen for Privy auth via BroadcastChannel
          useEffect(() => {
            const channel = new BroadcastChannel('launchr-auth');
            channel.onmessage = (e) => {
              if (e.data?.type === 'privy-auth-success' && e.data?.address) {
                handleWalletConnected(e.data.address);
                showNotification('Connected with Privy wallet!');
              }
            };

            window.addEventListener('message', (e) => {
              if (e.data?.type === 'privy-auth-success' && e.data?.address) {
                handleWalletConnected(e.data.address);
                showNotification('Connected with Privy wallet!');
              }
            });

            return () => channel.close();
          }, []);

          const handleWalletConnected = async (address, type = 'privy') => {
            console.log('[WALLET] Connected:', address, 'type:', type);
            setWalletAddress(address);
            setWalletType(type);
            setShowWalletSelect(false);

            // Fetch balance
            try {
              console.log('[BALANCE] Fetching for:', address, 'via', SOLANA_RPC);
              const res = await fetch(SOLANA_RPC, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ jsonrpc: '2.0', id: 1, method: 'getBalance', params: [address] }),
              });
              const data = await res.json();
              console.log('[BALANCE] Response:', data);
              if (data.result?.value !== undefined) {
                const bal = data.result.value / 1e9;
                console.log('[BALANCE] Setting:', bal, 'SOL');
                setWalletBalance(bal);
              } else if (data.error) {
                console.error('[BALANCE] RPC error:', data.error);
              }
            } catch (e) {
              console.error('[BALANCE] Fetch failed:', e);
            }
          };

          const disconnectWallet = () => {
            setWalletAddress(null);
            setWalletBalance(0);
            setWalletType(null);
            setShowWalletInfo(false);
            showNotification('Wallet disconnected');
          };

          const joinCulture = (culture, tier) => {
            if (!walletAddress) {
              setShowWalletSelect(true);
              return;
            }

            const existingIndex = userHoldings.findIndex(h => h.cultureId === culture.id);
            if (existingIndex >= 0) {
              showNotification(`Already a member of ${culture.name}`, 'error');
              return;
            }

            const newHolding = {
              cultureId: culture.id,
              cultureName: culture.name,
              ticker: culture.ticker,
              category: culture.category,
              tier: tier.name,
              percent: tier.percent,
              coins: Math.floor(culture.supply * (tier.percent / 100)),
              joinedAt: Date.now(),
              daysHeld: 0
            };

            setUserHoldings([...userHoldings, newHolding]);
            showNotification(`Joined ${culture.name} as ${tier.name}!`);
          };

          const handleSelectCulture = (culture) => {
            setSelectedCulture(culture);
            setView('culture');
          };

          // Wallet context value
          const walletContextValue = {
            address: walletAddress,
            balance: walletBalance,
            type: walletType, // 'phantom', 'solflare', or 'privy'
            holdings: userHoldings,
            connect: () => {
              console.log('[WALLET] connect() called - showing modal');
              setShowWalletSelect(true);
            },
            showModal: () => setShowWalletInfo(true),
            joinCulture,
            showNotification
          };

          // Sidebar component
          const Sidebar = ({ view, setView }) => {
            const navItems = [
              { id: 'home', label: 'Home', icon: '⌂', action: () => window.location.href = '/' },
              { id: 'leaderboard', label: 'Leaderboard', icon: '◎', action: () => window.location.href = '/launchpad' },
              { id: 'dashboard', label: 'Dashboard', icon: '◈', action: () => window.location.href = '/dashboard' },
              { id: 'guide', label: 'Guide', icon: '◉', action: () => window.location.href = '/guide' },
              { id: 'roadmap', label: 'Roadmap', icon: '◇', action: () => window.location.href = '/roadmap' },
            ];
            const cultureItems = [
              { id: 'discover', label: 'Discover', icon: '◎', action: () => setView('discover'), active: true },
              { id: 'feed', label: 'Feed', icon: '◈', disabled: true, soon: true },
              { id: 'auctions', label: 'Auctions', icon: '◇', disabled: true, soon: true },
            ];
            const creatorItems = [
              { id: 'create', label: 'Create', icon: '◈', disabled: true, soon: true },
              { id: 'mycultures', label: 'My Cultures', icon: '◉', disabled: true, soon: true },
            ];
            const socialItems = [
              { id: 'twitter', label: 'Twitter', icon: '𝕏', href: 'https://twitter.com/laaboratory' },
              { id: 'telegram', label: 'Telegram', icon: '◆', href: 'https://t.me/launchr_sol' },
              { id: 'bot', label: 'Telegram Bot', icon: '◇', href: 'https://t.me/LAUNCHR_V3_BOT' },
            ];

            const renderNavButton = (item, isActive) => {
              const isDisabled = item.disabled;
              const showSoon = item.soon;

              return (
                <button
                  key={item.id}
                  onClick={isDisabled ? undefined : item.action}
                  disabled={isDisabled}
                  style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '10px',
                    width: '100%',
                    padding: '10px 12px',
                    background: isActive && !isDisabled ? 'rgba(139, 92, 246, 0.1)' : 'transparent',
                    border: 'none',
                    borderRadius: '6px',
                    color: isDisabled ? 'rgba(139, 92, 246, 0.3)' : (isActive ? '#8b5cf6' : 'rgba(139, 92, 246, 0.6)'),
                    fontSize: '13px',
                    cursor: isDisabled ? 'default' : 'pointer',
                    textAlign: 'left',
                    marginBottom: '4px',
                    transition: 'all 0.2s',
                    textShadow: isActive && !isDisabled ? '0 0 10px rgba(139, 92, 246, 0.4)' : 'none',
                    pointerEvents: isDisabled ? 'none' : 'auto'
                  }}
                  onMouseEnter={(e) => {
                    if (!isActive && !isDisabled) {
                      e.target.style.color = '#8b5cf6';
                      e.target.style.textShadow = '0 0 10px rgba(139, 92, 246, 0.3)';
                    }
                  }}
                  onMouseLeave={(e) => {
                    if (!isActive && !isDisabled) {
                      e.target.style.color = 'rgba(139, 92, 246, 0.6)';
                      e.target.style.textShadow = 'none';
                    }
                  }}
                >
                  <span style={{ fontSize: '14px' }}>{item.icon}</span>
                  {item.label}
                  {showSoon && <span style={{ fontSize: '10px', color: 'rgba(139, 92, 246, 0.4)', marginLeft: 'auto' }}>(soon)</span>}
                </button>
              );
            };

            return (
              <div style={{
                position: 'fixed',
                left: 0,
                top: '76px',
                bottom: 0,
                width: '200px',
                background: '#0a0a0a',
                borderRight: '1px solid #1a1a1a',
                padding: '24px 0',
                display: 'flex',
                flexDirection: 'column',
                zIndex: 100,
                fontFamily: "'IBM Plex Mono', monospace"
              }}>
                {/* Navigation */}
                <div style={{ padding: '0 16px', marginBottom: '24px' }}>
                  <div style={{ fontSize: '10px', color: '#444', letterSpacing: '0.1em', marginBottom: '12px' }}>NAVIGATION</div>
                  {navItems.map(item => renderNavButton(item, false))}
                </div>

                {/* Culture Coins */}
                <div style={{ padding: '0 16px', marginBottom: '24px' }}>
                  <div style={{ fontSize: '10px', color: '#444', letterSpacing: '0.1em', marginBottom: '12px' }}>CULTURE COINS</div>
                  {cultureItems.map(item => renderNavButton(item, item.id === 'discover' && view === 'discover'))}
                </div>

                {/* Creator Central */}
                <div style={{ padding: '0 16px', marginBottom: '24px' }}>
                  <div style={{ fontSize: '10px', color: '#444', letterSpacing: '0.1em', marginBottom: '12px' }}>CREATOR CENTRAL</div>
                  {creatorItems.map(item => renderNavButton(item, false))}
                </div>

                {/* Resources */}
                <div style={{ padding: '0 16px', marginTop: 'auto' }}>
                  <div style={{ fontSize: '10px', color: '#444', letterSpacing: '0.1em', marginBottom: '12px' }}>RESOURCES</div>
                  {socialItems.map(item => (
                    <a
                      key={item.id}
                      href={item.href}
                      target="_blank"
                      rel="noopener noreferrer"
                      style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '10px',
                        padding: '10px 12px',
                        color: 'rgba(139, 92, 246, 0.6)',
                        fontSize: '12px',
                        textDecoration: 'none',
                        marginBottom: '4px',
                        borderRadius: '6px',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={(e) => {
                        e.target.style.color = '#8b5cf6';
                        e.target.style.textShadow = '0 0 10px rgba(139, 92, 246, 0.3)';
                      }}
                      onMouseLeave={(e) => {
                        e.target.style.color = 'rgba(139, 92, 246, 0.6)';
                        e.target.style.textShadow = 'none';
                      }}
                    >
                      <span style={{ fontSize: '14px' }}>{item.icon}</span>
                      {item.label}
                    </a>
                  ))}
                </div>
              </div>
            );
          };

          return (
            <WalletContext.Provider value={walletContextValue}>
              <div style={{ minHeight: '100vh', background: '#0a0a0a', color: '#fff' }}>
                <Navigation view={view} setView={(v) => { setView(v); setSelectedCulture(null); }} />
                <Sidebar view={view} setView={(v) => { setView(v); setSelectedCulture(null); }} />

                <div style={{ marginLeft: '200px' }}>
                  {view === 'discover' && <DiscoveryView onSelectCulture={handleSelectCulture} />}
                  {view === 'feed' && <FeedView onSelectCulture={handleSelectCulture} />}
                  {view === 'create' && <CreateCulturePage />}
                  {view === 'edit' && <CreateCulturePage editMode={true} />}
                  {view === 'culture' && selectedCulture && (
                    <CulturePage
                      culture={selectedCulture}
                      onBack={() => { setView('discover'); setSelectedCulture(null); }}
                    />
                  )}
                  {view === 'auctions' && <AuctionsView />}
                  {view === 'dashboard' && <DashboardView />}
                </div>

                {/* Modals */}
                {showWalletSelect && (
                  <WalletSelectModal
                    onClose={() => setShowWalletSelect(false)}
                    onConnect={handleWalletConnected}
                  />
                )}
                {showWalletInfo && walletAddress && (
                  <WalletInfoModal
                    address={walletAddress}
                    balance={walletBalance}
                    holdings={userHoldings}
                    onClose={() => setShowWalletInfo(false)}
                    onDisconnect={disconnectWallet}
                  />
                )}

                {/* Notification */}
                {notification && (
                  <Notification
                    message={notification.message}
                    type={notification.type}
                    onClose={() => setNotification(null)}
                  />
                )}
              </div>
            </WalletContext.Provider>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CultureCoinsApp />);
    </script>
</body>
</html>
